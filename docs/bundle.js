!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";function r(){}n.r(e);function o(t){return t()}function i(){return Object.create(null)}function c(t){t.forEach(o)}function a(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t){return 0===Object.keys(t).length}function u(t,...e){if(null==t)return r;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function d(t,e,n){t.$$.on_destroy.push(u(e,n))}new Set;let f=!1;function m(t,e,n,r){for(;t<e;){const o=t+(e-t>>1);n(o)<=r?t=o+1:e=o}return t}function p(t,e){f?(!function(t){if(t.hydrate_init)return;t.hydrate_init=!0;const e=t.childNodes,n=new Int32Array(e.length+1),r=new Int32Array(e.length);n[0]=-1;let o=0;for(let t=0;t<e.length;t++){const i=m(1,o+1,t=>e[n[t]].claim_order,e[t].claim_order)-1;r[t]=n[i]+1;const c=i+1;n[c]=t,o=Math.max(c,o)}const i=[],c=[];let a=e.length-1;for(let t=n[o]+1;0!=t;t=r[t-1]){for(i.push(e[t-1]);a>=t;a--)c.push(e[a]);a--}for(;a>=0;a--)c.push(e[a]);i.reverse(),c.sort((t,e)=>t.claim_order-e.claim_order);for(let e=0,n=0;e<c.length;e++){for(;n<i.length&&c[e].claim_order>=i[n].claim_order;)n++;const r=n<i.length?i[n]:null;t.insertBefore(c[e],r)}}(t),(void 0===t.actual_end_child||null!==t.actual_end_child&&t.actual_end_child.parentElement!==t)&&(t.actual_end_child=t.firstChild),e!==t.actual_end_child?t.insertBefore(e,t.actual_end_child):t.actual_end_child=e.nextSibling):e.parentNode!==t&&t.appendChild(e)}function h(t,e,n){f&&!n?p(t,e):(e.parentNode!==t||n&&e.nextSibling!==n)&&t.insertBefore(e,n||null)}function g(t){t.parentNode.removeChild(t)}function $(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function y(){return v(" ")}function k(){return v("")}function w(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function x(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function C(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function S(t,e){t.value=null==e?"":e}function _(t,e,n){t.classList[n?"add":"remove"](e)}function j(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}new Set;let D;function R(t){D=t}function O(){if(!D)throw new Error("Function called outside component initialization");return D}function E(t){O().$$.on_mount.push(t)}function M(){const t=O();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const o=j(e,n);r.slice().forEach(e=>{e.call(t,o)})}}}const T=[],N=[],A=[],L=[],I=Promise.resolve();let P=!1;function B(){P||(P=!0,I.then(F))}function U(t){A.push(t)}let q=!1;const J=new Set;function F(){if(!q){q=!0;do{for(let t=0;t<T.length;t+=1){const e=T[t];R(e),H(e.$$)}for(R(null),T.length=0;N.length;)N.pop()();for(let t=0;t<A.length;t+=1){const e=A[t];J.has(e)||(J.add(e),e())}A.length=0}while(T.length);for(;L.length;)L.pop()();P=!1,q=!1,J.clear()}}function H(t){if(null!==t.fragment){t.update(),c(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(U)}}const z=new Set;let V;function W(){V={r:0,c:[],p:V}}function X(){V.r||c(V.c),V=V.p}function G(t,e){t&&t.i&&(z.delete(t),t.i(e))}function K(t,e,n,r){if(t&&t.o){if(z.has(t))return;z.add(t),V.c.push(()=>{z.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);let Q;function Y(t){t&&t.c()}function Z(t,e,n,r){const{fragment:i,on_mount:s,on_destroy:l,after_update:u}=t.$$;i&&i.m(e,n),r||U(()=>{const e=s.map(o).filter(a);l?l.push(...e):c(e),t.$$.on_mount=[]}),u.forEach(U)}function tt(t,e){const n=t.$$;null!==n.fragment&&(c(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function et(t,e,n,o,a,s,l=[-1]){const u=D;R(t);const d=t.$$={fragment:null,ctx:null,props:s,update:r,not_equal:a,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:e.context||[]),callbacks:i(),dirty:l,skip_bound:!1};let m=!1;if(d.ctx=n?n(t,e.props||{},(e,n,...r)=>{const o=r.length?r[0]:n;return d.ctx&&a(d.ctx[e],d.ctx[e]=o)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](o),m&&function(t,e){-1===t.$$.dirty[0]&&(T.push(t),B(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),n}):[],d.update(),m=!0,c(d.before_update),d.fragment=!!o&&o(d.ctx),e.target){if(e.hydrate){f=!0;const t=(p=e.target,Array.from(p.childNodes));d.fragment&&d.fragment.l(t),t.forEach(g)}else d.fragment&&d.fragment.c();e.intro&&G(t.$$.fragment),Z(t,e.target,e.anchor,e.customElement),f=!1,F()}var p;R(u)}"function"==typeof HTMLElement&&(Q=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(o).filter(a);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){c(this.$$.on_disconnect)}$destroy(){tt(this,1),this.$destroy=r}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!l(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class nt{$destroy(){tt(this,1),this.$destroy=r}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!l(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const rt=[];function ot(t,e=r){let n;const o=[];function i(e){if(s(t,e)&&(t=e,n)){const e=!rt.length;for(let e=0;e<o.length;e+=1){const n=o[e];n[1](),rt.push(n,t)}if(e){for(let t=0;t<rt.length;t+=2)rt[t][0](rt[t+1]);rt.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(c,a=r){const s=[c,a];return o.push(s),1===o.length&&(n=e(i)||r),c(t),()=>{const t=o.indexOf(s);-1!==t&&o.splice(t,1),0===o.length&&(n(),n=null)}}}}function it(t,e,n){const o=!Array.isArray(t),i=o?[t]:t,s=e.length<2;return{subscribe:ot(n,t=>{let n=!1;const l=[];let d=0,f=r;const m=()=>{if(d)return;f();const n=e(o?l[0]:l,t);s?t(n):f=a(n)?n:r},p=i.map((t,e)=>u(t,t=>{l[e]=t,d&=~(1<<e),n&&m()},()=>{d|=1<<e}));return n=!0,m(),function(){c(p),f()}}).subscribe}}const ct=ot([]),at=t=>{try{return!0===JSON.parse(t)}catch{return!1}},st=ot((()=>{const t=Object.fromEntries(new URLSearchParams(location.search).entries()),e={role:t.role||"both",stream:t.stream||"both",audioVisOnly:at(t.audioVisOnly),manual:at(t.manual),remote:at(t.remote),hideSignaling:at(t.hideSignaling)};return Object.entries(e).map(([t,e])=>({key:t,value:e}))})()),lt=it(st,t=>`${window.location.protocol}//${window.location.host}/?${(t=>{const e=new URLSearchParams;for(let[n,r]of t)e.set(n,r);return e.toString()})(t.map(({key:t,value:e})=>[t,e]))}`),ut=it(st,t=>{const e=Object.fromEntries(t.map(({key:t,value:e})=>[t,e]));let{role:n,stream:r,manual:o,remote:i,hideSignaling:c}=e;const a="recv"!==n,s="call"!==n&&"send"!==n||!1,l="down"!==r||!1,u="up"!==r||!1,d=o&&"no"!==o||!1,f=i&&"no"!==i||!1,m=a?"bob":"alice",p=s?"bob":"alice";return{...e,role:n,stream:r,manual:o,remote:i,hasCaller:a,hasReceiver:s,hasUpstream:l,hasDownstream:u,isManual:d,isRemote:f,hideSignaling:c,to:m,from:p}}),dt=ot({});const ft=t=>(e,n)=>function(t,e,n){const r={name:t,short:e,event:n};ct.update(t=>[...t,r]),dt.update(n=>({...n,[t]:[...n[t]||[],e]}))}(t,e,n);function mt(t,e,n){const r=t.slice();return r[6]=e[n].key,r[7]=e[n].value,r[8]=e,r[9]=n,r}function pt(t){let e,n,r;function o(){t[3].call(e,t[8],t[9])}return{c(){e=b("input"),x(e,"type","text")},m(i,c){h(i,e,c),S(e,t[7]),n||(r=w(e,"input",o),n=!0)},p(n,r){t=n,2&r&&e.value!==t[7]&&S(e,t[7])},d(t){t&&g(e),n=!1,r()}}}function ht(t){let e,n,r;function o(){t[2].call(e,t[8],t[9])}return{c(){e=b("input"),x(e,"type","checkbox")},m(i,c){h(i,e,c),e.checked=t[7],n||(r=w(e,"change",o),n=!0)},p(n,r){t=n,2&r&&(e.checked=t[7])},d(t){t&&g(e),n=!1,r()}}}function gt(t){let e,n,r,o,i,c,a=t[6]+"";function s(t,e){return"boolean"==typeof t[7]?ht:pt}let l=s(t),u=l(t);return{c(){e=b("tr"),n=b("td"),r=v(a),o=y(),i=b("td"),u.c(),c=y()},m(t,a){h(t,e,a),p(e,n),p(n,r),p(e,o),p(e,i),u.m(i,null),p(e,c)},p(t,e){2&e&&a!==(a=t[6]+"")&&C(r,a),l===(l=s(t))&&u?u.p(t,e):(u.d(1),u=l(t),u&&(u.c(),u.m(i,null)))},d(t){t&&g(e),u.d()}}}function $t(t){let e,n,o,i,c,a,s,l,u,d=t[1],f=[];for(let e=0;e<d.length;e+=1)f[e]=gt(mt(t,d,e));return{c(){e=b("details"),n=b("summary"),n.textContent="config",o=y(),i=b("code"),c=b("pre"),a=b("a"),s=v(t[0]),l=y(),u=b("table");for(let t=0;t<f.length;t+=1)f[t].c();x(a,"href",t[0]),x(i,"class","svelte-12ii7jf")},m(t,r){h(t,e,r),p(e,n),p(e,o),p(e,i),p(i,c),p(c,a),p(a,s),p(e,l),p(e,u);for(let t=0;t<f.length;t+=1)f[t].m(u,null)},p(t,[e]){if(1&e&&C(s,t[0]),1&e&&x(a,"href",t[0]),2&e){let n;for(d=t[1],n=0;n<d.length;n+=1){const r=mt(t,d,n);f[n]?f[n].p(r,e):(f[n]=gt(r),f[n].c(),f[n].m(u,null))}for(;n<f.length;n+=1)f[n].d(1);f.length=d.length}},i:r,o:r,d(t){t&&g(e),$(f,t)}}}function bt(t,e,n){let r,o;d(t,lt,t=>n(0,r=t)),d(t,st,t=>n(1,o=t));return[r,o,function(t,e){t[e].value=this.checked,st.set(o)},function(t,e){t[e].value=this.value,st.set(o)}]}var vt=class extends nt{constructor(t){super(),et(this,t,bt,$t,s,{})}};const yt=ot({}),kt=ot({}),wt=ot({});function xt({from:t,offer:e}){yt.update(n=>({...n,[t]:e}))}function Ct({from:t,answer:e}){kt.update(n=>({...n,[t]:e}))}function St({from:t,candidate:e}){wt.update(n=>{const r=n[t]||[];return{...n,[t]:[...r,e]}})}function _t({from:t}){wt.update(e=>({...e,[t]:[]}))}class jt{constructor({to:t,from:e}){this.to=t,this.from=e}connect({url:t}){this.url=t;const e=new WebSocket(t);e.onopen=()=>{this.socket=e,this.socket.onmessage=this.received.bind(this)}}received({data:t}){const e=JSON.parse(t),{[this.to]:n,type:r}=e;console.debug("its for me!",n);const o=this.to;switch(r){case"offer":xt({from:o,offer:n});break;case"answer":Ct({from:o,answer:n});break;case"candidate":St({from:o,candidate:new RTCIceCandidate(n)})}}sendOffer(t){if(t){const e={[this.from]:t,type:"offer"};this.send(e)}}sendAnswer(t){if(t){const e={[this.from]:t,type:"answer"};this.send(e)}}sendCandidate(t){if(t){const e={[this.from]:t,type:"candidate"};this.send(e)}}send(t){if(this.socket){const e=JSON.stringify(t);this.socket.send(e)}}toString(){return`[Signaling Server calling ${this.from} → ${this.to}]`}}const Dt=t=>"string"==typeof t?JSON.parse(t).sdp:"object"==typeof t?t.sdp:void 0,Rt=t=>({type:"offer",sdp:t}),Ot=t=>({type:"answer",sdp:t});function Et(t){let e,n,o,i,c,a,s,l,u=JSON.stringify(t[2],null,4)+"";return{c(){e=b("details"),n=b("summary"),o=v(t[1]),i=y(),c=b("pre"),a=b("code"),s=v(u),x(a,"class","svelte-ubxtzq"),e.open=l=Boolean(t[2])&&t[0]},m(t,r){h(t,e,r),p(e,n),p(n,o),p(e,i),p(e,c),p(c,a),p(a,s)},p(t,[n]){2&n&&C(o,t[1]),4&n&&u!==(u=JSON.stringify(t[2],null,4)+"")&&C(s,u),5&n&&l!==(l=Boolean(t[2])&&t[0])&&(e.open=l)},i:r,o:r,d(t){t&&g(e)}}}function Mt(t,e,n){let{open:r=!0}=e,{summary:o="???"}=e,{data:i}=e;return t.$$set=t=>{"open"in t&&n(0,r=t.open),"summary"in t&&n(1,o=t.summary),"data"in t&&n(2,i=t.data)},[r,o,i]}var Tt=class extends nt{constructor(t){super(),et(this,t,Mt,Et,s,{open:0,summary:1,data:2})}};function Nt(t,e,n){const r=t.slice();return r[23]=e[n],r}function At(t,e,n){const r=t.slice();return r[26]=e[n],r[28]=n,r}function Lt(t){let e,n,r,o,i,c=(t[26].label||"camera "+t[28])+"";function a(){return t[14](t[26])}return{c(){e=b("button"),n=v(c),r=y(),x(e,"class","svelte-2jsuhx")},m(t,c){h(t,e,c),p(e,n),p(e,r),o||(i=w(e,"click",a),o=!0)},p(e,r){t=e,4&r&&c!==(c=(t[26].label||"camera "+t[28])+"")&&C(n,c)},d(t){t&&g(e),o=!1,i()}}}function It(t){let e;return{c(){e=v("✔️")},m(t,n){h(t,e,n)},d(t){t&&g(e)}}}function Pt(t){let e,n,r,o,i,a,s,l,u,d,f,m,$,k,S,_=t[23].name+"",j=t[0]===t[23]&&It();function D(){return t[15](t[23])}function R(){return t[16](t[23])}function O(){return t[17](t[23])}return{c(){e=b("tr"),n=b("td"),j&&j.c(),r=y(),o=b("td"),i=b("button"),a=v(_),s=y(),l=b("td"),u=b("button"),u.textContent="stop",d=y(),f=b("td"),m=b("button"),m.textContent="X",$=y(),x(i,"class","svelte-2jsuhx"),x(u,"class","svelte-2jsuhx"),x(m,"class","svelte-2jsuhx")},m(t,c){h(t,e,c),p(e,n),j&&j.m(n,null),p(e,r),p(e,o),p(o,i),p(i,a),p(e,s),p(e,l),p(l,u),p(e,d),p(e,f),p(f,m),p(e,$),k||(S=[w(i,"click",D),w(u,"click",R),w(m,"click",O)],k=!0)},p(e,r){(t=e)[0]===t[23]?j||(j=It(),j.c(),j.m(n,null)):j&&(j.d(1),j=null),8&r&&_!==(_=t[23].name+"")&&C(a,_)},d(t){t&&g(e),j&&j.d(),k=!1,c(S)}}}function Bt(t){let e,n,r,o,i,c,a,s,l,u,d,f,m,$=t[4].readyState+"";return u=new Tt({props:{summary:"settings",data:t[4].getSettings()}}),f=new Tt({props:{summary:"constraints",data:t[4].getConstraints()}}),{c(){e=b("details"),n=b("summary"),r=v(t[5]),o=y(),i=b("dl"),c=b("dt"),c.textContent="readState",a=b("dd"),s=v($),l=y(),Y(u.$$.fragment),d=y(),Y(f.$$.fragment)},m(t,g){h(t,e,g),p(e,n),p(n,r),p(e,o),p(e,i),p(i,c),p(i,a),p(a,s),p(e,l),Z(u,e,null),p(e,d),Z(f,e,null),m=!0},p(t,e){(!m||32&e)&&C(r,t[5]),(!m||16&e)&&$!==($=t[4].readyState+"")&&C(s,$);const n={};16&e&&(n.data=t[4].getSettings()),u.$set(n);const o={};16&e&&(o.data=t[4].getConstraints()),f.$set(o)},i(t){m||(G(u.$$.fragment,t),G(f.$$.fragment,t),m=!0)},o(t){K(u.$$.fragment,t),K(f.$$.fragment,t),m=!1},d(t){t&&g(e),tt(u),tt(f)}}}function Ut(t){let e,n,r,o,i,a,s,l,u,d,f,m,v,C,S,_,j,D,R=t[2],O=[];for(let e=0;e<R.length;e+=1)O[e]=Lt(At(t,R,e));let E=t[3],M=[];for(let e=0;e<E.length;e+=1)M[e]=Pt(Nt(t,E,e));let T=t[4]&&Bt(t);return{c(){e=b("h5"),e.textContent="upstream",n=y(),r=b("video"),r.innerHTML='<track kind="captions"/>',o=y(),i=b("nav"),a=b("button"),a.textContent="default",s=y(),l=b("button"),l.textContent="noise",u=y(),d=b("br"),f=y();for(let t=0;t<O.length;t+=1)O[t].c();m=y(),v=b("table");for(let t=0;t<M.length;t+=1)M[t].c();C=y(),T&&T.c(),S=k(),x(r,"id","upstream"),r.autoplay="true",x(a,"class","svelte-2jsuhx"),x(l,"class","svelte-2jsuhx"),x(i,"class","svelte-2jsuhx")},m(c,g){h(c,e,g),h(c,n,g),h(c,r,g),t[11](r),h(c,o,g),h(c,i,g),p(i,a),p(i,s),p(i,l),p(i,u),p(i,d),p(i,f);for(let t=0;t<O.length;t+=1)O[t].m(i,null);h(c,m,g),h(c,v,g);for(let t=0;t<M.length;t+=1)M[t].m(v,null);h(c,C,g),T&&T.m(c,g),h(c,S,g),_=!0,j||(D=[w(a,"click",t[12]),w(l,"click",t[13])],j=!0)},p(t,[e]){if(132&e){let n;for(R=t[2],n=0;n<R.length;n+=1){const r=At(t,R,n);O[n]?O[n].p(r,e):(O[n]=Lt(r),O[n].c(),O[n].m(i,null))}for(;n<O.length;n+=1)O[n].d(1);O.length=R.length}if(1801&e){let n;for(E=t[3],n=0;n<E.length;n+=1){const r=Nt(t,E,n);M[n]?M[n].p(r,e):(M[n]=Pt(r),M[n].c(),M[n].m(v,null))}for(;n<M.length;n+=1)M[n].d(1);M.length=E.length}t[4]?T?(T.p(t,e),16&e&&G(T,1)):(T=Bt(t),T.c(),G(T,1),T.m(S.parentNode,S)):T&&(W(),K(T,1,1,()=>{T=null}),X())},i(t){_||(G(T),_=!0)},o(t){K(T),_=!1},d(a){a&&g(e),a&&g(n),a&&g(r),t[11](null),a&&g(o),a&&g(i),$(O,a),a&&g(m),a&&g(v),$(M,a),a&&g(C),T&&T.d(a),a&&g(S),j=!1,c(D)}}}function qt(t,e,n){let r,o,i;const c=M();let a,s,l=[],u=[];async function d(){const t=await function(){let t=Object.assign(document.createElement("canvas"),{width:400,height:300}),e=t.getContext("2d");e.fillRect(0,0,t.width,t.height);let n=e.getImageData(0,0,t.width,t.height);return requestAnimationFrame((function t(){for(var r=0;r<n.data.length;r++)n.data[r++]=n.data[r++]=n.data[r++]=255*Math.random();e.putImageData(n,0,0),requestAnimationFrame(t)})),t.captureStream(60)}();t.name="noise feed",m(t),n(3,u=[...u,t])}async function f(t){const e=await async function(t){const e={video:!t||{deviceId:t}};return await navigator.mediaDevices.getUserMedia(e)}(t);e.name=t?function(t){const e=t&&l.find(({deviceId:e})=>e===t);return e&&e.label}(t):"default webcam",m(e),n(3,u=[...u,e])}function m(t){n(0,s=t),n(1,a.srcObject=t,a),c("stream",t)}function p(t){t.getTracks().forEach(t=>t.stop()),c("stop",t)}function h(t){p(t),n(3,u=[...u.filter(e=>e!=t)]),s===t&&n(0,s=void 0)}async function g(){const t=await navigator.mediaDevices.enumerateDevices();n(2,l=t.filter(({kind:t})=>"videoinput"===t))}E(()=>{g(),navigator.mediaDevices.addEventListener("devicechange",t=>{navigator.mediaDevices.enumerateDevices().then(t=>g())})});return t.$$.update=()=>{1&t.$$.dirty&&n(4,r=s&&s.getTracks()[0]),1&t.$$.dirty&&n(5,o=s&&s.constructor.name),1&t.$$.dirty&&(i=Boolean(s))},[s,a,l,u,r,o,d,f,m,p,h,function(t){N[t?"unshift":"push"](()=>{a=t,n(1,a)})},()=>f(),()=>d(),t=>f(t.deviceId),t=>m(t),t=>p(t),t=>h(t)]}var Jt=class extends nt{constructor(t){super(),et(this,t,qt,Ut,s,{})}};function Ft(t){let e,n,r,o;return e=new Tt({props:{summary:"settings",data:t[1].getSettings()}}),r=new Tt({props:{summary:"constraints",data:t[1].getConstraints()}}),{c(){Y(e.$$.fragment),n=y(),Y(r.$$.fragment)},m(t,i){Z(e,t,i),h(t,n,i),Z(r,t,i),o=!0},p(t,n){const o={};2&n&&(o.data=t[1].getSettings()),e.$set(o);const i={};2&n&&(i.data=t[1].getConstraints()),r.$set(i)},i(t){o||(G(e.$$.fragment,t),G(r.$$.fragment,t),o=!0)},o(t){K(e.$$.fragment,t),K(r.$$.fragment,t),o=!1},d(t){tt(e,t),t&&g(n),tt(r,t)}}}function Ht(t){let e,n,r,o,i,c,a=t[1]&&Ft(t);return{c(){e=b("h5"),e.textContent="downstream",n=y(),r=b("video"),r.innerHTML='<track kind="captions"/>',o=y(),a&&a.c(),i=k(),r.autoplay="true"},m(s,l){h(s,e,l),h(s,n,l),h(s,r,l),t[3](r),h(s,o,l),a&&a.m(s,l),h(s,i,l),c=!0},p(t,[e]){t[1]?a?(a.p(t,e),2&e&&G(a,1)):(a=Ft(t),a.c(),G(a,1),a.m(i.parentNode,i)):a&&(W(),K(a,1,1,()=>{a=null}),X())},i(t){c||(G(a),c=!0)},o(t){K(a),c=!1},d(c){c&&g(e),c&&g(n),c&&g(r),t[3](null),c&&g(o),a&&a.d(c),c&&g(i)}}}function zt(t,e,n){let r,o,{stream:i}=e;return t.$$set=t=>{"stream"in t&&n(2,i=t.stream)},t.$$.update=()=>{4&t.$$.dirty&&n(1,r=i&&i.getTracks()[0]),5&t.$$.dirty&&o&&n(0,o.srcObject=i,o)},[o,r,i,function(t){N[t?"unshift":"push"](()=>{o=t,n(0,o),n(2,i)})}]}var Vt=class extends nt{constructor(t){super(),et(this,t,zt,Ht,s,{stream:2})}};function Wt(t){let e,n,o,i,a,s,l;return{c(){e=b("form"),n=b("input"),o=y(),i=b("code"),a=v(t[0]),x(n,"size","90"),x(n,"placeholder","ws url")},m(r,c){var u;h(r,e,c),p(e,n),S(n,t[1]),h(r,o,c),h(r,i,c),p(i,a),s||(l=[w(n,"input",t[2]),w(e,"submit",(u=Xt,function(t){return t.preventDefault(),u.call(this,t)}))],s=!0)},p(t,[e]){2&e&&n.value!==t[1]&&S(n,t[1]),1&e&&C(a,t[0])},i:r,o:r,d(t){t&&g(e),t&&g(o),t&&g(i),s=!1,c(l)}}}function Xt(){}function Gt(t,e,n){let r,{signalingClient:o}=e;return t.$$set=t=>{"signalingClient"in t&&n(0,o=t.signalingClient)},t.$$.update=()=>{3&t.$$.dirty&&(o.connect({url:r}),window.client=o)},n(1,r=`wss://${window.location.host}/signaling/test`),[o,r,function(){r=this.value,n(1,r)}]}var Kt=class extends nt{constructor(t){super(),et(this,t,Gt,Wt,s,{signalingClient:0})}};function Qt(t,e,n){const r=t.slice();return r[3]=e[n],r}function Yt(t){let e,n,r=t[0],o=[];for(let e=0;e<r.length;e+=1)o[e]=Zt(Qt(t,r,e));const i=t=>K(o[t],1,1,()=>{o[t]=null});return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=k()},m(t,r){for(let e=0;e<o.length;e+=1)o[e].m(t,r);h(t,e,r),n=!0},p(t,n){if(1&n){let c;for(r=t[0],c=0;c<r.length;c+=1){const i=Qt(t,r,c);o[c]?(o[c].p(i,n),G(o[c],1)):(o[c]=Zt(i),o[c].c(),G(o[c],1),o[c].m(e.parentNode,e))}for(W(),c=r.length;c<o.length;c+=1)i(c);X()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)G(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)K(o[t]);n=!1},d(t){$(o,t),t&&g(e)}}}function Zt(t){let e,n,r,o,i,c,a,s,l,u,d,f,m="transceiver "+t[3].mid,$=t[3].mid+"";return d=new Tt({props:{summary:"details",data:t[3],open:!1}}),{c(){e=v(m),n=y(),r=b("table"),o=b("tr"),i=b("th"),i.textContent="mid",c=y(),a=b("td"),s=b("code"),l=v($),u=y(),Y(d.$$.fragment)},m(t,m){h(t,e,m),h(t,n,m),h(t,r,m),p(r,o),p(o,i),p(o,c),p(o,a),p(a,s),p(s,l),h(t,u,m),Z(d,t,m),f=!0},p(t,n){(!f||1&n)&&m!==(m="transceiver "+t[3].mid)&&C(e,m),(!f||1&n)&&$!==($=t[3].mid+"")&&C(l,$);const r={};1&n&&(r.data=t[3]),d.$set(r)},i(t){f||(G(d.$$.fragment,t),f=!0)},o(t){K(d.$$.fragment,t),f=!1},d(t){t&&g(e),t&&g(n),t&&g(r),t&&g(u),tt(d,t)}}}function te(t){let e,n,r,o,i=t[0]&&Yt(t);return{c(){e=b("h5"),e.textContent="transceivers",n=y(),i&&i.c(),r=k()},m(t,c){h(t,e,c),h(t,n,c),i&&i.m(t,c),h(t,r,c),o=!0},p(t,[e]){t[0]?i?(i.p(t,e),1&e&&G(i,1)):(i=Yt(t),i.c(),G(i,1),i.m(r.parentNode,r)):i&&(W(),K(i,1,1,()=>{i=null}),X())},i(t){o||(G(i),o=!0)},o(t){K(i),o=!1},d(t){t&&g(e),t&&g(n),i&&i.d(t),t&&g(r)}}}function ee(t,e,n){let r,o,{peerconnection:i}=e;return E(()=>{const t=setInterval(()=>{r&&n(0,o=r.map(({mid:t,direction:e,currentDirection:n,stopped:r,sender:o,receiver:i})=>{let c={},a={};{let{dtmf:t,track:e,transport:n}=o;c={dtmf:t,track:e,transport:n,parameters:o.getParameters&&o.getParameters()}}{let{dtmf:t,track:e,transport:n}=i;a={dtmf:t,track:e,transport:n,parameters:i.getParameters&&i.getParameters(),csrcs:i.getContributingSources(),ssrcs:i.getSynchronizationSources()}}return{mid:t,direction:e,currentDirection:n,stopped:r,sender:c,receiver:a}}))},1e3);return()=>clearInterval(t)}),t.$$set=t=>{"peerconnection"in t&&n(1,i=t.peerconnection)},t.$$.update=()=>{2&t.$$.dirty&&(r=i&&i.getTransceivers())},[o,i]}var ne=class extends nt{constructor(t){super(),et(this,t,ee,te,s,{peerconnection:1})}};function re(t){let e,n;return e=new Kt({props:{signalingClient:t[23]}}),{c(){Y(e.$$.fragment)},m(t,r){Z(e,t,r),n=!0},p:r,i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){K(e.$$.fragment,t),n=!1},d(t){tt(e,t)}}}function oe(t){let e,n,o;return n=new Jt({}),n.$on("stream",t[36]),n.$on("stop",t[37]),{c(){e=b("article"),Y(n.$$.fragment),x(e,"id","upstream"),x(e,"class","box")},m(t,r){h(t,e,r),Z(n,e,null),o=!0},p:r,i(t){o||(G(n.$$.fragment,t),o=!0)},o(t){K(n.$$.fragment,t),o=!1},d(t){t&&g(e),tt(n)}}}function ie(t){let e,n,r;return n=new Vt({props:{}}),t[38](n),{c(){e=b("article"),Y(n.$$.fragment),x(e,"id","downstream"),x(e,"class","box")},m(t,o){h(t,e,o),Z(n,e,null),r=!0},p(t,e){n.$set({})},i(t){r||(G(n.$$.fragment,t),r=!0)},o(t){K(n.$$.fragment,t),r=!1},d(r){r&&g(e),t[38](null),tt(n)}}}function ce(t){let e;return{c(){e=v("addStream")},m(t,n){h(t,e,n)},d(t){t&&g(e)}}}function ae(t){let e;return{c(){e=v("replaceTrack")},m(t,n){h(t,e,n)},d(t){t&&g(e)}}}function se(t){let e,n,r,o,i,c,a,s=t[17].join(" ")+"";return{c(){e=b("tr"),n=b("th"),n.textContent="events:",r=y(),o=b("td"),i=b("code"),c=b("small"),a=v(s)},m(t,s){h(t,e,s),p(e,n),p(e,r),p(e,o),p(o,i),p(i,c),p(c,a)},p(t,e){131072&e[0]&&s!==(s=t[17].join(" ")+"")&&C(a,s)},d(t){t&&g(e)}}}function le(t){let e,n,r,o,i,c,a,s,l,u=t[13]&&ue(t),d=t[19]&&!t[5].isManual&&de(t),f=t[5].isManual&&fe(t);return{c(){e=b("label"),n=v("1.\n                "),r=b("button"),r.textContent="create offer",o=y(),u&&u.c(),i=y(),d&&d.c(),c=y(),f&&f.c(),a=k()},m(m,g){h(m,e,g),p(e,n),p(e,r),h(m,o,g),u&&u.m(m,g),h(m,i,g),d&&d.m(m,g),h(m,c,g),f&&f.m(m,g),h(m,a,g),s||(l=w(r,"click",t[25]),s=!0)},p(t,e){t[13]?u?u.p(t,e):(u=ue(t),u.c(),u.m(i.parentNode,i)):u&&(u.d(1),u=null),t[19]&&!t[5].isManual?d?d.p(t,e):(d=de(t),d.c(),d.m(c.parentNode,c)):d&&(d.d(1),d=null),t[5].isManual?f?f.p(t,e):(f=fe(t),f.c(),f.m(a.parentNode,a)):f&&(f.d(1),f=null)},d(t){t&&g(e),t&&g(o),u&&u.d(t),t&&g(i),d&&d.d(t),t&&g(c),f&&f.d(t),t&&g(a),s=!1,l()}}}function ue(t){let e,n,r,o,i,a,s,l,u,d,f,m;return{c(){e=b("div"),n=b("textarea"),r=y(),o=b("br"),i=y(),a=b("label"),s=v("2.\n                        "),l=b("button"),l.textContent="setLocalDescription",u=y(),d=b("button"),d.textContent="send offer",x(n,"rows","20"),x(n,"class","svelte-19mjatr"),_(n,"hideSignaling",t[22])},m(c,g){h(c,e,g),p(e,n),S(n,t[13]),p(e,r),p(e,o),p(e,i),p(e,a),p(a,s),p(a,l),p(a,u),p(a,d),f||(m=[w(n,"input",t[42]),w(l,"click",t[43]),w(d,"click",t[27])],f=!0)},p(t,e){8192&e[0]&&S(n,t[13]),4194304&e[0]&&_(n,"hideSignaling",t[22])},d(t){t&&g(e),f=!1,c(m)}}}function de(t){let e,n,r,o,i,a,s,l,u,d;return{c(){e=b("div"),n=b("textarea"),r=y(),o=b("br"),i=y(),a=b("label"),s=v("5.\n                        "),l=b("button"),l.textContent="setRemoteDescription",x(n,"rows","20"),x(n,"class","svelte-19mjatr"),_(n,"hideSignaling",t[22])},m(c,f){h(c,e,f),p(e,n),S(n,t[19]),p(e,r),p(e,o),p(e,i),p(e,a),p(a,s),p(a,l),u||(d=[w(n,"input",t[44]),w(l,"click",t[45])],u=!0)},p(t,e){524288&e[0]&&S(n,t[19]),4194304&e[0]&&_(n,"hideSignaling",t[22])},d(t){t&&g(e),u=!1,c(d)}}}function fe(t){let e,n,r,o,i,a,s,l,u,d,f,m;return{c(){e=b("div"),n=b("strong"),n.textContent="MANUAL ANSWER HERE",r=y(),o=b("textarea"),i=y(),a=b("br"),s=y(),l=b("label"),u=v("5.\n                        "),d=b("button"),d.textContent="setRemoteDescription",x(o,"rows","20"),x(o,"class","svelte-19mjatr")},m(c,g){h(c,e,g),p(e,n),p(e,r),p(e,o),S(o,t[16]),p(e,i),p(e,a),p(e,s),p(e,l),p(l,u),p(l,d),f||(m=[w(o,"input",t[46]),w(d,"click",t[47])],f=!0)},p(t,e){65536&e[0]&&S(o,t[16])},d(t){t&&g(e),f=!1,c(m)}}}function me(t){let e,n,r,o=t[18]&&!t[5].isManual&&pe(t),i=t[5].isManual&&he(t),c=t[14]&&t[18]&&ge(t);return{c(){o&&o.c(),e=y(),i&&i.c(),n=y(),c&&c.c(),r=k()},m(t,a){o&&o.m(t,a),h(t,e,a),i&&i.m(t,a),h(t,n,a),c&&c.m(t,a),h(t,r,a)},p(t,a){t[18]&&!t[5].isManual?o?o.p(t,a):(o=pe(t),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),t[5].isManual?i?i.p(t,a):(i=he(t),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null),t[14]&&t[18]?c?c.p(t,a):(c=ge(t),c.c(),c.m(r.parentNode,r)):c&&(c.d(1),c=null)},d(t){o&&o.d(t),t&&g(e),i&&i.d(t),t&&g(n),c&&c.d(t),t&&g(r)}}}function pe(t){let e,n,r,o,i,a,s,l,u,d,f,m;return{c(){e=b("div"),n=b("textarea"),r=y(),o=b("br"),i=y(),a=b("label"),s=v("3.\n                        "),l=b("button"),l.textContent="setRemoteDescription",u=y(),d=b("button"),d.textContent="create answer",x(n,"rows","20"),x(n,"class","svelte-19mjatr"),_(n,"hideSignaling",t[22])},m(c,g){h(c,e,g),p(e,n),S(n,t[18]),p(e,r),p(e,o),p(e,i),p(e,a),p(a,s),p(a,l),p(a,u),p(a,d),f||(m=[w(n,"input",t[48]),w(l,"click",t[49]),w(d,"click",t[26])],f=!0)},p(t,e){262144&e[0]&&S(n,t[18]),4194304&e[0]&&_(n,"hideSignaling",t[22])},d(t){t&&g(e),f=!1,c(m)}}}function he(t){let e,n,r,o,i,a,s,l,u,d,f,m,$,k;return{c(){e=b("div"),n=b("strong"),n.textContent="MANUAL OFFER HERE",r=y(),o=b("textarea"),i=y(),a=b("br"),s=y(),l=b("label"),u=v("3.\n                        "),d=b("button"),d.textContent="setRemoteDescription",f=y(),m=b("button"),m.textContent="create answer",x(o,"rows","20"),x(o,"class","svelte-19mjatr")},m(c,g){h(c,e,g),p(e,n),p(e,r),p(e,o),S(o,t[15]),p(e,i),p(e,a),p(e,s),p(e,l),p(l,u),p(l,d),p(l,f),p(l,m),$||(k=[w(o,"input",t[50]),w(d,"click",t[51]),w(m,"click",t[26])],$=!0)},p(t,e){32768&e[0]&&S(o,t[15])},d(t){t&&g(e),$=!1,c(k)}}}function ge(t){let e,n,r,o,i,a,s,l,u,d,f,m;return{c(){e=b("div"),n=b("textarea"),r=y(),o=b("br"),i=y(),a=b("label"),s=v("4.\n                        "),l=b("button"),l.textContent="setLocalDescription",u=y(),d=b("button"),d.textContent="send answer",x(n,"rows","20"),x(n,"class","svelte-19mjatr"),_(n,"hideSignaling",t[22])},m(c,g){h(c,e,g),p(e,n),S(n,t[14]),p(e,r),p(e,o),p(e,i),p(e,a),p(a,s),p(a,l),p(a,u),p(a,d),f||(m=[w(n,"input",t[52]),w(l,"click",t[53]),w(d,"click",t[28])],f=!0)},p(t,e){16384&e[0]&&S(n,t[14]),4194304&e[0]&&_(n,"hideSignaling",t[22])},d(t){t&&g(e),f=!1,c(m)}}}function $e(t){let e,n,r;return{c(){e=b("textarea"),x(e,"rows","10"),x(e,"class","svelte-19mjatr"),_(e,"hideSignaling",t[22])},m(o,i){h(o,e,i),S(e,t[20]),n||(r=w(e,"input",t[54]),n=!0)},p(t,n){1048576&n[0]&&S(e,t[20]),4194304&n[0]&&_(e,"hideSignaling",t[22])},d(t){t&&g(e),n=!1,r()}}}function be(t){let e,n,r,o,i,c,a,s,l=JSON.stringify(t[21],null,4)+"";return{c(){e=b("label"),e.textContent="injected Candidates",n=y(),r=b("textarea"),o=y(),i=b("pre"),c=v(l),x(e,"for","injectedCandidates"),x(r,"name","injectedCandidates"),x(r,"rows","20"),x(r,"class","svelte-19mjatr")},m(l,u){h(l,e,u),h(l,n,u),h(l,r,u),S(r,t[4]),h(l,o,u),h(l,i,u),p(i,c),a||(s=w(r,"input",t[55]),a=!0)},p(t,e){16&e[0]&&S(r,t[4]),2097152&e[0]&&l!==(l=JSON.stringify(t[21],null,4)+"")&&C(c,l)},d(t){t&&g(e),t&&g(n),t&&g(r),t&&g(o),t&&g(i),a=!1,s()}}}function ve(t){let e,n,r,o,i,a,s,l,u,d,f,m,$,k,S,_,j,D,R,O,E,M,T,N,A,L,I,P,B,U,q,J,F,H,z,V,Q,et,nt,rt,ot,it,ct,at,st,lt,ut,dt,ft,mt,pt,ht,gt,$t,bt,vt,yt,kt,wt,xt,Ct,St,_t,jt=t[5].isRemote&&re(t),Dt=t[5].hasUpstream&&oe(t),Rt=t[5].hasDownstream&&ie(t);function Ot(t,e){return t[8]?ae:ce}let Et=Ot(t),Mt=Et(t);R=new ne({props:{name:t[2],peerconnection:t[7]}});let Tt=!t[22]&&se(t),Nt=t[0]&&le(t),At=t[1]&&me(t),Lt=(t[20].length||t[5].isManual)&&$e(t),It=t[5].isManual&&be(t);return{c(){e=b("section"),n=b("h3"),r=v(t[2]),o=y(),i=b("small"),a=v("talking to "),s=v(t[3]),l=y(),jt&&jt.c(),u=y(),Dt&&Dt.c(),d=y(),Rt&&Rt.c(),f=y(),m=b("article"),$=b("h5"),$.textContent="streams",k=y(),S=b("button"),Mt.c(),j=y(),D=b("article"),Y(R.$$.fragment),O=y(),E=b("article"),M=b("h5"),M.textContent="signaling",T=y(),N=b("div"),A=b("table"),L=b("tr"),I=b("th"),I.textContent="signaling:",P=y(),B=b("td"),U=b("code"),q=v(t[10]),J=y(),F=b("tr"),H=b("th"),H.textContent="connection:",z=y(),V=b("td"),Q=b("code"),et=v(t[11]),nt=y(),rt=b("tr"),ot=b("th"),ot.textContent="ice:",it=y(),ct=b("td"),at=b("code"),st=v(t[12]),lt=y(),Tt&&Tt.c(),ut=y(),dt=b("div"),ft=b("span"),mt=b("label"),pt=b("input"),ht=v("\n                    caller"),gt=y(),$t=b("label"),bt=b("input"),vt=v("\n                    receiver"),yt=y(),Nt&&Nt.c(),kt=y(),At&&At.c(),wt=y(),Lt&&Lt.c(),xt=y(),It&&It.c(),S.disabled=_=!Boolean(t[9]),x(m,"class","box"),x(D,"class","box"),x(A,"class","vertical"),x(N,"class","box"),x(pt,"type","checkbox"),x(bt,"type","checkbox"),x(dt,"class","box"),x(E,"class","box")},m(c,g){h(c,e,g),p(e,n),p(n,r),p(n,o),p(n,i),p(i,a),p(i,s),p(e,l),jt&&jt.m(e,null),p(e,u),Dt&&Dt.m(e,null),p(e,d),Rt&&Rt.m(e,null),p(e,f),p(e,m),p(m,$),p(m,k),p(m,S),Mt.m(S,null),p(e,j),p(e,D),Z(R,D,null),p(e,O),p(e,E),p(E,M),p(E,T),p(E,N),p(N,A),p(A,L),p(L,I),p(L,P),p(L,B),p(B,U),p(U,q),p(A,J),p(A,F),p(F,H),p(F,z),p(F,V),p(V,Q),p(Q,et),p(A,nt),p(A,rt),p(rt,ot),p(rt,it),p(rt,ct),p(ct,at),p(at,st),p(A,lt),Tt&&Tt.m(A,null),p(E,ut),p(E,dt),p(dt,ft),p(ft,mt),p(mt,pt),pt.checked=t[0],p(mt,ht),p(ft,gt),p(ft,$t),p($t,bt),bt.checked=t[1],p($t,vt),p(E,yt),Nt&&Nt.m(E,null),p(E,kt),At&&At.m(E,null),p(E,wt),Lt&&Lt.m(E,null),p(E,xt),It&&It.m(E,null),Ct=!0,St||(_t=[w(S,"click",t[39]),w(pt,"change",t[40]),w(bt,"change",t[41])],St=!0)},p(t,n){(!Ct||4&n[0])&&C(r,t[2]),(!Ct||8&n[0])&&C(s,t[3]),t[5].isRemote?jt?(jt.p(t,n),32&n[0]&&G(jt,1)):(jt=re(t),jt.c(),G(jt,1),jt.m(e,u)):jt&&(W(),K(jt,1,1,()=>{jt=null}),X()),t[5].hasUpstream?Dt?(Dt.p(t,n),32&n[0]&&G(Dt,1)):(Dt=oe(t),Dt.c(),G(Dt,1),Dt.m(e,d)):Dt&&(W(),K(Dt,1,1,()=>{Dt=null}),X()),t[5].hasDownstream?Rt?(Rt.p(t,n),32&n[0]&&G(Rt,1)):(Rt=ie(t),Rt.c(),G(Rt,1),Rt.m(e,f)):Rt&&(W(),K(Rt,1,1,()=>{Rt=null}),X()),Et!==(Et=Ot(t))&&(Mt.d(1),Mt=Et(t),Mt&&(Mt.c(),Mt.m(S,null))),(!Ct||512&n[0]&&_!==(_=!Boolean(t[9])))&&(S.disabled=_);const o={};4&n[0]&&(o.name=t[2]),128&n[0]&&(o.peerconnection=t[7]),R.$set(o),(!Ct||1024&n[0])&&C(q,t[10]),(!Ct||2048&n[0])&&C(et,t[11]),(!Ct||4096&n[0])&&C(st,t[12]),t[22]?Tt&&(Tt.d(1),Tt=null):Tt?Tt.p(t,n):(Tt=se(t),Tt.c(),Tt.m(A,null)),1&n[0]&&(pt.checked=t[0]),2&n[0]&&(bt.checked=t[1]),t[0]?Nt?Nt.p(t,n):(Nt=le(t),Nt.c(),Nt.m(E,kt)):Nt&&(Nt.d(1),Nt=null),t[1]?At?At.p(t,n):(At=me(t),At.c(),At.m(E,wt)):At&&(At.d(1),At=null),t[20].length||t[5].isManual?Lt?Lt.p(t,n):(Lt=$e(t),Lt.c(),Lt.m(E,xt)):Lt&&(Lt.d(1),Lt=null),t[5].isManual?It?It.p(t,n):(It=be(t),It.c(),It.m(E,null)):It&&(It.d(1),It=null)},i(t){Ct||(G(jt),G(Dt),G(Rt),G(R.$$.fragment,t),Ct=!0)},o(t){K(jt),K(Dt),K(Rt),K(R.$$.fragment,t),Ct=!1},d(t){t&&g(e),jt&&jt.d(),Dt&&Dt.d(),Rt&&Rt.d(),Mt.d(),tt(R),Tt&&Tt.d(),Nt&&Nt.d(),At&&At.d(),Lt&&Lt.d(),It&&It.d(),St=!1,c(_t)}}}function ye(t,e,n){let r,o,i,c,a,s,l,u,f,m,p;d(t,dt,t=>n(33,l=t)),d(t,yt,t=>n(34,u=t)),d(t,kt,t=>n(35,f=t)),d(t,ut,t=>n(5,m=t)),d(t,wt,t=>n(56,p=t));let{isCaller:h=!1}=e,{isReceiver:g=!1}=e,{name:$="unnamed participant"}=e,{recipient:b=null}=e;const v=new jt({from:$,to:b}),y=(M(),ft($));let k,w,x,C,S="",_="",j="",D="",R="",O="",T="",A=[],L="",I="plan-b"===new URL(document.location).searchParams.get("semantic")?{sdpSemantics:"plan-b"}:{sdpSemantics:"unified-plan"};function P(){const t=new RTCPeerConnection(I);return t.ontrack=t=>{const{track:e,streams:n,transceiver:r}=t,o=n[0];k.$set({stream:o}),o.onaddtrack=()=>{y("ta","track added"),console.warn($+"track added to stream",{track:e,stream:o})},"video"==e.kind&&(console.info($+".ontrack",{track:e,streams:n,kind:e.kind,transceiver:r}),e.onmute=t=>{y("tm","track muted"),console.info($+" track onmute",{event:t})},e.onunmute=t=>{y("tu","track unmuted"),console.info($+" track onunmute",{event:t})},e.onended=t=>{y("te","track ended"),console.debug($+" track onended",{event:t})})},t.onicecandidate=({candidate:t})=>{y("lc","create candidate"),n(32,A=[...A,t]),function(t){$&&t&&(St({from:$,candidate:t}),m.isRemote&&v.sendCandidate(t))}(t)},t.onsignalingstatechange=e=>n(10,S=t.signalingState),t.onconnectionstatechange=e=>n(11,_=t.connectionState),t.oniceconnectionstatechange=e=>n(12,j=t.iceConnectionState),console.info("setup RTCPeerConnection for "+$,I,t),t}function B(t){x?(y("rt","replace track"),console.info("replace track",{sender:x}),x.replaceTrack(t.getTracks()[0])):(y("at","add track"),console.info("add track"),n(8,x=w.addTrack(t.getTracks()[0],t)))}async function U(){y("o","create offer");const t=await w.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});n(13,D=t.sdp)}async function q(t){y("l","setLocalDescription"),console.debug("localDescription ->",t);const e=t;_t($),w.setLocalDescription(e),F(),_t(b)}function J(t){y("r","setRemoteDescription");const e=Rt(t);w.setRemoteDescription(e),F(),_t(b)}function F(){m.isManual?(a||[]).forEach(t=>{t&&(y("ac","addIceCandidate"),w.addIceCandidate(t))}):(console.debug(p[b]),(p[b]||[]).forEach(t=>{t&&(y("ac","addIceCandidate"),w.addIceCandidate(t))}))}function H(t){y("r","setRemoteDescription");const e=Ot(t);w.setRemoteDescription(e),_t($)}E(()=>{n(7,w=P()),wt.subscribe(({[b]:t})=>{t&&y("rc")}),m.hasCaller&&U()});return t.$$set=t=>{"isCaller"in t&&n(0,h=t.isCaller),"isReceiver"in t&&n(1,g=t.isReceiver),"name"in t&&n(2,$=t.name),"recipient"in t&&n(3,b=t.recipient)},t.$$.update=()=>{4&t.$$.dirty[0]|4&t.$$.dirty[1]&&n(17,r=l[$]||[]),8&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(18,o=Dt(u[b])),8&t.$$.dirty[0]|16&t.$$.dirty[1]&&n(19,i=Dt(f[b])),2&t.$$.dirty[1]&&n(20,c=JSON.stringify(A)),16&t.$$.dirty[0]&&n(21,a=(t=>{try{return JSON.parse(t)}catch(e){return""!==t&&console.warn({parseError:e}),[]}})(L)),32&t.$$.dirty[0]&&n(22,s=m.hideSignaling)},[h,g,$,b,L,m,k,w,x,C,S,_,j,D,R,O,T,r,o,i,c,a,s,v,B,U,async function(){y("a","create answer");const t=await w.createAnswer();n(14,R=t.sdp)},function(){const t=Rt(D);xt({from:$,offer:t}),m.isRemote&&v.sendOffer(t)},function(){const t=Rt(R);Ct({from:$,answer:t}),m.isRemote&&v.sendAnswer(t)},q,J,H,A,l,u,f,({detail:t})=>n(9,C=t),()=>n(9,C=void 0),function(t){N[t?"unshift":"push"](()=>{k=t,n(6,k)})},()=>B(C),function(){h=this.checked,n(0,h)},function(){g=this.checked,n(1,g)},function(){D=this.value,n(13,D)},()=>q(Rt(D)),function(){i=this.value,n(19,i),n(35,f),n(3,b)},()=>H(i),function(){T=this.value,n(16,T)},()=>H(T),function(){o=this.value,n(18,o),n(34,u),n(3,b)},()=>J(o),function(){O=this.value,n(15,O)},()=>J(O),function(){R=this.value,n(14,R)},()=>q(Ot(R)),function(){c=this.value,n(20,c),n(32,A)},function(){L=this.value,n(4,L)}]}var ke=class extends nt{constructor(t){super(),et(this,t,ye,ve,s,{isCaller:0,isReceiver:1,name:2,recipient:3},[-1,-1,-1])}};function we(t,e,n){const r=t.slice();return r[2]=e[n].name,r[3]=e[n].event,r}function xe(t){let e,n,r,o,i,c,a,s,l,u=t[2]+"",d=t[3]+"";return{c(){e=b("tr"),n=b("th"),r=v(u),o=v(":"),i=y(),c=b("td"),a=b("code"),s=v(d),l=y()},m(t,u){h(t,e,u),p(e,n),p(n,r),p(n,o),p(e,i),p(e,c),p(c,a),p(a,s),p(e,l)},p(t,e){1&e&&u!==(u=t[2]+"")&&C(r,u),1&e&&d!==(d=t[3]+"")&&C(s,d)},d(t){t&&g(e)}}}function Ce(t){let e,n,o,i,c,a=t[0].filter(Se),s=[];for(let e=0;e<a.length;e+=1)s[e]=xe(we(t,a,e));return{c(){e=b("section"),n=b("h3"),n.innerHTML="Event Log <small>please open\n        <code>about://webrtc-internals</code></small>",o=y(),i=b("div"),c=b("table");for(let t=0;t<s.length;t+=1)s[t].c();x(c,"class","vertical svelte-111zlyk"),x(i,"class","box")},m(t,r){h(t,e,r),p(e,n),p(e,o),p(e,i),p(i,c);for(let t=0;t<s.length;t+=1)s[t].m(c,null)},p(t,[e]){if(1&e){let n;for(a=t[0].filter(Se),n=0;n<a.length;n+=1){const r=we(t,a,n);s[n]?s[n].p(r,e):(s[n]=xe(r),s[n].c(),s[n].m(c,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=a.length}},i:r,o:r,d(t){t&&g(e),$(s,t)}}}const Se=t=>t.event;function _e(t,e,n){let r;d(t,ct,t=>n(0,r=t));Array(100).fill({name:"hendrik",event:"fun stuff"});return[r]}var je=class extends nt{constructor(t){super(),et(this,t,_e,Ce,s,{})}};function De(t){let e,n;return e=new ke({props:{name:"alice",isCaller:"true",recipient:"bob"}}),{c(){Y(e.$$.fragment)},m(t,r){Z(e,t,r),n=!0},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){K(e.$$.fragment,t),n=!1},d(t){tt(e,t)}}}function Re(t){let e,n;return e=new ke({props:{name:"bob",isReceiver:"true",recipient:"alice"}}),{c(){Y(e.$$.fragment)},m(t,r){Z(e,t,r),n=!0},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){K(e.$$.fragment,t),n=!1},d(t){tt(e,t)}}}function Oe(t){let e,n;return e=new je({}),{c(){Y(e.$$.fragment)},m(t,r){Z(e,t,r),n=!0},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){K(e.$$.fragment,t),n=!1},d(t){tt(e,t)}}}function Ee(t){let e,n,r,o,i,c,a,s,l,u,d=t[0].hasCaller&&De(),f=t[0].hasReceiver&&Re(),m=!t[0].hideSignaling&&Oe();return l=new vt({}),{c(){e=b("div"),n=b("h1"),n.textContent="WebRTC Plumber",r=y(),o=b("main"),d&&d.c(),i=y(),f&&f.c(),c=y(),m&&m.c(),a=y(),s=b("aside"),Y(l.$$.fragment),x(o,"class","svelte-1mx8d2d"),x(e,"class","svelte-1mx8d2d")},m(t,g){h(t,e,g),p(e,n),p(e,r),p(e,o),d&&d.m(o,null),p(o,i),f&&f.m(o,null),p(o,c),m&&m.m(o,null),p(e,a),p(e,s),Z(l,s,null),u=!0},p(t,[e]){t[0].hasCaller?d?1&e&&G(d,1):(d=De(),d.c(),G(d,1),d.m(o,i)):d&&(W(),K(d,1,1,()=>{d=null}),X()),t[0].hasReceiver?f?1&e&&G(f,1):(f=Re(),f.c(),G(f,1),f.m(o,c)):f&&(W(),K(f,1,1,()=>{f=null}),X()),t[0].hideSignaling?m&&(W(),K(m,1,1,()=>{m=null}),X()):m?1&e&&G(m,1):(m=Oe(),m.c(),G(m,1),m.m(o,null))},i(t){u||(G(d),G(f),G(m),G(l.$$.fragment,t),u=!0)},o(t){K(d),K(f),K(m),K(l.$$.fragment,t),u=!1},d(t){t&&g(e),d&&d.d(),f&&f.d(),m&&m.d(),tt(l)}}}function Me(t,e,n){let r;return d(t,ut,t=>n(0,r=t)),[r]}var Te=class extends nt{constructor(t){super(),et(this,t,Me,Ee,s,{})}};function Ne(t,e,n){const r=t.slice();return r[26]=e[n],r[28]=n,r}function Ae(t){let e,n,r,o,i=(t[26].label||"micorophone "+t[28])+"";function c(){return t[9](t[26])}return{c(){e=b("button"),n=v(i)},m(t,i){h(t,e,i),p(e,n),r||(o=w(e,"click",c),r=!0)},p(e,r){t=e,4&r&&i!==(i=(t[26].label||"micorophone "+t[28])+"")&&C(n,i)},d(t){t&&g(e),r=!1,o()}}}function Le(t){let e,n,o,i,a,s,l,u,d,f,m,v,k,C,S,_,j,D=t[2],R=[];for(let e=0;e<D.length;e+=1)R[e]=Ae(Ne(t,D,e));return{c(){e=b("h5"),e.textContent="audio devices",n=y(),o=b("audio"),o.innerHTML='<track kind="captions"/>',i=y(),a=b("nav");for(let t=0;t<R.length;t+=1)R[t].c();s=y(),l=b("hr"),u=y(),d=b("button"),d.textContent="pluginStream",f=y(),m=b("button"),m.textContent="start drawing",v=y(),k=b("button"),k.textContent="stop drawing",C=y(),S=b("canvas"),x(o,"id","upstream"),o.autoplay="false",o.controls="true"},m(r,c){h(r,e,c),h(r,n,c),h(r,o,c),t[8](o),h(r,i,c),h(r,a,c);for(let t=0;t<R.length;t+=1)R[t].m(a,null);p(a,s),p(a,l),p(a,u),p(a,d),p(a,f),p(a,m),p(a,v),p(a,k),h(r,C,c),h(r,S,c),t[13](S),_||(j=[w(d,"click",t[10]),w(m,"click",t[11]),w(k,"click",t[12])],_=!0)},p(t,[e]){if(20&e){let n;for(D=t[2],n=0;n<D.length;n+=1){const r=Ne(t,D,n);R[n]?R[n].p(r,e):(R[n]=Ae(r),R[n].c(),R[n].m(a,s))}for(;n<R.length;n+=1)R[n].d(1);R.length=D.length}},i:r,o:r,d(r){r&&g(e),r&&g(n),r&&g(o),t[8](null),r&&g(i),r&&g(a),$(R,r),r&&g(C),r&&g(S),t[13](null),_=!1,c(j)}}}function Ie(t,e,n){const r=M();let o,i,c,a,s,l,u,d,f=[],m=!1;async function p(){const t=await navigator.mediaDevices.enumerateDevices();n(2,f=t.filter(({kind:t})=>"audioinput"===t))}async function h(t){const e=await async function(t){const e={audio:!t||{deviceId:t}};return await navigator.mediaDevices.getUserMedia(e)}(t);e.name=function(t){const e=t&&f.find(({deviceId:e})=>e===t);return e&&e.label}(t),function(t){n(1,i=t),n(0,o.srcObject=t,o),r("stream",t)}(e)}function g(t){s.createMediaStreamSource(t).connect(l)}function $(){m||(m=!0,requestAnimationFrame(v))}function b(){m=!1,requestAnimationFrame(v)}function v(){m&&requestAnimationFrame(v),l.getByteTimeDomainData(d),l.getByteTimeDomainData(d),a.fillStyle="rgb(200, 200, 200)",a.fillRect(0,0,c.width,c.height),a.lineWidth=2,a.strokeStyle="rgb(0, 0, 0)",a.beginPath();let t=1*c.width/u,e=0;for(let n=0;n<u;n++){const r=d[n]/128*c.height/2;0===n?a.moveTo(e,r):a.lineTo(e,r),e+=t}a.lineTo(c.width,c.height/2),a.stroke()}E(()=>{p(),navigator.mediaDevices.addEventListener("devicechange",t=>{navigator.mediaDevices.enumerateDevices().then(t=>p())}),a=c.getContext("2d"),s||(s=new AudioContext,l=s.createAnalyser(),l.fftSize=2048,u=l.frequencyBinCount,d=new Uint8Array(u))});return[o,i,f,c,h,g,$,b,function(t){N[t?"unshift":"push"](()=>{o=t,n(0,o)})},t=>h(t.deviceId),()=>g(i),()=>$(),()=>b(),function(t){N[t?"unshift":"push"](()=>{c=t,n(3,c)})}]}var Pe=class extends nt{constructor(t){super(),et(this,t,Ie,Le,s,{})}};function Be(t){let e,n;return e=new Te({}),{c(){Y(e.$$.fragment)},m(t,r){Z(e,t,r),n=!0},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){K(e.$$.fragment,t),n=!1},d(t){tt(e,t)}}}function Ue(t){let e,n,r;return n=new Pe({}),{c(){e=b("article"),Y(n.$$.fragment),x(e,"class","box")},m(t,o){h(t,e,o),Z(n,e,null),r=!0},i(t){r||(G(n.$$.fragment,t),r=!0)},o(t){K(n.$$.fragment,t),r=!1},d(t){t&&g(e),tt(n)}}}function qe(t){let e,n,r,o;const i=[Ue,Be],c=[];function a(t,e){return t[0].audioVisOnly?0:1}return e=a(t),n=c[e]=i[e](t),{c(){n.c(),r=k()},m(t,n){c[e].m(t,n),h(t,r,n),o=!0},p(t,[o]){let s=e;e=a(t),e!==s&&(W(),K(c[s],1,1,()=>{c[s]=null}),X(),n=c[e],n||(n=c[e]=i[e](t),n.c()),G(n,1),n.m(r.parentNode,r))},i(t){o||(G(n),o=!0)},o(t){K(n),o=!1},d(t){c[e].d(t),t&&g(r)}}}function Je(t,e,n){let r;return d(t,ut,t=>n(0,r=t)),[r]}const Fe=new class extends nt{constructor(t){super(),et(this,t,Je,qe,s,{})}}({target:document.body,props:{}});window.app=Fe;e.default=Fe}]);