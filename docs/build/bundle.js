(()=>{"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t){return 0===Object.keys(t).length}function a(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function s(t,e,n){t.$$.on_destroy.push(a(e,n))}new Set;let l,u=!1;function d(t,e){t.appendChild(e)}function f(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function h(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function g(t){return document.createTextNode(t)}function v(){return g(" ")}function $(){return g("")}function b(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function k(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function w(t,e){t.value=null==e?"":e}function x(t,e,n){t.classList[n?"add":"remove"](e)}function C(t){l=t}function S(){if(!l)throw new Error("Function called outside component initialization");return l}function E(t){S().$$.on_mount.push(t)}function T(){const t=S();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const o=function(t,e,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,!1,e),r}(e,n);r.slice().forEach((e=>{e.call(t,o)}))}}}new Set;const R=[],L=[],D=[],_=[],A=Promise.resolve();let O=!1;function M(t){D.push(t)}let N=!1;const j=new Set;function P(){if(!N){N=!0;do{for(let t=0;t<R.length;t+=1){const e=R[t];C(e),I(e.$$)}for(C(null),R.length=0;L.length;)L.pop()();for(let t=0;t<D.length;t+=1){const e=D[t];j.has(e)||(j.add(e),e())}D.length=0}while(R.length);for(;_.length;)_.pop()();O=!1,N=!1,j.clear()}}function I(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const F=new Set;let B,q;function U(){B={r:0,c:[],p:B}}function J(){B.r||r(B.c),B=B.p}function z(t,e){t&&t.i&&(F.delete(t),t.i(e))}function H(t,e,n,r){if(t&&t.o){if(F.has(t))return;F.add(t),B.c.push((()=>{F.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function W(t){t&&t.c()}function V(t,n,i,c){const{fragment:a,on_mount:s,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,i),c||M((()=>{const n=s.map(e).filter(o);l?l.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(M)}function X(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function G(e,o,i,c,a,s,d,f=[-1]){const h=l;C(e);const p=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:o.context||[]),callbacks:n(),dirty:f,skip_bound:!1,root:o.target||h.$$.root};d&&d(p.root);let g=!1;if(p.ctx=i?i(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&a(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),g&&function(t,e){-1===t.$$.dirty[0]&&(R.push(t),O||(O=!0,A.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],p.update(),g=!0,r(p.before_update),p.fragment=!!c&&c(p.ctx),o.target){if(o.hydrate){u=!0;const t=(v=o.target,Array.from(v.childNodes));p.fragment&&p.fragment.l(t),t.forEach(m)}else p.fragment&&p.fragment.c();o.intro&&z(e.$$.fragment),V(e,o.target,o.anchor,o.customElement),u=!1,P()}var v;C(h)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(q=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(o);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){r(this.$$.on_disconnect)}$destroy(){X(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!c(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class K{$destroy(){X(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!c(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Q=[];function Y(e,n=t){let r;const o=new Set;function c(t){if(i(e,t)&&(e=t,r)){const t=!Q.length;for(const t of o)t[1](),Q.push(t,e);if(t){for(let t=0;t<Q.length;t+=2)Q[t][0](Q[t+1]);Q.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(i,a=t){const s=[i,a];return o.add(s),1===o.size&&(r=n(c)||t),i(e),()=>{o.delete(s),0===o.size&&(r(),r=null)}}}}function Z(e,n,i){const c=!Array.isArray(e),s=c?[e]:e,l=n.length<2;return{subscribe:Y(i,(e=>{let i=!1;const u=[];let d=0,f=t;const m=()=>{if(d)return;f();const r=n(c?u[0]:u,e);l?e(r):f=o(r)?r:t},h=s.map(((t,e)=>a(t,(t=>{u[e]=t,d&=~(1<<e),i&&m()}),(()=>{d|=1<<e}))));return i=!0,m(),function(){r(h),f()}})).subscribe}}const tt=Y([]),et=t=>{try{return!0===JSON.parse(t)}catch{return!1}},nt=Y((()=>{const t=Object.fromEntries(new URLSearchParams(location.search).entries()),e={role:t.role||"both",stream:t.stream||"both",autoSignal:et(t.autoSignal),audioVisOnly:et(t.audioVisOnly),manual:et(t.manual),remote:et(t.remote),hideSignaling:et(t.hideSignaling),hideEvents:et(t.hideEvents)};return Object.entries(e).map((([t,e])=>({key:t,value:e})))})()),rt=Z(nt,(t=>`${window.location.protocol}//${window.location.host}/?${(t=>{const e=new URLSearchParams;for(let[n,r]of t)e.set(n,r);return e.toString()})(t.map((({key:t,value:e})=>[t,e])))}`)),ot=Z(nt,(t=>{const e=Object.fromEntries(t.map((({key:t,value:e})=>[t,e])));let{role:n,stream:r,manual:o,remote:i,hideSignaling:c,hideEvents:a,autoSignal:s}=e;const l="recv"!==n,u="call"!==n&&"send"!==n||!1,d="down"!==r||!1,f="up"!==r||!1,m=o&&"no"!==o||!1,h=i&&"no"!==i||!1,p=l?"bob":"alice",g=u?"bob":"alice";return{...e,role:n,stream:r,manual:o,remote:i,hasCaller:l,hasReceiver:u,hasUpstream:d,hasDownstream:f,autoSignal:s,isManual:m,isRemote:h,hideSignaling:c,hideEvents:a,to:p,from:g}})),it=Y({});function ct(t,e,n){const r=t.slice();return r[4]=e[n].key,r[5]=e[n].value,r[6]=e,r[7]=n,r}function at(t){let e,n,r;function o(){t[3].call(e,t[6],t[7])}return{c(){e=p("input"),y(e,"type","text")},m(i,c){f(i,e,c),w(e,t[5]),n||(r=b(e,"input",o),n=!0)},p(n,r){t=n,2&r&&e.value!==t[5]&&w(e,t[5])},d(t){t&&m(e),n=!1,r()}}}function st(t){let e,n,r;function o(){t[2].call(e,t[6],t[7])}return{c(){e=p("input"),y(e,"type","checkbox")},m(i,c){f(i,e,c),e.checked=t[5],n||(r=b(e,"change",o),n=!0)},p(n,r){t=n,2&r&&(e.checked=t[5])},d(t){t&&m(e),n=!1,r()}}}function lt(t){let e,n,r,o,i,c,a=t[4]+"";function s(t,e){return"boolean"==typeof t[5]?st:at}let l=s(t),u=l(t);return{c(){e=p("tr"),n=p("td"),r=g(a),o=v(),i=p("td"),u.c(),c=v()},m(t,a){f(t,e,a),d(e,n),d(n,r),d(e,o),d(e,i),u.m(i,null),d(e,c)},p(t,e){2&e&&a!==(a=t[4]+"")&&k(r,a),l===(l=s(t))&&u?u.p(t,e):(u.d(1),u=l(t),u&&(u.c(),u.m(i,null)))},d(t){t&&m(e),u.d()}}}function ut(e){let n,r,o,i,c,a,s,l,u,$=e[1],b=[];for(let t=0;t<$.length;t+=1)b[t]=lt(ct(e,$,t));return{c(){n=p("details"),r=p("summary"),r.textContent="config",o=v(),i=p("code"),c=p("pre"),a=p("a"),s=g(e[0]),l=v(),u=p("table");for(let t=0;t<b.length;t+=1)b[t].c();y(a,"href",e[0])},m(t,e){f(t,n,e),d(n,r),d(n,o),d(n,i),d(i,c),d(c,a),d(a,s),d(n,l),d(n,u);for(let t=0;t<b.length;t+=1)b[t].m(u,null)},p(t,[e]){if(1&e&&k(s,t[0]),1&e&&y(a,"href",t[0]),2&e){let n;for($=t[1],n=0;n<$.length;n+=1){const r=ct(t,$,n);b[n]?b[n].p(r,e):(b[n]=lt(r),b[n].c(),b[n].m(u,null))}for(;n<b.length;n+=1)b[n].d(1);b.length=$.length}},i:t,o:t,d(t){t&&m(n),h(b,t)}}}function dt(t,e,n){let r,o;return s(t,rt,(t=>n(0,r=t))),s(t,nt,(t=>n(1,o=t))),[r,o,function(t,e){t[e].value=this.checked,nt.set(o)},function(t,e){t[e].value=this.value,nt.set(o)}]}const ft=class extends K{constructor(t){super(),G(this,t,dt,ut,i,{})}},mt=Y({}),ht=Y({}),pt=Y({});function gt({from:t,offer:e}){mt.update((n=>({...n,[t]:e})))}function vt({from:t,answer:e}){ht.update((n=>({...n,[t]:e})))}function $t({from:t,candidate:e}){pt.update((n=>{const r=n[t]||[];return{...n,[t]:[...r,e]}}))}function bt({from:t}){pt.update((e=>({...e,[t]:[]})))}const yt=new EventTarget;class kt{to;from;socket;constructor({to:t,from:e}){this.to=t,this.from=e}connect({url:t}){const e=new WebSocket(t);e.onopen=()=>{this.socket=e,this.socket.onmessage=this.received.bind(this)}}received({data:t}){const e=JSON.parse(t),{[this.to]:n,type:r}=e;console.debug("its for me!",n);const o=this.to;switch(r){case"offer":gt({from:o,offer:n});break;case"answer":vt({from:o,answer:n});break;case"candidate":$t({from:o,candidate:new RTCIceCandidate(n)})}}sendOffer(t){if(t){const e={[this.from]:t,type:"offer"};this.send(e)}}sendAnswer(t){if(t){const e={[this.from]:t,type:"answer"};this.send(e)}}sendCandidate(t){if(t){const e={[this.from]:t,type:"candidate"};this.send(e)}}send(t){if(this.socket){const e=JSON.stringify(t);this.socket.send(e)}}toString(){return`[Signaling Server calling ${this.from} → ${this.to}]`}}const wt=t=>"string"==typeof t?JSON.parse(t).sdp:"object"==typeof t?t.sdp:void 0,xt=t=>({type:"offer",sdp:t}),Ct=t=>({type:"answer",sdp:t});function St(e){let n,r,o,i,c,a,s,l,u=JSON.stringify(e[2],null,4)+"";return{c(){n=p("details"),r=p("summary"),o=g(e[1]),i=v(),c=p("pre"),a=p("code"),s=g(u),n.open=l=Boolean(e[2])&&e[0]},m(t,e){f(t,n,e),d(n,r),d(r,o),d(n,i),d(n,c),d(c,a),d(a,s)},p(t,[e]){2&e&&k(o,t[1]),4&e&&u!==(u=JSON.stringify(t[2],null,4)+"")&&k(s,u),5&e&&l!==(l=Boolean(t[2])&&t[0])&&(n.open=l)},i:t,o:t,d(t){t&&m(n)}}}function Et(t,e,n){let{open:r=!0}=e,{summary:o="???"}=e,{data:i}=e;return t.$$set=t=>{"open"in t&&n(0,r=t.open),"summary"in t&&n(1,o=t.summary),"data"in t&&n(2,i=t.data)},[r,o,i]}const Tt=class extends K{constructor(t){super(),G(this,t,Et,St,i,{open:0,summary:1,data:2})}};function Rt(t,e,n){const r=t.slice();return r[27]=e[n],r}function Lt(t,e,n){const r=t.slice();return r[30]=e[n],r[32]=n,r}function Dt(t){let e,n,r,o,i,c=(t[30].label||`camera ${t[32]}`)+"";function a(){return t[18](t[30])}return{c(){e=p("button"),n=g(c),r=v(),y(e,"class","svelte-vk2oy1")},m(t,c){f(t,e,c),d(e,n),d(e,r),o||(i=b(e,"click",a),o=!0)},p(e,r){t=e,4&r[0]&&c!==(c=(t[30].label||`camera ${t[32]}`)+"")&&k(n,c)},d(t){t&&m(e),o=!1,i()}}}function _t(t){let e;return{c(){e=g("✔️")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function At(t){let e;return{c(){e=g("(canvas)")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Ot(t){let e,n,o,i,c,a,s,l,u,h,$,w,x,C,S,E,T,R=t[27].name+"",L=t[9](t[27]),D=t[0]===t[27]&&_t();function _(){return t[19](t[27])}function A(){return t[20](t[27])}function O(){return t[21](t[27])}let M=L&&At();return{c(){e=p("tr"),n=p("td"),D&&D.c(),o=v(),i=p("td"),c=p("button"),a=g(R),s=v(),l=p("td"),u=p("button"),u.textContent="stop",h=v(),$=p("td"),w=p("button"),w.textContent="X",x=v(),C=p("td"),M&&M.c(),S=v(),y(c,"class","svelte-vk2oy1"),y(u,"class","svelte-vk2oy1"),y(w,"class","svelte-vk2oy1")},m(t,r){f(t,e,r),d(e,n),D&&D.m(n,null),d(e,o),d(e,i),d(i,c),d(c,a),d(e,s),d(e,l),d(l,u),d(e,h),d(e,$),d($,w),d(e,x),d(e,C),M&&M.m(C,null),d(e,S),E||(T=[b(c,"click",_),b(u,"click",A),b(w,"click",O)],E=!0)},p(e,r){(t=e)[0]===t[27]?D||(D=_t(),D.c(),D.m(n,null)):D&&(D.d(1),D=null),8&r[0]&&R!==(R=t[27].name+"")&&k(a,R),8&r[0]&&(L=t[9](t[27])),L?M||(M=At(),M.c(),M.m(C,null)):M&&(M.d(1),M=null)},d(t){t&&m(e),D&&D.d(),M&&M.d(),E=!1,r(T)}}}function Mt(t){let e,n,r,o,i,c,a,s,l,u,h,$,b,y,w,x,C,S,E,T=t[8].readyState+"";return x=new Tt({props:{summary:"settings",data:t[8].getSettings()}}),S=new Tt({props:{summary:"constraints",data:t[8].getConstraints()}}),{c(){e=p("details"),n=p("summary"),r=g(t[7]),o=g(" / "),i=g(t[6]),c=g(" / "),a=g(t[5]),s=g("/ "),l=g(t[4]),u=v(),h=p("dl"),$=p("dt"),$.textContent="readState",b=p("dd"),y=g(T),w=v(),W(x.$$.fragment),C=v(),W(S.$$.fragment)},m(t,m){f(t,e,m),d(e,n),d(n,r),d(n,o),d(n,i),d(n,c),d(n,a),d(n,s),d(n,l),d(e,u),d(e,h),d(h,$),d(h,b),d(b,y),d(e,w),V(x,e,null),d(e,C),V(S,e,null),E=!0},p(t,e){(!E||128&e[0])&&k(r,t[7]),(!E||64&e[0])&&k(i,t[6]),(!E||32&e[0])&&k(a,t[5]),(!E||16&e[0])&&k(l,t[4]),(!E||256&e[0])&&T!==(T=t[8].readyState+"")&&k(y,T);const n={};256&e[0]&&(n.data=t[8].getSettings()),x.$set(n);const o={};256&e[0]&&(o.data=t[8].getConstraints()),S.$set(o)},i(t){E||(z(x.$$.fragment,t),z(S.$$.fragment,t),E=!0)},o(t){H(x.$$.fragment,t),H(S.$$.fragment,t),E=!1},d(t){t&&m(e),X(x),X(S)}}}function Nt(t){let e,n,o,i,c,a,s,l,u,g,k,w,x,C,S,E,T,R,L=t[2],D=[];for(let e=0;e<L.length;e+=1)D[e]=Dt(Lt(t,L,e));let _=t[3],A=[];for(let e=0;e<_.length;e+=1)A[e]=Ot(Rt(t,_,e));let O=t[8]&&Mt(t);return{c(){e=p("h5"),e.textContent="upstream",n=v(),o=p("video"),o.innerHTML='<track kind="captions"/>',i=v(),c=p("nav"),a=p("button"),a.textContent="default",s=v(),l=p("button"),l.textContent="noise",u=v(),g=p("br"),k=v();for(let t=0;t<D.length;t+=1)D[t].c();w=v(),x=p("table");for(let t=0;t<A.length;t+=1)A[t].c();C=v(),O&&O.c(),S=$(),y(o,"id","upstream"),o.autoplay="true",y(o,"class","svelte-vk2oy1"),y(a,"class","svelte-vk2oy1"),y(l,"class","svelte-vk2oy1"),y(c,"class","svelte-vk2oy1")},m(r,m){f(r,e,m),f(r,n,m),f(r,o,m),t[15](o),f(r,i,m),f(r,c,m),d(c,a),d(c,s),d(c,l),d(c,u),d(c,g),d(c,k);for(let t=0;t<D.length;t+=1)D[t].m(c,null);f(r,w,m),f(r,x,m);for(let t=0;t<A.length;t+=1)A[t].m(x,null);f(r,C,m),O&&O.m(r,m),f(r,S,m),E=!0,T||(R=[b(a,"click",t[16]),b(l,"click",t[17])],T=!0)},p(t,e){if(2052&e[0]){let n;for(L=t[2],n=0;n<L.length;n+=1){const r=Lt(t,L,n);D[n]?D[n].p(r,e):(D[n]=Dt(r),D[n].c(),D[n].m(c,null))}for(;n<D.length;n+=1)D[n].d(1);D.length=L.length}if(29193&e[0]){let n;for(_=t[3],n=0;n<_.length;n+=1){const r=Rt(t,_,n);A[n]?A[n].p(r,e):(A[n]=Ot(r),A[n].c(),A[n].m(x,null))}for(;n<A.length;n+=1)A[n].d(1);A.length=_.length}t[8]?O?(O.p(t,e),256&e[0]&&z(O,1)):(O=Mt(t),O.c(),z(O,1),O.m(S.parentNode,S)):O&&(U(),H(O,1,1,(()=>{O=null})),J())},i(t){E||(z(O),E=!0)},o(t){H(O),E=!1},d(a){a&&m(e),a&&m(n),a&&m(o),t[15](null),a&&m(i),a&&m(c),h(D,a),a&&m(w),a&&m(x),h(A,a),a&&m(C),O&&O.d(a),a&&m(S),T=!1,r(R)}}}function jt(t,e,n){let r,o,i,c,a;var s=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function c(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))};const l=T();let u,d,f=[],m=[];function h(){return s(this,void 0,void 0,(function*(){const t=yield function(){let t=Object.assign(document.createElement("canvas"),{width:400,height:300}),e=t.getContext("2d");e.fillRect(0,0,t.width,t.height);let n=e.getImageData(0,0,t.width,t.height);return requestAnimationFrame((function t(){for(var r=0;r<n.data.length;r++)n.data[r++]=n.data[r++]=n.data[r++]=255*Math.random();e.putImageData(n,0,0),requestAnimationFrame(t)})),t.captureStream(60)}();t.name="noise feed",g(t),n(3,m=[...m,t])}))}function p(t){return s(this,void 0,void 0,(function*(){const e=yield function(t){return s(this,void 0,void 0,(function*(){const e={video:!t||{deviceId:t}};return yield navigator.mediaDevices.getUserMedia(e)}))}(t);e.name=t?function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t):"default webcam",g(e),n(3,m=[...m,e])}))}function g(t){n(0,d=t),n(1,u.srcObject=t,u),l("stream",t)}function v(t){t.getTracks().forEach((t=>t.stop())),l("stop",t)}function $(t){v(t),n(3,m=[...m.filter((e=>e!=t))]),d===t&&n(0,d=void 0)}function b(){return s(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"videoinput"===t)))}))}return E((()=>{b();const t=()=>b();return navigator.mediaDevices.addEventListener("devicechange",t),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),t.$$.update=()=>{1&t.$$.dirty[0]&&n(8,r=d&&d.getTracks()[0]),1&t.$$.dirty[0]&&n(7,o=d&&d.constructor.name),1&t.$$.dirty[0]&&n(6,i=d&&d.getTracks()[0].constructor.name),1&t.$$.dirty[0]&&n(5,c=d&&d.canvas),1&t.$$.dirty[0]&&n(4,a=d&&d.getTracks()[0].canvas)},[d,u,f,m,a,c,i,o,r,t=>"CanvasCaptureMediaStream"===(null==t?void 0:t.constructor.name)||"CanvasCaptureMediaStreamTrack"===(null==t?void 0:t.getTracks()[0].constructor.name),h,p,g,v,$,function(t){L[t?"unshift":"push"]((()=>{u=t,n(1,u)}))},()=>p(),()=>h(),t=>p(t.deviceId),t=>g(t),t=>v(t),t=>$(t)]}const Pt=class extends K{constructor(t){super(),G(this,t,jt,Nt,i,{},null,[-1,-1])}};function It(t){let e,n,r,o;return e=new Tt({props:{summary:"settings",data:t[1].getSettings()}}),r=new Tt({props:{summary:"constraints",data:t[1].getConstraints()}}),{c(){W(e.$$.fragment),n=v(),W(r.$$.fragment)},m(t,i){V(e,t,i),f(t,n,i),V(r,t,i),o=!0},p(t,n){const o={};2&n&&(o.data=t[1].getSettings()),e.$set(o);const i={};2&n&&(i.data=t[1].getConstraints()),r.$set(i)},i(t){o||(z(e.$$.fragment,t),z(r.$$.fragment,t),o=!0)},o(t){H(e.$$.fragment,t),H(r.$$.fragment,t),o=!1},d(t){X(e,t),t&&m(n),X(r,t)}}}function Ft(t){let e,n,r,o,i,c,a,s=t[1]&&It(t);return{c(){e=p("h5"),e.textContent="downstream",n=v(),r=p("video"),r.innerHTML='<track kind="captions"/>',i=v(),s&&s.c(),c=$(),r.autoplay=o=!0},m(o,l){f(o,e,l),f(o,n,l),f(o,r,l),t[3](r),f(o,i,l),s&&s.m(o,l),f(o,c,l),a=!0},p(t,[e]){t[1]?s?(s.p(t,e),2&e&&z(s,1)):(s=It(t),s.c(),z(s,1),s.m(c.parentNode,c)):s&&(U(),H(s,1,1,(()=>{s=null})),J())},i(t){a||(z(s),a=!0)},o(t){H(s),a=!1},d(o){o&&m(e),o&&m(n),o&&m(r),t[3](null),o&&m(i),s&&s.d(o),o&&m(c)}}}function Bt(t,e,n){let r,o,{stream:i}=e;return t.$$set=t=>{"stream"in t&&n(2,i=t.stream)},t.$$.update=()=>{4&t.$$.dirty&&n(1,r=i&&i.getTracks()[0]),5&t.$$.dirty&&o&&n(0,o.srcObject=i,o)},[o,r,i,function(t){L[t?"unshift":"push"]((()=>{o=t,n(0,o),n(2,i)}))}]}const qt=class extends K{constructor(t){super(),G(this,t,Bt,Ft,i,{stream:2})}};function Ut(e){let n,o,i,c,a,s,l;return{c(){n=p("form"),o=p("input"),i=v(),c=p("code"),a=g(e[0]),y(o,"size","90"),y(o,"placeholder","ws url")},m(t,r){var u;f(t,n,r),d(n,o),w(o,e[1]),f(t,i,r),f(t,c,r),d(c,a),s||(l=[b(o,"input",e[2]),b(n,"submit",(u=Jt,function(t){return t.preventDefault(),u.call(this,t)}))],s=!0)},p(t,[e]){2&e&&o.value!==t[1]&&w(o,t[1]),1&e&&k(a,t[0])},i:t,o:t,d(t){t&&m(n),t&&m(i),t&&m(c),s=!1,r(l)}}}function Jt(){}function zt(t,e,n){let r,{signalingClient:o}=e;return t.$$set=t=>{"signalingClient"in t&&n(0,o=t.signalingClient)},t.$$.update=()=>{3&t.$$.dirty&&(o.connect({url:r}),window.client=o)},n(1,r=`wss://${window.location.host}/signaling/test`),[o,r,function(){r=this.value,n(1,r)}]}const Ht=class extends K{constructor(t){super(),G(this,t,zt,Ut,i,{signalingClient:0})}};function Wt(t,e,n){const r=t.slice();return r[6]=e[n][0],r[7]=e[n][1],r}function Vt(t){let e,n,r=t[0],o=[];for(let e=0;e<r.length;e+=1)o[e]=Xt(Wt(t,r,e));const i=t=>H(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=$()},m(t,r){for(let e=0;e<o.length;e+=1)o[e].m(t,r);f(t,e,r),n=!0},p(t,n){if(3&n){let c;for(r=t[0],c=0;c<r.length;c+=1){const i=Wt(t,r,c);o[c]?(o[c].p(i,n),z(o[c],1)):(o[c]=Xt(i),o[c].c(),z(o[c],1),o[c].m(e.parentNode,e))}for(U(),c=r.length;c<o.length;c+=1)i(c);J()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)z(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)H(o[t]);n=!1},d(t){h(o,t),t&&m(e)}}}function Xt(t){let e,n,i,c,a,s,l,u,h,$,w,x,C,S,E,T,R,L,D,_,A,O,M,N,j,P,I,F,B,q=`transceiver ${t[7].mid}`,U=t[7].mid+"",J=t[7].sender.track+"";function G(){return t[4](t[6])}return _=new Tt({props:{summary:"details",data:t[7],open:!1}}),{c(){e=p("div"),n=p("div"),i=g(q),c=v(),a=p("table"),s=p("tr"),l=p("th"),l.textContent="mid",u=v(),h=p("td"),$=p("code"),w=g(U),x=v(),C=p("tr"),S=p("th"),S.textContent="track",E=v(),T=p("td"),R=p("code"),L=g(J),D=v(),W(_.$$.fragment),A=v(),O=p("div"),M=p("button"),M.textContent="replaceTrack",N=v(),j=p("button"),j.textContent="replaceTrack(null)",P=v(),y(M,"class","btn-small"),y(j,"class","btn-small"),y(e,"class","grid box svelte-1nbk03h")},m(r,m){f(r,e,m),d(e,n),d(n,i),d(n,c),d(n,a),d(a,s),d(s,l),d(s,u),d(s,h),d(h,$),d($,w),d(a,x),d(a,C),d(C,S),d(C,E),d(C,T),d(T,R),d(R,L),d(n,D),V(_,n,null),d(e,A),d(e,O),d(O,M),d(O,N),d(O,j),d(e,P),I=!0,F||(B=[b(M,"click",(function(){o(t[1](t[6].sender))&&t[1](t[6].sender).apply(this,arguments)})),b(j,"click",G)],F=!0)},p(e,n){t=e,(!I||1&n)&&q!==(q=`transceiver ${t[7].mid}`)&&k(i,q),(!I||1&n)&&U!==(U=t[7].mid+"")&&k(w,U),(!I||1&n)&&J!==(J=t[7].sender.track+"")&&k(L,J);const r={};1&n&&(r.data=t[7]),_.$set(r)},i(t){I||(z(_.$$.fragment,t),I=!0)},o(t){H(_.$$.fragment,t),I=!1},d(t){t&&m(e),X(_),F=!1,r(B)}}}function Gt(t){let e,n,r,o,i=t[0]&&Vt(t);return{c(){e=p("h5"),e.textContent="transceivers",n=v(),i&&i.c(),r=$()},m(t,c){f(t,e,c),f(t,n,c),i&&i.m(t,c),f(t,r,c),o=!0},p(t,[e]){t[0]?i?(i.p(t,e),1&e&&z(i,1)):(i=Vt(t),i.c(),z(i,1),i.m(r.parentNode,r)):i&&(U(),H(i,1,1,(()=>{i=null})),J())},i(t){o||(z(i),o=!0)},o(t){H(i),o=!1},d(t){t&&m(e),t&&m(n),i&&i.d(t),t&&m(r)}}}function Kt(t,e,n){let r,o,{peerconnection:i}=e,{streamSource:c}=e;return E((()=>{const t=setInterval((()=>{r&&n(0,o=r.map((t=>{const{mid:e,direction:n,currentDirection:r,stopped:o,sender:i,receiver:c}=t;let a={},s={};{let{dtmf:t,track:e,transport:n}=i;a={dtmf:t,track:e,transport:n,parameters:i.getParameters&&i.getParameters()}}{let{dtmf:t,track:e,transport:n}=c;s={dtmf:t,track:e,transport:n,parameters:c.getParameters&&c.getParameters(),csrcs:c.getContributingSources(),ssrcs:c.getSynchronizationSources()}}return[t,{mid:e,direction:n,currentDirection:r,stopped:o,sender:a,receiver:s}]})))}),1e3);return()=>clearInterval(t)})),t.$$set=t=>{"peerconnection"in t&&n(2,i=t.peerconnection),"streamSource"in t&&n(3,c=t.streamSource)},t.$$.update=()=>{4&t.$$.dirty&&(r=i&&i.getTransceivers())},[o,function(t){return()=>{const e=c().getTracks()[0];e&&t.replaceTrack(e)}},i,c,t=>t.sender.replaceTrack(null)]}const Qt=class extends K{constructor(t){super(),G(this,t,Kt,Gt,i,{peerconnection:2,streamSource:3})}};function Yt(e){let n,r;return n=new Ht({props:{signalingClient:e[25]}}),{c(){W(n.$$.fragment)},m(t,e){V(n,t,e),r=!0},p:t,i(t){r||(z(n.$$.fragment,t),r=!0)},o(t){H(n.$$.fragment,t),r=!1},d(t){X(n,t)}}}function Zt(e){let n,r,o;return r=new Pt({}),r.$on("stream",e[39]),r.$on("stop",e[40]),{c(){n=p("article"),W(r.$$.fragment),y(n,"id","upstream"),y(n,"class","box")},m(t,e){f(t,n,e),V(r,n,null),o=!0},p:t,i(t){o||(z(r.$$.fragment,t),o=!0)},o(t){H(r.$$.fragment,t),o=!1},d(t){t&&m(n),X(r)}}}function te(t){let e,n,r;return n=new qt({props:{stream:void 0}}),t[41](n),{c(){e=p("article"),W(n.$$.fragment),y(e,"id","downstream"),y(e,"class","box")},m(t,o){f(t,e,o),V(n,e,null),r=!0},p(t,e){n.$set({})},i(t){r||(z(n.$$.fragment,t),r=!0)},o(t){H(n.$$.fragment,t),r=!1},d(r){r&&m(e),t[41](null),X(n)}}}function ee(t){let e;return{c(){e=g("addStream")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function ne(t){let e;return{c(){e=g("replaceTrack")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function re(t){let e,n,r,o,i=t[9].name+"";return{c(){e=p("small"),n=p("code"),r=p("pre"),o=g(i)},m(t,i){f(t,e,i),d(e,n),d(n,r),d(r,o)},p(t,e){512&e[0]&&i!==(i=t[9].name+"")&&k(o,i)},d(t){t&&m(e)}}}function oe(t){let e,n,r,o,i,c,a,s=t[24].join(" ")+"";return{c(){e=p("tr"),n=p("th"),n.textContent="events:",r=v(),o=p("td"),i=p("code"),c=p("small"),a=g(s)},m(t,s){f(t,e,s),d(e,n),d(e,r),d(e,o),d(o,i),d(i,c),d(c,a)},p(t,e){16777216&e[0]&&s!==(s=t[24].join(" ")+"")&&k(a,s)},d(t){t&&m(e)}}}function ie(t){let e,n,r,o,i,c,a,s,l,u,h,y=t[21]&&ce(t),k=t[13]&&ae(t),w=t[22]&&!t[5].isManual&&se(t),x=t[5].isManual&&le(t);return{c(){y&&y.c(),e=v(),n=p("label"),r=g("1.\n                "),o=p("button"),i=g("create offer"),c=v(),k&&k.c(),a=v(),w&&w.c(),s=v(),x&&x.c(),l=$(),o.disabled=t[21]},m(m,p){y&&y.m(m,p),f(m,e,p),f(m,n,p),d(n,r),d(n,o),d(o,i),f(m,c,p),k&&k.m(m,p),f(m,a,p),w&&w.m(m,p),f(m,s,p),x&&x.m(m,p),f(m,l,p),u||(h=b(o,"click",t[28]),u=!0)},p(t,n){t[21]?y?y.p(t,n):(y=ce(t),y.c(),y.m(e.parentNode,e)):y&&(y.d(1),y=null),2097152&n[0]&&(o.disabled=t[21]),t[13]?k?k.p(t,n):(k=ae(t),k.c(),k.m(a.parentNode,a)):k&&(k.d(1),k=null),t[22]&&!t[5].isManual?w?w.p(t,n):(w=se(t),w.c(),w.m(s.parentNode,s)):w&&(w.d(1),w=null),t[5].isManual?x?x.p(t,n):(x=le(t),x.c(),x.m(l.parentNode,l)):x&&(x.d(1),x=null)},d(t){y&&y.d(t),t&&m(e),t&&m(n),t&&m(c),k&&k.d(t),t&&m(a),w&&w.d(t),t&&m(s),x&&x.d(t),t&&m(l),u=!1,h()}}}function ce(e){let n,r,o,i,c;return{c(){n=p("label"),r=g("0.\n                    "),o=p("button"),o.textContent="start call"},m(t,a){f(t,n,a),d(n,r),d(n,o),i||(c=b(o,"click",e[27]),i=!0)},p:t,d(t){t&&m(n),i=!1,c()}}}function ae(t){let e,n,o,i,c,a,s,l,u,h,$,k,C,S;return{c(){e=p("div"),n=p("textarea"),o=v(),i=p("br"),c=v(),a=p("label"),s=g("2.\n                        "),l=p("button"),u=g("setLocalDescription"),h=v(),$=p("button"),k=g("send offer"),y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),x(n,"hideSignaling",t[18]),l.disabled=t[21],$.disabled=t[21]},m(r,m){f(r,e,m),d(e,n),w(n,t[13]),d(e,o),d(e,i),d(e,c),d(e,a),d(a,s),d(a,l),d(l,u),d(a,h),d(a,$),d($,k),C||(S=[b(n,"input",t[47]),b(l,"click",t[48]),b($,"click",t[30])],C=!0)},p(t,e){8192&e[0]&&w(n,t[13]),262144&e[0]&&x(n,"hideSignaling",t[18]),2097152&e[0]&&(l.disabled=t[21]),2097152&e[0]&&($.disabled=t[21])},d(t){t&&m(e),C=!1,r(S)}}}function se(t){let e,n,o,i,c,a,s,l,u,h,$;return{c(){e=p("div"),n=p("textarea"),o=v(),i=p("br"),c=v(),a=p("label"),s=g("5.\n                        "),l=p("button"),u=g("setRemoteDescription"),y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),x(n,"hideSignaling",t[18]),l.disabled=t[21]},m(r,m){f(r,e,m),d(e,n),w(n,t[22]),d(e,o),d(e,i),d(e,c),d(e,a),d(a,s),d(a,l),d(l,u),h||($=[b(n,"input",t[49]),b(l,"click",t[50])],h=!0)},p(t,e){4194304&e[0]&&w(n,t[22]),262144&e[0]&&x(n,"hideSignaling",t[18]),2097152&e[0]&&(l.disabled=t[21])},d(t){t&&m(e),h=!1,r($)}}}function le(t){let e,n,o,i,c,a,s,l,u,h,$,k,x;return{c(){e=p("div"),n=p("strong"),n.textContent="MANUAL ANSWER HERE",o=v(),i=p("textarea"),c=v(),a=p("br"),s=v(),l=p("label"),u=g("5.\n                        "),h=p("button"),$=g("setRemoteDescription"),y(i,"rows","20"),y(i,"class","svelte-3b0r9n"),h.disabled=t[21]},m(r,m){f(r,e,m),d(e,n),d(e,o),d(e,i),w(i,t[16]),d(e,c),d(e,a),d(e,s),d(e,l),d(l,u),d(l,h),d(h,$),k||(x=[b(i,"input",t[51]),b(h,"click",t[52])],k=!0)},p(t,e){65536&e[0]&&w(i,t[16]),2097152&e[0]&&(h.disabled=t[21])},d(t){t&&m(e),k=!1,r(x)}}}function ue(t){let e,n,r,o=t[23]&&!t[5].isManual&&de(t),i=t[5].isManual&&fe(t),c=t[14]&&t[23]&&me(t);return{c(){o&&o.c(),e=v(),i&&i.c(),n=v(),c&&c.c(),r=$()},m(t,a){o&&o.m(t,a),f(t,e,a),i&&i.m(t,a),f(t,n,a),c&&c.m(t,a),f(t,r,a)},p(t,a){t[23]&&!t[5].isManual?o?o.p(t,a):(o=de(t),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),t[5].isManual?i?i.p(t,a):(i=fe(t),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null),t[14]&&t[23]?c?c.p(t,a):(c=me(t),c.c(),c.m(r.parentNode,r)):c&&(c.d(1),c=null)},d(t){o&&o.d(t),t&&m(e),i&&i.d(t),t&&m(n),c&&c.d(t),t&&m(r)}}}function de(t){let e,n,o,i,c,a,s,l,u,h,$,k,C,S;return{c(){e=p("div"),n=p("textarea"),o=v(),i=p("br"),c=v(),a=p("label"),s=g("3.\n                        "),l=p("button"),u=g("setRemoteDescription"),h=v(),$=p("button"),k=g("create answer"),y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),x(n,"hideSignaling",t[18]),l.disabled=t[21],$.disabled=t[21]},m(r,m){f(r,e,m),d(e,n),w(n,t[23]),d(e,o),d(e,i),d(e,c),d(e,a),d(a,s),d(a,l),d(l,u),d(a,h),d(a,$),d($,k),C||(S=[b(n,"input",t[53]),b(l,"click",t[54]),b($,"click",t[29])],C=!0)},p(t,e){8388608&e[0]&&w(n,t[23]),262144&e[0]&&x(n,"hideSignaling",t[18]),2097152&e[0]&&(l.disabled=t[21]),2097152&e[0]&&($.disabled=t[21])},d(t){t&&m(e),C=!1,r(S)}}}function fe(t){let e,n,o,i,c,a,s,l,u,h,$,k,x,C,S,E;return{c(){e=p("div"),n=p("strong"),n.textContent="MANUAL OFFER HERE",o=v(),i=p("textarea"),c=v(),a=p("br"),s=v(),l=p("label"),u=g("3.\n                        "),h=p("button"),$=g("setRemoteDescription"),k=v(),x=p("button"),C=g("create answer"),y(i,"rows","20"),y(i,"class","svelte-3b0r9n"),h.disabled=t[21],x.disabled=t[21]},m(r,m){f(r,e,m),d(e,n),d(e,o),d(e,i),w(i,t[15]),d(e,c),d(e,a),d(e,s),d(e,l),d(l,u),d(l,h),d(h,$),d(l,k),d(l,x),d(x,C),S||(E=[b(i,"input",t[55]),b(h,"click",t[56]),b(x,"click",t[29])],S=!0)},p(t,e){32768&e[0]&&w(i,t[15]),2097152&e[0]&&(h.disabled=t[21]),2097152&e[0]&&(x.disabled=t[21])},d(t){t&&m(e),S=!1,r(E)}}}function me(t){let e,n,o,i,c,a,s,l,u,h,$,k,C,S;return{c(){e=p("div"),n=p("textarea"),o=v(),i=p("br"),c=v(),a=p("label"),s=g("4.\n                        "),l=p("button"),u=g("setLocalDescription"),h=v(),$=p("button"),k=g("send answer"),y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),x(n,"hideSignaling",t[18]),l.disabled=t[21],$.disabled=t[21]},m(r,m){f(r,e,m),d(e,n),w(n,t[14]),d(e,o),d(e,i),d(e,c),d(e,a),d(a,s),d(a,l),d(l,u),d(a,h),d(a,$),d($,k),C||(S=[b(n,"input",t[57]),b(l,"click",t[58]),b($,"click",t[31])],C=!0)},p(t,e){16384&e[0]&&w(n,t[14]),262144&e[0]&&x(n,"hideSignaling",t[18]),2097152&e[0]&&(l.disabled=t[21]),2097152&e[0]&&($.disabled=t[21])},d(t){t&&m(e),C=!1,r(S)}}}function he(t){let e,n,r;return{c(){e=p("textarea"),y(e,"rows","10"),y(e,"class","svelte-3b0r9n"),x(e,"hideSignaling",t[18])},m(o,i){f(o,e,i),w(e,t[20]),n||(r=b(e,"input",t[59]),n=!0)},p(t,n){1048576&n[0]&&w(e,t[20]),262144&n[0]&&x(e,"hideSignaling",t[18])},d(t){t&&m(e),n=!1,r()}}}function pe(t){let e,n,r,o,i,c,a,s,l=JSON.stringify(t[19],null,4)+"";return{c(){e=p("label"),e.textContent="injected Candidates",n=v(),r=p("textarea"),o=v(),i=p("pre"),c=g(l),y(e,"for","injectedCandidates"),y(r,"name","injectedCandidates"),y(r,"rows","20"),y(r,"class","svelte-3b0r9n")},m(l,u){f(l,e,u),f(l,n,u),f(l,r,u),w(r,t[4]),f(l,o,u),f(l,i,u),d(i,c),a||(s=b(r,"input",t[60]),a=!0)},p(t,e){16&e[0]&&w(r,t[4]),524288&e[0]&&l!==(l=JSON.stringify(t[19],null,4)+"")&&k(c,l)},d(t){t&&m(e),t&&m(n),t&&m(r),t&&m(o),t&&m(i),a=!1,s()}}}function ge(t){let e,n,o,i,c,a,s,l,u,h,$,w,x,C,S,E,T,R,L,D,_,A,O,M,N,j,P,I,F,B,q,G,K,Q,Y,Z,tt,et,nt,rt,ot,it,ct,at,st,lt,ut,dt,ft,mt,ht,pt,gt,vt,$t,bt,yt,kt,wt,xt,Ct,St,Et,Tt,Rt,Lt,Dt,_t=t[5].isRemote&&Yt(t),At=t[5].hasUpstream&&Zt(t),Ot=t[5].hasDownstream&&te(t);function Mt(t,e){return t[8]?ne:ee}let Nt=Mt(t),jt=Nt(t),Pt=t[9]&&t[9].name&&re(t);L=new Qt({props:{peerconnection:t[7],streamSource:t[43]}});let It=!t[17]&&oe(t),Ft=t[0]&&ie(t),Bt=t[1]&&ue(t),qt=(t[20].length||t[5].isManual)&&he(t),Ut=t[5].isManual&&pe(t);return{c(){e=p("section"),n=p("h3"),o=g(t[2]),i=v(),c=p("small"),a=g("talking to "),s=g(t[3]),l=v(),_t&&_t.c(),u=v(),At&&At.c(),h=v(),Ot&&Ot.c(),$=v(),w=p("article"),x=p("h5"),x.textContent="peerconnection",C=v(),S=p("button"),jt.c(),T=v(),Pt&&Pt.c(),R=v(),W(L.$$.fragment),D=v(),_=p("article"),A=p("h5"),A.textContent="signaling",O=v(),M=p("div"),N=p("table"),j=p("tr"),P=p("th"),P.textContent="signaling:",I=v(),F=p("td"),B=p("code"),q=g(t[10]),G=v(),K=p("tr"),Q=p("th"),Q.textContent="connection:",Y=v(),Z=p("td"),tt=p("code"),et=g(t[11]),nt=v(),rt=p("tr"),ot=p("th"),ot.textContent="ice:",it=v(),ct=p("td"),at=p("code"),st=g(t[12]),lt=v(),It&&It.c(),ut=v(),dt=p("div"),ft=p("span"),mt=p("label"),ht=p("input"),pt=g("\n                    caller"),gt=v(),vt=p("label"),$t=p("input"),bt=g("\n                    receiver"),yt=v(),kt=p("label"),wt=p("input"),xt=g("\n                    auto"),Ct=v(),Ft&&Ft.c(),St=v(),Bt&&Bt.c(),Et=v(),qt&&qt.c(),Tt=v(),Ut&&Ut.c(),S.disabled=E=!Boolean(t[9]),y(w,"class","box"),y(N,"class","vertical"),y(M,"class","box"),y(ht,"type","checkbox"),y($t,"type","checkbox"),y(wt,"type","checkbox"),y(dt,"class","box"),y(_,"class","box")},m(r,m){f(r,e,m),d(e,n),d(n,o),d(n,i),d(n,c),d(c,a),d(c,s),d(e,l),_t&&_t.m(e,null),d(e,u),At&&At.m(e,null),d(e,h),Ot&&Ot.m(e,null),d(e,$),d(e,w),d(w,x),d(w,C),d(w,S),jt.m(S,null),d(w,T),Pt&&Pt.m(w,null),d(w,R),V(L,w,null),d(e,D),d(e,_),d(_,A),d(_,O),d(_,M),d(M,N),d(N,j),d(j,P),d(j,I),d(j,F),d(F,B),d(B,q),d(N,G),d(N,K),d(K,Q),d(K,Y),d(K,Z),d(Z,tt),d(tt,et),d(N,nt),d(N,rt),d(rt,ot),d(rt,it),d(rt,ct),d(ct,at),d(at,st),d(N,lt),It&&It.m(N,null),d(_,ut),d(_,dt),d(dt,ft),d(ft,mt),d(mt,ht),ht.checked=t[0],d(mt,pt),d(ft,gt),d(ft,vt),d(vt,$t),$t.checked=t[1],d(vt,bt),d(ft,yt),d(ft,kt),d(kt,wt),wt.checked=t[21],d(kt,xt),d(_,Ct),Ft&&Ft.m(_,null),d(_,St),Bt&&Bt.m(_,null),d(_,Et),qt&&qt.m(_,null),d(_,Tt),Ut&&Ut.m(_,null),Rt=!0,Lt||(Dt=[b(S,"click",t[42]),b(ht,"change",t[44]),b($t,"change",t[45]),b(wt,"change",t[46])],Lt=!0)},p(t,n){(!Rt||4&n[0])&&k(o,t[2]),(!Rt||8&n[0])&&k(s,t[3]),t[5].isRemote?_t?(_t.p(t,n),32&n[0]&&z(_t,1)):(_t=Yt(t),_t.c(),z(_t,1),_t.m(e,u)):_t&&(U(),H(_t,1,1,(()=>{_t=null})),J()),t[5].hasUpstream?At?(At.p(t,n),32&n[0]&&z(At,1)):(At=Zt(t),At.c(),z(At,1),At.m(e,h)):At&&(U(),H(At,1,1,(()=>{At=null})),J()),t[5].hasDownstream?Ot?(Ot.p(t,n),32&n[0]&&z(Ot,1)):(Ot=te(t),Ot.c(),z(Ot,1),Ot.m(e,$)):Ot&&(U(),H(Ot,1,1,(()=>{Ot=null})),J()),Nt!==(Nt=Mt(t))&&(jt.d(1),jt=Nt(t),jt&&(jt.c(),jt.m(S,null))),(!Rt||512&n[0]&&E!==(E=!Boolean(t[9])))&&(S.disabled=E),t[9]&&t[9].name?Pt?Pt.p(t,n):(Pt=re(t),Pt.c(),Pt.m(w,R)):Pt&&(Pt.d(1),Pt=null);const r={};128&n[0]&&(r.peerconnection=t[7]),512&n[0]&&(r.streamSource=t[43]),L.$set(r),(!Rt||1024&n[0])&&k(q,t[10]),(!Rt||2048&n[0])&&k(et,t[11]),(!Rt||4096&n[0])&&k(st,t[12]),t[17]?It&&(It.d(1),It=null):It?It.p(t,n):(It=oe(t),It.c(),It.m(N,null)),1&n[0]&&(ht.checked=t[0]),2&n[0]&&($t.checked=t[1]),2097152&n[0]&&(wt.checked=t[21]),t[0]?Ft?Ft.p(t,n):(Ft=ie(t),Ft.c(),Ft.m(_,St)):Ft&&(Ft.d(1),Ft=null),t[1]?Bt?Bt.p(t,n):(Bt=ue(t),Bt.c(),Bt.m(_,Et)):Bt&&(Bt.d(1),Bt=null),t[20].length||t[5].isManual?qt?qt.p(t,n):(qt=he(t),qt.c(),qt.m(_,Tt)):qt&&(qt.d(1),qt=null),t[5].isManual?Ut?Ut.p(t,n):(Ut=pe(t),Ut.c(),Ut.m(_,null)):Ut&&(Ut.d(1),Ut=null)},i(t){Rt||(z(_t),z(At),z(Ot),z(L.$$.fragment,t),Rt=!0)},o(t){H(_t),H(At),H(Ot),H(L.$$.fragment,t),Rt=!1},d(t){t&&m(e),_t&&_t.d(),At&&At.d(),Ot&&Ot.d(),jt.d(),Pt&&Pt.d(),X(L),It&&It.d(),Ft&&Ft.d(),Bt&&Bt.d(),qt&&qt.d(),Ut&&Ut.d(),Lt=!1,r(Dt)}}}function ve(t,e,n){let r,o,i,c,a,l,u,d,f,m,h,p,g;s(t,ot,(t=>n(5,f=t))),s(t,pt,(t=>n(61,m=t))),s(t,ht,(t=>n(36,h=t))),s(t,mt,(t=>n(37,p=t))),s(t,it,(t=>n(38,g=t)));var v=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function c(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))};let{isCaller:$=!1}=e,{isReceiver:b=!1}=e,{name:y="unnamed participant"}=e,{recipient:k=null}=e;const w=new kt({from:y,to:k}),x=(t=>(e,n)=>function(t,e,n){const r={name:t,short:e,event:n};tt.update((t=>[...t,r])),it.update((n=>({...n,[t]:[...n[t]||[],e]})))}(t,e,n))(y);let C,S,T,R,D="",_="",A="",O="";yt.addEventListener(`OfferTo:${y}`,(({detail:t})=>v(void 0,void 0,void 0,(function*(){r&&(W(wt(t)),yield U(),H(Ct(M)),z())})))),yt.addEventListener(`AnswerTo:${y}`,(({detail:t})=>v(void 0,void 0,void 0,(function*(){r&&X(wt(t))}))));let M="",N="",j="",P=[],I="",F="plan-b"===new URL(document.location.toString()).searchParams.get("semantic")?{sdpSemantics:"plan-b"}:{sdpSemantics:"unified-plan"};function B(t){T?(x("rt","replace track"),console.info("replace track",{sender:T}),T.replaceTrack(t.getTracks()[0])):(x("at","add track"),console.info("add track"),n(8,T=S.addTrack(t.getTracks()[0],t)))}function q(){return v(this,void 0,void 0,(function*(){x("o","create offer");const t=yield S.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});n(13,O=t.sdp)}))}function U(){return v(this,void 0,void 0,(function*(){x("a","create answer");const t=yield S.createAnswer();n(14,M=t.sdp)}))}function J(){const t=xt(O);gt({from:y,offer:t}),f.isRemote&&w.sendOffer(t),yt.dispatchEvent(new CustomEvent(`OfferTo:${k}`,{detail:t}))}function z(){const t=xt(M);vt({from:y,answer:t}),f.isRemote&&w.sendAnswer(t),yt.dispatchEvent(new CustomEvent(`AnswerTo:${k}`,{detail:t}))}function H(t){return v(this,void 0,void 0,(function*(){x("l","setLocalDescription"),console.debug("localDescription ->",t);const e=t;bt({from:y}),S.setLocalDescription(e),V(),bt({from:k})}))}function W(t){x("r","setRemoteDescription");const e=xt(t);S.setRemoteDescription(e),V(),bt({from:k})}function V(){f.isManual?(l||[]).forEach((t=>{t&&(x("ac","addIceCandidate"),S.addIceCandidate(t))})):(console.debug(m[k]),(m[k]||[]).forEach((t=>{t&&(x("ac","addIceCandidate"),S.addIceCandidate(t))})))}function X(t){x("r","setRemoteDescription");const e=Ct(t);S.setRemoteDescription(e),bt({from:y})}return E((()=>{n(7,S=function(){const t=new RTCPeerConnection(F);return t.addEventListener("track",(t=>{x("pct","pc ontrack");const{track:e,streams:n,transceiver:r}=t,o=n[0];console.info(`${y}.ontrack`,{track:e,streams:n,kind:e.kind,transceiver:r}),C.$set({stream:o}),e.addEventListener("ended",(()=>{x("track ended","te"),console.info(`${y} track ended`,{event:t})})),e.addEventListener("mute",(()=>{x("track muted","mute"),console.info(`${y} track muted`,{event:t})})),e.addEventListener("unmute",(()=>{x("track unmuted","unmute"),console.info(`${y} track unmuted`,{event:t})})),o.addEventListener("addtrack",(()=>{x("stream track added","add")})),o.addEventListener("removetrack",(()=>{x("stream track removed","rem")}))})),t.addEventListener("icecandidate",(({candidate:t})=>{x("lc","create candidate"),n(35,P=[...P,t]),function(t){y&&t&&($t({from:y,candidate:t}),f.isRemote&&w.sendCandidate(t))}(t)})),t.addEventListener("signalingstatechange",(()=>n(10,D=t.signalingState))),t.addEventListener("connectionstatechange",(()=>n(11,_=t.connectionState))),t.addEventListener("iceconnectionstatechange",(()=>n(12,A=t.iceConnectionState))),t.addEventListener("negotiationneeded",(()=>x("negotiation needed","nn"))),t.addEventListener("addstream",(t=>{x("addstream","🗑as"),console.warn("addstream",t)})),t.addEventListener("removestream",(t=>{x("removestream","🗑rs"),console.warn("removestream",t)})),console.info(`setup RTCPeerConnection for ${y}`,F,t),t}()),pt.subscribe((({[k]:t})=>{t&&x("rc")})),f.hasCaller&&q()})),t.$$set=t=>{"isCaller"in t&&n(0,$=t.isCaller),"isReceiver"in t&&n(1,b=t.isReceiver),"name"in t&&n(2,y=t.name),"recipient"in t&&n(3,k=t.recipient)},t.$$.update=()=>{32&t.$$.dirty[0]&&n(21,r=f.autoSignal),4&t.$$.dirty[0]|128&t.$$.dirty[1]&&n(24,o=g[y]||[]),8&t.$$.dirty[0]|64&t.$$.dirty[1]&&n(23,i=wt(p[k])),8&t.$$.dirty[0]|32&t.$$.dirty[1]&&n(22,c=wt(h[k])),16&t.$$.dirty[1]&&n(20,a=JSON.stringify(P)),16&t.$$.dirty[0]&&n(19,l=(t=>{try{return JSON.parse(t)}catch(e){return""!==t&&console.warn({parseError:e}),[]}})(I)),32&t.$$.dirty[0]&&n(18,u=f.hideSignaling),32&t.$$.dirty[0]&&n(17,d=f.hideEvents)},[$,b,y,k,I,f,C,S,T,R,D,_,A,O,M,N,j,d,u,l,a,r,c,i,o,w,B,function(){return v(this,void 0,void 0,(function*(){yield q(),H(xt(O)),J()}))},q,U,J,z,H,W,X,P,h,p,g,({detail:t})=>n(9,R=t),()=>n(9,R=void 0),function(t){L[t?"unshift":"push"]((()=>{C=t,n(6,C)}))},()=>B(R),()=>R,function(){$=this.checked,n(0,$)},function(){b=this.checked,n(1,b)},function(){r=this.checked,n(21,r),n(5,f)},function(){O=this.value,n(13,O)},()=>H(xt(O)),function(){c=this.value,n(22,c),n(36,h),n(3,k)},()=>X(c),function(){j=this.value,n(16,j)},()=>X(j),function(){i=this.value,n(23,i),n(37,p),n(3,k)},()=>W(i),function(){N=this.value,n(15,N)},()=>W(N),function(){M=this.value,n(14,M)},()=>H(Ct(M)),function(){a=this.value,n(20,a),n(35,P)},function(){I=this.value,n(4,I)}]}const $e=class extends K{constructor(t){super(),G(this,t,ve,ge,i,{isCaller:0,isReceiver:1,name:2,recipient:3},null,[-1,-1,-1])}};function be(t,e,n){const r=t.slice();return r[1]=e[n].name,r[2]=e[n].event,r}function ye(t){let e,n,r,o,i,c,a,s,l,u=t[1]+"",h=t[2]+"";return{c(){e=p("tr"),n=p("th"),r=g(u),o=g(":"),i=v(),c=p("td"),a=p("code"),s=g(h),l=v()},m(t,u){f(t,e,u),d(e,n),d(n,r),d(n,o),d(e,i),d(e,c),d(c,a),d(a,s),d(e,l)},p(t,e){1&e&&u!==(u=t[1]+"")&&k(r,u),1&e&&h!==(h=t[2]+"")&&k(s,h)},d(t){t&&m(e)}}}function ke(e){let n,r,o,i,c,a=e[0].filter(we),s=[];for(let t=0;t<a.length;t+=1)s[t]=ye(be(e,a,t));return{c(){n=p("section"),r=p("h3"),r.innerHTML="Event Log <small>please open\n        <code>about://webrtc-internals</code></small>",o=v(),i=p("div"),c=p("table");for(let t=0;t<s.length;t+=1)s[t].c();y(c,"class","vertical svelte-111zlyk"),y(i,"class","box")},m(t,e){f(t,n,e),d(n,r),d(n,o),d(n,i),d(i,c);for(let t=0;t<s.length;t+=1)s[t].m(c,null)},p(t,[e]){if(1&e){let n;for(a=t[0].filter(we),n=0;n<a.length;n+=1){const r=be(t,a,n);s[n]?s[n].p(r,e):(s[n]=ye(r),s[n].c(),s[n].m(c,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=a.length}},i:t,o:t,d(t){t&&m(n),h(s,t)}}}const we=t=>t.event;function xe(t,e,n){let r;return s(t,tt,(t=>n(0,r=t))),[r]}const Ce=class extends K{constructor(t){super(),G(this,t,xe,ke,i,{})}};function Se(t){let e,n;return e=new $e({props:{name:"alice",isCaller:"true",recipient:"bob"}}),{c(){W(e.$$.fragment)},m(t,r){V(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Ee(t){let e,n;return e=new $e({props:{name:"bob",isReceiver:"true",recipient:"alice"}}),{c(){W(e.$$.fragment)},m(t,r){V(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Te(t){let e,n;return e=new Ce({}),{c(){W(e.$$.fragment)},m(t,r){V(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Re(t){let e,n,r,o,i,c,a,s,l,u,h=t[0].hasCaller&&Se(),g=t[0].hasReceiver&&Ee(),$=!t[0].hideEvents&&Te();return l=new ft({}),{c(){e=p("div"),n=p("h1"),n.textContent="WebRTC Plumber",r=v(),o=p("main"),h&&h.c(),i=v(),g&&g.c(),c=v(),$&&$.c(),a=v(),s=p("aside"),W(l.$$.fragment),y(o,"class","svelte-1mx8d2d"),y(e,"class","svelte-1mx8d2d")},m(t,m){f(t,e,m),d(e,n),d(e,r),d(e,o),h&&h.m(o,null),d(o,i),g&&g.m(o,null),d(o,c),$&&$.m(o,null),d(e,a),d(e,s),V(l,s,null),u=!0},p(t,[e]){t[0].hasCaller?h?1&e&&z(h,1):(h=Se(),h.c(),z(h,1),h.m(o,i)):h&&(U(),H(h,1,1,(()=>{h=null})),J()),t[0].hasReceiver?g?1&e&&z(g,1):(g=Ee(),g.c(),z(g,1),g.m(o,c)):g&&(U(),H(g,1,1,(()=>{g=null})),J()),t[0].hideEvents?$&&(U(),H($,1,1,(()=>{$=null})),J()):$?1&e&&z($,1):($=Te(),$.c(),z($,1),$.m(o,null))},i(t){u||(z(h),z(g),z($),z(l.$$.fragment,t),u=!0)},o(t){H(h),H(g),H($),H(l.$$.fragment,t),u=!1},d(t){t&&m(e),h&&h.d(),g&&g.d(),$&&$.d(),X(l)}}}function Le(t,e,n){let r;return s(t,ot,(t=>n(0,r=t))),[r]}const De=class extends K{constructor(t){super(),G(this,t,Le,Re,i,{})}};function _e(t,e,n){const r=t.slice();return r[33]=e[n],r}function Ae(t,e,n){const r=t.slice();return r[36]=e[n],r[38]=n,r}function Oe(t){let e,n,r,o,i=(t[36].label||`micorophone ${t[38]}`)+"";function c(){return t[13](t[36])}return{c(){e=p("button"),n=g(i),y(e,"class","svelte-2jsuhx")},m(t,i){f(t,e,i),d(e,n),r||(o=b(e,"click",c),r=!0)},p(e,r){t=e,4&r[0]&&i!==(i=(t[36].label||`micorophone ${t[38]}`)+"")&&k(n,i)},d(t){t&&m(e),r=!1,o()}}}function Me(t){let e;return{c(){e=g("✔️")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Ne(t){let e,n,o,i,c,a,s,l,u,h,$,w,x,C,S,E=t[33].name+"",T=t[1]===t[33]&&Me();function R(){return t[18](t[33])}function L(){return t[19](t[33])}function D(){return t[20](t[33])}return{c(){e=p("tr"),n=p("td"),T&&T.c(),o=v(),i=p("td"),c=p("button"),a=g(E),s=v(),l=p("td"),u=p("button"),u.textContent="stop",h=v(),$=p("td"),w=p("button"),w.textContent="X",x=v(),y(c,"class","svelte-2jsuhx"),y(u,"class","svelte-2jsuhx"),y(w,"class","svelte-2jsuhx")},m(t,r){f(t,e,r),d(e,n),T&&T.m(n,null),d(e,o),d(e,i),d(i,c),d(c,a),d(e,s),d(e,l),d(l,u),d(e,h),d(e,$),d($,w),d(e,x),C||(S=[b(c,"click",R),b(u,"click",L),b(w,"click",D)],C=!0)},p(e,r){(t=e)[1]===t[33]?T||(T=Me(),T.c(),T.m(n,null)):T&&(T.d(1),T=null),8&r[0]&&E!==(E=t[33].name+"")&&k(a,E)},d(t){t&&m(e),T&&T.d(),C=!1,r(S)}}}function je(e){let n,o,i,c,a,s,l,u,g,$,k,w,x,C,S,E,T,R,L,D,_=e[2],A=[];for(let t=0;t<_.length;t+=1)A[t]=Oe(Ae(e,_,t));let O=e[3],M=[];for(let t=0;t<O.length;t+=1)M[t]=Ne(_e(e,O,t));return{c(){n=p("h5"),n.textContent="audio devices",o=v(),i=p("canvas"),c=v(),a=p("nav");for(let t=0;t<A.length;t+=1)A[t].c();s=v(),l=p("audio"),u=p("track"),k=v(),w=p("button"),w.textContent="bars",x=v(),C=p("button"),C.textContent="waveform",S=v(),E=p("button"),E.textContent="volume",T=v(),R=p("table");for(let t=0;t<M.length;t+=1)M[t].c();y(u,"kind","captions"),y(l,"id","upstream"),l.autoplay=g=!1,l.controls=$=Boolean(e[1]),y(a,"class","svelte-2jsuhx"),y(w,"class","svelte-2jsuhx"),y(C,"class","svelte-2jsuhx"),y(E,"class","svelte-2jsuhx")},m(t,r){f(t,n,r),f(t,o,r),f(t,i,r),e[12](i),f(t,c,r),f(t,a,r);for(let t=0;t<A.length;t+=1)A[t].m(a,null);d(a,s),d(a,l),d(l,u),e[14](l),f(t,k,r),f(t,w,r),f(t,x,r),f(t,C,r),f(t,S,r),f(t,E,r),f(t,T,r),f(t,R,r);for(let t=0;t<M.length;t+=1)M[t].m(R,null);L||(D=[b(w,"click",e[15]),b(C,"click",e[16]),b(E,"click",e[17])],L=!0)},p(t,e){if(260&e[0]){let n;for(_=t[2],n=0;n<_.length;n+=1){const r=Ae(t,_,n);A[n]?A[n].p(r,e):(A[n]=Oe(r),A[n].c(),A[n].m(a,s))}for(;n<A.length;n+=1)A[n].d(1);A.length=_.length}if(2&e[0]&&$!==($=Boolean(t[1]))&&(l.controls=$),3594&e[0]){let n;for(O=t[3],n=0;n<O.length;n+=1){const r=_e(t,O,n);M[n]?M[n].p(r,e):(M[n]=Ne(r),M[n].c(),M[n].m(R,null))}for(;n<M.length;n+=1)M[n].d(1);M.length=O.length}},i:t,o:t,d(t){t&&m(n),t&&m(o),t&&m(i),e[12](null),t&&m(c),t&&m(a),h(A,t),e[14](null),t&&m(k),t&&m(w),t&&m(x),t&&m(C),t&&m(S),t&&m(E),t&&m(T),t&&m(R),h(M,t),L=!1,r(D)}}}function Pe(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function c(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))};const o=T();let i,c,a,s,l,u,d,f=[],m=[];function h(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),r=t.frequencyBinCount,o=new Uint8Array(r);let i;function c(){t.getByteTimeDomainData(o),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,e.width,e.height),n.lineWidth=2,n.strokeStyle="rgb(255, 255, 255)",n.beginPath();let a=1*e.width/r,s=0;for(let t=0;t<r;t++){const r=o[t]/128*e.height/2;0===t?n.moveTo(s,r):n.lineTo(s,r),s+=a}n.lineTo(e.width,e.height/2),n.stroke(),i=requestAnimationFrame(c)}return{start(){void 0===i&&c()},stop(){cancelAnimationFrame(i),i=void 0}}}({analyser:l,canvas:a}),u.start()}function p(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),r=t.frequencyBinCount,o=new Float32Array(r);let i;const{width:c,height:a}=e;function s(){t.getFloatFrequencyData(o),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,c,a);for(var e,l=c/r*2.5,u=0,d=0;d<r;d++)e=2*(o[d]+140),n.fillStyle="rgb("+Math.floor(e+100)+",50,50)",n.fillRect(u,a-e/2,l,e/2),u+=l+1;i=requestAnimationFrame(s)}return{start(){void 0===i&&s()},stop(){cancelAnimationFrame(i),i=void 0}}}({analyser:l,canvas:a}),u.start()}function g(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),r=t.frequencyBinCount,o=new Uint8Array(r);let i;function c(){t.getByteTimeDomainData(o),n.fillStyle="rgba(0, 0, 0, 0.1)",n.fillRect(0,0,e.width,e.height),n.font="15px sans-serif",n.strokeStyle="rgb(255, 255, 255)";let a=0;n.lineWidth=5;for(let t=0;t<r;t++){const n=o[t]/128*e.height/2;n>a&&(a=n)}let s=2*(a-75),l=e.height-s;n.beginPath(),n.moveTo(0,l),n.lineTo(e.width,l),n.stroke(),n.fillStyle="rgb(100,255,100)",n.fillRect(0,e.height,e.width,-e.height+l),n.fillStyle="rgb(0,0,0)",n.fillText(String(s),e.width-40,e.height-10),i=requestAnimationFrame(c)}return{start(){void 0===i&&c()},stop(){cancelAnimationFrame(i),i=void 0}}}({analyser:l,canvas:a}),u.start()}function v(){return r(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"audioinput"===t)))}))}function $(t){return r(this,void 0,void 0,(function*(){const e=yield function(t){return r(this,void 0,void 0,(function*(){const e={audio:!t||{deviceId:t}};return yield navigator.mediaDevices.getUserMedia(e)}))}(t);e.name=function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t),b(e),n(3,m=[...m,e])}))}function b(t){n(1,c=t),n(0,i.srcObject=t,i),function(t){console.debug("disconnecting",d),null==d||d.disconnect(l),d=void 0;const e=s.createMediaStreamSource(t);e.connect(l),d=e}(t),o("stream",t)}function y(t){t.getTracks().forEach((t=>t.stop())),o("stop",t)}function k(t){y(t),n(3,m=[...m.filter((e=>e!=t))]),c===t&&n(1,c=void 0)}return E((()=>{v();const t=()=>v();return navigator.mediaDevices.addEventListener("devicechange",t),s||(s=new AudioContext,l=s.createAnalyser(),l.fftSize=2048),g(),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),[i,c,f,m,a,h,p,g,$,b,y,k,function(t){L[t?"unshift":"push"]((()=>{a=t,n(4,a)}))},t=>$(t.deviceId),function(t){L[t?"unshift":"push"]((()=>{i=t,n(0,i)}))},()=>p(),()=>h(),()=>g(),t=>b(t),t=>y(t),t=>k(t)]}const Ie=class extends K{constructor(t){super(),G(this,t,Pe,je,i,{},null,[-1,-1])}};function Fe(t){let e,n;return e=new De({}),{c(){W(e.$$.fragment)},m(t,r){V(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Be(t){let e,n,r,o,i,c,a;return r=new Ie({}),c=new Pt({}),{c(){e=p("section"),n=p("article"),W(r.$$.fragment),o=v(),i=p("article"),W(c.$$.fragment),y(n,"class","box"),y(i,"class","box")},m(t,s){f(t,e,s),d(e,n),V(r,n,null),d(e,o),d(e,i),V(c,i,null),a=!0},i(t){a||(z(r.$$.fragment,t),z(c.$$.fragment,t),a=!0)},o(t){H(r.$$.fragment,t),H(c.$$.fragment,t),a=!1},d(t){t&&m(e),X(r),X(c)}}}function qe(t){let e,n,r,o;const i=[Be,Fe],c=[];function a(t,e){return t[0].audioVisOnly?0:1}return e=a(t),n=c[e]=i[e](t),{c(){n.c(),r=$()},m(t,n){c[e].m(t,n),f(t,r,n),o=!0},p(t,[o]){let s=e;e=a(t),e!==s&&(U(),H(c[s],1,1,(()=>{c[s]=null})),J(),n=c[e],n||(n=c[e]=i[e](t),n.c()),z(n,1),n.m(r.parentNode,r))},i(t){o||(z(n),o=!0)},o(t){H(n),o=!1},d(t){c[e].d(t),t&&m(r)}}}function Ue(t,e,n){let r;return s(t,ot,(t=>n(0,r=t))),[r]}const Je=new class extends K{constructor(t){super(),G(this,t,Ue,qe,i,{})}}({target:document.body,props:{}});window.app=Je})();