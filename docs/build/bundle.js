(()=>{"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t){return 0===Object.keys(t).length}function a(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function s(t,e,n){t.$$.on_destroy.push(a(e,n))}new Set;let l,u=!1;function d(t,e){t.appendChild(e)}function f(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function h(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function g(t){return document.createTextNode(t)}function v(){return g(" ")}function $(){return g("")}function b(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function k(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function w(t,e){t.value=null==e?"":e}function C(t,e,n){t.classList[n?"add":"remove"](e)}function x(t){l=t}function S(){if(!l)throw new Error("Function called outside component initialization");return l}function E(t){S().$$.on_mount.push(t)}function T(){const t=S();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const o=function(t,e,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,!1,e),r}(e,n);r.slice().forEach((e=>{e.call(t,o)}))}}}new Set;const j=[],L=[],D=[],R=[],_=Promise.resolve();let M=!1;function O(){M||(M=!0,_.then(P))}function A(t){D.push(t)}function N(t){R.push(t)}let z=!1;const I=new Set;function P(){if(!z){z=!0;do{for(let t=0;t<j.length;t+=1){const e=j[t];x(e),B(e.$$)}for(x(null),j.length=0;L.length;)L.pop()();for(let t=0;t<D.length;t+=1){const e=D[t];I.has(e)||(I.add(e),e())}D.length=0}while(j.length);for(;R.length;)R.pop()();M=!1,z=!1,I.clear()}}function B(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}const F=new Set;let q;function J(){q={r:0,c:[],p:q}}function U(){q.r||r(q.c),q=q.p}function H(t,e){t&&t.i&&(F.delete(t),t.i(e))}function W(t,e,n,r){if(t&&t.o){if(F.has(t))return;F.add(t),q.c.push((()=>{F.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}const V="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;let G;function X(t,e,n){const r=t.$$.props[e];void 0!==r&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function K(t){t&&t.c()}function Q(t,n,i,c){const{fragment:a,on_mount:s,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,i),c||A((()=>{const n=s.map(e).filter(o);l?l.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(A)}function Y(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Z(e,o,i,c,a,s,d,f=[-1]){const h=l;x(e);const p=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:o.context||[]),callbacks:n(),dirty:f,skip_bound:!1,root:o.target||h.$$.root};d&&d(p.root);let g=!1;if(p.ctx=i?i(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&a(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),g&&function(t,e){-1===t.$$.dirty[0]&&(j.push(t),O(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],p.update(),g=!0,r(p.before_update),p.fragment=!!c&&c(p.ctx),o.target){if(o.hydrate){u=!0;const t=(v=o.target,Array.from(v.childNodes));p.fragment&&p.fragment.l(t),t.forEach(m)}else p.fragment&&p.fragment.c();o.intro&&H(e.$$.fragment),Q(e,o.target,o.anchor,o.customElement),u=!1,P()}var v;x(h)}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(G=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(o);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){r(this.$$.on_disconnect)}$destroy(){Y(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!c(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class tt{$destroy(){Y(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!c(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const et=[];function nt(e,n=t){let r;const o=new Set;function c(t){if(i(e,t)&&(e=t,r)){const t=!et.length;for(const t of o)t[1](),et.push(t,e);if(t){for(let t=0;t<et.length;t+=2)et[t][0](et[t+1]);et.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(i,a=t){const s=[i,a];return o.add(s),1===o.size&&(r=n(c)||t),i(e),()=>{o.delete(s),0===o.size&&(r(),r=null)}}}}function rt(e,n,i){const c=!Array.isArray(e),s=c?[e]:e,l=n.length<2;return{subscribe:nt(i,(e=>{let i=!1;const u=[];let d=0,f=t;const m=()=>{if(d)return;f();const r=n(c?u[0]:u,e);l?e(r):f=o(r)?r:t},h=s.map(((t,e)=>a(t,(t=>{u[e]=t,d&=~(1<<e),i&&m()}),(()=>{d|=1<<e}))));return i=!0,m(),function(){r(h),f()}})).subscribe}}const ot=nt([]),it=t=>{try{return!0===JSON.parse(t)}catch{return!1}},ct=nt((()=>{const t=Object.fromEntries(new URLSearchParams(location.search).entries()),e={role:t.role||"both",stream:t.stream||"both",autoSignal:it(t.autoSignal),audioVisOnly:it(t.audioVisOnly),manual:it(t.manual),remote:it(t.remote),hideSignaling:it(t.hideSignaling),hideEvents:it(t.hideEvents),showCandidateEvents:it(t.showCandidateEvents),showTransceivers:it(t.showTransceivers??!0)};return Object.entries(e).map((([t,e])=>({key:t,value:e})))})()),at=rt(ct,(t=>`${window.origin}${window.location.pathname}?${(t=>{const e=new URLSearchParams;for(let[n,r]of t)e.set(n,r);return e.toString()})(t.map((({key:t,value:e})=>[t,e])))}`)),st=rt(ct,(t=>{const e=Object.fromEntries(t.map((({key:t,value:e})=>[t,e])));let{role:n,stream:r,manual:o,remote:i,hideSignaling:c,hideEvents:a,showTransceivers:s,autoSignal:l,showCandidateEvents:u}=e;const d="recv"!==n,f="call"!==n&&"send"!==n||!1,m="down"!==r||!1,h="up"!==r||!1,p=o&&"no"!==o||!1,g=i&&"no"!==i||!1,v=d?"bob":"alice",$=f?"bob":"alice";return{...e,role:n,stream:r,manual:o,remote:i,hasCaller:d,hasReceiver:f,hasUpstream:m,hasDownstream:h,autoSignal:l,isManual:p,isRemote:g,hideSignaling:c,hideEvents:a,showTransceivers:s,showCandidateEvents:u,to:v,from:$}})),lt=nt({});function ut(t,e,n){const r=t.slice();return r[4]=e[n].key,r[5]=e[n].value,r[6]=e,r[7]=n,r}function dt(t){let e,n,r,o,i,c,a,s=t[4]+"";function l(){t[3].call(i,t[6],t[7])}return{c(){e=p("td"),n=g(s),r=v(),o=p("td"),i=p("input"),y(i,"type","text")},m(s,u){f(s,e,u),d(e,n),f(s,r,u),f(s,o,u),d(o,i),w(i,t[5]),c||(a=b(i,"input",l),c=!0)},p(e,r){t=e,1&r&&s!==(s=t[4]+"")&&k(n,s),1&r&&i.value!==t[5]&&w(i,t[5])},d(t){t&&m(e),t&&m(r),t&&m(o),c=!1,a()}}}function ft(t){let e,n,r,o,i,c,a,s,l,u=t[4]+"";function h(){t[2].call(r,t[6],t[7])}return{c(){e=p("td"),n=p("label"),r=p("input"),i=v(),c=g(u),y(r,"type","checkbox"),y(r,"id",o=t[4]),y(n,"for",a=t[4]),y(e,"colspan","2")},m(o,a){f(o,e,a),d(e,n),d(n,r),r.checked=t[5],d(n,i),d(n,c),s||(l=b(r,"change",h),s=!0)},p(e,i){t=e,1&i&&o!==(o=t[4])&&y(r,"id",o),1&i&&(r.checked=t[5]),1&i&&u!==(u=t[4]+"")&&k(c,u),1&i&&a!==(a=t[4])&&y(n,"for",a)},d(t){t&&m(e),s=!1,l()}}}function mt(t){let e,n;function r(t,e){return"boolean"==typeof t[5]?ft:dt}let o=r(t),i=o(t);return{c(){e=p("tr"),i.c(),n=v()},m(t,r){f(t,e,r),i.m(e,null),d(e,n)},p(t,c){o===(o=r(t))&&i?i.p(t,c):(i.d(1),i=o(t),i&&(i.c(),i.m(e,n)))},d(t){t&&m(e),i.d()}}}function ht(e){let n,r,o,i,c,a,s,l,u,$,b=e[0],w=[];for(let t=0;t<b.length;t+=1)w[t]=mt(ut(e,b,t));return{c(){n=p("details"),r=p("summary"),r.textContent="Config",o=v(),i=p("div"),c=p("table");for(let t=0;t<w.length;t+=1)w[t].c();a=v(),s=p("code"),l=p("pre"),u=p("a"),$=g(e[1]),y(r,"class","svelte-rc03x9"),y(u,"href",e[1]),y(n,"class","svelte-rc03x9")},m(t,e){f(t,n,e),d(n,r),d(n,o),d(n,i),d(i,c);for(let t=0;t<w.length;t+=1)w[t].m(c,null);d(i,a),d(i,s),d(s,l),d(l,u),d(u,$)},p(t,[e]){if(1&e){let n;for(b=t[0],n=0;n<b.length;n+=1){const r=ut(t,b,n);w[n]?w[n].p(r,e):(w[n]=mt(r),w[n].c(),w[n].m(c,null))}for(;n<w.length;n+=1)w[n].d(1);w.length=b.length}2&e&&k($,t[1]),2&e&&y(u,"href",t[1])},i:t,o:t,d(t){t&&m(n),h(w,t)}}}function pt(t,e,n){let r,o;return s(t,ct,(t=>n(0,r=t))),s(t,at,(t=>n(1,o=t))),[r,o,function(t,e){t[e].value=this.checked,ct.set(r)},function(t,e){t[e].value=this.value,ct.set(r)}]}const gt=class extends tt{constructor(t){super(),Z(this,t,pt,ht,i,{})}},vt=nt({}),$t=nt({}),bt=nt({});function yt({from:t,offer:e}){vt.update((n=>({...n,[t]:e})))}function kt({from:t,answer:e}){$t.update((n=>({...n,[t]:e})))}function wt({from:t,candidate:e}){bt.update((n=>{const r=n[t]||[];return{...n,[t]:[...r,e]}}))}function Ct({from:t}){bt.update((e=>({...e,[t]:[]})))}const xt=new EventTarget;class St{to;from;socket;constructor({to:t,from:e}){this.to=t,this.from=e}connect({url:t}){const e=new WebSocket(t);e.onopen=()=>{this.socket=e,this.socket.onmessage=this.received.bind(this)}}received({data:t}){const e=JSON.parse(t),{[this.to]:n,type:r}=e;console.debug("its for me!",n);const o=this.to;switch(r){case"offer":yt({from:o,offer:n});break;case"answer":kt({from:o,answer:n});break;case"candidate":wt({from:o,candidate:new RTCIceCandidate(n)})}}sendOffer(t){if(t){const e={[this.from]:t,type:"offer"};this.send(e)}}sendAnswer(t){if(t){const e={[this.from]:t,type:"answer"};this.send(e)}}sendCandidate(t){if(t){const e={[this.from]:t,type:"candidate"};this.send(e)}}send(t){if(this.socket){const e=JSON.stringify(t);this.socket.send(e)}}toString(){return`[Signaling Server calling ${this.from} → ${this.to}]`}}const Et=t=>"string"==typeof t?JSON.parse(t).sdp:"object"==typeof t?t.sdp:void 0,Tt=t=>({type:"offer",sdp:t}),jt=t=>({type:"answer",sdp:t});function Lt(e){let n,r,o,i,c,a,s,l,u=JSON.stringify(e[2],null,4)+"";return{c(){n=p("details"),r=p("summary"),o=g(e[1]),i=v(),c=p("pre"),a=p("code"),s=g(u),n.open=l=Boolean(e[2])&&e[0]},m(t,e){f(t,n,e),d(n,r),d(r,o),d(n,i),d(n,c),d(c,a),d(a,s)},p(t,[e]){2&e&&k(o,t[1]),4&e&&u!==(u=JSON.stringify(t[2],null,4)+"")&&k(s,u),5&e&&l!==(l=Boolean(t[2])&&t[0])&&(n.open=l)},i:t,o:t,d(t){t&&m(n)}}}function Dt(t,e,n){let{open:r=!0}=e,{summary:o="???"}=e,{data:i}=e;return t.$$set=t=>{"open"in t&&n(0,r=t.open),"summary"in t&&n(1,o=t.summary),"data"in t&&n(2,i=t.data)},[r,o,i]}const Rt=class extends tt{constructor(t){super(),Z(this,t,Dt,Lt,i,{open:0,summary:1,data:2})}};function _t(t,e,n){const r=t.slice();return r[27]=e[n],r}function Mt(t,e,n){const r=t.slice();return r[30]=e[n],r[32]=n,r}function Ot(t){let e,n,r,o,i,c=(t[30].label||`camera ${t[32]}`)+"";function a(){return t[18](t[30])}return{c(){e=p("button"),n=g(c),r=v(),y(e,"class","svelte-vk2oy1")},m(t,c){f(t,e,c),d(e,n),d(e,r),o||(i=b(e,"click",a),o=!0)},p(e,r){t=e,4&r[0]&&c!==(c=(t[30].label||`camera ${t[32]}`)+"")&&k(n,c)},d(t){t&&m(e),o=!1,i()}}}function At(t){let e;return{c(){e=g("✔️")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Nt(t){let e;return{c(){e=g("(canvas)")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function zt(t){let e,n,o,i,c,a,s,l,u,h,$,w,C,x,S,E,T,j=t[27].name+"",L=t[9](t[27]),D=t[0]===t[27]&&At();function R(){return t[19](t[27])}function _(){return t[20](t[27])}function M(){return t[21](t[27])}let O=L&&Nt();return{c(){e=p("tr"),n=p("td"),D&&D.c(),o=v(),i=p("td"),c=p("button"),a=g(j),s=v(),l=p("td"),u=p("button"),u.textContent="stop",h=v(),$=p("td"),w=p("button"),w.textContent="X",C=v(),x=p("td"),O&&O.c(),S=v(),y(c,"class","svelte-vk2oy1"),y(u,"class","svelte-vk2oy1"),y(w,"class","svelte-vk2oy1")},m(t,r){f(t,e,r),d(e,n),D&&D.m(n,null),d(e,o),d(e,i),d(i,c),d(c,a),d(e,s),d(e,l),d(l,u),d(e,h),d(e,$),d($,w),d(e,C),d(e,x),O&&O.m(x,null),d(e,S),E||(T=[b(c,"click",R),b(u,"click",_),b(w,"click",M)],E=!0)},p(e,r){(t=e)[0]===t[27]?D||(D=At(),D.c(),D.m(n,null)):D&&(D.d(1),D=null),8&r[0]&&j!==(j=t[27].name+"")&&k(a,j),8&r[0]&&(L=t[9](t[27])),L?O||(O=Nt(),O.c(),O.m(x,null)):O&&(O.d(1),O=null)},d(t){t&&m(e),D&&D.d(),O&&O.d(),E=!1,r(T)}}}function It(t){let e,n,r,o,i,c,a,s,l,u,h,$,b,y,w,C,x,S,E,T=t[8].readyState+"";return C=new Rt({props:{summary:"settings",data:t[8].getSettings()}}),S=new Rt({props:{summary:"constraints",data:t[8].getConstraints()}}),{c(){e=p("details"),n=p("summary"),r=g(t[7]),o=g(" / "),i=g(t[6]),c=g(" / "),a=g(t[5]),s=g("/ "),l=g(t[4]),u=v(),h=p("dl"),$=p("dt"),$.textContent="readState",b=p("dd"),y=g(T),w=v(),K(C.$$.fragment),x=v(),K(S.$$.fragment)},m(t,m){f(t,e,m),d(e,n),d(n,r),d(n,o),d(n,i),d(n,c),d(n,a),d(n,s),d(n,l),d(e,u),d(e,h),d(h,$),d(h,b),d(b,y),d(e,w),Q(C,e,null),d(e,x),Q(S,e,null),E=!0},p(t,e){(!E||128&e[0])&&k(r,t[7]),(!E||64&e[0])&&k(i,t[6]),(!E||32&e[0])&&k(a,t[5]),(!E||16&e[0])&&k(l,t[4]),(!E||256&e[0])&&T!==(T=t[8].readyState+"")&&k(y,T);const n={};256&e[0]&&(n.data=t[8].getSettings()),C.$set(n);const o={};256&e[0]&&(o.data=t[8].getConstraints()),S.$set(o)},i(t){E||(H(C.$$.fragment,t),H(S.$$.fragment,t),E=!0)},o(t){W(C.$$.fragment,t),W(S.$$.fragment,t),E=!1},d(t){t&&m(e),Y(C),Y(S)}}}function Pt(t){let e,n,o,i,c,a,s,l,u,g,k,w,C,x,S,E,T,j,L=t[2],D=[];for(let e=0;e<L.length;e+=1)D[e]=Ot(Mt(t,L,e));let R=t[3],_=[];for(let e=0;e<R.length;e+=1)_[e]=zt(_t(t,R,e));let M=t[8]&&It(t);return{c(){e=p("h5"),e.textContent="upstream",n=v(),o=p("video"),o.innerHTML='<track kind="captions"/>',i=v(),c=p("nav"),a=p("button"),a.textContent="default",s=v(),l=p("button"),l.textContent="noise",u=v(),g=p("br"),k=v();for(let t=0;t<D.length;t+=1)D[t].c();w=v(),C=p("table");for(let t=0;t<_.length;t+=1)_[t].c();x=v(),M&&M.c(),S=$(),y(o,"id","upstream"),o.autoplay="true",y(o,"class","svelte-vk2oy1"),y(a,"class","svelte-vk2oy1"),y(l,"class","svelte-vk2oy1"),y(c,"class","svelte-vk2oy1")},m(r,m){f(r,e,m),f(r,n,m),f(r,o,m),t[15](o),f(r,i,m),f(r,c,m),d(c,a),d(c,s),d(c,l),d(c,u),d(c,g),d(c,k);for(let t=0;t<D.length;t+=1)D[t].m(c,null);f(r,w,m),f(r,C,m);for(let t=0;t<_.length;t+=1)_[t].m(C,null);f(r,x,m),M&&M.m(r,m),f(r,S,m),E=!0,T||(j=[b(a,"click",t[16]),b(l,"click",t[17])],T=!0)},p(t,e){if(2052&e[0]){let n;for(L=t[2],n=0;n<L.length;n+=1){const r=Mt(t,L,n);D[n]?D[n].p(r,e):(D[n]=Ot(r),D[n].c(),D[n].m(c,null))}for(;n<D.length;n+=1)D[n].d(1);D.length=L.length}if(29193&e[0]){let n;for(R=t[3],n=0;n<R.length;n+=1){const r=_t(t,R,n);_[n]?_[n].p(r,e):(_[n]=zt(r),_[n].c(),_[n].m(C,null))}for(;n<_.length;n+=1)_[n].d(1);_.length=R.length}t[8]?M?(M.p(t,e),256&e[0]&&H(M,1)):(M=It(t),M.c(),H(M,1),M.m(S.parentNode,S)):M&&(J(),W(M,1,1,(()=>{M=null})),U())},i(t){E||(H(M),E=!0)},o(t){W(M),E=!1},d(a){a&&m(e),a&&m(n),a&&m(o),t[15](null),a&&m(i),a&&m(c),h(D,a),a&&m(w),a&&m(C),h(_,a),a&&m(x),M&&M.d(a),a&&m(S),T=!1,r(j)}}}function Bt(t,e,n){let r,o,i,c,a;var s=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function c(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))};const l=T();let u,d,f=[],m=[];function h(){return s(this,void 0,void 0,(function*(){const t=yield function(){let t=Object.assign(document.createElement("canvas"),{width:400,height:300}),e=t.getContext("2d");e.fillRect(0,0,t.width,t.height);let n=e.getImageData(0,0,t.width,t.height);return requestAnimationFrame((function t(){for(var r=0;r<n.data.length;r++)n.data[r++]=n.data[r++]=n.data[r++]=255*Math.random();e.putImageData(n,0,0),requestAnimationFrame(t)})),t.captureStream(60)}();t.name="noise feed",g(t),n(3,m=[...m,t])}))}function p(t){return s(this,void 0,void 0,(function*(){const e=yield function(t){return s(this,void 0,void 0,(function*(){const e={video:!t||{deviceId:t}};return yield navigator.mediaDevices.getUserMedia(e)}))}(t);e.name=t?function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t):"default webcam",g(e),n(3,m=[...m,e])}))}function g(t){n(0,d=t),n(1,u.srcObject=t,u),l("stream",t)}function v(t){t.getTracks().forEach((t=>t.stop())),l("stop",t)}function $(t){v(t),n(3,m=[...m.filter((e=>e!=t))]),d===t&&n(0,d=void 0)}function b(){return s(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"videoinput"===t)))}))}return E((()=>{b();const t=()=>b();return navigator.mediaDevices.addEventListener("devicechange",t),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),t.$$.update=()=>{1&t.$$.dirty[0]&&n(8,r=d&&d.getTracks()[0]),1&t.$$.dirty[0]&&n(7,o=d&&d.constructor.name),1&t.$$.dirty[0]&&n(6,i=d&&d.getTracks()[0].constructor.name),1&t.$$.dirty[0]&&n(5,c=d&&d.canvas),1&t.$$.dirty[0]&&n(4,a=d&&d.getTracks()[0].canvas)},[d,u,f,m,a,c,i,o,r,t=>"CanvasCaptureMediaStream"===(null==t?void 0:t.constructor.name)||"CanvasCaptureMediaStreamTrack"===(null==t?void 0:t.getTracks()[0].constructor.name),h,p,g,v,$,function(t){L[t?"unshift":"push"]((()=>{u=t,n(1,u)}))},()=>p(),()=>h(),t=>p(t.deviceId),t=>g(t),t=>v(t),t=>$(t)]}const Ft=class extends tt{constructor(t){super(),Z(this,t,Bt,Pt,i,{},null,[-1,-1])}};function qt(t){let e,n,r,o;return e=new Rt({props:{summary:"settings",data:t[1].getSettings(),open:!1}}),r=new Rt({props:{summary:"constraints",data:t[1].getConstraints(),open:!1}}),{c(){K(e.$$.fragment),n=v(),K(r.$$.fragment)},m(t,i){Q(e,t,i),f(t,n,i),Q(r,t,i),o=!0},p(t,n){const o={};2&n&&(o.data=t[1].getSettings()),e.$set(o);const i={};2&n&&(i.data=t[1].getConstraints()),r.$set(i)},i(t){o||(H(e.$$.fragment,t),H(r.$$.fragment,t),o=!0)},o(t){W(e.$$.fragment,t),W(r.$$.fragment,t),o=!1},d(t){Y(e,t),t&&m(n),Y(r,t)}}}function Jt(t){let e,n,r,o,i,c,a,s=t[1]&&qt(t);return{c(){e=p("h5"),e.textContent="downstream",n=v(),r=p("video"),r.innerHTML='<track kind="captions"/>',i=v(),s&&s.c(),c=$(),r.autoplay=o=!0},m(o,l){f(o,e,l),f(o,n,l),f(o,r,l),t[3](r),f(o,i,l),s&&s.m(o,l),f(o,c,l),a=!0},p(t,[e]){t[1]?s?(s.p(t,e),2&e&&H(s,1)):(s=qt(t),s.c(),H(s,1),s.m(c.parentNode,c)):s&&(J(),W(s,1,1,(()=>{s=null})),U())},i(t){a||(H(s),a=!0)},o(t){W(s),a=!1},d(o){o&&m(e),o&&m(n),o&&m(r),t[3](null),o&&m(i),s&&s.d(o),o&&m(c)}}}function Ut(t,e,n){let r,o,{stream:i}=e;return t.$$set=t=>{"stream"in t&&n(2,i=t.stream)},t.$$.update=()=>{4&t.$$.dirty&&n(1,r=i&&i.getTracks()[0]),5&t.$$.dirty&&o&&n(0,o.srcObject=i,o)},[o,r,i,function(t){L[t?"unshift":"push"]((()=>{o=t,n(0,o),n(2,i)}))}]}const Ht=class extends tt{constructor(t){super(),Z(this,t,Ut,Jt,i,{stream:2})}};function Wt(e){let n,o,i,c,a,s,l;return{c(){n=p("form"),o=p("input"),i=v(),c=p("code"),a=g(e[0]),y(o,"size","90"),y(o,"placeholder","ws url")},m(t,r){var u;f(t,n,r),d(n,o),w(o,e[1]),f(t,i,r),f(t,c,r),d(c,a),s||(l=[b(o,"input",e[2]),b(n,"submit",(u=Vt,function(t){return t.preventDefault(),u.call(this,t)}))],s=!0)},p(t,[e]){2&e&&o.value!==t[1]&&w(o,t[1]),1&e&&k(a,t[0])},i:t,o:t,d(t){t&&m(n),t&&m(i),t&&m(c),s=!1,r(l)}}}function Vt(){}function Gt(t,e,n){let r,{signalingClient:o}=e;return t.$$set=t=>{"signalingClient"in t&&n(0,o=t.signalingClient)},t.$$.update=()=>{3&t.$$.dirty&&(o.connect({url:r}),window.client=o)},n(1,r=`wss://${window.location.host}/signaling/test`),[o,r,function(){r=this.value,n(1,r)}]}const Xt=class extends tt{constructor(t){super(),Z(this,t,Gt,Wt,i,{signalingClient:0})}},{Boolean:Kt}=V;function Qt(t,e,n){const r=t.slice();return r[18]=e[n][0],r[19]=e[n][1],r[20]=e,r[21]=n,r}function Yt(t,e,n){const r=t.slice();return r[22]=e[n],r}function Zt(t){let e,n,r=t[1],o=[];for(let e=0;e<r.length;e+=1)o[e]=oe(Qt(t,r,e));const i=t=>W(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=$()},m(t,r){for(let e=0;e<o.length;e+=1)o[e].m(t,r);f(t,e,r),n=!0},p(t,n){if(827&n){let c;for(r=t[1],c=0;c<r.length;c+=1){const i=Qt(t,r,c);o[c]?(o[c].p(i,n),H(o[c],1)):(o[c]=oe(i),o[c].c(),H(o[c],1),o[c].m(e.parentNode,e))}for(J(),c=r.length;c<o.length;c+=1)i(c);U()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)H(o[t]);n=!0}},o(t){o=o.filter(Kt);for(let t=0;t<o.length;t+=1)W(o[t]);n=!1},d(t){h(o,t),t&&m(e)}}}function te(t){let e,n,i,c,a,s,l,u,$,w,C,x,S,E,T,j,L,D,R,_,M,O,A,N,z,I,P,B,F,q,J,U,V,G,X,Z,tt,et,nt,rt,ot,it,ct,at,st,lt,ut,dt,ft,mt,ht,pt,gt,vt,$t,bt,yt,kt,wt,Ct,xt,St,Et,Tt,jt,Lt,Dt,_t,Mt,Ot,At,Nt,zt,It,Pt,Bt,Ft,qt,Jt,Ut,Ht,Wt,Vt,Gt,Xt,Kt,Qt,Zt,te,oe,ie,ce,ae,se,le,ue,de,fe,me,he,pe,ge=t[19].currentDirection+"",ve=t[19].direction+"",$e=t[4].has(t[18]),be=t[9](t[19].sender.track)+"",ye=t[8](t[19].sender.parameters.encodings)+"",ke=t[8](t[19].sender.parameters.rtcp)+"",we=t[8](t[19].sender.ssrcs)+"",Ce=t[8](t[19].sender.csrcs)+"",xe=t[9](t[19].receiver.track)+"",Se=t[8](t[19].receiver.ssrcs)+"",Ee=t[8](t[19].receiver.csrcs)+"",Te=t[4].has(t[18]),je=["sendrecv","sendonly","recvonly","inactive"],Le=[];for(let e=0;e<4;e+=1)Le[e]=ee(Yt(t,je,e));function De(...e){return t[11](t[18],t[20],t[21],...e)}let Re=$e&&ne(t);function _e(){return t[12](t[18])}Ct=new Rt({props:{summary:"verbose",data:t[19].sender,open:!1}}),Zt=new Rt({props:{summary:"verbose",data:t[19].receiver,open:!1}});let Me=Te&&re(t);function Oe(){return t[14](t[18])}function Ae(){return t[15](t[18])}return{c(){e=p("div"),n=p("table"),i=p("tr"),c=p("th"),c.textContent="direction",a=v(),s=p("td"),l=p("strong"),u=p("code"),$=g(ge),w=v(),C=p("em"),x=p("code"),S=g("("),E=g(ve),T=g(")"),j=v(),L=p("select");for(let t=0;t<4;t+=1)Le[t].c();D=v(),Re&&Re.c(),R=v(),_=p("hr"),M=v(),O=p("table"),A=p("tablehead"),A.innerHTML='<tr><th colspan="2" class="svelte-1ycjrzf">sender</th></tr>',N=v(),z=p("tr"),I=p("th"),I.textContent="track",P=v(),B=p("td"),F=p("code"),q=g(be),J=v(),U=p("tr"),V=p("th"),V.textContent="encodings",G=v(),X=p("td"),Z=p("code"),tt=g(ye),et=v(),nt=p("tr"),rt=p("th"),rt.textContent="rtcp",ot=v(),it=p("td"),ct=p("code"),at=g(ke),st=v(),lt=p("tr"),ut=p("th"),ut.textContent="ssrcs",dt=v(),ft=p("td"),mt=p("code"),ht=g(we),pt=v(),gt=p("tr"),vt=p("th"),vt.textContent="csrcs",$t=v(),bt=p("td"),yt=p("code"),kt=g(Ce),wt=v(),K(Ct.$$.fragment),xt=v(),St=p("hr"),Et=v(),Tt=p("table"),jt=p("tablehead"),jt.innerHTML='<tr><th colspan="2" class="svelte-1ycjrzf">receiver</th></tr>',Lt=v(),Dt=p("tr"),_t=p("th"),_t.textContent="track",Mt=v(),Ot=p("td"),At=p("code"),Nt=g(xe),zt=v(),It=p("tr"),Pt=p("th"),Pt.textContent="ssrcs",Bt=v(),Ft=p("td"),qt=p("code"),Jt=g(Se),Ut=v(),Ht=p("tr"),Wt=p("th"),Wt.textContent="csrcs",Vt=v(),Gt=p("td"),Xt=p("code"),Kt=g(Ee),Qt=v(),K(Zt.$$.fragment),te=v(),oe=p("div"),ie=p("button"),ie.textContent="replaceTrack",ce=v(),ae=p("button"),ae.textContent="replaceTrack(null)",se=v(),Me&&Me.c(),le=v(),ue=p("button"),ue.textContent="stop",de=v(),fe=p("button"),fe.textContent="removeTrack",y(c,"class","svelte-1ycjrzf"),y(A,"class","svelte-1ycjrzf"),y(I,"class","svelte-1ycjrzf"),y(V,"class","svelte-1ycjrzf"),y(rt,"class","svelte-1ycjrzf"),y(ut,"class","svelte-1ycjrzf"),y(vt,"class","svelte-1ycjrzf"),y(jt,"class","svelte-1ycjrzf"),y(_t,"class","svelte-1ycjrzf"),y(Pt,"class","svelte-1ycjrzf"),y(Wt,"class","svelte-1ycjrzf"),y(ie,"class","btn-small"),y(ae,"class","btn-small"),y(ue,"class","btn-small"),y(fe,"class","btn-small")},m(r,m){f(r,e,m),d(e,n),d(n,i),d(i,c),d(i,a),d(i,s),d(s,l),d(l,u),d(u,$),d(s,w),d(s,C),d(C,x),d(x,S),d(x,E),d(x,T),d(s,j),d(s,L);for(let t=0;t<4;t+=1)Le[t].m(L,null);d(n,D),Re&&Re.m(n,null),d(e,R),d(e,_),d(e,M),d(e,O),d(O,A),d(O,N),d(O,z),d(z,I),d(z,P),d(z,B),d(B,F),d(F,q),d(O,J),d(O,U),d(U,V),d(U,G),d(U,X),d(X,Z),d(Z,tt),d(O,et),d(O,nt),d(nt,rt),d(nt,ot),d(nt,it),d(it,ct),d(ct,at),d(O,st),d(O,lt),d(lt,ut),d(lt,dt),d(lt,ft),d(ft,mt),d(mt,ht),d(O,pt),d(O,gt),d(gt,vt),d(gt,$t),d(gt,bt),d(bt,yt),d(yt,kt),d(e,wt),Q(Ct,e,null),d(e,xt),d(e,St),d(e,Et),d(e,Tt),d(Tt,jt),d(Tt,Lt),d(Tt,Dt),d(Dt,_t),d(Dt,Mt),d(Dt,Ot),d(Ot,At),d(At,Nt),d(Tt,zt),d(Tt,It),d(It,Pt),d(It,Bt),d(It,Ft),d(Ft,qt),d(qt,Jt),d(Tt,Ut),d(Tt,Ht),d(Ht,Wt),d(Ht,Vt),d(Ht,Gt),d(Gt,Xt),d(Xt,Kt),d(e,Qt),Q(Zt,e,null),f(r,te,m),f(r,oe,m),d(oe,ie),d(oe,ce),d(oe,ae),d(oe,se),Me&&Me.m(oe,null),d(oe,le),d(oe,ue),d(oe,de),d(oe,fe),me=!0,he||(pe=[b(L,"change",De),b(ie,"click",(function(){o(t[5](t[18].sender))&&t[5](t[18].sender).apply(this,arguments)})),b(ae,"click",_e),b(ue,"click",Oe),b(fe,"click",Ae)],he=!0)},p(e,r){if(t=e,(!me||2&r)&&ge!==(ge=t[19].currentDirection+"")&&k($,ge),(!me||2&r)&&ve!==(ve=t[19].direction+"")&&k(E,ve),2&r){let e;for(je=["sendrecv","sendonly","recvonly","inactive"],e=0;e<4;e+=1){const n=Yt(t,je,e);Le[e]?Le[e].p(n,r):(Le[e]=ee(n),Le[e].c(),Le[e].m(L,null))}for(;e<4;e+=1)Le[e].d(1)}2&r&&($e=t[4].has(t[18])),$e?Re?Re.p(t,r):(Re=ne(t),Re.c(),Re.m(n,null)):Re&&(Re.d(1),Re=null),(!me||2&r)&&be!==(be=t[9](t[19].sender.track)+"")&&k(q,be),(!me||2&r)&&ye!==(ye=t[8](t[19].sender.parameters.encodings)+"")&&k(tt,ye),(!me||2&r)&&ke!==(ke=t[8](t[19].sender.parameters.rtcp)+"")&&k(at,ke),(!me||2&r)&&we!==(we=t[8](t[19].sender.ssrcs)+"")&&k(ht,we),(!me||2&r)&&Ce!==(Ce=t[8](t[19].sender.csrcs)+"")&&k(kt,Ce);const o={};2&r&&(o.data=t[19].sender),Ct.$set(o),(!me||2&r)&&xe!==(xe=t[9](t[19].receiver.track)+"")&&k(Nt,xe),(!me||2&r)&&Se!==(Se=t[8](t[19].receiver.ssrcs)+"")&&k(Jt,Se),(!me||2&r)&&Ee!==(Ee=t[8](t[19].receiver.csrcs)+"")&&k(Kt,Ee);const i={};2&r&&(i.data=t[19].receiver),Zt.$set(i),2&r&&(Te=t[4].has(t[18])),Te?Me?Me.p(t,r):(Me=re(t),Me.c(),Me.m(oe,le)):Me&&(Me.d(1),Me=null)},i(t){me||(H(Ct.$$.fragment,t),H(Zt.$$.fragment,t),me=!0)},o(t){W(Ct.$$.fragment,t),W(Zt.$$.fragment,t),me=!1},d(t){t&&m(e),h(Le,t),Re&&Re.d(),Y(Ct),Y(Zt),t&&m(te),t&&m(oe),Me&&Me.d(),he=!1,r(pe)}}}function ee(t){let e,n,r,o;return{c(){e=p("option"),n=g(t[22]),e.__value=r=t[22],e.value=e.__value,e.selected=o=t[22]===t[18].currentDirection},m(t,r){f(t,e,r),d(e,n)},p(t,n){2&n&&o!==(o=t[22]===t[18].currentDirection)&&(e.selected=o)},d(t){t&&m(e)}}}function ne(t){let e,n,r,o,i,c,a=(t[4].has(t[18])&&t[4].get(t[18]))+"";return{c(){e=p("tr"),n=p("th"),n.textContent="track",r=v(),o=p("td"),i=p("code"),c=g(a),y(n,"class","svelte-1ycjrzf")},m(t,a){f(t,e,a),d(e,n),d(e,r),d(e,o),d(o,i),d(i,c)},p(t,e){2&e&&a!==(a=(t[4].has(t[18])&&t[4].get(t[18]))+"")&&k(c,a)},d(t){t&&m(e)}}}function re(t){let e,n,r;function o(){return t[13](t[18])}return{c(){e=p("button"),e.textContent="display track",y(e,"class","btn-small")},m(t,i){f(t,e,i),n||(r=b(e,"click",o),n=!0)},p(e,n){t=e},d(t){t&&m(e),n=!1,r()}}}function oe(t){let e,n,r,o,i,c,a,s,l=t[19].mid+"",u=(null!==t[19].mid||t[19].track)&&te(t);return{c(){e=p("div"),n=p("strong"),n.textContent="mid:",r=v(),o=p("code"),i=g(l),c=v(),u&&u.c(),a=v(),y(e,"class","grid box svelte-1ycjrzf")},m(t,l){f(t,e,l),d(e,n),d(e,r),d(e,o),d(o,i),d(e,c),u&&u.m(e,null),d(e,a),s=!0},p(t,n){(!s||2&n)&&l!==(l=t[19].mid+"")&&k(i,l),null!==t[19].mid||t[19].track?u?(u.p(t,n),2&n&&H(u,1)):(u=te(t),u.c(),H(u,1),u.m(e,a)):u&&(J(),W(u,1,1,(()=>{u=null})),U())},i(t){s||(H(u),s=!0)},o(t){W(u),s=!1},d(t){t&&m(e),u&&u.d()}}}function ie(t){let e,n,o,i,c,a,s,l,u,h,g,$=t[1]&&Zt(t);return{c(){e=p("details"),n=p("summary"),n.innerHTML="<strong>transceivers</strong>",o=v(),$&&$.c(),i=v(),c=p("button"),c.textContent="add video transceiver",a=v(),s=p("button"),s.textContent="update",y(s,"class","btn-small"),e.open=l=Boolean(t[2].showTransceivers)},m(r,l){f(r,e,l),d(e,n),d(e,o),$&&$.m(e,null),d(e,i),d(e,c),d(e,a),d(e,s),u=!0,h||(g=[b(c,"click",t[6]),b(s,"click",t[7])],h=!0)},p(t,[n]){t[1]?$?($.p(t,n),2&n&&H($,1)):($=Zt(t),$.c(),H($,1),$.m(e,i)):$&&(J(),W($,1,1,(()=>{$=null})),U()),(!u||4&n&&l!==(l=Boolean(t[2].showTransceivers)))&&(e.open=l)},i(t){u||(H($),u=!0)},o(t){W($),u=!1},d(t){t&&m(e),$&&$.d(),h=!1,r(g)}}}function ce(t,e,n){let r,o;s(t,st,(t=>n(2,o=t)));var i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function c(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))};let{peerconnection:c}=e,{streamSource:a}=e;const l=T();let u;const d=new Map;function f(){n(1,u=c&&c.getTransceivers().map((t=>{const{mid:e,direction:n,currentDirection:r,sender:o,receiver:i}=t;let c={},a={};{let{dtmf:t,track:e,transport:n}=o;c={dtmf:t,track:e,transport:n,parameters:o.getParameters&&o.getParameters()}}{let{dtmf:t,track:e,transport:n}=i;a={dtmf:t,track:e,transport:n,parameters:i.getParameters&&i.getParameters(),csrcs:i.getContributingSources(),ssrcs:i.getSynchronizationSources()}}return[t,{mid:e,direction:n,currentDirection:r,sender:c,receiver:a}]})))}return E((()=>i(void 0,void 0,void 0,(function*(){const t=setInterval((()=>{r&&f()}),1e3);return yield(O(),_),c.addEventListener("track",(({track:t,transceiver:e,streams:n})=>{n[0]||new MediaStream([t]),d.set(e,t),f()})),()=>clearInterval(t)})))),t.$$set=t=>{"peerconnection"in t&&n(0,c=t.peerconnection),"streamSource"in t&&n(10,a=t.streamSource)},t.$$.update=()=>{1&t.$$.dirty&&(r=c&&c.getTransceivers())},[c,u,o,l,d,function(t){return()=>{const e=a().getTracks()[0];e&&t.replaceTrack(e)}},function(){c.addTransceiver("video"),r=c.getTransceivers(),f()},f,t=>new Array(t).flatMap((t=>JSON.stringify(t))),t=>{var e;return JSON.stringify(null===(e=null==t?void 0:t.constructor)||void 0===e?void 0:e.name)},a,(t,e,r,{target:o})=>n(1,e[r][0].direction=o.value,u),t=>t.sender.replaceTrack(null),t=>l("track",d.get(t)),t=>t.stop(),t=>c.removeTrack(t.sender)]}const ae=class extends tt{constructor(t){super(),Z(this,t,ce,ie,i,{peerconnection:0,streamSource:10})}};function se(e){let n,r,o,i,c,a,s,l,u,h,$,x,S,E,T,j,L,D,R,_,M=e[4].join(", ")+"";return{c(){n=p("div"),r=p("textarea"),o=v(),i=p("div"),c=p("table"),a=p("tr"),s=p("th"),s.textContent="mlines",l=v(),u=p("td"),h=p("code"),$=g(e[5]),x=v(),S=p("tr"),E=p("th"),E.textContent="directions",T=v(),j=p("td"),L=p("code"),D=g(M),y(r,"rows",e[1]),y(r,"name",e[2]),y(r,"class","svelte-cn7s01"),C(r,"hideSignaling",e[3]),y(c,"class","vertical"),y(i,"class","box")},m(t,m){f(t,n,m),d(n,r),w(r,e[0]),d(n,o),d(n,i),d(i,c),d(c,a),d(a,s),d(a,l),d(a,u),d(u,h),d(h,$),d(c,x),d(c,S),d(S,E),d(S,T),d(S,j),d(j,L),d(L,D),R||(_=b(r,"input",e[7]),R=!0)},p(t,[e]){2&e&&y(r,"rows",t[1]),4&e&&y(r,"name",t[2]),1&e&&w(r,t[0]),8&e&&C(r,"hideSignaling",t[3]),32&e&&k($,t[5]),16&e&&M!==(M=t[4].join(", ")+"")&&k(D,M)},i:t,o:t,d(t){t&&m(n),R=!1,_()}}}function le(t,e,n){let r,o,i,{value:c}=e,{rows:a}=e,{name:s}=e,{hideSignaling:l}=e;return t.$$set=t=>{"value"in t&&n(0,c=t.value),"rows"in t&&n(1,a=t.rows),"name"in t&&n(2,s=t.name),"hideSignaling"in t&&n(3,l=t.hideSignaling)},t.$$.update=()=>{1&t.$$.dirty&&n(6,r=c.split("\n")),64&t.$$.dirty&&n(5,o=r.filter((t=>t.startsWith("m="))).length),64&t.$$.dirty&&n(4,i=Array.from(r.filter((t=>t.startsWith("a=sendrecv")||t.startsWith("a=sendonly")||t.startsWith("a=recvonly")||t.startsWith("a=inactive"))),(t=>null==t?void 0:t.slice(2))))},[c,a,s,l,i,o,r,function(){c=this.value,n(0,c)}]}const ue=class extends tt{constructor(t){super(),Z(this,t,le,se,i,{value:0,rows:1,name:2,hideSignaling:3})}};function de(e){let n,r;return n=new Xt({props:{signalingClient:e[26]}}),{c(){K(n.$$.fragment)},m(t,e){Q(n,t,e),r=!0},p:t,i(t){r||(H(n.$$.fragment,t),r=!0)},o(t){W(n.$$.fragment,t),r=!1},d(t){Y(n,t)}}}function fe(e){let n,r,o;return r=new Ft({}),r.$on("stream",e[41]),r.$on("stop",e[42]),{c(){n=p("article"),K(r.$$.fragment),y(n,"id","upstream"),y(n,"class","box")},m(t,e){f(t,n,e),Q(r,n,null),o=!0},p:t,i(t){o||(H(r.$$.fragment,t),o=!0)},o(t){W(r.$$.fragment,t),o=!1},d(t){t&&m(n),Y(r)}}}function me(t){let e,n,r;return n=new Ht({props:{stream:void 0}}),t[43](n),{c(){e=p("article"),K(n.$$.fragment),y(e,"id","downstream"),y(e,"class","box")},m(t,o){f(t,e,o),Q(n,e,null),r=!0},p(t,e){n.$set({})},i(t){r||(H(n.$$.fragment,t),r=!0)},o(t){W(n.$$.fragment,t),r=!1},d(r){r&&m(e),t[43](null),Y(n)}}}function he(t){let e;return{c(){e=g("addTrack")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function pe(t){let e;return{c(){e=g("replaceTrack")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function ge(t){let e,n,r,o,i=t[9].name+"";return{c(){e=p("small"),n=p("code"),r=p("pre"),o=g(i)},m(t,i){f(t,e,i),d(e,n),d(n,r),d(r,o)},p(t,e){512&e[0]&&i!==(i=t[9].name+"")&&k(o,i)},d(t){t&&m(e)}}}function ve(t){let e,n,r,o,i,c,a,s=t[25].join(" ")+"";return{c(){e=p("tr"),n=p("th"),n.textContent="events:",r=v(),o=p("td"),i=p("code"),c=p("small"),a=g(s)},m(t,s){f(t,e,s),d(e,n),d(e,r),d(e,o),d(o,i),d(i,c),d(c,a)},p(t,e){33554432&e[0]&&s!==(s=t[25].join(" ")+"")&&k(a,s)},d(t){t&&m(e)}}}function $e(t){let e,n,r,o,i,c,a,s,l,u,h,y,k=t[22]&&be(t),w=t[14]&&ye(t),C=t[23]&&!t[5].isManual&&ke(t),x=t[5].isManual&&we(t);return{c(){k&&k.c(),e=v(),n=p("label"),r=g("1.\n                    "),o=p("button"),i=g("create offer"),c=v(),w&&w.c(),a=v(),C&&C.c(),s=v(),x&&x.c(),l=$(),o.disabled=t[22]},m(m,p){k&&k.m(m,p),f(m,e,p),f(m,n,p),d(n,r),d(n,o),d(o,i),f(m,c,p),w&&w.m(m,p),f(m,a,p),C&&C.m(m,p),f(m,s,p),x&&x.m(m,p),f(m,l,p),u=!0,h||(y=b(o,"click",t[29]),h=!0)},p(t,n){t[22]?k?k.p(t,n):(k=be(t),k.c(),k.m(e.parentNode,e)):k&&(k.d(1),k=null),(!u||4194304&n[0])&&(o.disabled=t[22]),t[14]?w?(w.p(t,n),16384&n[0]&&H(w,1)):(w=ye(t),w.c(),H(w,1),w.m(a.parentNode,a)):w&&(J(),W(w,1,1,(()=>{w=null})),U()),t[23]&&!t[5].isManual?C?(C.p(t,n),8388640&n[0]&&H(C,1)):(C=ke(t),C.c(),H(C,1),C.m(s.parentNode,s)):C&&(J(),W(C,1,1,(()=>{C=null})),U()),t[5].isManual?x?(x.p(t,n),32&n[0]&&H(x,1)):(x=we(t),x.c(),H(x,1),x.m(l.parentNode,l)):x&&(J(),W(x,1,1,(()=>{x=null})),U())},i(t){u||(H(w),H(C),H(x),u=!0)},o(t){W(w),W(C),W(x),u=!1},d(t){k&&k.d(t),t&&m(e),t&&m(n),t&&m(c),w&&w.d(t),t&&m(a),C&&C.d(t),t&&m(s),x&&x.d(t),t&&m(l),h=!1,y()}}}function be(e){let n,r,o,i,c;return{c(){n=p("label"),r=g("0.\n                        "),o=p("button"),o.textContent="start call"},m(t,a){f(t,n,a),d(n,r),d(n,o),i||(c=b(o,"click",e[28]),i=!0)},p:t,d(t){t&&m(n),i=!1,c()}}}function ye(t){let e,n,o,i,c,a,s,l,u,h,$,y,k,w,C,x;function S(e){t[51](e)}let E={hideSignaling:t[19],rows:20};return void 0!==t[14]&&(E.value=t[14]),n=new ue({props:E}),L.push((()=>X(n,"value",S))),{c(){e=p("div"),K(n.$$.fragment),i=v(),c=p("br"),a=v(),s=p("label"),l=g("2.\n                            "),u=p("button"),h=g("setLocalDescription"),$=v(),y=p("button"),k=g("send offer"),u.disabled=t[22],y.disabled=t[22]},m(r,o){f(r,e,o),Q(n,e,null),d(e,i),d(e,c),d(e,a),d(e,s),d(s,l),d(s,u),d(u,h),d(s,$),d(s,y),d(y,k),w=!0,C||(x=[b(u,"click",t[52]),b(y,"click",t[31])],C=!0)},p(t,e){const r={};524288&e[0]&&(r.hideSignaling=t[19]),!o&&16384&e[0]&&(o=!0,r.value=t[14],N((()=>o=!1))),n.$set(r),(!w||4194304&e[0])&&(u.disabled=t[22]),(!w||4194304&e[0])&&(y.disabled=t[22])},i(t){w||(H(n.$$.fragment,t),w=!0)},o(t){W(n.$$.fragment,t),w=!1},d(t){t&&m(e),Y(n),C=!1,r(x)}}}function ke(t){let e,n,r,o,i,c,a,s,l,u,h,$,y;function k(e){t[53](e)}let w={hideSignaling:t[19],rows:20};return void 0!==t[23]&&(w.value=t[23]),n=new ue({props:w}),L.push((()=>X(n,"value",k))),{c(){e=p("div"),K(n.$$.fragment),o=v(),i=p("br"),c=v(),a=p("label"),s=g("5.\n                            "),l=p("button"),u=g("setRemoteDescription"),l.disabled=t[22]},m(r,m){f(r,e,m),Q(n,e,null),d(e,o),d(e,i),d(e,c),d(e,a),d(a,s),d(a,l),d(l,u),h=!0,$||(y=b(l,"click",t[54]),$=!0)},p(t,e){const o={};524288&e[0]&&(o.hideSignaling=t[19]),!r&&8388608&e[0]&&(r=!0,o.value=t[23],N((()=>r=!1))),n.$set(o),(!h||4194304&e[0])&&(l.disabled=t[22])},i(t){h||(H(n.$$.fragment,t),h=!0)},o(t){W(n.$$.fragment,t),h=!1},d(t){t&&m(e),Y(n),$=!1,y()}}}function we(t){let e,n,r,o,i,c,a,s,l,u,h,$,y,k,w;function C(e){t[55](e)}let x={hideSignaling:t[19],rows:20};return void 0!==t[17]&&(x.value=t[17]),o=new ue({props:x}),L.push((()=>X(o,"value",C))),{c(){e=p("div"),n=p("strong"),n.textContent="MANUAL ANSWER HERE",r=v(),K(o.$$.fragment),c=v(),a=p("br"),s=v(),l=p("label"),u=g("5.\n                            "),h=p("button"),$=g("setRemoteDescription"),h.disabled=t[22]},m(i,m){f(i,e,m),d(e,n),d(e,r),Q(o,e,null),d(e,c),d(e,a),d(e,s),d(e,l),d(l,u),d(l,h),d(h,$),y=!0,k||(w=b(h,"click",t[56]),k=!0)},p(t,e){const n={};524288&e[0]&&(n.hideSignaling=t[19]),!i&&131072&e[0]&&(i=!0,n.value=t[17],N((()=>i=!1))),o.$set(n),(!y||4194304&e[0])&&(h.disabled=t[22])},i(t){y||(H(o.$$.fragment,t),y=!0)},o(t){W(o.$$.fragment,t),y=!1},d(t){t&&m(e),Y(o),k=!1,w()}}}function Ce(t){let e,n,r,o,i=t[24]&&!t[5].isManual&&xe(t),c=t[5].isManual&&Se(t),a=t[15]&&t[24]&&Ee(t);return{c(){i&&i.c(),e=v(),c&&c.c(),n=v(),a&&a.c(),r=$()},m(t,s){i&&i.m(t,s),f(t,e,s),c&&c.m(t,s),f(t,n,s),a&&a.m(t,s),f(t,r,s),o=!0},p(t,o){t[24]&&!t[5].isManual?i?(i.p(t,o),16777248&o[0]&&H(i,1)):(i=xe(t),i.c(),H(i,1),i.m(e.parentNode,e)):i&&(J(),W(i,1,1,(()=>{i=null})),U()),t[5].isManual?c?(c.p(t,o),32&o[0]&&H(c,1)):(c=Se(t),c.c(),H(c,1),c.m(n.parentNode,n)):c&&(J(),W(c,1,1,(()=>{c=null})),U()),t[15]&&t[24]?a?(a.p(t,o),16809984&o[0]&&H(a,1)):(a=Ee(t),a.c(),H(a,1),a.m(r.parentNode,r)):a&&(J(),W(a,1,1,(()=>{a=null})),U())},i(t){o||(H(i),H(c),H(a),o=!0)},o(t){W(i),W(c),W(a),o=!1},d(t){i&&i.d(t),t&&m(e),c&&c.d(t),t&&m(n),a&&a.d(t),t&&m(r)}}}function xe(t){let e,n,o,i,c,a,s,l,u,h,$,y,k,w,C,x;function S(e){t[57](e)}let E={hideSignaling:t[19],rows:20};return void 0!==t[24]&&(E.value=t[24]),n=new ue({props:E}),L.push((()=>X(n,"value",S))),{c(){e=p("div"),K(n.$$.fragment),i=v(),c=p("br"),a=v(),s=p("label"),l=g("3.\n                            "),u=p("button"),h=g("setRemoteDescription"),$=v(),y=p("button"),k=g("create answer"),u.disabled=t[22],y.disabled=t[22]},m(r,o){f(r,e,o),Q(n,e,null),d(e,i),d(e,c),d(e,a),d(e,s),d(s,l),d(s,u),d(u,h),d(s,$),d(s,y),d(y,k),w=!0,C||(x=[b(u,"click",t[58]),b(y,"click",t[30])],C=!0)},p(t,e){const r={};524288&e[0]&&(r.hideSignaling=t[19]),!o&&16777216&e[0]&&(o=!0,r.value=t[24],N((()=>o=!1))),n.$set(r),(!w||4194304&e[0])&&(u.disabled=t[22]),(!w||4194304&e[0])&&(y.disabled=t[22])},i(t){w||(H(n.$$.fragment,t),w=!0)},o(t){W(n.$$.fragment,t),w=!1},d(t){t&&m(e),Y(n),C=!1,r(x)}}}function Se(t){let e,n,o,i,c,a,s,l,u,h,$,y,k,w,C,x,S,E;function T(e){t[59](e)}let j={hideSignaling:t[19],rows:20};return void 0!==t[16]&&(j.value=t[16]),i=new ue({props:j}),L.push((()=>X(i,"value",T))),{c(){e=p("div"),n=p("strong"),n.textContent="MANUAL OFFER HERE",o=v(),K(i.$$.fragment),a=v(),s=p("br"),l=v(),u=p("label"),h=g("3.\n                            "),$=p("button"),y=g("setRemoteDescription"),k=v(),w=p("button"),C=g("create answer"),$.disabled=t[22],w.disabled=t[22]},m(r,c){f(r,e,c),d(e,n),d(e,o),Q(i,e,null),d(e,a),d(e,s),d(e,l),d(e,u),d(u,h),d(u,$),d($,y),d(u,k),d(u,w),d(w,C),x=!0,S||(E=[b($,"click",t[60]),b(w,"click",t[30])],S=!0)},p(t,e){const n={};524288&e[0]&&(n.hideSignaling=t[19]),!c&&65536&e[0]&&(c=!0,n.value=t[16],N((()=>c=!1))),i.$set(n),(!x||4194304&e[0])&&($.disabled=t[22]),(!x||4194304&e[0])&&(w.disabled=t[22])},i(t){x||(H(i.$$.fragment,t),x=!0)},o(t){W(i.$$.fragment,t),x=!1},d(t){t&&m(e),Y(i),S=!1,r(E)}}}function Ee(t){let e,n,o,i,c,a,s,l,u,h,$,y,k,w,C,x;function S(e){t[61](e)}let E={hideSignaling:t[19],rows:20};return void 0!==t[15]&&(E.value=t[15]),n=new ue({props:E}),L.push((()=>X(n,"value",S))),{c(){e=p("div"),K(n.$$.fragment),i=v(),c=p("br"),a=v(),s=p("label"),l=g("4.\n                            "),u=p("button"),h=g("setLocalDescription"),$=v(),y=p("button"),k=g("send answer"),u.disabled=t[22],y.disabled=t[22]},m(r,o){f(r,e,o),Q(n,e,null),d(e,i),d(e,c),d(e,a),d(e,s),d(s,l),d(s,u),d(u,h),d(s,$),d(s,y),d(y,k),w=!0,C||(x=[b(u,"click",t[62]),b(y,"click",t[32])],C=!0)},p(t,e){const r={};524288&e[0]&&(r.hideSignaling=t[19]),!o&&32768&e[0]&&(o=!0,r.value=t[15],N((()=>o=!1))),n.$set(r),(!w||4194304&e[0])&&(u.disabled=t[22]),(!w||4194304&e[0])&&(y.disabled=t[22])},i(t){w||(H(n.$$.fragment,t),w=!0)},o(t){W(n.$$.fragment,t),w=!1},d(t){t&&m(e),Y(n),C=!1,r(x)}}}function Te(t){let e,n,r;return{c(){e=p("textarea"),y(e,"rows","10"),y(e,"class","svelte-3b0r9n"),C(e,"hideSignaling",t[19])},m(o,i){f(o,e,i),w(e,t[21]),n||(r=b(e,"input",t[63]),n=!0)},p(t,n){2097152&n[0]&&w(e,t[21]),524288&n[0]&&C(e,"hideSignaling",t[19])},d(t){t&&m(e),n=!1,r()}}}function je(t){let e,n,r,o,i,c,a,s,l=JSON.stringify(t[20],null,4)+"";return{c(){e=p("label"),e.textContent="injected Candidates",n=v(),r=p("textarea"),o=v(),i=p("pre"),c=g(l),y(e,"for","injectedCandidates"),y(r,"name","injectedCandidates"),y(r,"rows","20"),y(r,"class","svelte-3b0r9n")},m(l,u){f(l,e,u),f(l,n,u),f(l,r,u),w(r,t[4]),f(l,o,u),f(l,i,u),d(i,c),a||(s=b(r,"input",t[64]),a=!0)},p(t,e){16&e[0]&&w(r,t[4]),1048576&e[0]&&l!==(l=JSON.stringify(t[20],null,4)+"")&&k(c,l)},d(t){t&&m(e),t&&m(n),t&&m(r),t&&m(o),t&&m(i),a=!1,s()}}}function Le(t){let e,n,o,i,c,a,s,l,u,h,$,w,C,x,S,E,T,j,L,D,R,_,M,O,A,N,z,I,P,B,F,q,V,G,X,Z,tt,et,nt,rt,ot,it,ct,at,st,lt,ut,dt,ft,mt,ht,pt,gt,vt,$t,bt,yt,kt,wt,Ct,xt,St,Et,Tt,jt,Lt,Dt,Rt,_t,Mt,Ot,At,Nt,zt,It,Pt,Bt,Ft=t[5].isRemote&&de(t),qt=t[5].hasUpstream&&fe(t),Jt=t[5].hasDownstream&&me(t);function Ut(t,e){return t[8]?pe:he}let Ht=Ut(t),Wt=Ht(t),Vt=t[9]&&t[9].name&&ge(t);R=new ae({props:{peerconnection:t[7],streamSource:t[46]}}),R.$on("track",t[47]);let Gt=!t[18]&&ve(t),Xt=t[0]&&$e(t),Kt=t[1]&&Ce(t),Qt=(t[21].length||t[5].isManual)&&Te(t),Yt=t[5].isManual&&je(t);return{c(){e=p("section"),n=p("h3"),o=g(t[2]),i=v(),c=p("small"),a=g("talking to "),s=g(t[3]),l=v(),Ft&&Ft.c(),u=v(),qt&&qt.c(),h=v(),Jt&&Jt.c(),$=v(),w=p("article"),C=p("h5"),C.textContent="peerconnection",x=v(),S=p("button"),Wt.c(),T=v(),j=p("button"),j.textContent="close",L=v(),Vt&&Vt.c(),D=v(),K(R.$$.fragment),_=v(),M=p("article"),O=p("details"),A=p("summary"),A.textContent="signaling",N=v(),z=p("div"),I=p("table"),P=p("tr"),B=p("th"),B.textContent="signaling:",F=v(),q=p("td"),V=p("code"),G=g(t[10]),X=v(),Z=p("tr"),tt=p("th"),tt.textContent="connection:",et=v(),nt=p("td"),rt=p("code"),ot=g(t[11]),it=v(),ct=p("tr"),at=p("th"),at.textContent="iceGathering:",st=v(),lt=p("td"),ut=p("code"),dt=g(t[13]),ft=v(),mt=p("tr"),ht=p("th"),ht.textContent="iceConnection:",pt=v(),gt=p("td"),vt=p("code"),$t=g(t[12]),bt=v(),Gt&&Gt.c(),yt=v(),kt=p("div"),wt=p("span"),Ct=p("label"),xt=p("input"),St=g("\n                        caller"),Et=v(),Tt=p("label"),jt=p("input"),Lt=g("\n                        receiver"),Dt=v(),Rt=p("label"),_t=p("input"),Mt=g("\n                        auto"),Ot=v(),Xt&&Xt.c(),At=v(),Kt&&Kt.c(),Nt=v(),Qt&&Qt.c(),zt=v(),Yt&&Yt.c(),S.disabled=E=!Boolean(t[9]),y(j,"class","btn-small"),y(w,"class","box"),y(I,"class","vertical"),y(z,"class","box"),y(xt,"type","checkbox"),y(jt,"type","checkbox"),y(_t,"type","checkbox"),y(kt,"class","box"),O.open="true",y(M,"class","box")},m(r,m){f(r,e,m),d(e,n),d(n,o),d(n,i),d(n,c),d(c,a),d(c,s),d(e,l),Ft&&Ft.m(e,null),d(e,u),qt&&qt.m(e,null),d(e,h),Jt&&Jt.m(e,null),d(e,$),d(e,w),d(w,C),d(w,x),d(w,S),Wt.m(S,null),d(w,T),d(w,j),d(w,L),Vt&&Vt.m(w,null),d(w,D),Q(R,w,null),d(e,_),d(e,M),d(M,O),d(O,A),d(O,N),d(O,z),d(z,I),d(I,P),d(P,B),d(P,F),d(P,q),d(q,V),d(V,G),d(I,X),d(I,Z),d(Z,tt),d(Z,et),d(Z,nt),d(nt,rt),d(rt,ot),d(I,it),d(I,ct),d(ct,at),d(ct,st),d(ct,lt),d(lt,ut),d(ut,dt),d(I,ft),d(I,mt),d(mt,ht),d(mt,pt),d(mt,gt),d(gt,vt),d(vt,$t),d(I,bt),Gt&&Gt.m(I,null),d(O,yt),d(O,kt),d(kt,wt),d(wt,Ct),d(Ct,xt),xt.checked=t[0],d(Ct,St),d(wt,Et),d(wt,Tt),d(Tt,jt),jt.checked=t[1],d(Tt,Lt),d(wt,Dt),d(wt,Rt),d(Rt,_t),_t.checked=t[22],d(Rt,Mt),d(O,Ot),Xt&&Xt.m(O,null),d(O,At),Kt&&Kt.m(O,null),d(O,Nt),Qt&&Qt.m(O,null),d(O,zt),Yt&&Yt.m(O,null),It=!0,Pt||(Bt=[b(S,"click",t[44]),b(j,"click",t[45]),b(xt,"change",t[48]),b(jt,"change",t[49]),b(_t,"change",t[50])],Pt=!0)},p(t,n){(!It||4&n[0])&&k(o,t[2]),(!It||8&n[0])&&k(s,t[3]),t[5].isRemote?Ft?(Ft.p(t,n),32&n[0]&&H(Ft,1)):(Ft=de(t),Ft.c(),H(Ft,1),Ft.m(e,u)):Ft&&(J(),W(Ft,1,1,(()=>{Ft=null})),U()),t[5].hasUpstream?qt?(qt.p(t,n),32&n[0]&&H(qt,1)):(qt=fe(t),qt.c(),H(qt,1),qt.m(e,h)):qt&&(J(),W(qt,1,1,(()=>{qt=null})),U()),t[5].hasDownstream?Jt?(Jt.p(t,n),32&n[0]&&H(Jt,1)):(Jt=me(t),Jt.c(),H(Jt,1),Jt.m(e,$)):Jt&&(J(),W(Jt,1,1,(()=>{Jt=null})),U()),Ht!==(Ht=Ut(t))&&(Wt.d(1),Wt=Ht(t),Wt&&(Wt.c(),Wt.m(S,null))),(!It||512&n[0]&&E!==(E=!Boolean(t[9])))&&(S.disabled=E),t[9]&&t[9].name?Vt?Vt.p(t,n):(Vt=ge(t),Vt.c(),Vt.m(w,D)):Vt&&(Vt.d(1),Vt=null);const r={};128&n[0]&&(r.peerconnection=t[7]),512&n[0]&&(r.streamSource=t[46]),R.$set(r),(!It||1024&n[0])&&k(G,t[10]),(!It||2048&n[0])&&k(ot,t[11]),(!It||8192&n[0])&&k(dt,t[13]),(!It||4096&n[0])&&k($t,t[12]),t[18]?Gt&&(Gt.d(1),Gt=null):Gt?Gt.p(t,n):(Gt=ve(t),Gt.c(),Gt.m(I,null)),1&n[0]&&(xt.checked=t[0]),2&n[0]&&(jt.checked=t[1]),4194304&n[0]&&(_t.checked=t[22]),t[0]?Xt?(Xt.p(t,n),1&n[0]&&H(Xt,1)):(Xt=$e(t),Xt.c(),H(Xt,1),Xt.m(O,At)):Xt&&(J(),W(Xt,1,1,(()=>{Xt=null})),U()),t[1]?Kt?(Kt.p(t,n),2&n[0]&&H(Kt,1)):(Kt=Ce(t),Kt.c(),H(Kt,1),Kt.m(O,Nt)):Kt&&(J(),W(Kt,1,1,(()=>{Kt=null})),U()),t[21].length||t[5].isManual?Qt?Qt.p(t,n):(Qt=Te(t),Qt.c(),Qt.m(O,zt)):Qt&&(Qt.d(1),Qt=null),t[5].isManual?Yt?Yt.p(t,n):(Yt=je(t),Yt.c(),Yt.m(O,null)):Yt&&(Yt.d(1),Yt=null)},i(t){It||(H(Ft),H(qt),H(Jt),H(R.$$.fragment,t),H(Xt),H(Kt),It=!0)},o(t){W(Ft),W(qt),W(Jt),W(R.$$.fragment,t),W(Xt),W(Kt),It=!1},d(t){t&&m(e),Ft&&Ft.d(),qt&&qt.d(),Jt&&Jt.d(),Wt.d(),Vt&&Vt.d(),Y(R),Gt&&Gt.d(),Xt&&Xt.d(),Kt&&Kt.d(),Qt&&Qt.d(),Yt&&Yt.d(),Pt=!1,r(Bt)}}}function De(t,e,n){let r,o,i,c,a,l,u,d,f,m,h,p,g;s(t,st,(t=>n(5,f=t))),s(t,bt,(t=>n(65,m=t))),s(t,$t,(t=>n(38,h=t))),s(t,vt,(t=>n(39,p=t))),s(t,lt,(t=>n(40,g=t)));var v=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function c(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))};let{isCaller:$=!1}=e,{isReceiver:b=!1}=e,{name:y="unnamed participant"}=e,{recipient:k=null}=e;const w=new St({from:y,to:k}),C=(t=>(e,n)=>function(t,e,n){const r={name:t,short:e,event:n,timestamp:(new Date).toISOString().split("T")[1]};ot.update((t=>[...t,r])),lt.update((n=>({...n,[t]:[...n[t]||[],e]})))}(t,e,n))(y);let x,S,T,j,D="",R="",_="",M="",O="";xt.addEventListener(`OfferTo:${y}`,(({detail:t})=>v(void 0,void 0,void 0,(function*(){r&&(V(Et(t)),yield J(),W(jt(A)),H())})))),xt.addEventListener(`AnswerTo:${y}`,(({detail:t})=>v(void 0,void 0,void 0,(function*(){r&&X(Et(t))})))),xt.addEventListener(`CandidateTo:${y}`,(({detail:t})=>v(void 0,void 0,void 0,(function*(){r&&(yield function(t){return v(this,void 0,void 0,(function*(){f.showCandidateEvents&&C("ac","addIceCandidate"),yield S.addIceCandidate(t)}))}(t))}))));let A="",N="",z="",I=[],P="",B="plan-b"===new URL(document.location.toString()).searchParams.get("semantic")?{sdpSemantics:"plan-b"}:{sdpSemantics:"unified-plan"};function F(t){T?(C("rt","replace track"),console.info("replace track",{sender:T}),T.replaceTrack(t.getTracks()[0])):(C("at","add track"),console.info("add track"),n(8,T=S.addTrack(t.getTracks()[0],t)))}function q(){return v(this,void 0,void 0,(function*(){C("o","create offer");const t=yield S.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});n(14,O=t.sdp)}))}function J(){return v(this,void 0,void 0,(function*(){C("a","create answer");const t=yield S.createAnswer();n(15,A=t.sdp)}))}function U(){const t=Tt(O);yt({from:y,offer:t}),f.isRemote&&w.sendOffer(t),xt.dispatchEvent(new CustomEvent(`OfferTo:${k}`,{detail:t}))}function H(){const t=Tt(A);kt({from:y,answer:t}),f.isRemote&&w.sendAnswer(t),xt.dispatchEvent(new CustomEvent(`AnswerTo:${k}`,{detail:t}))}function W(t){return v(this,void 0,void 0,(function*(){C("l","setLocalDescription"),console.debug("localDescription ->",t);const e=t;Ct({from:y}),S.setLocalDescription(e),G(),Ct({from:k})}))}function V(t){C("r","setRemoteDescription");const e=Tt(t);S.setRemoteDescription(e),G(),Ct({from:k})}function G(){f.isManual?(l||[]).forEach((t=>{t&&f.showCandidateEvents&&(C("ac","addIceCandidate"),S.addIceCandidate(t))})):(console.debug(m[k]),(m[k]||[]).forEach((t=>{t&&f.showCandidateEvents&&(C("ac","addIceCandidate"),S.addIceCandidate(t))})))}function X(t){C("r","setRemoteDescription");const e=jt(t);S.setRemoteDescription(e),Ct({from:y})}function K(t){if(t.stream)x.$set({stream:t.stream});else if(t.track){const e=new MediaStream([t.track]);x.$set({stream:e})}else console.error("can't use stream or track, nothing there",t)}return E((()=>{n(7,S=function(){const t=new RTCPeerConnection(B);return t.addEventListener("track",(t=>{C("pct","pc ontrack");const{track:e,streams:n,transceiver:r}=t,o=n[0]||new MediaStream([e]);console.info(`${y}.ontrack`,{track:e,streams:n,kind:e.kind,transceiver:r}),K({stream:o,track:e}),e.addEventListener("ended",(()=>{C("te","track ended"),console.info(`${y} track ended`,{event:t})})),e.addEventListener("mute",(()=>{C("🔇","track muted"),console.info(`${y} track muted`,{event:t})})),e.addEventListener("unmute",(()=>{C("🔈","track unmuted"),console.info(`${y} track unmuted`,{event:t})})),o.addEventListener("addtrack",(()=>{C("add","stream track added")})),o.addEventListener("removetrack",(()=>{C("rem","stream track removed")}))})),t.addEventListener("icecandidate",(({candidate:t})=>{f.showCandidateEvents&&C("lc","create candidate"),n(37,I=[...I,t]),function(t){y&&t&&(wt({from:y,candidate:t}),f.isRemote&&w.sendCandidate(t),xt.dispatchEvent(new CustomEvent(`CandidateTo:${k}`,{detail:t})))}(t)})),t.addEventListener("signalingstatechange",(()=>n(10,D=t.signalingState))),t.addEventListener("connectionstatechange",(()=>n(11,R=t.connectionState))),t.addEventListener("iceconnectionstatechange",(()=>n(12,_=t.iceConnectionState))),t.addEventListener("icegatheringstatechange",(({target:{iceGatheringState:t}})=>n(13,M=t))),t.addEventListener("negotiationneeded",(()=>C("nn","negotiation needed"))),t.addEventListener("addstream",(t=>{C("🗑as","addstream"),console.warn("addstream",t)})),t.addEventListener("removestream",(t=>{C("🗑rs","removestream"),console.warn("removestream",t)})),console.info(`setup RTCPeerConnection for ${y}`,B,t),t}()),bt.subscribe((({[k]:t})=>{t&&f.showCandidateEvents&&C("rc")})),f.hasCaller&&q()})),t.$$set=t=>{"isCaller"in t&&n(0,$=t.isCaller),"isReceiver"in t&&n(1,b=t.isReceiver),"name"in t&&n(2,y=t.name),"recipient"in t&&n(3,k=t.recipient)},t.$$.update=()=>{32&t.$$.dirty[0]&&n(22,r=f.autoSignal),4&t.$$.dirty[0]|512&t.$$.dirty[1]&&n(25,o=g[y]||[]),8&t.$$.dirty[0]|256&t.$$.dirty[1]&&n(24,i=Et(p[k])),8&t.$$.dirty[0]|128&t.$$.dirty[1]&&n(23,c=Et(h[k])),64&t.$$.dirty[1]&&n(21,a=JSON.stringify(I)),16&t.$$.dirty[0]&&n(20,l=(t=>{try{return JSON.parse(t)}catch(e){return""!==t&&console.warn({parseError:e}),[]}})(P)),32&t.$$.dirty[0]&&n(19,u=f.hideSignaling),32&t.$$.dirty[0]&&n(18,d=f.hideEvents)},[$,b,y,k,P,f,x,S,T,j,D,R,_,M,O,A,N,z,d,u,l,a,r,c,i,o,w,F,function(){return v(this,void 0,void 0,(function*(){yield q(),W(Tt(O)),U()}))},q,J,U,H,W,V,X,K,I,h,p,g,({detail:t})=>n(9,j=t),()=>n(9,j=void 0),function(t){L[t?"unshift":"push"]((()=>{x=t,n(6,x)}))},()=>F(j),()=>S.close(),()=>j,({detail:t})=>K({track:t}),function(){$=this.checked,n(0,$)},function(){b=this.checked,n(1,b)},function(){r=this.checked,n(22,r),n(5,f)},function(t){O=t,n(14,O)},()=>W(Tt(O)),function(t){c=t,n(23,c),n(38,h),n(3,k)},()=>X(c),function(t){z=t,n(17,z)},()=>X(z),function(t){i=t,n(24,i),n(39,p),n(3,k)},()=>V(i),function(t){N=t,n(16,N)},()=>V(N),function(t){A=t,n(15,A)},()=>W(jt(A)),function(){a=this.value,n(21,a),n(37,I)},function(){P=this.value,n(4,P)}]}const Re=class extends tt{constructor(t){super(),Z(this,t,De,Le,i,{isCaller:0,isReceiver:1,name:2,recipient:3},null,[-1,-1,-1])}};function _e(t,e,n){const r=t.slice();return r[6]=e[n].name,r[7]=e[n].event,r[8]=e[n].timestamp,r}function Me(t){let e,n,r,o,i,c,a,s,l,u,h,$,b,w=t[8]+"",C=t[6]+"",x=t[7]+"";return{c(){e=p("tr"),n=p("td"),r=p("code"),o=g(w),i=v(),c=p("th"),a=g(C),s=g(":"),l=v(),u=p("td"),h=p("code"),$=g(x),b=v(),y(r,"class","timestamp svelte-1io0inb")},m(t,m){f(t,e,m),d(e,n),d(n,r),d(r,o),d(e,i),d(e,c),d(c,a),d(c,s),d(e,l),d(e,u),d(u,h),d(h,$),d(e,b)},p(t,e){4&e&&w!==(w=t[8]+"")&&k(o,w),4&e&&C!==(C=t[6]+"")&&k(a,C),4&e&&x!==(x=t[7]+"")&&k($,x)},d(t){t&&m(e)}}}function Oe(e){let n,r,o,i,c,a,s,l,u,g,$=e[2],k=[];for(let t=0;t<$.length;t+=1)k[t]=Me(_e(e,$,t));return{c(){n=p("section"),r=p("h3"),r.innerHTML="Event Log <small>please open\n            <code>about://webrtc-internals</code></small>",o=v(),i=p("div"),c=p("table");for(let t=0;t<k.length;t+=1)k[t].c();a=v(),s=p("label"),l=p("input"),y(c,"class","vertical svelte-1io0inb"),y(i,"class","box svelte-1io0inb"),y(l,"type","text"),y(l,"name","filterTerm"),y(l,"id","filterTerm"),y(l,"placeholder","filter"),y(l,"class","svelte-1io0inb"),y(s,"for","filterTerm"),y(n,"id","EventLog")},m(t,m){f(t,n,m),d(n,r),d(n,o),d(n,i),d(i,c);for(let t=0;t<k.length;t+=1)k[t].m(c,null);e[4](i),d(n,a),d(n,s),d(s,l),w(l,e[0]),u||(g=b(l,"input",e[5]),u=!0)},p(t,[e]){if(4&e){let n;for($=t[2],n=0;n<$.length;n+=1){const r=_e(t,$,n);k[n]?k[n].p(r,e):(k[n]=Me(r),k[n].c(),k[n].m(c,null))}for(;n<k.length;n+=1)k[n].d(1);k.length=$.length}1&e&&l.value!==t[0]&&w(l,t[0])},i:t,o:t,d(t){t&&m(n),h(k,t),e[4](null),u=!1,g()}}}function Ae(t,e,n){let r,o,i;s(t,ot,(t=>n(3,o=t)));let c="";return E((()=>{ot.subscribe((()=>{n(1,i.scrollTop=i.scrollHeight,i)}))})),t.$$.update=()=>{9&t.$$.dirty&&n(2,r=c&&c.length?o.filter((({event:t,short:e,name:n})=>(null==t?void 0:t.match(c))||(null==n?void 0:n.match(c))||(null==e?void 0:e.includes(c)))):o)},[c,i,r,o,function(t){L[t?"unshift":"push"]((()=>{i=t,n(1,i)}))},function(){c=this.value,n(0,c)}]}const Ne=class extends tt{constructor(t){super(),Z(this,t,Ae,Oe,i,{})}};function ze(t){let e,n;return e=new Re({props:{name:"alice",isCaller:"true",recipient:"bob"}}),{c(){K(e.$$.fragment)},m(t,r){Q(e,t,r),n=!0},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){Y(e,t)}}}function Ie(t){let e,n;return e=new Re({props:{name:"bob",isReceiver:"true",recipient:"alice"}}),{c(){K(e.$$.fragment)},m(t,r){Q(e,t,r),n=!0},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){Y(e,t)}}}function Pe(t){let e,n;return e=new Ne({}),{c(){K(e.$$.fragment)},m(t,r){Q(e,t,r),n=!0},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){Y(e,t)}}}function Be(t){let e,n,r,o,i,c,a,s,l,u;i=new gt({});let h=t[0].hasCaller&&ze(),g=t[0].hasReceiver&&Ie(),$=!t[0].hideEvents&&Pe();return{c(){e=p("div"),n=p("h1"),n.textContent="WebRTC Demo",r=v(),o=p("aside"),K(i.$$.fragment),c=v(),a=p("main"),h&&h.c(),s=v(),g&&g.c(),l=v(),$&&$.c(),y(o,"class","svelte-if8jgd"),y(a,"class","svelte-if8jgd"),y(e,"class","svelte-if8jgd")},m(t,m){f(t,e,m),d(e,n),d(e,r),d(e,o),Q(i,o,null),d(e,c),d(e,a),h&&h.m(a,null),d(a,s),g&&g.m(a,null),d(a,l),$&&$.m(a,null),u=!0},p(t,[e]){t[0].hasCaller?h?1&e&&H(h,1):(h=ze(),h.c(),H(h,1),h.m(a,s)):h&&(J(),W(h,1,1,(()=>{h=null})),U()),t[0].hasReceiver?g?1&e&&H(g,1):(g=Ie(),g.c(),H(g,1),g.m(a,l)):g&&(J(),W(g,1,1,(()=>{g=null})),U()),t[0].hideEvents?$&&(J(),W($,1,1,(()=>{$=null})),U()):$?1&e&&H($,1):($=Pe(),$.c(),H($,1),$.m(a,null))},i(t){u||(H(i.$$.fragment,t),H(h),H(g),H($),u=!0)},o(t){W(i.$$.fragment,t),W(h),W(g),W($),u=!1},d(t){t&&m(e),Y(i),h&&h.d(),g&&g.d(),$&&$.d()}}}function Fe(t,e,n){let r;return s(t,st,(t=>n(0,r=t))),[r]}const qe=class extends tt{constructor(t){super(),Z(this,t,Fe,Be,i,{})}};function Je(t,e,n){const r=t.slice();return r[33]=e[n],r}function Ue(t,e,n){const r=t.slice();return r[36]=e[n],r[38]=n,r}function He(t){let e,n,r,o,i=(t[36].label||`micorophone ${t[38]}`)+"";function c(){return t[13](t[36])}return{c(){e=p("button"),n=g(i),y(e,"class","svelte-2jsuhx")},m(t,i){f(t,e,i),d(e,n),r||(o=b(e,"click",c),r=!0)},p(e,r){t=e,4&r[0]&&i!==(i=(t[36].label||`micorophone ${t[38]}`)+"")&&k(n,i)},d(t){t&&m(e),r=!1,o()}}}function We(t){let e;return{c(){e=g("✔️")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Ve(t){let e,n,o,i,c,a,s,l,u,h,$,w,C,x,S,E=t[33].name+"",T=t[1]===t[33]&&We();function j(){return t[18](t[33])}function L(){return t[19](t[33])}function D(){return t[20](t[33])}return{c(){e=p("tr"),n=p("td"),T&&T.c(),o=v(),i=p("td"),c=p("button"),a=g(E),s=v(),l=p("td"),u=p("button"),u.textContent="stop",h=v(),$=p("td"),w=p("button"),w.textContent="X",C=v(),y(c,"class","svelte-2jsuhx"),y(u,"class","svelte-2jsuhx"),y(w,"class","svelte-2jsuhx")},m(t,r){f(t,e,r),d(e,n),T&&T.m(n,null),d(e,o),d(e,i),d(i,c),d(c,a),d(e,s),d(e,l),d(l,u),d(e,h),d(e,$),d($,w),d(e,C),x||(S=[b(c,"click",j),b(u,"click",L),b(w,"click",D)],x=!0)},p(e,r){(t=e)[1]===t[33]?T||(T=We(),T.c(),T.m(n,null)):T&&(T.d(1),T=null),8&r[0]&&E!==(E=t[33].name+"")&&k(a,E)},d(t){t&&m(e),T&&T.d(),x=!1,r(S)}}}function Ge(e){let n,o,i,c,a,s,l,u,g,$,k,w,C,x,S,E,T,j,L,D,R=e[2],_=[];for(let t=0;t<R.length;t+=1)_[t]=He(Ue(e,R,t));let M=e[3],O=[];for(let t=0;t<M.length;t+=1)O[t]=Ve(Je(e,M,t));return{c(){n=p("h5"),n.textContent="audio devices",o=v(),i=p("canvas"),c=v(),a=p("nav");for(let t=0;t<_.length;t+=1)_[t].c();s=v(),l=p("audio"),u=p("track"),k=v(),w=p("button"),w.textContent="bars",C=v(),x=p("button"),x.textContent="waveform",S=v(),E=p("button"),E.textContent="volume",T=v(),j=p("table");for(let t=0;t<O.length;t+=1)O[t].c();y(u,"kind","captions"),y(l,"id","upstream"),l.autoplay=g=!1,l.controls=$=Boolean(e[1]),y(a,"class","svelte-2jsuhx"),y(w,"class","svelte-2jsuhx"),y(x,"class","svelte-2jsuhx"),y(E,"class","svelte-2jsuhx")},m(t,r){f(t,n,r),f(t,o,r),f(t,i,r),e[12](i),f(t,c,r),f(t,a,r);for(let t=0;t<_.length;t+=1)_[t].m(a,null);d(a,s),d(a,l),d(l,u),e[14](l),f(t,k,r),f(t,w,r),f(t,C,r),f(t,x,r),f(t,S,r),f(t,E,r),f(t,T,r),f(t,j,r);for(let t=0;t<O.length;t+=1)O[t].m(j,null);L||(D=[b(w,"click",e[15]),b(x,"click",e[16]),b(E,"click",e[17])],L=!0)},p(t,e){if(260&e[0]){let n;for(R=t[2],n=0;n<R.length;n+=1){const r=Ue(t,R,n);_[n]?_[n].p(r,e):(_[n]=He(r),_[n].c(),_[n].m(a,s))}for(;n<_.length;n+=1)_[n].d(1);_.length=R.length}if(2&e[0]&&$!==($=Boolean(t[1]))&&(l.controls=$),3594&e[0]){let n;for(M=t[3],n=0;n<M.length;n+=1){const r=Je(t,M,n);O[n]?O[n].p(r,e):(O[n]=Ve(r),O[n].c(),O[n].m(j,null))}for(;n<O.length;n+=1)O[n].d(1);O.length=M.length}},i:t,o:t,d(t){t&&m(n),t&&m(o),t&&m(i),e[12](null),t&&m(c),t&&m(a),h(_,t),e[14](null),t&&m(k),t&&m(w),t&&m(C),t&&m(x),t&&m(S),t&&m(E),t&&m(T),t&&m(j),h(O,t),L=!1,r(D)}}}function Xe(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function c(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))};const o=T();let i,c,a,s,l,u,d,f=[],m=[];function h(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),r=t.frequencyBinCount,o=new Uint8Array(r);let i;function c(){t.getByteTimeDomainData(o),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,e.width,e.height),n.lineWidth=2,n.strokeStyle="rgb(255, 255, 255)",n.beginPath();let a=1*e.width/r,s=0;for(let t=0;t<r;t++){const r=o[t]/128*e.height/2;0===t?n.moveTo(s,r):n.lineTo(s,r),s+=a}n.lineTo(e.width,e.height/2),n.stroke(),i=requestAnimationFrame(c)}return{start(){void 0===i&&c()},stop(){cancelAnimationFrame(i),i=void 0}}}({analyser:l,canvas:a}),u.start()}function p(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),r=t.frequencyBinCount,o=new Float32Array(r);let i;const{width:c,height:a}=e;function s(){t.getFloatFrequencyData(o),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,c,a);for(var e,l=c/r*2.5,u=0,d=0;d<r;d++)e=2*(o[d]+140),n.fillStyle="rgb("+Math.floor(e+100)+",50,50)",n.fillRect(u,a-e/2,l,e/2),u+=l+1;i=requestAnimationFrame(s)}return{start(){void 0===i&&s()},stop(){cancelAnimationFrame(i),i=void 0}}}({analyser:l,canvas:a}),u.start()}function g(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),r=t.frequencyBinCount,o=new Uint8Array(r);let i;function c(){t.getByteTimeDomainData(o),n.fillStyle="rgba(0, 0, 0, 0.1)",n.fillRect(0,0,e.width,e.height),n.font="15px sans-serif",n.strokeStyle="rgb(255, 255, 255)";let a=0;n.lineWidth=5;for(let t=0;t<r;t++){const n=o[t]/128*e.height/2;n>a&&(a=n)}let s=2*(a-75),l=e.height-s;n.beginPath(),n.moveTo(0,l),n.lineTo(e.width,l),n.stroke(),n.fillStyle="rgb(100,255,100)",n.fillRect(0,e.height,e.width,-e.height+l),n.fillStyle="rgb(0,0,0)",n.fillText(String(s),e.width-40,e.height-10),i=requestAnimationFrame(c)}return{start(){void 0===i&&c()},stop(){cancelAnimationFrame(i),i=void 0}}}({analyser:l,canvas:a}),u.start()}function v(){return r(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"audioinput"===t)))}))}function $(t){return r(this,void 0,void 0,(function*(){const e=yield function(t){return r(this,void 0,void 0,(function*(){const e={audio:!t||{deviceId:t}};return yield navigator.mediaDevices.getUserMedia(e)}))}(t);e.name=function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t),b(e),n(3,m=[...m,e])}))}function b(t){n(1,c=t),n(0,i.srcObject=t,i),function(t){console.debug("disconnecting",d),null==d||d.disconnect(l),d=void 0;const e=s.createMediaStreamSource(t);e.connect(l),d=e}(t),o("stream",t)}function y(t){t.getTracks().forEach((t=>t.stop())),o("stop",t)}function k(t){y(t),n(3,m=[...m.filter((e=>e!=t))]),c===t&&n(1,c=void 0)}return E((()=>{v();const t=()=>v();return navigator.mediaDevices.addEventListener("devicechange",t),s||(s=new AudioContext,l=s.createAnalyser(),l.fftSize=2048),g(),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),[i,c,f,m,a,h,p,g,$,b,y,k,function(t){L[t?"unshift":"push"]((()=>{a=t,n(4,a)}))},t=>$(t.deviceId),function(t){L[t?"unshift":"push"]((()=>{i=t,n(0,i)}))},()=>p(),()=>h(),()=>g(),t=>b(t),t=>y(t),t=>k(t)]}const Ke=class extends tt{constructor(t){super(),Z(this,t,Xe,Ge,i,{},null,[-1,-1])}};function Qe(t){let e,n;return e=new qe({}),{c(){K(e.$$.fragment)},m(t,r){Q(e,t,r),n=!0},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){Y(e,t)}}}function Ye(t){let e,n,r,o,i,c,a;return r=new Ke({}),c=new Ft({}),{c(){e=p("section"),n=p("article"),K(r.$$.fragment),o=v(),i=p("article"),K(c.$$.fragment),y(n,"class","box"),y(i,"class","box")},m(t,s){f(t,e,s),d(e,n),Q(r,n,null),d(e,o),d(e,i),Q(c,i,null),a=!0},i(t){a||(H(r.$$.fragment,t),H(c.$$.fragment,t),a=!0)},o(t){W(r.$$.fragment,t),W(c.$$.fragment,t),a=!1},d(t){t&&m(e),Y(r),Y(c)}}}function Ze(t){let e,n,r,o;const i=[Ye,Qe],c=[];function a(t,e){return t[0].audioVisOnly?0:1}return e=a(t),n=c[e]=i[e](t),{c(){n.c(),r=$()},m(t,n){c[e].m(t,n),f(t,r,n),o=!0},p(t,[o]){let s=e;e=a(t),e!==s&&(J(),W(c[s],1,1,(()=>{c[s]=null})),U(),n=c[e],n||(n=c[e]=i[e](t),n.c()),H(n,1),n.m(r.parentNode,r))},i(t){o||(H(n),o=!0)},o(t){W(n),o=!1},d(t){c[e].d(t),t&&m(r)}}}function tn(t,e,n){let r;return s(t,st,(t=>n(0,r=t))),[r]}const en=new class extends tt{constructor(t){super(),Z(this,t,tn,Ze,i,{})}}({target:document.body,props:{}});window.app=en})();