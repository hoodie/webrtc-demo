(()=>{"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t){return 0===Object.keys(t).length}function a(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function s(t,e,n){t.$$.on_destroy.push(a(e,n))}new Set;let l,u=!1;function d(t,e){t.appendChild(e)}function f(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function p(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function g(t){return document.createTextNode(t)}function $(){return g(" ")}function v(){return g("")}function b(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function k(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function w(t,e){t.value=null==e?"":e}function x(t,e,n){t.classList[n?"add":"remove"](e)}function C(t){l=t}function S(){if(!l)throw new Error("Function called outside component initialization");return l}function R(t){S().$$.on_mount.push(t)}function T(){const t=S();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=function(t,e,n=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n,!1,e),o}(e,n);o.slice().forEach((e=>{e.call(t,r)}))}}}new Set;const D=[],E=[],_=[],O=[],N=Promise.resolve();let M=!1;function A(t){_.push(t)}let j=!1;const L=new Set;function I(){if(!j){j=!0;do{for(let t=0;t<D.length;t+=1){const e=D[t];C(e),P(e.$$)}for(C(null),D.length=0;E.length;)E.pop()();for(let t=0;t<_.length;t+=1){const e=_[t];L.has(e)||(L.add(e),e())}_.length=0}while(D.length);for(;O.length;)O.pop()();M=!1,j=!1,L.clear()}}function P(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}const B=new Set;let U,J;function q(){U={r:0,c:[],p:U}}function F(){U.r||o(U.c),U=U.p}function z(t,e){t&&t.i&&(B.delete(t),t.i(e))}function H(t,e,n,o){if(t&&t.o){if(B.has(t))return;B.add(t),U.c.push((()=>{B.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function W(t){t&&t.c()}function V(t,n,c,i){const{fragment:a,on_mount:s,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,c),i||A((()=>{const n=s.map(e).filter(r);l?l.push(...n):o(n),t.$$.on_mount=[]})),u.forEach(A)}function X(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function G(e,r,c,i,a,s,d,f=[-1]){const p=l;C(e);const h=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(p?p.$$.context:r.context||[]),callbacks:n(),dirty:f,skip_bound:!1,root:r.target||p.$$.root};d&&d(h.root);let g=!1;if(h.ctx=c?c(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return h.ctx&&a(h.ctx[t],h.ctx[t]=r)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](r),g&&function(t,e){-1===t.$$.dirty[0]&&(D.push(t),M||(M=!0,N.then(I)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],h.update(),g=!0,o(h.before_update),h.fragment=!!i&&i(h.ctx),r.target){if(r.hydrate){u=!0;const t=($=r.target,Array.from($.childNodes));h.fragment&&h.fragment.l(t),t.forEach(m)}else h.fragment&&h.fragment.c();r.intro&&z(e.$$.fragment),V(e,r.target,r.anchor,r.customElement),u=!1,I()}var $;C(p)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(J=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(r);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){o(this.$$.on_disconnect)}$destroy(){X(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!i(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class K{$destroy(){X(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!i(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Q=[];function Y(e,n=t){let o;const r=new Set;function i(t){if(c(e,t)&&(e=t,o)){const t=!Q.length;for(const t of r)t[1](),Q.push(t,e);if(t){for(let t=0;t<Q.length;t+=2)Q[t][0](Q[t+1]);Q.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(c,a=t){const s=[c,a];return r.add(s),1===r.size&&(o=n(i)||t),c(e),()=>{r.delete(s),0===r.size&&(o(),o=null)}}}}function Z(e,n,c){const i=!Array.isArray(e),s=i?[e]:e,l=n.length<2;return{subscribe:Y(c,(e=>{let c=!1;const u=[];let d=0,f=t;const m=()=>{if(d)return;f();const o=n(i?u[0]:u,e);l?e(o):f=r(o)?o:t},p=s.map(((t,e)=>a(t,(t=>{u[e]=t,d&=~(1<<e),c&&m()}),(()=>{d|=1<<e}))));return c=!0,m(),function(){o(p),f()}})).subscribe}}const tt=Y([]),et=t=>{try{return!0===JSON.parse(t)}catch{return!1}},nt=Y((()=>{const t=Object.fromEntries(new URLSearchParams(location.search).entries()),e={role:t.role||"both",stream:t.stream||"both",audioVisOnly:et(t.audioVisOnly),manual:et(t.manual),remote:et(t.remote),hideSignaling:et(t.hideSignaling)};return Object.entries(e).map((([t,e])=>({key:t,value:e})))})()),ot=Z(nt,(t=>`${window.location.protocol}//${window.location.host}/?${(t=>{const e=new URLSearchParams;for(let[n,o]of t)e.set(n,o);return e.toString()})(t.map((({key:t,value:e})=>[t,e])))}`)),rt=Z(nt,(t=>{const e=Object.fromEntries(t.map((({key:t,value:e})=>[t,e])));let{role:n,stream:o,manual:r,remote:c,hideSignaling:i}=e;const a="recv"!==n,s="call"!==n&&"send"!==n||!1,l="down"!==o||!1,u="up"!==o||!1,d=r&&"no"!==r||!1,f=c&&"no"!==c||!1,m=a?"bob":"alice",p=s?"bob":"alice";return{...e,role:n,stream:o,manual:r,remote:c,hasCaller:a,hasReceiver:s,hasUpstream:l,hasDownstream:u,isManual:d,isRemote:f,hideSignaling:i,to:m,from:p}})),ct=Y({});function it(t,e,n){const o=t.slice();return o[4]=e[n].key,o[5]=e[n].value,o[6]=e,o[7]=n,o}function at(t){let e,n,o;function r(){t[3].call(e,t[6],t[7])}return{c(){e=h("input"),y(e,"type","text")},m(c,i){f(c,e,i),w(e,t[5]),n||(o=b(e,"input",r),n=!0)},p(n,o){t=n,2&o&&e.value!==t[5]&&w(e,t[5])},d(t){t&&m(e),n=!1,o()}}}function st(t){let e,n,o;function r(){t[2].call(e,t[6],t[7])}return{c(){e=h("input"),y(e,"type","checkbox")},m(c,i){f(c,e,i),e.checked=t[5],n||(o=b(e,"change",r),n=!0)},p(n,o){t=n,2&o&&(e.checked=t[5])},d(t){t&&m(e),n=!1,o()}}}function lt(t){let e,n,o,r,c,i,a=t[4]+"";function s(t,e){return"boolean"==typeof t[5]?st:at}let l=s(t),u=l(t);return{c(){e=h("tr"),n=h("td"),o=g(a),r=$(),c=h("td"),u.c(),i=$()},m(t,a){f(t,e,a),d(e,n),d(n,o),d(e,r),d(e,c),u.m(c,null),d(e,i)},p(t,e){2&e&&a!==(a=t[4]+"")&&k(o,a),l===(l=s(t))&&u?u.p(t,e):(u.d(1),u=l(t),u&&(u.c(),u.m(c,null)))},d(t){t&&m(e),u.d()}}}function ut(e){let n,o,r,c,i,a,s,l,u,v=e[1],b=[];for(let t=0;t<v.length;t+=1)b[t]=lt(it(e,v,t));return{c(){n=h("details"),o=h("summary"),o.textContent="config",r=$(),c=h("code"),i=h("pre"),a=h("a"),s=g(e[0]),l=$(),u=h("table");for(let t=0;t<b.length;t+=1)b[t].c();y(a,"href",e[0])},m(t,e){f(t,n,e),d(n,o),d(n,r),d(n,c),d(c,i),d(i,a),d(a,s),d(n,l),d(n,u);for(let t=0;t<b.length;t+=1)b[t].m(u,null)},p(t,[e]){if(1&e&&k(s,t[0]),1&e&&y(a,"href",t[0]),2&e){let n;for(v=t[1],n=0;n<v.length;n+=1){const o=it(t,v,n);b[n]?b[n].p(o,e):(b[n]=lt(o),b[n].c(),b[n].m(u,null))}for(;n<b.length;n+=1)b[n].d(1);b.length=v.length}},i:t,o:t,d(t){t&&m(n),p(b,t)}}}function dt(t,e,n){let o,r;return s(t,ot,(t=>n(0,o=t))),s(t,nt,(t=>n(1,r=t))),[o,r,function(t,e){t[e].value=this.checked,nt.set(r)},function(t,e){t[e].value=this.value,nt.set(r)}]}const ft=class extends K{constructor(t){super(),G(this,t,dt,ut,c,{})}},mt=Y({}),pt=Y({}),ht=Y({});function gt({from:t,offer:e}){mt.update((n=>({...n,[t]:e})))}function $t({from:t,answer:e}){pt.update((n=>({...n,[t]:e})))}function vt({from:t,candidate:e}){ht.update((n=>{const o=n[t]||[];return{...n,[t]:[...o,e]}}))}function bt({from:t}){ht.update((e=>({...e,[t]:[]})))}class yt{to;from;socket;constructor({to:t,from:e}){this.to=t,this.from=e}connect({url:t}){const e=new WebSocket(t);e.onopen=()=>{this.socket=e,this.socket.onmessage=this.received.bind(this)}}received({data:t}){const e=JSON.parse(t),{[this.to]:n,type:o}=e;console.debug("its for me!",n);const r=this.to;switch(o){case"offer":gt({from:r,offer:n});break;case"answer":$t({from:r,answer:n});break;case"candidate":vt({from:r,candidate:new RTCIceCandidate(n)})}}sendOffer(t){if(t){const e={[this.from]:t,type:"offer"};this.send(e)}}sendAnswer(t){if(t){const e={[this.from]:t,type:"answer"};this.send(e)}}sendCandidate(t){if(t){const e={[this.from]:t,type:"candidate"};this.send(e)}}send(t){if(this.socket){const e=JSON.stringify(t);this.socket.send(e)}}toString(){return`[Signaling Server calling ${this.from} → ${this.to}]`}}const kt=t=>"string"==typeof t?JSON.parse(t).sdp:"object"==typeof t?t.sdp:void 0,wt=t=>({type:"offer",sdp:t}),xt=t=>({type:"answer",sdp:t});function Ct(e){let n,o,r,c,i,a,s,l,u=JSON.stringify(e[2],null,4)+"";return{c(){n=h("details"),o=h("summary"),r=g(e[1]),c=$(),i=h("pre"),a=h("code"),s=g(u),n.open=l=Boolean(e[2])&&e[0]},m(t,e){f(t,n,e),d(n,o),d(o,r),d(n,c),d(n,i),d(i,a),d(a,s)},p(t,[e]){2&e&&k(r,t[1]),4&e&&u!==(u=JSON.stringify(t[2],null,4)+"")&&k(s,u),5&e&&l!==(l=Boolean(t[2])&&t[0])&&(n.open=l)},i:t,o:t,d(t){t&&m(n)}}}function St(t,e,n){let{open:o=!0}=e,{summary:r="???"}=e,{data:c}=e;return t.$$set=t=>{"open"in t&&n(0,o=t.open),"summary"in t&&n(1,r=t.summary),"data"in t&&n(2,c=t.data)},[o,r,c]}const Rt=class extends K{constructor(t){super(),G(this,t,St,Ct,c,{open:0,summary:1,data:2})}};function Tt(t,e,n){const o=t.slice();return o[21]=e[n],o}function Dt(t,e,n){const o=t.slice();return o[24]=e[n],o[26]=n,o}function Et(t){let e,n,o,r,c,i=(t[24].label||`camera ${t[26]}`)+"";function a(){return t[14](t[24])}return{c(){e=h("button"),n=g(i),o=$(),y(e,"class","svelte-vk2oy1")},m(t,i){f(t,e,i),d(e,n),d(e,o),r||(c=b(e,"click",a),r=!0)},p(e,o){t=e,4&o&&i!==(i=(t[24].label||`camera ${t[26]}`)+"")&&k(n,i)},d(t){t&&m(e),r=!1,c()}}}function _t(t){let e;return{c(){e=g("✔️")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Ot(t){let e,n,r,c,i,a,s,l,u,p,v,w,x,C,S,R=t[21].name+"",T=t[0]===t[21]&&_t();function D(){return t[15](t[21])}function E(){return t[16](t[21])}function _(){return t[17](t[21])}return{c(){e=h("tr"),n=h("td"),T&&T.c(),r=$(),c=h("td"),i=h("button"),a=g(R),s=$(),l=h("td"),u=h("button"),u.textContent="stop",p=$(),v=h("td"),w=h("button"),w.textContent="X",x=$(),y(i,"class","svelte-vk2oy1"),y(u,"class","svelte-vk2oy1"),y(w,"class","svelte-vk2oy1")},m(t,o){f(t,e,o),d(e,n),T&&T.m(n,null),d(e,r),d(e,c),d(c,i),d(i,a),d(e,s),d(e,l),d(l,u),d(e,p),d(e,v),d(v,w),d(e,x),C||(S=[b(i,"click",D),b(u,"click",E),b(w,"click",_)],C=!0)},p(e,o){(t=e)[0]===t[21]?T||(T=_t(),T.c(),T.m(n,null)):T&&(T.d(1),T=null),8&o&&R!==(R=t[21].name+"")&&k(a,R)},d(t){t&&m(e),T&&T.d(),C=!1,o(S)}}}function Nt(t){let e,n,o,r,c,i,a,s,l,u,p,v,b,y=t[5].readyState+"";return u=new Rt({props:{summary:"settings",data:t[5].getSettings()}}),v=new Rt({props:{summary:"constraints",data:t[5].getConstraints()}}),{c(){e=h("details"),n=h("summary"),o=g(t[4]),r=$(),c=h("dl"),i=h("dt"),i.textContent="readState",a=h("dd"),s=g(y),l=$(),W(u.$$.fragment),p=$(),W(v.$$.fragment)},m(t,m){f(t,e,m),d(e,n),d(n,o),d(e,r),d(e,c),d(c,i),d(c,a),d(a,s),d(e,l),V(u,e,null),d(e,p),V(v,e,null),b=!0},p(t,e){(!b||16&e)&&k(o,t[4]),(!b||32&e)&&y!==(y=t[5].readyState+"")&&k(s,y);const n={};32&e&&(n.data=t[5].getSettings()),u.$set(n);const r={};32&e&&(r.data=t[5].getConstraints()),v.$set(r)},i(t){b||(z(u.$$.fragment,t),z(v.$$.fragment,t),b=!0)},o(t){H(u.$$.fragment,t),H(v.$$.fragment,t),b=!1},d(t){t&&m(e),X(u),X(v)}}}function Mt(t){let e,n,r,c,i,a,s,l,u,g,k,w,x,C,S,R,T,D,E=t[2],_=[];for(let e=0;e<E.length;e+=1)_[e]=Et(Dt(t,E,e));let O=t[3],N=[];for(let e=0;e<O.length;e+=1)N[e]=Ot(Tt(t,O,e));let M=t[5]&&Nt(t);return{c(){e=h("h5"),e.textContent="upstream",n=$(),r=h("video"),r.innerHTML='<track kind="captions"/>',c=$(),i=h("nav"),a=h("button"),a.textContent="default",s=$(),l=h("button"),l.textContent="noise",u=$(),g=h("br"),k=$();for(let t=0;t<_.length;t+=1)_[t].c();w=$(),x=h("table");for(let t=0;t<N.length;t+=1)N[t].c();C=$(),M&&M.c(),S=v(),y(r,"id","upstream"),r.autoplay="true",y(r,"class","svelte-vk2oy1"),y(a,"class","svelte-vk2oy1"),y(l,"class","svelte-vk2oy1"),y(i,"class","svelte-vk2oy1")},m(o,m){f(o,e,m),f(o,n,m),f(o,r,m),t[11](r),f(o,c,m),f(o,i,m),d(i,a),d(i,s),d(i,l),d(i,u),d(i,g),d(i,k);for(let t=0;t<_.length;t+=1)_[t].m(i,null);f(o,w,m),f(o,x,m);for(let t=0;t<N.length;t+=1)N[t].m(x,null);f(o,C,m),M&&M.m(o,m),f(o,S,m),R=!0,T||(D=[b(a,"click",t[12]),b(l,"click",t[13])],T=!0)},p(t,[e]){if(132&e){let n;for(E=t[2],n=0;n<E.length;n+=1){const o=Dt(t,E,n);_[n]?_[n].p(o,e):(_[n]=Et(o),_[n].c(),_[n].m(i,null))}for(;n<_.length;n+=1)_[n].d(1);_.length=E.length}if(1801&e){let n;for(O=t[3],n=0;n<O.length;n+=1){const o=Tt(t,O,n);N[n]?N[n].p(o,e):(N[n]=Ot(o),N[n].c(),N[n].m(x,null))}for(;n<N.length;n+=1)N[n].d(1);N.length=O.length}t[5]?M?(M.p(t,e),32&e&&z(M,1)):(M=Nt(t),M.c(),z(M,1),M.m(S.parentNode,S)):M&&(q(),H(M,1,1,(()=>{M=null})),F())},i(t){R||(z(M),R=!0)},o(t){H(M),R=!1},d(a){a&&m(e),a&&m(n),a&&m(r),t[11](null),a&&m(c),a&&m(i),p(_,a),a&&m(w),a&&m(x),p(N,a),a&&m(C),M&&M.d(a),a&&m(S),T=!1,o(D)}}}function At(t,e,n){let o,r;const c=T();let i,a,s=[],l=[];async function u(){const t=await function(){let t=Object.assign(document.createElement("canvas"),{width:400,height:300}),e=t.getContext("2d");e.fillRect(0,0,t.width,t.height);let n=e.getImageData(0,0,t.width,t.height);return requestAnimationFrame((function t(){for(var o=0;o<n.data.length;o++)n.data[o++]=n.data[o++]=n.data[o++]=255*Math.random();e.putImageData(n,0,0),requestAnimationFrame(t)})),t.captureStream(60)}();t.name="noise feed",f(t),n(3,l=[...l,t])}async function d(t){const e=await async function(t){const e={video:!t||{deviceId:t}};return await navigator.mediaDevices.getUserMedia(e)}(t);e.name=t?function(t){const e=t&&s.find((({deviceId:e})=>e===t));return e&&e.label}(t):"default webcam",f(e),n(3,l=[...l,e])}function f(t){n(0,a=t),n(1,i.srcObject=t,i),c("stream",t)}function m(t){t.getTracks().forEach((t=>t.stop())),c("stop",t)}function p(t){m(t),n(3,l=[...l.filter((e=>e!=t))]),a===t&&n(0,a=void 0)}async function h(){const t=await navigator.mediaDevices.enumerateDevices();n(2,s=t.filter((({kind:t})=>"videoinput"===t)))}return R((()=>{h();const t=()=>h();return navigator.mediaDevices.addEventListener("devicechange",t),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),t.$$.update=()=>{1&t.$$.dirty&&n(5,o=a&&a.getTracks()[0]),1&t.$$.dirty&&n(4,r=a&&a.constructor.name)},[a,i,s,l,r,o,u,d,f,m,p,function(t){E[t?"unshift":"push"]((()=>{i=t,n(1,i)}))},()=>d(),()=>u(),t=>d(t.deviceId),t=>f(t),t=>m(t),t=>p(t)]}const jt=class extends K{constructor(t){super(),G(this,t,At,Mt,c,{})}};function Lt(t){let e,n,o,r;return e=new Rt({props:{summary:"settings",data:t[1].getSettings()}}),o=new Rt({props:{summary:"constraints",data:t[1].getConstraints()}}),{c(){W(e.$$.fragment),n=$(),W(o.$$.fragment)},m(t,c){V(e,t,c),f(t,n,c),V(o,t,c),r=!0},p(t,n){const r={};2&n&&(r.data=t[1].getSettings()),e.$set(r);const c={};2&n&&(c.data=t[1].getConstraints()),o.$set(c)},i(t){r||(z(e.$$.fragment,t),z(o.$$.fragment,t),r=!0)},o(t){H(e.$$.fragment,t),H(o.$$.fragment,t),r=!1},d(t){X(e,t),t&&m(n),X(o,t)}}}function It(t){let e,n,o,r,c,i,a,s=t[1]&&Lt(t);return{c(){e=h("h5"),e.textContent="downstream",n=$(),o=h("video"),o.innerHTML='<track kind="captions"/>',c=$(),s&&s.c(),i=v(),o.autoplay=r=!0},m(r,l){f(r,e,l),f(r,n,l),f(r,o,l),t[3](o),f(r,c,l),s&&s.m(r,l),f(r,i,l),a=!0},p(t,[e]){t[1]?s?(s.p(t,e),2&e&&z(s,1)):(s=Lt(t),s.c(),z(s,1),s.m(i.parentNode,i)):s&&(q(),H(s,1,1,(()=>{s=null})),F())},i(t){a||(z(s),a=!0)},o(t){H(s),a=!1},d(r){r&&m(e),r&&m(n),r&&m(o),t[3](null),r&&m(c),s&&s.d(r),r&&m(i)}}}function Pt(t,e,n){let o,r,{stream:c}=e;return t.$$set=t=>{"stream"in t&&n(2,c=t.stream)},t.$$.update=()=>{4&t.$$.dirty&&n(1,o=c&&c.getTracks()[0]),5&t.$$.dirty&&r&&n(0,r.srcObject=c,r)},[r,o,c,function(t){E[t?"unshift":"push"]((()=>{r=t,n(0,r),n(2,c)}))}]}const Bt=class extends K{constructor(t){super(),G(this,t,Pt,It,c,{stream:2})}};function Ut(e){let n,r,c,i,a,s,l;return{c(){n=h("form"),r=h("input"),c=$(),i=h("code"),a=g(e[0]),y(r,"size","90"),y(r,"placeholder","ws url")},m(t,o){var u;f(t,n,o),d(n,r),w(r,e[1]),f(t,c,o),f(t,i,o),d(i,a),s||(l=[b(r,"input",e[2]),b(n,"submit",(u=Jt,function(t){return t.preventDefault(),u.call(this,t)}))],s=!0)},p(t,[e]){2&e&&r.value!==t[1]&&w(r,t[1]),1&e&&k(a,t[0])},i:t,o:t,d(t){t&&m(n),t&&m(c),t&&m(i),s=!1,o(l)}}}function Jt(){}function qt(t,e,n){let o,{signalingClient:r}=e;return t.$$set=t=>{"signalingClient"in t&&n(0,r=t.signalingClient)},t.$$.update=()=>{3&t.$$.dirty&&(r.connect({url:o}),window.client=r)},n(1,o=`wss://${window.location.host}/signaling/test`),[r,o,function(){o=this.value,n(1,o)}]}const Ft=class extends K{constructor(t){super(),G(this,t,qt,Ut,c,{signalingClient:0})}};function zt(t,e,n){const o=t.slice();return o[6]=e[n][0],o[7]=e[n][1],o}function Ht(t){let e,n,o=t[0],r=[];for(let e=0;e<o.length;e+=1)r[e]=Wt(zt(t,o,e));const c=t=>H(r[t],1,1,(()=>{r[t]=null}));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=v()},m(t,o){for(let e=0;e<r.length;e+=1)r[e].m(t,o);f(t,e,o),n=!0},p(t,n){if(3&n){let i;for(o=t[0],i=0;i<o.length;i+=1){const c=zt(t,o,i);r[i]?(r[i].p(c,n),z(r[i],1)):(r[i]=Wt(c),r[i].c(),z(r[i],1),r[i].m(e.parentNode,e))}for(q(),i=o.length;i<r.length;i+=1)c(i);F()}},i(t){if(!n){for(let t=0;t<o.length;t+=1)z(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)H(r[t]);n=!1},d(t){p(r,t),t&&m(e)}}}function Wt(t){let e,n,c,i,a,s,l,u,p,v,w,x,C,S,R,T,D,E,_,O,N,M,A,j,L,I,P,B,U,J=`transceiver ${t[7].mid}`,q=t[7].mid+"",F=t[7].sender.track+"";function G(){return t[4](t[6])}return O=new Rt({props:{summary:"details",data:t[7],open:!1}}),{c(){e=h("div"),n=h("div"),c=g(J),i=$(),a=h("table"),s=h("tr"),l=h("th"),l.textContent="mid",u=$(),p=h("td"),v=h("code"),w=g(q),x=$(),C=h("tr"),S=h("th"),S.textContent="track",R=$(),T=h("td"),D=h("code"),E=g(F),_=$(),W(O.$$.fragment),N=$(),M=h("div"),A=h("button"),A.textContent="replaceTrack",j=$(),L=h("button"),L.textContent="replaceTrack(null)",I=$(),y(A,"class","btn-small"),y(L,"class","btn-small"),y(e,"class","grid box svelte-1nbk03h")},m(o,m){f(o,e,m),d(e,n),d(n,c),d(n,i),d(n,a),d(a,s),d(s,l),d(s,u),d(s,p),d(p,v),d(v,w),d(a,x),d(a,C),d(C,S),d(C,R),d(C,T),d(T,D),d(D,E),d(n,_),V(O,n,null),d(e,N),d(e,M),d(M,A),d(M,j),d(M,L),d(e,I),P=!0,B||(U=[b(A,"click",(function(){r(t[1](t[6].sender))&&t[1](t[6].sender).apply(this,arguments)})),b(L,"click",G)],B=!0)},p(e,n){t=e,(!P||1&n)&&J!==(J=`transceiver ${t[7].mid}`)&&k(c,J),(!P||1&n)&&q!==(q=t[7].mid+"")&&k(w,q),(!P||1&n)&&F!==(F=t[7].sender.track+"")&&k(E,F);const o={};1&n&&(o.data=t[7]),O.$set(o)},i(t){P||(z(O.$$.fragment,t),P=!0)},o(t){H(O.$$.fragment,t),P=!1},d(t){t&&m(e),X(O),B=!1,o(U)}}}function Vt(t){let e,n,o,r,c=t[0]&&Ht(t);return{c(){e=h("h5"),e.textContent="transceivers",n=$(),c&&c.c(),o=v()},m(t,i){f(t,e,i),f(t,n,i),c&&c.m(t,i),f(t,o,i),r=!0},p(t,[e]){t[0]?c?(c.p(t,e),1&e&&z(c,1)):(c=Ht(t),c.c(),z(c,1),c.m(o.parentNode,o)):c&&(q(),H(c,1,1,(()=>{c=null})),F())},i(t){r||(z(c),r=!0)},o(t){H(c),r=!1},d(t){t&&m(e),t&&m(n),c&&c.d(t),t&&m(o)}}}function Xt(t,e,n){let o,r,{peerconnection:c}=e,{streamSource:i}=e;return R((()=>{const t=setInterval((()=>{o&&n(0,r=o.map((t=>{const{mid:e,direction:n,currentDirection:o,stopped:r,sender:c,receiver:i}=t;let a={},s={};{let{dtmf:t,track:e,transport:n}=c;a={dtmf:t,track:e,transport:n,parameters:c.getParameters&&c.getParameters()}}{let{dtmf:t,track:e,transport:n}=i;s={dtmf:t,track:e,transport:n,parameters:i.getParameters&&i.getParameters(),csrcs:i.getContributingSources(),ssrcs:i.getSynchronizationSources()}}return[t,{mid:e,direction:n,currentDirection:o,stopped:r,sender:a,receiver:s}]})))}),1e3);return()=>clearInterval(t)})),t.$$set=t=>{"peerconnection"in t&&n(2,c=t.peerconnection),"streamSource"in t&&n(3,i=t.streamSource)},t.$$.update=()=>{4&t.$$.dirty&&(o=c&&c.getTransceivers())},[r,function(t){return()=>{const e=i().getTracks()[0];e&&t.replaceTrack(e)}},c,i,t=>t.sender.replaceTrack(null)]}const Gt=class extends K{constructor(t){super(),G(this,t,Xt,Vt,c,{peerconnection:2,streamSource:3})}};function Kt(e){let n,o;return n=new Ft({props:{signalingClient:e[23]}}),{c(){W(n.$$.fragment)},m(t,e){V(n,t,e),o=!0},p:t,i(t){o||(z(n.$$.fragment,t),o=!0)},o(t){H(n.$$.fragment,t),o=!1},d(t){X(n,t)}}}function Qt(e){let n,o,r;return o=new jt({}),o.$on("stream",e[36]),o.$on("stop",e[37]),{c(){n=h("article"),W(o.$$.fragment),y(n,"id","upstream"),y(n,"class","box")},m(t,e){f(t,n,e),V(o,n,null),r=!0},p:t,i(t){r||(z(o.$$.fragment,t),r=!0)},o(t){H(o.$$.fragment,t),r=!1},d(t){t&&m(n),X(o)}}}function Yt(t){let e,n,o;return n=new Bt({props:{stream:void 0}}),t[38](n),{c(){e=h("article"),W(n.$$.fragment),y(e,"id","downstream"),y(e,"class","box")},m(t,r){f(t,e,r),V(n,e,null),o=!0},p(t,e){n.$set({})},i(t){o||(z(n.$$.fragment,t),o=!0)},o(t){H(n.$$.fragment,t),o=!1},d(o){o&&m(e),t[38](null),X(n)}}}function Zt(t){let e;return{c(){e=g("addStream")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function te(t){let e;return{c(){e=g("replaceTrack")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function ee(t){let e,n,o,r,c=t[9].name+"";return{c(){e=h("small"),n=h("code"),o=h("pre"),r=g(c)},m(t,c){f(t,e,c),d(e,n),d(n,o),d(o,r)},p(t,e){512&e[0]&&c!==(c=t[9].name+"")&&k(r,c)},d(t){t&&m(e)}}}function ne(t){let e,n,o,r,c,i,a,s=t[22].join(" ")+"";return{c(){e=h("tr"),n=h("th"),n.textContent="events:",o=$(),r=h("td"),c=h("code"),i=h("small"),a=g(s)},m(t,s){f(t,e,s),d(e,n),d(e,o),d(e,r),d(r,c),d(c,i),d(i,a)},p(t,e){4194304&e[0]&&s!==(s=t[22].join(" ")+"")&&k(a,s)},d(t){t&&m(e)}}}function oe(t){let e,n,o,r,c,i,a,s,l,u=t[13]&&re(t),p=t[20]&&!t[5].isManual&&ce(t),y=t[5].isManual&&ie(t);return{c(){e=h("label"),n=g("1.\n                "),o=h("button"),o.textContent="create offer",r=$(),u&&u.c(),c=$(),p&&p.c(),i=$(),y&&y.c(),a=v()},m(m,h){f(m,e,h),d(e,n),d(e,o),f(m,r,h),u&&u.m(m,h),f(m,c,h),p&&p.m(m,h),f(m,i,h),y&&y.m(m,h),f(m,a,h),s||(l=b(o,"click",t[25]),s=!0)},p(t,e){t[13]?u?u.p(t,e):(u=re(t),u.c(),u.m(c.parentNode,c)):u&&(u.d(1),u=null),t[20]&&!t[5].isManual?p?p.p(t,e):(p=ce(t),p.c(),p.m(i.parentNode,i)):p&&(p.d(1),p=null),t[5].isManual?y?y.p(t,e):(y=ie(t),y.c(),y.m(a.parentNode,a)):y&&(y.d(1),y=null)},d(t){t&&m(e),t&&m(r),u&&u.d(t),t&&m(c),p&&p.d(t),t&&m(i),y&&y.d(t),t&&m(a),s=!1,l()}}}function re(t){let e,n,r,c,i,a,s,l,u,p,v,k;return{c(){e=h("div"),n=h("textarea"),r=$(),c=h("br"),i=$(),a=h("label"),s=g("2.\n                        "),l=h("button"),l.textContent="setLocalDescription",u=$(),p=h("button"),p.textContent="send offer",y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),x(n,"hideSignaling",t[17])},m(o,m){f(o,e,m),d(e,n),w(n,t[13]),d(e,r),d(e,c),d(e,i),d(e,a),d(a,s),d(a,l),d(a,u),d(a,p),v||(k=[b(n,"input",t[43]),b(l,"click",t[44]),b(p,"click",t[27])],v=!0)},p(t,e){8192&e[0]&&w(n,t[13]),131072&e[0]&&x(n,"hideSignaling",t[17])},d(t){t&&m(e),v=!1,o(k)}}}function ce(t){let e,n,r,c,i,a,s,l,u,p;return{c(){e=h("div"),n=h("textarea"),r=$(),c=h("br"),i=$(),a=h("label"),s=g("5.\n                        "),l=h("button"),l.textContent="setRemoteDescription",y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),x(n,"hideSignaling",t[17])},m(o,m){f(o,e,m),d(e,n),w(n,t[20]),d(e,r),d(e,c),d(e,i),d(e,a),d(a,s),d(a,l),u||(p=[b(n,"input",t[45]),b(l,"click",t[46])],u=!0)},p(t,e){1048576&e[0]&&w(n,t[20]),131072&e[0]&&x(n,"hideSignaling",t[17])},d(t){t&&m(e),u=!1,o(p)}}}function ie(t){let e,n,r,c,i,a,s,l,u,p,v,k;return{c(){e=h("div"),n=h("strong"),n.textContent="MANUAL ANSWER HERE",r=$(),c=h("textarea"),i=$(),a=h("br"),s=$(),l=h("label"),u=g("5.\n                        "),p=h("button"),p.textContent="setRemoteDescription",y(c,"rows","20"),y(c,"class","svelte-3b0r9n")},m(o,m){f(o,e,m),d(e,n),d(e,r),d(e,c),w(c,t[16]),d(e,i),d(e,a),d(e,s),d(e,l),d(l,u),d(l,p),v||(k=[b(c,"input",t[47]),b(p,"click",t[48])],v=!0)},p(t,e){65536&e[0]&&w(c,t[16])},d(t){t&&m(e),v=!1,o(k)}}}function ae(t){let e,n,o,r=t[21]&&!t[5].isManual&&se(t),c=t[5].isManual&&le(t),i=t[14]&&t[21]&&ue(t);return{c(){r&&r.c(),e=$(),c&&c.c(),n=$(),i&&i.c(),o=v()},m(t,a){r&&r.m(t,a),f(t,e,a),c&&c.m(t,a),f(t,n,a),i&&i.m(t,a),f(t,o,a)},p(t,a){t[21]&&!t[5].isManual?r?r.p(t,a):(r=se(t),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),t[5].isManual?c?c.p(t,a):(c=le(t),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null),t[14]&&t[21]?i?i.p(t,a):(i=ue(t),i.c(),i.m(o.parentNode,o)):i&&(i.d(1),i=null)},d(t){r&&r.d(t),t&&m(e),c&&c.d(t),t&&m(n),i&&i.d(t),t&&m(o)}}}function se(t){let e,n,r,c,i,a,s,l,u,p,v,k;return{c(){e=h("div"),n=h("textarea"),r=$(),c=h("br"),i=$(),a=h("label"),s=g("3.\n                        "),l=h("button"),l.textContent="setRemoteDescription",u=$(),p=h("button"),p.textContent="create answer",y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),x(n,"hideSignaling",t[17])},m(o,m){f(o,e,m),d(e,n),w(n,t[21]),d(e,r),d(e,c),d(e,i),d(e,a),d(a,s),d(a,l),d(a,u),d(a,p),v||(k=[b(n,"input",t[49]),b(l,"click",t[50]),b(p,"click",t[26])],v=!0)},p(t,e){2097152&e[0]&&w(n,t[21]),131072&e[0]&&x(n,"hideSignaling",t[17])},d(t){t&&m(e),v=!1,o(k)}}}function le(t){let e,n,r,c,i,a,s,l,u,p,v,k,x,C;return{c(){e=h("div"),n=h("strong"),n.textContent="MANUAL OFFER HERE",r=$(),c=h("textarea"),i=$(),a=h("br"),s=$(),l=h("label"),u=g("3.\n                        "),p=h("button"),p.textContent="setRemoteDescription",v=$(),k=h("button"),k.textContent="create answer",y(c,"rows","20"),y(c,"class","svelte-3b0r9n")},m(o,m){f(o,e,m),d(e,n),d(e,r),d(e,c),w(c,t[15]),d(e,i),d(e,a),d(e,s),d(e,l),d(l,u),d(l,p),d(l,v),d(l,k),x||(C=[b(c,"input",t[51]),b(p,"click",t[52]),b(k,"click",t[26])],x=!0)},p(t,e){32768&e[0]&&w(c,t[15])},d(t){t&&m(e),x=!1,o(C)}}}function ue(t){let e,n,r,c,i,a,s,l,u,p,v,k;return{c(){e=h("div"),n=h("textarea"),r=$(),c=h("br"),i=$(),a=h("label"),s=g("4.\n                        "),l=h("button"),l.textContent="setLocalDescription",u=$(),p=h("button"),p.textContent="send answer",y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),x(n,"hideSignaling",t[17])},m(o,m){f(o,e,m),d(e,n),w(n,t[14]),d(e,r),d(e,c),d(e,i),d(e,a),d(a,s),d(a,l),d(a,u),d(a,p),v||(k=[b(n,"input",t[53]),b(l,"click",t[54]),b(p,"click",t[28])],v=!0)},p(t,e){16384&e[0]&&w(n,t[14]),131072&e[0]&&x(n,"hideSignaling",t[17])},d(t){t&&m(e),v=!1,o(k)}}}function de(t){let e,n,o;return{c(){e=h("textarea"),y(e,"rows","10"),y(e,"class","svelte-3b0r9n"),x(e,"hideSignaling",t[17])},m(r,c){f(r,e,c),w(e,t[19]),n||(o=b(e,"input",t[55]),n=!0)},p(t,n){524288&n[0]&&w(e,t[19]),131072&n[0]&&x(e,"hideSignaling",t[17])},d(t){t&&m(e),n=!1,o()}}}function fe(t){let e,n,o,r,c,i,a,s,l=JSON.stringify(t[18],null,4)+"";return{c(){e=h("label"),e.textContent="injected Candidates",n=$(),o=h("textarea"),r=$(),c=h("pre"),i=g(l),y(e,"for","injectedCandidates"),y(o,"name","injectedCandidates"),y(o,"rows","20"),y(o,"class","svelte-3b0r9n")},m(l,u){f(l,e,u),f(l,n,u),f(l,o,u),w(o,t[4]),f(l,r,u),f(l,c,u),d(c,i),a||(s=b(o,"input",t[56]),a=!0)},p(t,e){16&e[0]&&w(o,t[4]),262144&e[0]&&l!==(l=JSON.stringify(t[18],null,4)+"")&&k(i,l)},d(t){t&&m(e),t&&m(n),t&&m(o),t&&m(r),t&&m(c),a=!1,s()}}}function me(t){let e,n,r,c,i,a,s,l,u,p,v,w,x,C,S,R,T,D,E,_,O,N,M,A,j,L,I,P,B,U,J,G,K,Q,Y,Z,tt,et,nt,ot,rt,ct,it,at,st,lt,ut,dt,ft,mt,pt,ht,gt,$t,vt,bt,yt,kt,wt,xt,Ct,St,Rt,Tt=t[5].isRemote&&Kt(t),Dt=t[5].hasUpstream&&Qt(t),Et=t[5].hasDownstream&&Yt(t);function _t(t,e){return t[8]?te:Zt}let Ot=_t(t),Nt=Ot(t),Mt=t[9]&&t[9].name&&ee(t);E=new Gt({props:{peerconnection:t[7],streamSource:t[40]}});let At=!t[17]&&ne(t),jt=t[0]&&oe(t),Lt=t[1]&&ae(t),It=(t[19].length||t[5].isManual)&&de(t),Pt=t[5].isManual&&fe(t);return{c(){e=h("section"),n=h("h3"),r=g(t[2]),c=$(),i=h("small"),a=g("talking to "),s=g(t[3]),l=$(),Tt&&Tt.c(),u=$(),Dt&&Dt.c(),p=$(),Et&&Et.c(),v=$(),w=h("article"),x=h("h5"),x.textContent="peerconnection",C=$(),S=h("button"),Nt.c(),T=$(),Mt&&Mt.c(),D=$(),W(E.$$.fragment),_=$(),O=h("article"),N=h("h5"),N.textContent="signaling",M=$(),A=h("div"),j=h("table"),L=h("tr"),I=h("th"),I.textContent="signaling:",P=$(),B=h("td"),U=h("code"),J=g(t[10]),G=$(),K=h("tr"),Q=h("th"),Q.textContent="connection:",Y=$(),Z=h("td"),tt=h("code"),et=g(t[11]),nt=$(),ot=h("tr"),rt=h("th"),rt.textContent="ice:",ct=$(),it=h("td"),at=h("code"),st=g(t[12]),lt=$(),At&&At.c(),ut=$(),dt=h("div"),ft=h("span"),mt=h("label"),pt=h("input"),ht=g("\n                    caller"),gt=$(),$t=h("label"),vt=h("input"),bt=g("\n                    receiver"),yt=$(),jt&&jt.c(),kt=$(),Lt&&Lt.c(),wt=$(),It&&It.c(),xt=$(),Pt&&Pt.c(),S.disabled=R=!Boolean(t[9]),y(w,"class","box"),y(j,"class","vertical"),y(A,"class","box"),y(pt,"type","checkbox"),y(vt,"type","checkbox"),y(dt,"class","box"),y(O,"class","box")},m(o,m){f(o,e,m),d(e,n),d(n,r),d(n,c),d(n,i),d(i,a),d(i,s),d(e,l),Tt&&Tt.m(e,null),d(e,u),Dt&&Dt.m(e,null),d(e,p),Et&&Et.m(e,null),d(e,v),d(e,w),d(w,x),d(w,C),d(w,S),Nt.m(S,null),d(w,T),Mt&&Mt.m(w,null),d(w,D),V(E,w,null),d(e,_),d(e,O),d(O,N),d(O,M),d(O,A),d(A,j),d(j,L),d(L,I),d(L,P),d(L,B),d(B,U),d(U,J),d(j,G),d(j,K),d(K,Q),d(K,Y),d(K,Z),d(Z,tt),d(tt,et),d(j,nt),d(j,ot),d(ot,rt),d(ot,ct),d(ot,it),d(it,at),d(at,st),d(j,lt),At&&At.m(j,null),d(O,ut),d(O,dt),d(dt,ft),d(ft,mt),d(mt,pt),pt.checked=t[0],d(mt,ht),d(ft,gt),d(ft,$t),d($t,vt),vt.checked=t[1],d($t,bt),d(O,yt),jt&&jt.m(O,null),d(O,kt),Lt&&Lt.m(O,null),d(O,wt),It&&It.m(O,null),d(O,xt),Pt&&Pt.m(O,null),Ct=!0,St||(Rt=[b(S,"click",t[39]),b(pt,"change",t[41]),b(vt,"change",t[42])],St=!0)},p(t,n){(!Ct||4&n[0])&&k(r,t[2]),(!Ct||8&n[0])&&k(s,t[3]),t[5].isRemote?Tt?(Tt.p(t,n),32&n[0]&&z(Tt,1)):(Tt=Kt(t),Tt.c(),z(Tt,1),Tt.m(e,u)):Tt&&(q(),H(Tt,1,1,(()=>{Tt=null})),F()),t[5].hasUpstream?Dt?(Dt.p(t,n),32&n[0]&&z(Dt,1)):(Dt=Qt(t),Dt.c(),z(Dt,1),Dt.m(e,p)):Dt&&(q(),H(Dt,1,1,(()=>{Dt=null})),F()),t[5].hasDownstream?Et?(Et.p(t,n),32&n[0]&&z(Et,1)):(Et=Yt(t),Et.c(),z(Et,1),Et.m(e,v)):Et&&(q(),H(Et,1,1,(()=>{Et=null})),F()),Ot!==(Ot=_t(t))&&(Nt.d(1),Nt=Ot(t),Nt&&(Nt.c(),Nt.m(S,null))),(!Ct||512&n[0]&&R!==(R=!Boolean(t[9])))&&(S.disabled=R),t[9]&&t[9].name?Mt?Mt.p(t,n):(Mt=ee(t),Mt.c(),Mt.m(w,D)):Mt&&(Mt.d(1),Mt=null);const o={};128&n[0]&&(o.peerconnection=t[7]),512&n[0]&&(o.streamSource=t[40]),E.$set(o),(!Ct||1024&n[0])&&k(J,t[10]),(!Ct||2048&n[0])&&k(et,t[11]),(!Ct||4096&n[0])&&k(st,t[12]),t[17]?At&&(At.d(1),At=null):At?At.p(t,n):(At=ne(t),At.c(),At.m(j,null)),1&n[0]&&(pt.checked=t[0]),2&n[0]&&(vt.checked=t[1]),t[0]?jt?jt.p(t,n):(jt=oe(t),jt.c(),jt.m(O,kt)):jt&&(jt.d(1),jt=null),t[1]?Lt?Lt.p(t,n):(Lt=ae(t),Lt.c(),Lt.m(O,wt)):Lt&&(Lt.d(1),Lt=null),t[19].length||t[5].isManual?It?It.p(t,n):(It=de(t),It.c(),It.m(O,xt)):It&&(It.d(1),It=null),t[5].isManual?Pt?Pt.p(t,n):(Pt=fe(t),Pt.c(),Pt.m(O,null)):Pt&&(Pt.d(1),Pt=null)},i(t){Ct||(z(Tt),z(Dt),z(Et),z(E.$$.fragment,t),Ct=!0)},o(t){H(Tt),H(Dt),H(Et),H(E.$$.fragment,t),Ct=!1},d(t){t&&m(e),Tt&&Tt.d(),Dt&&Dt.d(),Et&&Et.d(),Nt.d(),Mt&&Mt.d(),X(E),At&&At.d(),jt&&jt.d(),Lt&&Lt.d(),It&&It.d(),Pt&&Pt.d(),St=!1,o(Rt)}}}function pe(t,e,n){let o,r,c,i,a,l,u,d,f,m,p;s(t,rt,(t=>n(5,u=t))),s(t,ht,(t=>n(57,d=t))),s(t,pt,(t=>n(33,f=t))),s(t,mt,(t=>n(34,m=t))),s(t,ct,(t=>n(35,p=t)));var h=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,c){function i(t){try{s(o.next(t))}catch(t){c(t)}}function a(t){try{s(o.throw(t))}catch(t){c(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}s((o=o.apply(t,e||[])).next())}))};let{isCaller:g=!1}=e,{isReceiver:$=!1}=e,{name:v="unnamed participant"}=e,{recipient:b=null}=e;const y=new yt({from:v,to:b}),k=(t=>(e,n)=>function(t,e,n){const o={name:t,short:e,event:n};tt.update((t=>[...t,o])),ct.update((n=>({...n,[t]:[...n[t]||[],e]})))}(t,e,n))(v);let w,x,C,S,T="",D="",_="",O="",N="",M="",A="",j=[],L="",I="plan-b"===new URL(document.location.toString()).searchParams.get("semantic")?{sdpSemantics:"plan-b"}:{sdpSemantics:"unified-plan"};function P(t){C?(k("rt","replace track"),console.info("replace track",{sender:C}),C.replaceTrack(t.getTracks()[0])):(k("at","add track"),console.info("add track"),n(8,C=x.addTrack(t.getTracks()[0],t)))}function B(){return h(this,void 0,void 0,(function*(){k("o","create offer");const t=yield x.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});n(13,O=t.sdp)}))}function U(t){return h(this,void 0,void 0,(function*(){k("l","setLocalDescription"),console.debug("localDescription ->",t);const e=t;bt({from:v}),x.setLocalDescription(e),q(),bt({from:b})}))}function J(t){k("r","setRemoteDescription");const e=wt(t);x.setRemoteDescription(e),q(),bt({from:b})}function q(){u.isManual?(a||[]).forEach((t=>{t&&(k("ac","addIceCandidate"),x.addIceCandidate(t))})):(console.debug(d[b]),(d[b]||[]).forEach((t=>{t&&(k("ac","addIceCandidate"),x.addIceCandidate(t))})))}function F(t){k("r","setRemoteDescription");const e=xt(t);x.setRemoteDescription(e),bt({from:v})}return R((()=>{n(7,x=function(){const t=new RTCPeerConnection(I);return t.ontrack=t=>{const{track:e,streams:n,transceiver:o}=t,r=n[0];w.$set({stream:r}),r.onaddtrack=()=>{k("ta","track added"),console.warn(`${v}track added to stream`,{track:e,stream:r})},"video"==e.kind&&(console.info(`${v}.ontrack`,{track:e,streams:n,kind:e.kind,transceiver:o}),e.onmute=t=>{k("tm","track muted"),console.info(`${v} track onmute`,{event:t})},e.onunmute=t=>{k("tu","track unmuted"),console.info(`${v} track onunmute`,{event:t})},e.onended=t=>{k("te","track ended"),console.debug(`${v} track onended`,{event:t})})},t.onicecandidate=({candidate:t})=>{k("lc","create candidate"),n(32,j=[...j,t]),function(t){v&&t&&(vt({from:v,candidate:t}),u.isRemote&&y.sendCandidate(t))}(t)},t.onsignalingstatechange=()=>n(10,T=t.signalingState),t.onconnectionstatechange=()=>n(11,D=t.connectionState),t.oniceconnectionstatechange=()=>n(12,_=t.iceConnectionState),console.info(`setup RTCPeerConnection for ${v}`,I,t),t}()),ht.subscribe((({[b]:t})=>{t&&k("rc")})),u.hasCaller&&B()})),t.$$set=t=>{"isCaller"in t&&n(0,g=t.isCaller),"isReceiver"in t&&n(1,$=t.isReceiver),"name"in t&&n(2,v=t.name),"recipient"in t&&n(3,b=t.recipient)},t.$$.update=()=>{4&t.$$.dirty[0]|16&t.$$.dirty[1]&&n(22,o=p[v]||[]),8&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(21,r=kt(m[b])),8&t.$$.dirty[0]|4&t.$$.dirty[1]&&n(20,c=kt(f[b])),2&t.$$.dirty[1]&&n(19,i=JSON.stringify(j)),16&t.$$.dirty[0]&&n(18,a=(t=>{try{return JSON.parse(t)}catch(e){return""!==t&&console.warn({parseError:e}),[]}})(L)),32&t.$$.dirty[0]&&n(17,l=u.hideSignaling)},[g,$,v,b,L,u,w,x,C,S,T,D,_,O,N,M,A,l,a,i,c,r,o,y,P,B,function(){return h(this,void 0,void 0,(function*(){k("a","create answer");const t=yield x.createAnswer();n(14,N=t.sdp)}))},function(){const t=wt(O);gt({from:v,offer:t}),u.isRemote&&y.sendOffer(t)},function(){const t=wt(N);$t({from:v,answer:t}),u.isRemote&&y.sendAnswer(t)},U,J,F,j,f,m,p,({detail:t})=>n(9,S=t),()=>n(9,S=void 0),function(t){E[t?"unshift":"push"]((()=>{w=t,n(6,w)}))},()=>P(S),()=>S,function(){g=this.checked,n(0,g)},function(){$=this.checked,n(1,$)},function(){O=this.value,n(13,O)},()=>U(wt(O)),function(){c=this.value,n(20,c),n(33,f),n(3,b)},()=>F(c),function(){A=this.value,n(16,A)},()=>F(A),function(){r=this.value,n(21,r),n(34,m),n(3,b)},()=>J(r),function(){M=this.value,n(15,M)},()=>J(M),function(){N=this.value,n(14,N)},()=>U(xt(N)),function(){i=this.value,n(19,i),n(32,j)},function(){L=this.value,n(4,L)}]}const he=class extends K{constructor(t){super(),G(this,t,pe,me,c,{isCaller:0,isReceiver:1,name:2,recipient:3},null,[-1,-1,-1])}};function ge(t,e,n){const o=t.slice();return o[1]=e[n].name,o[2]=e[n].event,o}function $e(t){let e,n,o,r,c,i,a,s,l,u=t[1]+"",p=t[2]+"";return{c(){e=h("tr"),n=h("th"),o=g(u),r=g(":"),c=$(),i=h("td"),a=h("code"),s=g(p),l=$()},m(t,u){f(t,e,u),d(e,n),d(n,o),d(n,r),d(e,c),d(e,i),d(i,a),d(a,s),d(e,l)},p(t,e){1&e&&u!==(u=t[1]+"")&&k(o,u),1&e&&p!==(p=t[2]+"")&&k(s,p)},d(t){t&&m(e)}}}function ve(e){let n,o,r,c,i,a=e[0].filter(be),s=[];for(let t=0;t<a.length;t+=1)s[t]=$e(ge(e,a,t));return{c(){n=h("section"),o=h("h3"),o.innerHTML="Event Log <small>please open\n        <code>about://webrtc-internals</code></small>",r=$(),c=h("div"),i=h("table");for(let t=0;t<s.length;t+=1)s[t].c();y(i,"class","vertical svelte-111zlyk"),y(c,"class","box")},m(t,e){f(t,n,e),d(n,o),d(n,r),d(n,c),d(c,i);for(let t=0;t<s.length;t+=1)s[t].m(i,null)},p(t,[e]){if(1&e){let n;for(a=t[0].filter(be),n=0;n<a.length;n+=1){const o=ge(t,a,n);s[n]?s[n].p(o,e):(s[n]=$e(o),s[n].c(),s[n].m(i,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=a.length}},i:t,o:t,d(t){t&&m(n),p(s,t)}}}const be=t=>t.event;function ye(t,e,n){let o;return s(t,tt,(t=>n(0,o=t))),[o]}const ke=class extends K{constructor(t){super(),G(this,t,ye,ve,c,{})}};function we(t){let e,n;return e=new he({props:{name:"alice",isCaller:"true",recipient:"bob"}}),{c(){W(e.$$.fragment)},m(t,o){V(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function xe(t){let e,n;return e=new he({props:{name:"bob",isReceiver:"true",recipient:"alice"}}),{c(){W(e.$$.fragment)},m(t,o){V(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Ce(t){let e,n;return e=new ke({}),{c(){W(e.$$.fragment)},m(t,o){V(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Se(t){let e,n,o,r,c,i,a,s,l,u,p=t[0].hasCaller&&we(),g=t[0].hasReceiver&&xe(),v=!t[0].hideSignaling&&Ce();return l=new ft({}),{c(){e=h("div"),n=h("h1"),n.textContent="WebRTC Plumber",o=$(),r=h("main"),p&&p.c(),c=$(),g&&g.c(),i=$(),v&&v.c(),a=$(),s=h("aside"),W(l.$$.fragment),y(r,"class","svelte-1mx8d2d"),y(e,"class","svelte-1mx8d2d")},m(t,m){f(t,e,m),d(e,n),d(e,o),d(e,r),p&&p.m(r,null),d(r,c),g&&g.m(r,null),d(r,i),v&&v.m(r,null),d(e,a),d(e,s),V(l,s,null),u=!0},p(t,[e]){t[0].hasCaller?p?1&e&&z(p,1):(p=we(),p.c(),z(p,1),p.m(r,c)):p&&(q(),H(p,1,1,(()=>{p=null})),F()),t[0].hasReceiver?g?1&e&&z(g,1):(g=xe(),g.c(),z(g,1),g.m(r,i)):g&&(q(),H(g,1,1,(()=>{g=null})),F()),t[0].hideSignaling?v&&(q(),H(v,1,1,(()=>{v=null})),F()):v?1&e&&z(v,1):(v=Ce(),v.c(),z(v,1),v.m(r,null))},i(t){u||(z(p),z(g),z(v),z(l.$$.fragment,t),u=!0)},o(t){H(p),H(g),H(v),H(l.$$.fragment,t),u=!1},d(t){t&&m(e),p&&p.d(),g&&g.d(),v&&v.d(),X(l)}}}function Re(t,e,n){let o;return s(t,rt,(t=>n(0,o=t))),[o]}const Te=class extends K{constructor(t){super(),G(this,t,Re,Se,c,{})}};function De(t,e,n){const o=t.slice();return o[31]=e[n],o}function Ee(t,e,n){const o=t.slice();return o[34]=e[n],o[36]=n,o}function _e(t){let e,n,o,r,c=(t[34].label||`micorophone ${t[36]}`)+"";function i(){return t[12](t[34])}return{c(){e=h("button"),n=g(c),y(e,"class","svelte-2jsuhx")},m(t,c){f(t,e,c),d(e,n),o||(r=b(e,"click",i),o=!0)},p(e,o){t=e,4&o[0]&&c!==(c=(t[34].label||`micorophone ${t[36]}`)+"")&&k(n,c)},d(t){t&&m(e),o=!1,r()}}}function Oe(t){let e;return{c(){e=g("✔️")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Ne(t){let e,n,r,c,i,a,s,l,u,p,v,w,x,C,S,R=t[31].name+"",T=t[1]===t[31]&&Oe();function D(){return t[16](t[31])}function E(){return t[17](t[31])}function _(){return t[18](t[31])}return{c(){e=h("tr"),n=h("td"),T&&T.c(),r=$(),c=h("td"),i=h("button"),a=g(R),s=$(),l=h("td"),u=h("button"),u.textContent="stop",p=$(),v=h("td"),w=h("button"),w.textContent="X",x=$(),y(i,"class","svelte-2jsuhx"),y(u,"class","svelte-2jsuhx"),y(w,"class","svelte-2jsuhx")},m(t,o){f(t,e,o),d(e,n),T&&T.m(n,null),d(e,r),d(e,c),d(c,i),d(i,a),d(e,s),d(e,l),d(l,u),d(e,p),d(e,v),d(v,w),d(e,x),C||(S=[b(i,"click",D),b(u,"click",E),b(w,"click",_)],C=!0)},p(e,o){(t=e)[1]===t[31]?T||(T=Oe(),T.c(),T.m(n,null)):T&&(T.d(1),T=null),8&o[0]&&R!==(R=t[31].name+"")&&k(a,R)},d(t){t&&m(e),T&&T.d(),C=!1,o(S)}}}function Me(e){let n,r,c,i,a,s,l,u,g,v,k,w,x,C,S,R,T,D,E=e[2],_=[];for(let t=0;t<E.length;t+=1)_[t]=_e(Ee(e,E,t));let O=e[3],N=[];for(let t=0;t<O.length;t+=1)N[t]=Ne(De(e,O,t));return{c(){n=h("h5"),n.textContent="audio devices",r=$(),c=h("canvas"),i=$(),a=h("nav");for(let t=0;t<_.length;t+=1)_[t].c();s=$(),l=h("audio"),u=h("track"),k=$(),w=h("button"),w.textContent="waveform",x=$(),C=h("button"),C.textContent="volume",S=$(),R=h("table");for(let t=0;t<N.length;t+=1)N[t].c();y(u,"kind","captions"),y(l,"id","upstream"),l.autoplay=g=!1,l.controls=v=Boolean(e[1]),y(a,"class","svelte-2jsuhx"),y(w,"class","svelte-2jsuhx"),y(C,"class","svelte-2jsuhx")},m(t,o){f(t,n,o),f(t,r,o),f(t,c,o),e[11](c),f(t,i,o),f(t,a,o);for(let t=0;t<_.length;t+=1)_[t].m(a,null);d(a,s),d(a,l),d(l,u),e[13](l),f(t,k,o),f(t,w,o),f(t,x,o),f(t,C,o),f(t,S,o),f(t,R,o);for(let t=0;t<N.length;t+=1)N[t].m(R,null);T||(D=[b(w,"click",e[14]),b(C,"click",e[15])],T=!0)},p(t,e){if(132&e[0]){let n;for(E=t[2],n=0;n<E.length;n+=1){const o=Ee(t,E,n);_[n]?_[n].p(o,e):(_[n]=_e(o),_[n].c(),_[n].m(a,s))}for(;n<_.length;n+=1)_[n].d(1);_.length=E.length}if(2&e[0]&&v!==(v=Boolean(t[1]))&&(l.controls=v),1802&e[0]){let n;for(O=t[3],n=0;n<O.length;n+=1){const o=De(t,O,n);N[n]?N[n].p(o,e):(N[n]=Ne(o),N[n].c(),N[n].m(R,null))}for(;n<N.length;n+=1)N[n].d(1);N.length=O.length}},i:t,o:t,d(t){t&&m(n),t&&m(r),t&&m(c),e[11](null),t&&m(i),t&&m(a),p(_,t),e[13](null),t&&m(k),t&&m(w),t&&m(x),t&&m(C),t&&m(S),t&&m(R),p(N,t),T=!1,o(D)}}}function Ae(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,c){function i(t){try{s(o.next(t))}catch(t){c(t)}}function a(t){try{s(o.throw(t))}catch(t){c(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}s((o=o.apply(t,e||[])).next())}))};const r=T();let c,i,a,s,l,u,d,f=[],m=[];function p(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),o=t.frequencyBinCount,r=new Uint8Array(o);let c;function i(){t.getByteTimeDomainData(r),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,e.width,e.height),n.lineWidth=2,n.strokeStyle="rgb(255, 255, 255)",n.beginPath();let a=1*e.width/o,s=0;for(let t=0;t<o;t++){const o=r[t]/128*e.height/2;0===t?n.moveTo(s,o):n.lineTo(s,o),s+=a}n.lineTo(e.width,e.height/2),n.stroke(),c=requestAnimationFrame(i)}return{start(){void 0===c&&i()},stop(){cancelAnimationFrame(c),c=void 0}}}({analyser:l,canvas:a}),u.start()}function h(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),o=t.frequencyBinCount,r=new Uint8Array(o);let c;function i(){t.getByteTimeDomainData(r),n.fillStyle="rgba(0, 0, 0, 0.1)",n.fillRect(0,0,e.width,e.height),n.font="15px sans-serif",n.strokeStyle="rgb(255, 255, 255)";let a=0;n.lineWidth=5;for(let t=0;t<o;t++){const n=r[t]/128*e.height/2;n>a&&(a=n)}let s=2*(a-75),l=e.height-s;n.beginPath(),n.moveTo(0,l),n.lineTo(e.width,l),n.stroke(),n.fillStyle="rgb(100,255,100)",n.fillRect(0,e.height,e.width,-e.height+l),n.fillStyle="rgb(0,0,0)",n.fillText(String(s),e.width-40,e.height-10),c=requestAnimationFrame(i)}return{start(){void 0===c&&i()},stop(){cancelAnimationFrame(c),c=void 0}}}({analyser:l,canvas:a}),u.start()}function g(){return o(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"audioinput"===t)))}))}function $(t){return o(this,void 0,void 0,(function*(){const e=yield function(t){return o(this,void 0,void 0,(function*(){const e={audio:!t||{deviceId:t}};return yield navigator.mediaDevices.getUserMedia(e)}))}(t);e.name=function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t),v(e),n(3,m=[...m,e])}))}function v(t){n(1,i=t),n(0,c.srcObject=t,c),function(t){console.debug("disconnecting",d),null==d||d.disconnect(l),d=void 0;const e=s.createMediaStreamSource(t);e.connect(l),d=e}(t),r("stream",t)}function b(t){t.getTracks().forEach((t=>t.stop())),r("stop",t)}function y(t){b(t),n(3,m=[...m.filter((e=>e!=t))]),i===t&&n(1,i=void 0)}return R((()=>{g();const t=()=>g();return navigator.mediaDevices.addEventListener("devicechange",t),s||(s=new AudioContext,l=s.createAnalyser(),l.fftSize=2048),h(),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),[c,i,f,m,a,p,h,$,v,b,y,function(t){E[t?"unshift":"push"]((()=>{a=t,n(4,a)}))},t=>$(t.deviceId),function(t){E[t?"unshift":"push"]((()=>{c=t,n(0,c)}))},()=>p(),()=>h(),t=>v(t),t=>b(t),t=>y(t)]}const je=class extends K{constructor(t){super(),G(this,t,Ae,Me,c,{},null,[-1,-1])}};function Le(t){let e,n;return e=new Te({}),{c(){W(e.$$.fragment)},m(t,o){V(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Ie(t){let e,n,o,r,c,i,a;return o=new je({}),i=new jt({}),{c(){e=h("section"),n=h("article"),W(o.$$.fragment),r=$(),c=h("article"),W(i.$$.fragment),y(n,"class","box"),y(c,"class","box")},m(t,s){f(t,e,s),d(e,n),V(o,n,null),d(e,r),d(e,c),V(i,c,null),a=!0},i(t){a||(z(o.$$.fragment,t),z(i.$$.fragment,t),a=!0)},o(t){H(o.$$.fragment,t),H(i.$$.fragment,t),a=!1},d(t){t&&m(e),X(o),X(i)}}}function Pe(t){let e,n,o,r;const c=[Ie,Le],i=[];function a(t,e){return t[0].audioVisOnly?0:1}return e=a(t),n=i[e]=c[e](t),{c(){n.c(),o=v()},m(t,n){i[e].m(t,n),f(t,o,n),r=!0},p(t,[r]){let s=e;e=a(t),e!==s&&(q(),H(i[s],1,1,(()=>{i[s]=null})),F(),n=i[e],n||(n=i[e]=c[e](t),n.c()),z(n,1),n.m(o.parentNode,o))},i(t){r||(z(n),r=!0)},o(t){H(n),r=!1},d(t){i[e].d(t),t&&m(o)}}}function Be(t,e,n){let o;return s(t,rt,(t=>n(0,o=t))),[o]}const Ue=new class extends K{constructor(t){super(),G(this,t,Be,Pe,c,{})}}({target:document.body,props:{}});window.app=Ue})();