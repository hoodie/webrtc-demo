(()=>{"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function i(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t){return 0===Object.keys(t).length}function a(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function s(t,e,n){t.$$.on_destroy.push(a(e,n))}new Set;let l,u=!1;function d(t,e){t.appendChild(e)}function f(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function h(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function g(t){return document.createTextNode(t)}function v(){return g(" ")}function $(){return g("")}function b(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function k(t){return""===t?null:+t}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function x(t,e){t.value=null==e?"":e}function C(t,e,n){t.classList[n?"add":"remove"](e)}function S(t){l=t}function E(){if(!l)throw new Error("Function called outside component initialization");return l}function T(t){E().$$.on_mount.push(t)}function R(){const t=E();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const i=function(t,e,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,!1,e),r}(e,n);r.slice().forEach((e=>{e.call(t,i)}))}}}new Set;const L=[],D=[],_=[],O=[],A=Promise.resolve();let M=!1;function N(t){_.push(t)}let j=!1;const I=new Set;function P(){if(!j){j=!0;do{for(let t=0;t<L.length;t+=1){const e=L[t];S(e),F(e.$$)}for(S(null),L.length=0;D.length;)D.pop()();for(let t=0;t<_.length;t+=1){const e=_[t];I.has(e)||(I.add(e),e())}_.length=0}while(L.length);for(;O.length;)O.pop()();M=!1,j=!1,I.clear()}}function F(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(N)}}const B=new Set;let q,U;function J(){q={r:0,c:[],p:q}}function H(){q.r||r(q.c),q=q.p}function z(t,e){t&&t.i&&(B.delete(t),t.i(e))}function W(t,e,n,r){if(t&&t.o){if(B.has(t))return;B.add(t),q.c.push((()=>{B.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function V(t){t&&t.c()}function G(t,n,o,c){const{fragment:a,on_mount:s,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,o),c||N((()=>{const n=s.map(e).filter(i);l?l.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(N)}function X(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function K(e,i,o,c,a,s,d,f=[-1]){const h=l;S(e);const p=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:i.context||[]),callbacks:n(),dirty:f,skip_bound:!1,root:i.target||h.$$.root};d&&d(p.root);let g=!1;if(p.ctx=o?o(e,i.props||{},((t,n,...r)=>{const i=r.length?r[0]:n;return p.ctx&&a(p.ctx[t],p.ctx[t]=i)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](i),g&&function(t,e){-1===t.$$.dirty[0]&&(L.push(t),M||(M=!0,A.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],p.update(),g=!0,r(p.before_update),p.fragment=!!c&&c(p.ctx),i.target){if(i.hydrate){u=!0;const t=(v=i.target,Array.from(v.childNodes));p.fragment&&p.fragment.l(t),t.forEach(m)}else p.fragment&&p.fragment.c();i.intro&&z(e.$$.fragment),G(e,i.target,i.anchor,i.customElement),u=!1,P()}var v;S(h)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(U=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(i);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){r(this.$$.on_disconnect)}$destroy(){X(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!c(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class Q{$destroy(){X(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!c(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Y=[];function Z(e,n=t){let r;const i=new Set;function c(t){if(o(e,t)&&(e=t,r)){const t=!Y.length;for(const t of i)t[1](),Y.push(t,e);if(t){for(let t=0;t<Y.length;t+=2)Y[t][0](Y[t+1]);Y.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(o,a=t){const s=[o,a];return i.add(s),1===i.size&&(r=n(c)||t),o(e),()=>{i.delete(s),0===i.size&&(r(),r=null)}}}}function tt(e,n,o){const c=!Array.isArray(e),s=c?[e]:e,l=n.length<2;return{subscribe:Z(o,(e=>{let o=!1;const u=[];let d=0,f=t;const m=()=>{if(d)return;f();const r=n(c?u[0]:u,e);l?e(r):f=i(r)?r:t},h=s.map(((t,e)=>a(t,(t=>{u[e]=t,d&=~(1<<e),o&&m()}),(()=>{d|=1<<e}))));return o=!0,m(),function(){r(h),f()}})).subscribe}}const et=Z([]),nt=t=>{try{return!0===JSON.parse(t)}catch{return!1}},rt=Z((()=>{const t=Object.fromEntries(new URLSearchParams(location.search).entries()),e={role:t.role||"both",stream:t.stream||"both",autoSignal:nt(t.autoSignal),audioVisOnly:nt(t.audioVisOnly),manual:nt(t.manual),remote:nt(t.remote),hideSignaling:nt(t.hideSignaling),hideEvents:nt(t.hideEvents)};return Object.entries(e).map((([t,e])=>({key:t,value:e})))})()),it=tt(rt,(t=>`${window.location.protocol}//${window.location.host}/?${(t=>{const e=new URLSearchParams;for(let[n,r]of t)e.set(n,r);return e.toString()})(t.map((({key:t,value:e})=>[t,e])))}`)),ot=tt(rt,(t=>{const e=Object.fromEntries(t.map((({key:t,value:e})=>[t,e])));let{role:n,stream:r,manual:i,remote:o,hideSignaling:c,hideEvents:a,autoSignal:s}=e;const l="recv"!==n,u="call"!==n&&"send"!==n||!1,d="down"!==r||!1,f="up"!==r||!1,m=i&&"no"!==i||!1,h=o&&"no"!==o||!1,p=l?"bob":"alice",g=u?"bob":"alice";return{...e,role:n,stream:r,manual:i,remote:o,hasCaller:l,hasReceiver:u,hasUpstream:d,hasDownstream:f,autoSignal:s,isManual:m,isRemote:h,hideSignaling:c,hideEvents:a,to:p,from:g}})),ct=Z({});function at(t,e,n){const r=t.slice();return r[4]=e[n].key,r[5]=e[n].value,r[6]=e,r[7]=n,r}function st(t){let e,n,r;function i(){t[3].call(e,t[6],t[7])}return{c(){e=p("input"),y(e,"type","text")},m(o,c){f(o,e,c),x(e,t[5]),n||(r=b(e,"input",i),n=!0)},p(n,r){t=n,1&r&&e.value!==t[5]&&x(e,t[5])},d(t){t&&m(e),n=!1,r()}}}function lt(t){let e,n,r;function i(){t[2].call(e,t[6],t[7])}return{c(){e=p("input"),y(e,"type","checkbox")},m(o,c){f(o,e,c),e.checked=t[5],n||(r=b(e,"change",i),n=!0)},p(n,r){t=n,1&r&&(e.checked=t[5])},d(t){t&&m(e),n=!1,r()}}}function ut(t){let e,n,r,i,o,c,a=t[4]+"";function s(t,e){return"boolean"==typeof t[5]?lt:st}let l=s(t),u=l(t);return{c(){e=p("tr"),n=p("td"),r=g(a),i=v(),o=p("td"),u.c(),c=v()},m(t,a){f(t,e,a),d(e,n),d(n,r),d(e,i),d(e,o),u.m(o,null),d(e,c)},p(t,e){1&e&&a!==(a=t[4]+"")&&w(r,a),l===(l=s(t))&&u?u.p(t,e):(u.d(1),u=l(t),u&&(u.c(),u.m(o,null)))},d(t){t&&m(e),u.d()}}}function dt(e){let n,r,i,o,c,a,s,l,u,$,b=e[0],k=[];for(let t=0;t<b.length;t+=1)k[t]=ut(at(e,b,t));return{c(){n=p("details"),r=p("summary"),r.textContent="Config",i=v(),o=p("div"),c=p("table");for(let t=0;t<k.length;t+=1)k[t].c();a=v(),s=p("code"),l=p("pre"),u=p("a"),$=g(e[1]),y(r,"class","svelte-7xid5t"),y(u,"href",e[1]),y(n,"class","svelte-7xid5t")},m(t,e){f(t,n,e),d(n,r),d(n,i),d(n,o),d(o,c);for(let t=0;t<k.length;t+=1)k[t].m(c,null);d(o,a),d(o,s),d(s,l),d(l,u),d(u,$)},p(t,[e]){if(1&e){let n;for(b=t[0],n=0;n<b.length;n+=1){const r=at(t,b,n);k[n]?k[n].p(r,e):(k[n]=ut(r),k[n].c(),k[n].m(c,null))}for(;n<k.length;n+=1)k[n].d(1);k.length=b.length}2&e&&w($,t[1]),2&e&&y(u,"href",t[1])},i:t,o:t,d(t){t&&m(n),h(k,t)}}}function ft(t,e,n){let r,i;return s(t,rt,(t=>n(0,r=t))),s(t,it,(t=>n(1,i=t))),[r,i,function(t,e){t[e].value=this.checked,rt.set(r)},function(t,e){t[e].value=this.value,rt.set(r)}]}const mt=class extends Q{constructor(t){super(),K(this,t,ft,dt,o,{})}},ht=Z({}),pt=Z({}),gt=Z({});function vt({from:t,offer:e}){ht.update((n=>({...n,[t]:e})))}function $t({from:t,answer:e}){pt.update((n=>({...n,[t]:e})))}function bt({from:t,candidate:e}){gt.update((n=>{const r=n[t]||[];return{...n,[t]:[...r,e]}}))}function yt({from:t}){gt.update((e=>({...e,[t]:[]})))}const kt=new EventTarget;class wt{to;from;socket;constructor({to:t,from:e}){this.to=t,this.from=e}connect({url:t}){const e=new WebSocket(t);e.onopen=()=>{this.socket=e,this.socket.onmessage=this.received.bind(this)}}received({data:t}){const e=JSON.parse(t),{[this.to]:n,type:r}=e;console.debug("its for me!",n);const i=this.to;switch(r){case"offer":vt({from:i,offer:n});break;case"answer":$t({from:i,answer:n});break;case"candidate":bt({from:i,candidate:new RTCIceCandidate(n)})}}sendOffer(t){if(t){const e={[this.from]:t,type:"offer"};this.send(e)}}sendAnswer(t){if(t){const e={[this.from]:t,type:"answer"};this.send(e)}}sendCandidate(t){if(t){const e={[this.from]:t,type:"candidate"};this.send(e)}}send(t){if(this.socket){const e=JSON.stringify(t);this.socket.send(e)}}toString(){return`[Signaling Server calling ${this.from} → ${this.to}]`}}const xt=t=>"string"==typeof t?JSON.parse(t).sdp:"object"==typeof t?t.sdp:void 0,Ct=t=>({type:"offer",sdp:t}),St=t=>({type:"answer",sdp:t});function Et(e){let n,r,i,o,c,a,s,l,u=JSON.stringify(e[2],null,4)+"";return{c(){n=p("details"),r=p("summary"),i=g(e[1]),o=v(),c=p("pre"),a=p("code"),s=g(u),n.open=l=Boolean(e[2])&&e[0]},m(t,e){f(t,n,e),d(n,r),d(r,i),d(n,o),d(n,c),d(c,a),d(a,s)},p(t,[e]){2&e&&w(i,t[1]),4&e&&u!==(u=JSON.stringify(t[2],null,4)+"")&&w(s,u),5&e&&l!==(l=Boolean(t[2])&&t[0])&&(n.open=l)},i:t,o:t,d(t){t&&m(n)}}}function Tt(t,e,n){let{open:r=!0}=e,{summary:i="???"}=e,{data:o}=e;return t.$$set=t=>{"open"in t&&n(0,r=t.open),"summary"in t&&n(1,i=t.summary),"data"in t&&n(2,o=t.data)},[r,i,o]}const Rt=class extends Q{constructor(t){super(),K(this,t,Tt,Et,o,{open:0,summary:1,data:2})}};function Lt(t,e,n){const r=t.slice();return r[27]=e[n],r}function Dt(t,e,n){const r=t.slice();return r[30]=e[n],r[32]=n,r}function _t(t){let e,n,r,i,o,c=(t[30].label||`camera ${t[32]}`)+"";function a(){return t[18](t[30])}return{c(){e=p("button"),n=g(c),r=v(),y(e,"class","svelte-vk2oy1")},m(t,c){f(t,e,c),d(e,n),d(e,r),i||(o=b(e,"click",a),i=!0)},p(e,r){t=e,4&r[0]&&c!==(c=(t[30].label||`camera ${t[32]}`)+"")&&w(n,c)},d(t){t&&m(e),i=!1,o()}}}function Ot(t){let e;return{c(){e=g("✔️")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function At(t){let e;return{c(){e=g("(canvas)")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Mt(t){let e,n,i,o,c,a,s,l,u,h,$,k,x,C,S,E,T,R=t[27].name+"",L=t[9](t[27]),D=t[0]===t[27]&&Ot();function _(){return t[19](t[27])}function O(){return t[20](t[27])}function A(){return t[21](t[27])}let M=L&&At();return{c(){e=p("tr"),n=p("td"),D&&D.c(),i=v(),o=p("td"),c=p("button"),a=g(R),s=v(),l=p("td"),u=p("button"),u.textContent="stop",h=v(),$=p("td"),k=p("button"),k.textContent="X",x=v(),C=p("td"),M&&M.c(),S=v(),y(c,"class","svelte-vk2oy1"),y(u,"class","svelte-vk2oy1"),y(k,"class","svelte-vk2oy1")},m(t,r){f(t,e,r),d(e,n),D&&D.m(n,null),d(e,i),d(e,o),d(o,c),d(c,a),d(e,s),d(e,l),d(l,u),d(e,h),d(e,$),d($,k),d(e,x),d(e,C),M&&M.m(C,null),d(e,S),E||(T=[b(c,"click",_),b(u,"click",O),b(k,"click",A)],E=!0)},p(e,r){(t=e)[0]===t[27]?D||(D=Ot(),D.c(),D.m(n,null)):D&&(D.d(1),D=null),8&r[0]&&R!==(R=t[27].name+"")&&w(a,R),8&r[0]&&(L=t[9](t[27])),L?M||(M=At(),M.c(),M.m(C,null)):M&&(M.d(1),M=null)},d(t){t&&m(e),D&&D.d(),M&&M.d(),E=!1,r(T)}}}function Nt(t){let e,n,r,i,o,c,a,s,l,u,h,$,b,y,k,x,C,S,E,T=t[8].readyState+"";return x=new Rt({props:{summary:"settings",data:t[8].getSettings()}}),S=new Rt({props:{summary:"constraints",data:t[8].getConstraints()}}),{c(){e=p("details"),n=p("summary"),r=g(t[7]),i=g(" / "),o=g(t[6]),c=g(" / "),a=g(t[5]),s=g("/ "),l=g(t[4]),u=v(),h=p("dl"),$=p("dt"),$.textContent="readState",b=p("dd"),y=g(T),k=v(),V(x.$$.fragment),C=v(),V(S.$$.fragment)},m(t,m){f(t,e,m),d(e,n),d(n,r),d(n,i),d(n,o),d(n,c),d(n,a),d(n,s),d(n,l),d(e,u),d(e,h),d(h,$),d(h,b),d(b,y),d(e,k),G(x,e,null),d(e,C),G(S,e,null),E=!0},p(t,e){(!E||128&e[0])&&w(r,t[7]),(!E||64&e[0])&&w(o,t[6]),(!E||32&e[0])&&w(a,t[5]),(!E||16&e[0])&&w(l,t[4]),(!E||256&e[0])&&T!==(T=t[8].readyState+"")&&w(y,T);const n={};256&e[0]&&(n.data=t[8].getSettings()),x.$set(n);const i={};256&e[0]&&(i.data=t[8].getConstraints()),S.$set(i)},i(t){E||(z(x.$$.fragment,t),z(S.$$.fragment,t),E=!0)},o(t){W(x.$$.fragment,t),W(S.$$.fragment,t),E=!1},d(t){t&&m(e),X(x),X(S)}}}function jt(t){let e,n,i,o,c,a,s,l,u,g,k,w,x,C,S,E,T,R,L=t[2],D=[];for(let e=0;e<L.length;e+=1)D[e]=_t(Dt(t,L,e));let _=t[3],O=[];for(let e=0;e<_.length;e+=1)O[e]=Mt(Lt(t,_,e));let A=t[8]&&Nt(t);return{c(){e=p("h5"),e.textContent="upstream",n=v(),i=p("video"),i.innerHTML='<track kind="captions"/>',o=v(),c=p("nav"),a=p("button"),a.textContent="default",s=v(),l=p("button"),l.textContent="noise",u=v(),g=p("br"),k=v();for(let t=0;t<D.length;t+=1)D[t].c();w=v(),x=p("table");for(let t=0;t<O.length;t+=1)O[t].c();C=v(),A&&A.c(),S=$(),y(i,"id","upstream"),i.autoplay="true",y(i,"class","svelte-vk2oy1"),y(a,"class","svelte-vk2oy1"),y(l,"class","svelte-vk2oy1"),y(c,"class","svelte-vk2oy1")},m(r,m){f(r,e,m),f(r,n,m),f(r,i,m),t[15](i),f(r,o,m),f(r,c,m),d(c,a),d(c,s),d(c,l),d(c,u),d(c,g),d(c,k);for(let t=0;t<D.length;t+=1)D[t].m(c,null);f(r,w,m),f(r,x,m);for(let t=0;t<O.length;t+=1)O[t].m(x,null);f(r,C,m),A&&A.m(r,m),f(r,S,m),E=!0,T||(R=[b(a,"click",t[16]),b(l,"click",t[17])],T=!0)},p(t,e){if(2052&e[0]){let n;for(L=t[2],n=0;n<L.length;n+=1){const r=Dt(t,L,n);D[n]?D[n].p(r,e):(D[n]=_t(r),D[n].c(),D[n].m(c,null))}for(;n<D.length;n+=1)D[n].d(1);D.length=L.length}if(29193&e[0]){let n;for(_=t[3],n=0;n<_.length;n+=1){const r=Lt(t,_,n);O[n]?O[n].p(r,e):(O[n]=Mt(r),O[n].c(),O[n].m(x,null))}for(;n<O.length;n+=1)O[n].d(1);O.length=_.length}t[8]?A?(A.p(t,e),256&e[0]&&z(A,1)):(A=Nt(t),A.c(),z(A,1),A.m(S.parentNode,S)):A&&(J(),W(A,1,1,(()=>{A=null})),H())},i(t){E||(z(A),E=!0)},o(t){W(A),E=!1},d(a){a&&m(e),a&&m(n),a&&m(i),t[15](null),a&&m(o),a&&m(c),h(D,a),a&&m(w),a&&m(x),h(O,a),a&&m(C),A&&A.d(a),a&&m(S),T=!1,r(R)}}}function It(t,e,n){let r,i,o,c,a;var s=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function c(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))};const l=R();let u,d,f=[],m=[];function h(){return s(this,void 0,void 0,(function*(){const t=yield function(){let t=Object.assign(document.createElement("canvas"),{width:400,height:300}),e=t.getContext("2d");e.fillRect(0,0,t.width,t.height);let n=e.getImageData(0,0,t.width,t.height);return requestAnimationFrame((function t(){for(var r=0;r<n.data.length;r++)n.data[r++]=n.data[r++]=n.data[r++]=255*Math.random();e.putImageData(n,0,0),requestAnimationFrame(t)})),t.captureStream(60)}();t.name="noise feed",g(t),n(3,m=[...m,t])}))}function p(t){return s(this,void 0,void 0,(function*(){const e=yield function(t){return s(this,void 0,void 0,(function*(){const e={video:!t||{deviceId:t}};return yield navigator.mediaDevices.getUserMedia(e)}))}(t);e.name=t?function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t):"default webcam",g(e),n(3,m=[...m,e])}))}function g(t){n(0,d=t),n(1,u.srcObject=t,u),l("stream",t)}function v(t){t.getTracks().forEach((t=>t.stop())),l("stop",t)}function $(t){v(t),n(3,m=[...m.filter((e=>e!=t))]),d===t&&n(0,d=void 0)}function b(){return s(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"videoinput"===t)))}))}return T((()=>{b();const t=()=>b();return navigator.mediaDevices.addEventListener("devicechange",t),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),t.$$.update=()=>{1&t.$$.dirty[0]&&n(8,r=d&&d.getTracks()[0]),1&t.$$.dirty[0]&&n(7,i=d&&d.constructor.name),1&t.$$.dirty[0]&&n(6,o=d&&d.getTracks()[0].constructor.name),1&t.$$.dirty[0]&&n(5,c=d&&d.canvas),1&t.$$.dirty[0]&&n(4,a=d&&d.getTracks()[0].canvas)},[d,u,f,m,a,c,o,i,r,t=>"CanvasCaptureMediaStream"===(null==t?void 0:t.constructor.name)||"CanvasCaptureMediaStreamTrack"===(null==t?void 0:t.getTracks()[0].constructor.name),h,p,g,v,$,function(t){D[t?"unshift":"push"]((()=>{u=t,n(1,u)}))},()=>p(),()=>h(),t=>p(t.deviceId),t=>g(t),t=>v(t),t=>$(t)]}const Pt=class extends Q{constructor(t){super(),K(this,t,It,jt,o,{},null,[-1,-1])}};function Ft(t){let e,n,r,i;return e=new Rt({props:{summary:"settings",data:t[1].getSettings()}}),r=new Rt({props:{summary:"constraints",data:t[1].getConstraints()}}),{c(){V(e.$$.fragment),n=v(),V(r.$$.fragment)},m(t,o){G(e,t,o),f(t,n,o),G(r,t,o),i=!0},p(t,n){const i={};2&n&&(i.data=t[1].getSettings()),e.$set(i);const o={};2&n&&(o.data=t[1].getConstraints()),r.$set(o)},i(t){i||(z(e.$$.fragment,t),z(r.$$.fragment,t),i=!0)},o(t){W(e.$$.fragment,t),W(r.$$.fragment,t),i=!1},d(t){X(e,t),t&&m(n),X(r,t)}}}function Bt(t){let e,n,r,i,o,c,a,s=t[1]&&Ft(t);return{c(){e=p("h5"),e.textContent="downstream",n=v(),r=p("video"),r.innerHTML='<track kind="captions"/>',o=v(),s&&s.c(),c=$(),r.autoplay=i=!0},m(i,l){f(i,e,l),f(i,n,l),f(i,r,l),t[3](r),f(i,o,l),s&&s.m(i,l),f(i,c,l),a=!0},p(t,[e]){t[1]?s?(s.p(t,e),2&e&&z(s,1)):(s=Ft(t),s.c(),z(s,1),s.m(c.parentNode,c)):s&&(J(),W(s,1,1,(()=>{s=null})),H())},i(t){a||(z(s),a=!0)},o(t){W(s),a=!1},d(i){i&&m(e),i&&m(n),i&&m(r),t[3](null),i&&m(o),s&&s.d(i),i&&m(c)}}}function qt(t,e,n){let r,i,{stream:o}=e;return t.$$set=t=>{"stream"in t&&n(2,o=t.stream)},t.$$.update=()=>{4&t.$$.dirty&&n(1,r=o&&o.getTracks()[0]),5&t.$$.dirty&&i&&n(0,i.srcObject=o,i)},[i,r,o,function(t){D[t?"unshift":"push"]((()=>{i=t,n(0,i),n(2,o)}))}]}const Ut=class extends Q{constructor(t){super(),K(this,t,qt,Bt,o,{stream:2})}};function Jt(e){let n,i,o,c,a,s,l;return{c(){n=p("form"),i=p("input"),o=v(),c=p("code"),a=g(e[0]),y(i,"size","90"),y(i,"placeholder","ws url")},m(t,r){var u;f(t,n,r),d(n,i),x(i,e[1]),f(t,o,r),f(t,c,r),d(c,a),s||(l=[b(i,"input",e[2]),b(n,"submit",(u=Ht,function(t){return t.preventDefault(),u.call(this,t)}))],s=!0)},p(t,[e]){2&e&&i.value!==t[1]&&x(i,t[1]),1&e&&w(a,t[0])},i:t,o:t,d(t){t&&m(n),t&&m(o),t&&m(c),s=!1,r(l)}}}function Ht(){}function zt(t,e,n){let r,{signalingClient:i}=e;return t.$$set=t=>{"signalingClient"in t&&n(0,i=t.signalingClient)},t.$$.update=()=>{3&t.$$.dirty&&(i.connect({url:r}),window.client=i)},n(1,r=`wss://${window.location.host}/signaling/test`),[i,r,function(){r=this.value,n(1,r)}]}const Wt=class extends Q{constructor(t){super(),K(this,t,zt,Jt,o,{signalingClient:0})}};function Vt(t,e,n){const r=t.slice();return r[6]=e[n][0],r[7]=e[n][1],r}function Gt(t){let e,n,r=t[0],i=[];for(let e=0;e<r.length;e+=1)i[e]=Xt(Vt(t,r,e));const o=t=>W(i[t],1,1,(()=>{i[t]=null}));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=$()},m(t,r){for(let e=0;e<i.length;e+=1)i[e].m(t,r);f(t,e,r),n=!0},p(t,n){if(3&n){let c;for(r=t[0],c=0;c<r.length;c+=1){const o=Vt(t,r,c);i[c]?(i[c].p(o,n),z(i[c],1)):(i[c]=Xt(o),i[c].c(),z(i[c],1),i[c].m(e.parentNode,e))}for(J(),c=r.length;c<i.length;c+=1)o(c);H()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)z(i[t]);n=!0}},o(t){i=i.filter(Boolean);for(let t=0;t<i.length;t+=1)W(i[t]);n=!1},d(t){h(i,t),t&&m(e)}}}function Xt(t){let e,n,o,c,a,s,l,u,h,$,k,x,C,S,E,T,R,L,D,_,O,A,M,N,j,I,P,F,B,q=`transceiver ${t[7].mid}`,U=t[7].mid+"",J=t[7].sender.track+"";function H(){return t[4](t[6])}return _=new Rt({props:{summary:"details",data:t[7],open:!1}}),{c(){e=p("div"),n=p("div"),o=g(q),c=v(),a=p("table"),s=p("tr"),l=p("th"),l.textContent="mid",u=v(),h=p("td"),$=p("code"),k=g(U),x=v(),C=p("tr"),S=p("th"),S.textContent="track",E=v(),T=p("td"),R=p("code"),L=g(J),D=v(),V(_.$$.fragment),O=v(),A=p("div"),M=p("button"),M.textContent="replaceTrack",N=v(),j=p("button"),j.textContent="replaceTrack(null)",I=v(),y(M,"class","btn-small"),y(j,"class","btn-small"),y(e,"class","grid box svelte-1nbk03h")},m(r,m){f(r,e,m),d(e,n),d(n,o),d(n,c),d(n,a),d(a,s),d(s,l),d(s,u),d(s,h),d(h,$),d($,k),d(a,x),d(a,C),d(C,S),d(C,E),d(C,T),d(T,R),d(R,L),d(n,D),G(_,n,null),d(e,O),d(e,A),d(A,M),d(A,N),d(A,j),d(e,I),P=!0,F||(B=[b(M,"click",(function(){i(t[1](t[6].sender))&&t[1](t[6].sender).apply(this,arguments)})),b(j,"click",H)],F=!0)},p(e,n){t=e,(!P||1&n)&&q!==(q=`transceiver ${t[7].mid}`)&&w(o,q),(!P||1&n)&&U!==(U=t[7].mid+"")&&w(k,U),(!P||1&n)&&J!==(J=t[7].sender.track+"")&&w(L,J);const r={};1&n&&(r.data=t[7]),_.$set(r)},i(t){P||(z(_.$$.fragment,t),P=!0)},o(t){W(_.$$.fragment,t),P=!1},d(t){t&&m(e),X(_),F=!1,r(B)}}}function Kt(t){let e,n,r,i,o=t[0]&&Gt(t);return{c(){e=p("h5"),e.textContent="transceivers",n=v(),o&&o.c(),r=$()},m(t,c){f(t,e,c),f(t,n,c),o&&o.m(t,c),f(t,r,c),i=!0},p(t,[e]){t[0]?o?(o.p(t,e),1&e&&z(o,1)):(o=Gt(t),o.c(),z(o,1),o.m(r.parentNode,r)):o&&(J(),W(o,1,1,(()=>{o=null})),H())},i(t){i||(z(o),i=!0)},o(t){W(o),i=!1},d(t){t&&m(e),t&&m(n),o&&o.d(t),t&&m(r)}}}function Qt(t,e,n){let r,i,{peerconnection:o}=e,{streamSource:c}=e;return T((()=>{const t=setInterval((()=>{r&&n(0,i=r.map((t=>{const{mid:e,direction:n,currentDirection:r,stopped:i,sender:o,receiver:c}=t;let a={},s={};{let{dtmf:t,track:e,transport:n}=o;a={dtmf:t,track:e,transport:n,parameters:o.getParameters&&o.getParameters()}}{let{dtmf:t,track:e,transport:n}=c;s={dtmf:t,track:e,transport:n,parameters:c.getParameters&&c.getParameters(),csrcs:c.getContributingSources(),ssrcs:c.getSynchronizationSources()}}return[t,{mid:e,direction:n,currentDirection:r,stopped:i,sender:a,receiver:s}]})))}),1e3);return()=>clearInterval(t)})),t.$$set=t=>{"peerconnection"in t&&n(2,o=t.peerconnection),"streamSource"in t&&n(3,c=t.streamSource)},t.$$.update=()=>{4&t.$$.dirty&&(r=o&&o.getTransceivers())},[i,function(t){return()=>{const e=c().getTracks()[0];e&&t.replaceTrack(e)}},o,c,t=>t.sender.replaceTrack(null)]}const Yt=class extends Q{constructor(t){super(),K(this,t,Qt,Kt,o,{peerconnection:2,streamSource:3})}};function Zt(e){let n,r;return n=new Wt({props:{signalingClient:e[26]}}),{c(){V(n.$$.fragment)},m(t,e){G(n,t,e),r=!0},p:t,i(t){r||(z(n.$$.fragment,t),r=!0)},o(t){W(n.$$.fragment,t),r=!1},d(t){X(n,t)}}}function te(e){let n,r,i;return r=new Pt({}),r.$on("stream",e[40]),r.$on("stop",e[41]),{c(){n=p("article"),V(r.$$.fragment),y(n,"id","upstream"),y(n,"class","box")},m(t,e){f(t,n,e),G(r,n,null),i=!0},p:t,i(t){i||(z(r.$$.fragment,t),i=!0)},o(t){W(r.$$.fragment,t),i=!1},d(t){t&&m(n),X(r)}}}function ee(t){let e,n,r;return n=new Ut({props:{stream:void 0}}),t[42](n),{c(){e=p("article"),V(n.$$.fragment),y(e,"id","downstream"),y(e,"class","box")},m(t,i){f(t,e,i),G(n,e,null),r=!0},p(t,e){n.$set({})},i(t){r||(z(n.$$.fragment,t),r=!0)},o(t){W(n.$$.fragment,t),r=!1},d(r){r&&m(e),t[42](null),X(n)}}}function ne(t){let e;return{c(){e=g("addStream")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function re(t){let e;return{c(){e=g("replaceTrack")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function ie(t){let e,n,r,i,o=t[9].name+"";return{c(){e=p("small"),n=p("code"),r=p("pre"),i=g(o)},m(t,o){f(t,e,o),d(e,n),d(n,r),d(r,i)},p(t,e){512&e[0]&&o!==(o=t[9].name+"")&&w(i,o)},d(t){t&&m(e)}}}function oe(t){let e,n,r,i,o,c,a,s=t[25].join(" ")+"";return{c(){e=p("tr"),n=p("th"),n.textContent="events:",r=v(),i=p("td"),o=p("code"),c=p("small"),a=g(s)},m(t,s){f(t,e,s),d(e,n),d(e,r),d(e,i),d(i,o),d(o,c),d(c,a)},p(t,e){33554432&e[0]&&s!==(s=t[25].join(" ")+"")&&w(a,s)},d(t){t&&m(e)}}}function ce(t){let e,n,r,i,o,c,a,s,l,u,h,y=t[22]&&ae(t),k=t[14]&&se(t),w=t[23]&&!t[5].isManual&&le(t),x=t[5].isManual&&ue(t);return{c(){y&&y.c(),e=v(),n=p("label"),r=g("1.\n                "),i=p("button"),o=g("create offer"),c=v(),k&&k.c(),a=v(),w&&w.c(),s=v(),x&&x.c(),l=$(),i.disabled=t[22]},m(m,p){y&&y.m(m,p),f(m,e,p),f(m,n,p),d(n,r),d(n,i),d(i,o),f(m,c,p),k&&k.m(m,p),f(m,a,p),w&&w.m(m,p),f(m,s,p),x&&x.m(m,p),f(m,l,p),u||(h=b(i,"click",t[29]),u=!0)},p(t,n){t[22]?y?y.p(t,n):(y=ae(t),y.c(),y.m(e.parentNode,e)):y&&(y.d(1),y=null),4194304&n[0]&&(i.disabled=t[22]),t[14]?k?k.p(t,n):(k=se(t),k.c(),k.m(a.parentNode,a)):k&&(k.d(1),k=null),t[23]&&!t[5].isManual?w?w.p(t,n):(w=le(t),w.c(),w.m(s.parentNode,s)):w&&(w.d(1),w=null),t[5].isManual?x?x.p(t,n):(x=ue(t),x.c(),x.m(l.parentNode,l)):x&&(x.d(1),x=null)},d(t){y&&y.d(t),t&&m(e),t&&m(n),t&&m(c),k&&k.d(t),t&&m(a),w&&w.d(t),t&&m(s),x&&x.d(t),t&&m(l),u=!1,h()}}}function ae(e){let n,r,i,o,c;return{c(){n=p("label"),r=g("0.\n                    "),i=p("button"),i.textContent="start call"},m(t,a){f(t,n,a),d(n,r),d(n,i),o||(c=b(i,"click",e[28]),o=!0)},p:t,d(t){t&&m(n),o=!1,c()}}}function se(t){let e,n,i,o,c,a,s,l,u,h,$,k,w,S;return{c(){e=p("div"),n=p("textarea"),i=v(),o=p("br"),c=v(),a=p("label"),s=g("2.\n                        "),l=p("button"),u=g("setLocalDescription"),h=v(),$=p("button"),k=g("send offer"),y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),C(n,"hideSignaling",t[19]),l.disabled=t[22],$.disabled=t[22]},m(r,m){f(r,e,m),d(e,n),x(n,t[14]),d(e,i),d(e,o),d(e,c),d(e,a),d(a,s),d(a,l),d(l,u),d(a,h),d(a,$),d($,k),w||(S=[b(n,"input",t[48]),b(l,"click",t[49]),b($,"click",t[31])],w=!0)},p(t,e){16384&e[0]&&x(n,t[14]),524288&e[0]&&C(n,"hideSignaling",t[19]),4194304&e[0]&&(l.disabled=t[22]),4194304&e[0]&&($.disabled=t[22])},d(t){t&&m(e),w=!1,r(S)}}}function le(t){let e,n,i,o,c,a,s,l,u,h,$;return{c(){e=p("div"),n=p("textarea"),i=v(),o=p("br"),c=v(),a=p("label"),s=g("5.\n                        "),l=p("button"),u=g("setRemoteDescription"),y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),C(n,"hideSignaling",t[19]),l.disabled=t[22]},m(r,m){f(r,e,m),d(e,n),x(n,t[23]),d(e,i),d(e,o),d(e,c),d(e,a),d(a,s),d(a,l),d(l,u),h||($=[b(n,"input",t[50]),b(l,"click",t[51])],h=!0)},p(t,e){8388608&e[0]&&x(n,t[23]),524288&e[0]&&C(n,"hideSignaling",t[19]),4194304&e[0]&&(l.disabled=t[22])},d(t){t&&m(e),h=!1,r($)}}}function ue(t){let e,n,i,o,c,a,s,l,u,h,$,k,w;return{c(){e=p("div"),n=p("strong"),n.textContent="MANUAL ANSWER HERE",i=v(),o=p("textarea"),c=v(),a=p("br"),s=v(),l=p("label"),u=g("5.\n                        "),h=p("button"),$=g("setRemoteDescription"),y(o,"rows","20"),y(o,"class","svelte-3b0r9n"),h.disabled=t[22]},m(r,m){f(r,e,m),d(e,n),d(e,i),d(e,o),x(o,t[17]),d(e,c),d(e,a),d(e,s),d(e,l),d(l,u),d(l,h),d(h,$),k||(w=[b(o,"input",t[52]),b(h,"click",t[53])],k=!0)},p(t,e){131072&e[0]&&x(o,t[17]),4194304&e[0]&&(h.disabled=t[22])},d(t){t&&m(e),k=!1,r(w)}}}function de(t){let e,n,r,i=t[24]&&!t[5].isManual&&fe(t),o=t[5].isManual&&me(t),c=t[15]&&t[24]&&he(t);return{c(){i&&i.c(),e=v(),o&&o.c(),n=v(),c&&c.c(),r=$()},m(t,a){i&&i.m(t,a),f(t,e,a),o&&o.m(t,a),f(t,n,a),c&&c.m(t,a),f(t,r,a)},p(t,a){t[24]&&!t[5].isManual?i?i.p(t,a):(i=fe(t),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null),t[5].isManual?o?o.p(t,a):(o=me(t),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null),t[15]&&t[24]?c?c.p(t,a):(c=he(t),c.c(),c.m(r.parentNode,r)):c&&(c.d(1),c=null)},d(t){i&&i.d(t),t&&m(e),o&&o.d(t),t&&m(n),c&&c.d(t),t&&m(r)}}}function fe(t){let e,n,i,o,c,a,s,l,u,h,$,k,w,S;return{c(){e=p("div"),n=p("textarea"),i=v(),o=p("br"),c=v(),a=p("label"),s=g("3.\n                        "),l=p("button"),u=g("setRemoteDescription"),h=v(),$=p("button"),k=g("create answer"),y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),C(n,"hideSignaling",t[19]),l.disabled=t[22],$.disabled=t[22]},m(r,m){f(r,e,m),d(e,n),x(n,t[24]),d(e,i),d(e,o),d(e,c),d(e,a),d(a,s),d(a,l),d(l,u),d(a,h),d(a,$),d($,k),w||(S=[b(n,"input",t[54]),b(l,"click",t[55]),b($,"click",t[30])],w=!0)},p(t,e){16777216&e[0]&&x(n,t[24]),524288&e[0]&&C(n,"hideSignaling",t[19]),4194304&e[0]&&(l.disabled=t[22]),4194304&e[0]&&($.disabled=t[22])},d(t){t&&m(e),w=!1,r(S)}}}function me(t){let e,n,i,o,c,a,s,l,u,h,$,k,w,C,S,E;return{c(){e=p("div"),n=p("strong"),n.textContent="MANUAL OFFER HERE",i=v(),o=p("textarea"),c=v(),a=p("br"),s=v(),l=p("label"),u=g("3.\n                        "),h=p("button"),$=g("setRemoteDescription"),k=v(),w=p("button"),C=g("create answer"),y(o,"rows","20"),y(o,"class","svelte-3b0r9n"),h.disabled=t[22],w.disabled=t[22]},m(r,m){f(r,e,m),d(e,n),d(e,i),d(e,o),x(o,t[16]),d(e,c),d(e,a),d(e,s),d(e,l),d(l,u),d(l,h),d(h,$),d(l,k),d(l,w),d(w,C),S||(E=[b(o,"input",t[56]),b(h,"click",t[57]),b(w,"click",t[30])],S=!0)},p(t,e){65536&e[0]&&x(o,t[16]),4194304&e[0]&&(h.disabled=t[22]),4194304&e[0]&&(w.disabled=t[22])},d(t){t&&m(e),S=!1,r(E)}}}function he(t){let e,n,i,o,c,a,s,l,u,h,$,k,w,S;return{c(){e=p("div"),n=p("textarea"),i=v(),o=p("br"),c=v(),a=p("label"),s=g("4.\n                        "),l=p("button"),u=g("setLocalDescription"),h=v(),$=p("button"),k=g("send answer"),y(n,"rows","20"),y(n,"class","svelte-3b0r9n"),C(n,"hideSignaling",t[19]),l.disabled=t[22],$.disabled=t[22]},m(r,m){f(r,e,m),d(e,n),x(n,t[15]),d(e,i),d(e,o),d(e,c),d(e,a),d(a,s),d(a,l),d(l,u),d(a,h),d(a,$),d($,k),w||(S=[b(n,"input",t[58]),b(l,"click",t[59]),b($,"click",t[32])],w=!0)},p(t,e){32768&e[0]&&x(n,t[15]),524288&e[0]&&C(n,"hideSignaling",t[19]),4194304&e[0]&&(l.disabled=t[22]),4194304&e[0]&&($.disabled=t[22])},d(t){t&&m(e),w=!1,r(S)}}}function pe(t){let e,n,r;return{c(){e=p("textarea"),y(e,"rows","10"),y(e,"class","svelte-3b0r9n"),C(e,"hideSignaling",t[19])},m(i,o){f(i,e,o),x(e,t[21]),n||(r=b(e,"input",t[60]),n=!0)},p(t,n){2097152&n[0]&&x(e,t[21]),524288&n[0]&&C(e,"hideSignaling",t[19])},d(t){t&&m(e),n=!1,r()}}}function ge(t){let e,n,r,i,o,c,a,s,l=JSON.stringify(t[20],null,4)+"";return{c(){e=p("label"),e.textContent="injected Candidates",n=v(),r=p("textarea"),i=v(),o=p("pre"),c=g(l),y(e,"for","injectedCandidates"),y(r,"name","injectedCandidates"),y(r,"rows","20"),y(r,"class","svelte-3b0r9n")},m(l,u){f(l,e,u),f(l,n,u),f(l,r,u),x(r,t[4]),f(l,i,u),f(l,o,u),d(o,c),a||(s=b(r,"input",t[61]),a=!0)},p(t,e){16&e[0]&&x(r,t[4]),1048576&e[0]&&l!==(l=JSON.stringify(t[20],null,4)+"")&&w(c,l)},d(t){t&&m(e),t&&m(n),t&&m(r),t&&m(i),t&&m(o),a=!1,s()}}}function ve(t){let e,n,i,o,c,a,s,l,u,h,$,k,x,C,S,E,T,R,L,D,_,O,A,M,N,j,I,P,F,B,q,U,K,Q,Y,Z,tt,et,nt,rt,it,ot,ct,at,st,lt,ut,dt,ft,mt,ht,pt,gt,vt,$t,bt,yt,kt,wt,xt,Ct,St,Et,Tt,Rt,Lt,Dt,_t,Ot,At,Mt,Nt,jt,It,Pt=t[5].isRemote&&Zt(t),Ft=t[5].hasUpstream&&te(t),Bt=t[5].hasDownstream&&ee(t);function qt(t,e){return t[8]?re:ne}let Ut=qt(t),Jt=Ut(t),Ht=t[9]&&t[9].name&&ie(t);L=new Yt({props:{peerconnection:t[7],streamSource:t[44]}});let zt=!t[18]&&oe(t),Wt=t[0]&&ce(t),Vt=t[1]&&de(t),Gt=(t[21].length||t[5].isManual)&&pe(t),Xt=t[5].isManual&&ge(t);return{c(){e=p("section"),n=p("h3"),i=g(t[2]),o=v(),c=p("small"),a=g("talking to "),s=g(t[3]),l=v(),Pt&&Pt.c(),u=v(),Ft&&Ft.c(),h=v(),Bt&&Bt.c(),$=v(),k=p("article"),x=p("h5"),x.textContent="peerconnection",C=v(),S=p("button"),Jt.c(),T=v(),Ht&&Ht.c(),R=v(),V(L.$$.fragment),D=v(),_=p("article"),O=p("h5"),O.textContent="signaling",A=v(),M=p("div"),N=p("table"),j=p("tr"),I=p("th"),I.textContent="signaling:",P=v(),F=p("td"),B=p("code"),q=g(t[10]),U=v(),K=p("tr"),Q=p("th"),Q.textContent="connection:",Y=v(),Z=p("td"),tt=p("code"),et=g(t[11]),nt=v(),rt=p("tr"),it=p("th"),it.textContent="iceGathering:",ot=v(),ct=p("td"),at=p("code"),st=g(t[13]),lt=v(),ut=p("tr"),dt=p("th"),dt.textContent="iceConnection:",ft=v(),mt=p("td"),ht=p("code"),pt=g(t[12]),gt=v(),zt&&zt.c(),vt=v(),$t=p("div"),bt=p("span"),yt=p("label"),kt=p("input"),wt=g("\n                    caller"),xt=v(),Ct=p("label"),St=p("input"),Et=g("\n                    receiver"),Tt=v(),Rt=p("label"),Lt=p("input"),Dt=g("\n                    auto"),_t=v(),Wt&&Wt.c(),Ot=v(),Vt&&Vt.c(),At=v(),Gt&&Gt.c(),Mt=v(),Xt&&Xt.c(),S.disabled=E=!Boolean(t[9]),y(k,"class","box"),y(N,"class","vertical"),y(M,"class","box"),y(kt,"type","checkbox"),y(St,"type","checkbox"),y(Lt,"type","checkbox"),y($t,"class","box"),y(_,"class","box")},m(r,m){f(r,e,m),d(e,n),d(n,i),d(n,o),d(n,c),d(c,a),d(c,s),d(e,l),Pt&&Pt.m(e,null),d(e,u),Ft&&Ft.m(e,null),d(e,h),Bt&&Bt.m(e,null),d(e,$),d(e,k),d(k,x),d(k,C),d(k,S),Jt.m(S,null),d(k,T),Ht&&Ht.m(k,null),d(k,R),G(L,k,null),d(e,D),d(e,_),d(_,O),d(_,A),d(_,M),d(M,N),d(N,j),d(j,I),d(j,P),d(j,F),d(F,B),d(B,q),d(N,U),d(N,K),d(K,Q),d(K,Y),d(K,Z),d(Z,tt),d(tt,et),d(N,nt),d(N,rt),d(rt,it),d(rt,ot),d(rt,ct),d(ct,at),d(at,st),d(N,lt),d(N,ut),d(ut,dt),d(ut,ft),d(ut,mt),d(mt,ht),d(ht,pt),d(N,gt),zt&&zt.m(N,null),d(_,vt),d(_,$t),d($t,bt),d(bt,yt),d(yt,kt),kt.checked=t[0],d(yt,wt),d(bt,xt),d(bt,Ct),d(Ct,St),St.checked=t[1],d(Ct,Et),d(bt,Tt),d(bt,Rt),d(Rt,Lt),Lt.checked=t[22],d(Rt,Dt),d(_,_t),Wt&&Wt.m(_,null),d(_,Ot),Vt&&Vt.m(_,null),d(_,At),Gt&&Gt.m(_,null),d(_,Mt),Xt&&Xt.m(_,null),Nt=!0,jt||(It=[b(S,"click",t[43]),b(kt,"change",t[45]),b(St,"change",t[46]),b(Lt,"change",t[47])],jt=!0)},p(t,n){(!Nt||4&n[0])&&w(i,t[2]),(!Nt||8&n[0])&&w(s,t[3]),t[5].isRemote?Pt?(Pt.p(t,n),32&n[0]&&z(Pt,1)):(Pt=Zt(t),Pt.c(),z(Pt,1),Pt.m(e,u)):Pt&&(J(),W(Pt,1,1,(()=>{Pt=null})),H()),t[5].hasUpstream?Ft?(Ft.p(t,n),32&n[0]&&z(Ft,1)):(Ft=te(t),Ft.c(),z(Ft,1),Ft.m(e,h)):Ft&&(J(),W(Ft,1,1,(()=>{Ft=null})),H()),t[5].hasDownstream?Bt?(Bt.p(t,n),32&n[0]&&z(Bt,1)):(Bt=ee(t),Bt.c(),z(Bt,1),Bt.m(e,$)):Bt&&(J(),W(Bt,1,1,(()=>{Bt=null})),H()),Ut!==(Ut=qt(t))&&(Jt.d(1),Jt=Ut(t),Jt&&(Jt.c(),Jt.m(S,null))),(!Nt||512&n[0]&&E!==(E=!Boolean(t[9])))&&(S.disabled=E),t[9]&&t[9].name?Ht?Ht.p(t,n):(Ht=ie(t),Ht.c(),Ht.m(k,R)):Ht&&(Ht.d(1),Ht=null);const r={};128&n[0]&&(r.peerconnection=t[7]),512&n[0]&&(r.streamSource=t[44]),L.$set(r),(!Nt||1024&n[0])&&w(q,t[10]),(!Nt||2048&n[0])&&w(et,t[11]),(!Nt||8192&n[0])&&w(st,t[13]),(!Nt||4096&n[0])&&w(pt,t[12]),t[18]?zt&&(zt.d(1),zt=null):zt?zt.p(t,n):(zt=oe(t),zt.c(),zt.m(N,null)),1&n[0]&&(kt.checked=t[0]),2&n[0]&&(St.checked=t[1]),4194304&n[0]&&(Lt.checked=t[22]),t[0]?Wt?Wt.p(t,n):(Wt=ce(t),Wt.c(),Wt.m(_,Ot)):Wt&&(Wt.d(1),Wt=null),t[1]?Vt?Vt.p(t,n):(Vt=de(t),Vt.c(),Vt.m(_,At)):Vt&&(Vt.d(1),Vt=null),t[21].length||t[5].isManual?Gt?Gt.p(t,n):(Gt=pe(t),Gt.c(),Gt.m(_,Mt)):Gt&&(Gt.d(1),Gt=null),t[5].isManual?Xt?Xt.p(t,n):(Xt=ge(t),Xt.c(),Xt.m(_,null)):Xt&&(Xt.d(1),Xt=null)},i(t){Nt||(z(Pt),z(Ft),z(Bt),z(L.$$.fragment,t),Nt=!0)},o(t){W(Pt),W(Ft),W(Bt),W(L.$$.fragment,t),Nt=!1},d(t){t&&m(e),Pt&&Pt.d(),Ft&&Ft.d(),Bt&&Bt.d(),Jt.d(),Ht&&Ht.d(),X(L),zt&&zt.d(),Wt&&Wt.d(),Vt&&Vt.d(),Gt&&Gt.d(),Xt&&Xt.d(),jt=!1,r(It)}}}function $e(t,e,n){let r,i,o,c,a,l,u,d,f,m,h,p,g;s(t,ot,(t=>n(5,f=t))),s(t,gt,(t=>n(62,m=t))),s(t,pt,(t=>n(37,h=t))),s(t,ht,(t=>n(38,p=t))),s(t,ct,(t=>n(39,g=t)));var v=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function c(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))};let{isCaller:$=!1}=e,{isReceiver:b=!1}=e,{name:y="unnamed participant"}=e,{recipient:k=null}=e;const w=new wt({from:y,to:k}),x=(t=>(e,n)=>function(t,e,n){const r={name:t,short:e,event:n,timestamp:(new Date).toISOString().split("T")[1]};et.update((t=>[...t,r])),ct.update((n=>({...n,[t]:[...n[t]||[],e]})))}(t,e,n))(y);let C,S,E,R,L="",_="",O="",A="",M="";kt.addEventListener(`OfferTo:${y}`,(({detail:t})=>v(void 0,void 0,void 0,(function*(){r&&(V(xt(t)),yield J(),W(St(N)),z())})))),kt.addEventListener(`AnswerTo:${y}`,(({detail:t})=>v(void 0,void 0,void 0,(function*(){r&&X(xt(t))})))),kt.addEventListener(`CandidateTo:${y}`,(({detail:t})=>v(void 0,void 0,void 0,(function*(){r&&(yield function(t){return v(this,void 0,void 0,(function*(){x("ac","addIceCandidate"),yield S.addIceCandidate(t)}))}(t))}))));let N="",j="",I="",P=[],F="",B="plan-b"===new URL(document.location.toString()).searchParams.get("semantic")?{sdpSemantics:"plan-b"}:{sdpSemantics:"unified-plan"};function q(t){E?(x("rt","replace track"),console.info("replace track",{sender:E}),E.replaceTrack(t.getTracks()[0])):(x("at","add track"),console.info("add track"),n(8,E=S.addTrack(t.getTracks()[0],t)))}function U(){return v(this,void 0,void 0,(function*(){x("o","create offer");const t=yield S.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});n(14,M=t.sdp)}))}function J(){return v(this,void 0,void 0,(function*(){x("a","create answer");const t=yield S.createAnswer();n(15,N=t.sdp)}))}function H(){const t=Ct(M);vt({from:y,offer:t}),f.isRemote&&w.sendOffer(t),kt.dispatchEvent(new CustomEvent(`OfferTo:${k}`,{detail:t}))}function z(){const t=Ct(N);$t({from:y,answer:t}),f.isRemote&&w.sendAnswer(t),kt.dispatchEvent(new CustomEvent(`AnswerTo:${k}`,{detail:t}))}function W(t){return v(this,void 0,void 0,(function*(){x("l","setLocalDescription"),console.debug("localDescription ->",t);const e=t;yt({from:y}),S.setLocalDescription(e),G(),yt({from:k})}))}function V(t){x("r","setRemoteDescription");const e=Ct(t);S.setRemoteDescription(e),G(),yt({from:k})}function G(){f.isManual?(l||[]).forEach((t=>{t&&(x("ac","addIceCandidate"),S.addIceCandidate(t))})):(console.debug(m[k]),(m[k]||[]).forEach((t=>{t&&(x("ac","addIceCandidate"),S.addIceCandidate(t))})))}function X(t){x("r","setRemoteDescription");const e=St(t);S.setRemoteDescription(e),yt({from:y})}return T((()=>{n(7,S=function(){const t=new RTCPeerConnection(B);return t.addEventListener("track",(t=>{x("pct","pc ontrack");const{track:e,streams:n,transceiver:r}=t,i=n[0];console.info(`${y}.ontrack`,{track:e,streams:n,kind:e.kind,transceiver:r}),C.$set({stream:i}),e.addEventListener("ended",(()=>{x("track ended","te"),console.info(`${y} track ended`,{event:t})})),e.addEventListener("mute",(()=>{x("track muted","mute"),console.info(`${y} track muted`,{event:t})})),e.addEventListener("unmute",(()=>{x("track unmuted","unmute"),console.info(`${y} track unmuted`,{event:t})})),i.addEventListener("addtrack",(()=>{x("stream track added","add")})),i.addEventListener("removetrack",(()=>{x("stream track removed","rem")}))})),t.addEventListener("icecandidate",(({candidate:t})=>{x("lc","create candidate"),n(36,P=[...P,t]),function(t){y&&t&&(bt({from:y,candidate:t}),f.isRemote&&w.sendCandidate(t),kt.dispatchEvent(new CustomEvent(`CandidateTo:${k}`,{detail:t})))}(t)})),t.addEventListener("signalingstatechange",(()=>n(10,L=t.signalingState))),t.addEventListener("connectionstatechange",(()=>n(11,_=t.connectionState))),t.addEventListener("iceconnectionstatechange",(()=>n(12,O=t.iceConnectionState))),t.addEventListener("icegatheringstatechange",(({target:{iceGatheringState:t}})=>n(13,A=t))),t.addEventListener("negotiationneeded",(()=>x("negotiation needed","nn"))),t.addEventListener("addstream",(t=>{x("addstream","🗑as"),console.warn("addstream",t)})),t.addEventListener("removestream",(t=>{x("removestream","🗑rs"),console.warn("removestream",t)})),console.info(`setup RTCPeerConnection for ${y}`,B,t),t}()),gt.subscribe((({[k]:t})=>{t&&x("rc")})),f.hasCaller&&U()})),t.$$set=t=>{"isCaller"in t&&n(0,$=t.isCaller),"isReceiver"in t&&n(1,b=t.isReceiver),"name"in t&&n(2,y=t.name),"recipient"in t&&n(3,k=t.recipient)},t.$$.update=()=>{32&t.$$.dirty[0]&&n(22,r=f.autoSignal),4&t.$$.dirty[0]|256&t.$$.dirty[1]&&n(25,i=g[y]||[]),8&t.$$.dirty[0]|128&t.$$.dirty[1]&&n(24,o=xt(p[k])),8&t.$$.dirty[0]|64&t.$$.dirty[1]&&n(23,c=xt(h[k])),32&t.$$.dirty[1]&&n(21,a=JSON.stringify(P)),16&t.$$.dirty[0]&&n(20,l=(t=>{try{return JSON.parse(t)}catch(e){return""!==t&&console.warn({parseError:e}),[]}})(F)),32&t.$$.dirty[0]&&n(19,u=f.hideSignaling),32&t.$$.dirty[0]&&n(18,d=f.hideEvents)},[$,b,y,k,F,f,C,S,E,R,L,_,O,A,M,N,j,I,d,u,l,a,r,c,o,i,w,q,function(){return v(this,void 0,void 0,(function*(){yield U(),W(Ct(M)),H()}))},U,J,H,z,W,V,X,P,h,p,g,({detail:t})=>n(9,R=t),()=>n(9,R=void 0),function(t){D[t?"unshift":"push"]((()=>{C=t,n(6,C)}))},()=>q(R),()=>R,function(){$=this.checked,n(0,$)},function(){b=this.checked,n(1,b)},function(){r=this.checked,n(22,r),n(5,f)},function(){M=this.value,n(14,M)},()=>W(Ct(M)),function(){c=this.value,n(23,c),n(37,h),n(3,k)},()=>X(c),function(){I=this.value,n(17,I)},()=>X(I),function(){o=this.value,n(24,o),n(38,p),n(3,k)},()=>V(o),function(){j=this.value,n(16,j)},()=>V(j),function(){N=this.value,n(15,N)},()=>W(St(N)),function(){a=this.value,n(21,a),n(36,P)},function(){F=this.value,n(4,F)}]}const be=class extends Q{constructor(t){super(),K(this,t,$e,ve,o,{isCaller:0,isReceiver:1,name:2,recipient:3},null,[-1,-1,-1])}};function ye(t,e,n){const r=t.slice();return r[6]=e[n].name,r[7]=e[n].event,r[8]=e[n].timestamp,r}function ke(t){let e,n,r,i,o,c,a,s,l,u,h,$,b,k=t[8]+"",x=t[6]+"",C=t[7]+"";return{c(){e=p("tr"),n=p("td"),r=p("code"),i=g(k),o=v(),c=p("th"),a=g(x),s=g(":"),l=v(),u=p("td"),h=p("code"),$=g(C),b=v(),y(r,"class","timestamp svelte-944373")},m(t,m){f(t,e,m),d(e,n),d(n,r),d(r,i),d(e,o),d(e,c),d(c,a),d(c,s),d(e,l),d(e,u),d(u,h),d(h,$),d(e,b)},p(t,e){8&e&&k!==(k=t[8]+"")&&w(i,k),8&e&&x!==(x=t[6]+"")&&w(a,x),8&e&&C!==(C=t[7]+"")&&w($,C)},d(t){t&&m(e)}}}function we(e){let n,i,o,c,a,s,l,u,$,C,S,E,T,R,L,D,_=e[2].length+"",O=e[3],A=[];for(let t=0;t<O.length;t+=1)A[t]=ke(ye(e,O,t));return{c(){n=p("section"),i=p("h3"),i.innerHTML="Event Log <small>please open\n            <code>about://webrtc-internals</code></small>",o=v(),c=p("label"),a=p("input"),s=g("\n        reversed"),l=v(),u=p("label"),$=p("input"),C=g(" of "),S=g(_),E=v(),T=p("div"),R=p("table");for(let t=0;t<A.length;t+=1)A[t].c();y(a,"type","checkbox"),y(a,"name","reverse"),y(a,"id","reverse"),y(c,"for","reverse"),y($,"type","number"),y($,"name","length"),y($,"id","length"),y($,"class","svelte-944373"),y(u,"for","reverse"),y(R,"class","vertical svelte-944373"),y(T,"class","box svelte-944373")},m(t,r){f(t,n,r),d(n,i),d(n,o),d(n,c),d(c,a),a.checked=e[0],d(c,s),d(n,l),d(n,u),d(u,$),x($,e[1]),d(u,C),d(u,S),d(n,E),d(n,T),d(T,R);for(let t=0;t<A.length;t+=1)A[t].m(R,null);L||(D=[b(a,"change",e[4]),b($,"input",e[5])],L=!0)},p(t,[e]){if(1&e&&(a.checked=t[0]),2&e&&k($.value)!==t[1]&&x($,t[1]),4&e&&_!==(_=t[2].length+"")&&w(S,_),8&e){let n;for(O=t[3],n=0;n<O.length;n+=1){const r=ye(t,O,n);A[n]?A[n].p(r,e):(A[n]=ke(r),A[n].c(),A[n].m(R,null))}for(;n<A.length;n+=1)A[n].d(1);A.length=O.length}},i:t,o:t,d(t){t&&m(n),h(A,t),L=!1,r(D)}}}function xe(t,e,n){let r,i;s(t,et,(t=>n(2,i=t)));let o=!0,c=80;return t.$$.update=()=>{7&t.$$.dirty&&n(3,r=o?i.filter((t=>t.event)).reverse().slice(0,c):i.filter((t=>t.event)).slice(0,c))},[o,c,i,r,function(){o=this.checked,n(0,o)},function(){c=k(this.value),n(1,c)}]}const Ce=class extends Q{constructor(t){super(),K(this,t,xe,we,o,{})}};function Se(t){let e,n;return e=new be({props:{name:"alice",isCaller:"true",recipient:"bob"}}),{c(){V(e.$$.fragment)},m(t,r){G(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Ee(t){let e,n;return e=new be({props:{name:"bob",isReceiver:"true",recipient:"alice"}}),{c(){V(e.$$.fragment)},m(t,r){G(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Te(t){let e,n;return e=new Ce({}),{c(){V(e.$$.fragment)},m(t,r){G(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Re(t){let e,n,r,i,o,c,a,s,l,u;o=new mt({});let h=t[0].hasCaller&&Se(),g=t[0].hasReceiver&&Ee(),$=!t[0].hideEvents&&Te();return{c(){e=p("div"),n=p("h1"),n.textContent="WebRTC Plumber",r=v(),i=p("aside"),V(o.$$.fragment),c=v(),a=p("main"),h&&h.c(),s=v(),g&&g.c(),l=v(),$&&$.c(),y(i,"class","svelte-if8jgd"),y(a,"class","svelte-if8jgd"),y(e,"class","svelte-if8jgd")},m(t,m){f(t,e,m),d(e,n),d(e,r),d(e,i),G(o,i,null),d(e,c),d(e,a),h&&h.m(a,null),d(a,s),g&&g.m(a,null),d(a,l),$&&$.m(a,null),u=!0},p(t,[e]){t[0].hasCaller?h?1&e&&z(h,1):(h=Se(),h.c(),z(h,1),h.m(a,s)):h&&(J(),W(h,1,1,(()=>{h=null})),H()),t[0].hasReceiver?g?1&e&&z(g,1):(g=Ee(),g.c(),z(g,1),g.m(a,l)):g&&(J(),W(g,1,1,(()=>{g=null})),H()),t[0].hideEvents?$&&(J(),W($,1,1,(()=>{$=null})),H()):$?1&e&&z($,1):($=Te(),$.c(),z($,1),$.m(a,null))},i(t){u||(z(o.$$.fragment,t),z(h),z(g),z($),u=!0)},o(t){W(o.$$.fragment,t),W(h),W(g),W($),u=!1},d(t){t&&m(e),X(o),h&&h.d(),g&&g.d(),$&&$.d()}}}function Le(t,e,n){let r;return s(t,ot,(t=>n(0,r=t))),[r]}const De=class extends Q{constructor(t){super(),K(this,t,Le,Re,o,{})}};function _e(t,e,n){const r=t.slice();return r[33]=e[n],r}function Oe(t,e,n){const r=t.slice();return r[36]=e[n],r[38]=n,r}function Ae(t){let e,n,r,i,o=(t[36].label||`micorophone ${t[38]}`)+"";function c(){return t[13](t[36])}return{c(){e=p("button"),n=g(o),y(e,"class","svelte-2jsuhx")},m(t,o){f(t,e,o),d(e,n),r||(i=b(e,"click",c),r=!0)},p(e,r){t=e,4&r[0]&&o!==(o=(t[36].label||`micorophone ${t[38]}`)+"")&&w(n,o)},d(t){t&&m(e),r=!1,i()}}}function Me(t){let e;return{c(){e=g("✔️")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Ne(t){let e,n,i,o,c,a,s,l,u,h,$,k,x,C,S,E=t[33].name+"",T=t[1]===t[33]&&Me();function R(){return t[18](t[33])}function L(){return t[19](t[33])}function D(){return t[20](t[33])}return{c(){e=p("tr"),n=p("td"),T&&T.c(),i=v(),o=p("td"),c=p("button"),a=g(E),s=v(),l=p("td"),u=p("button"),u.textContent="stop",h=v(),$=p("td"),k=p("button"),k.textContent="X",x=v(),y(c,"class","svelte-2jsuhx"),y(u,"class","svelte-2jsuhx"),y(k,"class","svelte-2jsuhx")},m(t,r){f(t,e,r),d(e,n),T&&T.m(n,null),d(e,i),d(e,o),d(o,c),d(c,a),d(e,s),d(e,l),d(l,u),d(e,h),d(e,$),d($,k),d(e,x),C||(S=[b(c,"click",R),b(u,"click",L),b(k,"click",D)],C=!0)},p(e,r){(t=e)[1]===t[33]?T||(T=Me(),T.c(),T.m(n,null)):T&&(T.d(1),T=null),8&r[0]&&E!==(E=t[33].name+"")&&w(a,E)},d(t){t&&m(e),T&&T.d(),C=!1,r(S)}}}function je(e){let n,i,o,c,a,s,l,u,g,$,k,w,x,C,S,E,T,R,L,D,_=e[2],O=[];for(let t=0;t<_.length;t+=1)O[t]=Ae(Oe(e,_,t));let A=e[3],M=[];for(let t=0;t<A.length;t+=1)M[t]=Ne(_e(e,A,t));return{c(){n=p("h5"),n.textContent="audio devices",i=v(),o=p("canvas"),c=v(),a=p("nav");for(let t=0;t<O.length;t+=1)O[t].c();s=v(),l=p("audio"),u=p("track"),k=v(),w=p("button"),w.textContent="bars",x=v(),C=p("button"),C.textContent="waveform",S=v(),E=p("button"),E.textContent="volume",T=v(),R=p("table");for(let t=0;t<M.length;t+=1)M[t].c();y(u,"kind","captions"),y(l,"id","upstream"),l.autoplay=g=!1,l.controls=$=Boolean(e[1]),y(a,"class","svelte-2jsuhx"),y(w,"class","svelte-2jsuhx"),y(C,"class","svelte-2jsuhx"),y(E,"class","svelte-2jsuhx")},m(t,r){f(t,n,r),f(t,i,r),f(t,o,r),e[12](o),f(t,c,r),f(t,a,r);for(let t=0;t<O.length;t+=1)O[t].m(a,null);d(a,s),d(a,l),d(l,u),e[14](l),f(t,k,r),f(t,w,r),f(t,x,r),f(t,C,r),f(t,S,r),f(t,E,r),f(t,T,r),f(t,R,r);for(let t=0;t<M.length;t+=1)M[t].m(R,null);L||(D=[b(w,"click",e[15]),b(C,"click",e[16]),b(E,"click",e[17])],L=!0)},p(t,e){if(260&e[0]){let n;for(_=t[2],n=0;n<_.length;n+=1){const r=Oe(t,_,n);O[n]?O[n].p(r,e):(O[n]=Ae(r),O[n].c(),O[n].m(a,s))}for(;n<O.length;n+=1)O[n].d(1);O.length=_.length}if(2&e[0]&&$!==($=Boolean(t[1]))&&(l.controls=$),3594&e[0]){let n;for(A=t[3],n=0;n<A.length;n+=1){const r=_e(t,A,n);M[n]?M[n].p(r,e):(M[n]=Ne(r),M[n].c(),M[n].m(R,null))}for(;n<M.length;n+=1)M[n].d(1);M.length=A.length}},i:t,o:t,d(t){t&&m(n),t&&m(i),t&&m(o),e[12](null),t&&m(c),t&&m(a),h(O,t),e[14](null),t&&m(k),t&&m(w),t&&m(x),t&&m(C),t&&m(S),t&&m(E),t&&m(T),t&&m(R),h(M,t),L=!1,r(D)}}}function Ie(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function c(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))};const i=R();let o,c,a,s,l,u,d,f=[],m=[];function h(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),r=t.frequencyBinCount,i=new Uint8Array(r);let o;function c(){t.getByteTimeDomainData(i),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,e.width,e.height),n.lineWidth=2,n.strokeStyle="rgb(255, 255, 255)",n.beginPath();let a=1*e.width/r,s=0;for(let t=0;t<r;t++){const r=i[t]/128*e.height/2;0===t?n.moveTo(s,r):n.lineTo(s,r),s+=a}n.lineTo(e.width,e.height/2),n.stroke(),o=requestAnimationFrame(c)}return{start(){void 0===o&&c()},stop(){cancelAnimationFrame(o),o=void 0}}}({analyser:l,canvas:a}),u.start()}function p(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),r=t.frequencyBinCount,i=new Float32Array(r);let o;const{width:c,height:a}=e;function s(){t.getFloatFrequencyData(i),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,c,a);for(var e,l=c/r*2.5,u=0,d=0;d<r;d++)e=2*(i[d]+140),n.fillStyle="rgb("+Math.floor(e+100)+",50,50)",n.fillRect(u,a-e/2,l,e/2),u+=l+1;o=requestAnimationFrame(s)}return{start(){void 0===o&&s()},stop(){cancelAnimationFrame(o),o=void 0}}}({analyser:l,canvas:a}),u.start()}function g(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),r=t.frequencyBinCount,i=new Uint8Array(r);let o;function c(){t.getByteTimeDomainData(i),n.fillStyle="rgba(0, 0, 0, 0.1)",n.fillRect(0,0,e.width,e.height),n.font="15px sans-serif",n.strokeStyle="rgb(255, 255, 255)";let a=0;n.lineWidth=5;for(let t=0;t<r;t++){const n=i[t]/128*e.height/2;n>a&&(a=n)}let s=2*(a-75),l=e.height-s;n.beginPath(),n.moveTo(0,l),n.lineTo(e.width,l),n.stroke(),n.fillStyle="rgb(100,255,100)",n.fillRect(0,e.height,e.width,-e.height+l),n.fillStyle="rgb(0,0,0)",n.fillText(String(s),e.width-40,e.height-10),o=requestAnimationFrame(c)}return{start(){void 0===o&&c()},stop(){cancelAnimationFrame(o),o=void 0}}}({analyser:l,canvas:a}),u.start()}function v(){return r(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"audioinput"===t)))}))}function $(t){return r(this,void 0,void 0,(function*(){const e=yield function(t){return r(this,void 0,void 0,(function*(){const e={audio:!t||{deviceId:t}};return yield navigator.mediaDevices.getUserMedia(e)}))}(t);e.name=function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t),b(e),n(3,m=[...m,e])}))}function b(t){n(1,c=t),n(0,o.srcObject=t,o),function(t){console.debug("disconnecting",d),null==d||d.disconnect(l),d=void 0;const e=s.createMediaStreamSource(t);e.connect(l),d=e}(t),i("stream",t)}function y(t){t.getTracks().forEach((t=>t.stop())),i("stop",t)}function k(t){y(t),n(3,m=[...m.filter((e=>e!=t))]),c===t&&n(1,c=void 0)}return T((()=>{v();const t=()=>v();return navigator.mediaDevices.addEventListener("devicechange",t),s||(s=new AudioContext,l=s.createAnalyser(),l.fftSize=2048),g(),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),[o,c,f,m,a,h,p,g,$,b,y,k,function(t){D[t?"unshift":"push"]((()=>{a=t,n(4,a)}))},t=>$(t.deviceId),function(t){D[t?"unshift":"push"]((()=>{o=t,n(0,o)}))},()=>p(),()=>h(),()=>g(),t=>b(t),t=>y(t),t=>k(t)]}const Pe=class extends Q{constructor(t){super(),K(this,t,Ie,je,o,{},null,[-1,-1])}};function Fe(t){let e,n;return e=new De({}),{c(){V(e.$$.fragment)},m(t,r){G(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Be(t){let e,n,r,i,o,c,a;return r=new Pe({}),c=new Pt({}),{c(){e=p("section"),n=p("article"),V(r.$$.fragment),i=v(),o=p("article"),V(c.$$.fragment),y(n,"class","box"),y(o,"class","box")},m(t,s){f(t,e,s),d(e,n),G(r,n,null),d(e,i),d(e,o),G(c,o,null),a=!0},i(t){a||(z(r.$$.fragment,t),z(c.$$.fragment,t),a=!0)},o(t){W(r.$$.fragment,t),W(c.$$.fragment,t),a=!1},d(t){t&&m(e),X(r),X(c)}}}function qe(t){let e,n,r,i;const o=[Be,Fe],c=[];function a(t,e){return t[0].audioVisOnly?0:1}return e=a(t),n=c[e]=o[e](t),{c(){n.c(),r=$()},m(t,n){c[e].m(t,n),f(t,r,n),i=!0},p(t,[i]){let s=e;e=a(t),e!==s&&(J(),W(c[s],1,1,(()=>{c[s]=null})),H(),n=c[e],n||(n=c[e]=o[e](t),n.c()),z(n,1),n.m(r.parentNode,r))},i(t){i||(z(n),i=!0)},o(t){W(n),i=!1},d(t){c[e].d(t),t&&m(r)}}}function Ue(t,e,n){let r;return s(t,ot,(t=>n(0,r=t))),[r]}const Je=new class extends Q{constructor(t){super(),K(this,t,Ue,qe,o,{})}}({target:document.body,props:{}});window.app=Je})();