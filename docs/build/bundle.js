(()=>{"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t){return 0===Object.keys(t).length}function a(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function s(t,e,n){t.$$.on_destroy.push(a(e,n))}new Set;let l,u=!1;function d(t,e,n,o){for(;t<e;){const r=t+(e-t>>1);n(r)<=o?t=r+1:e=r}return t}function f(t,e){u?(function(t){if(t.hydrate_init)return;t.hydrate_init=!0;const e=t.childNodes,n=new Int32Array(e.length+1),o=new Int32Array(e.length);n[0]=-1;let r=0;for(let t=0;t<e.length;t++){const c=d(1,r+1,(t=>e[n[t]].claim_order),e[t].claim_order)-1;o[t]=n[c]+1;const i=c+1;n[i]=t,r=Math.max(i,r)}const c=[],i=[];let a=e.length-1;for(let t=n[r]+1;0!=t;t=o[t-1]){for(c.push(e[t-1]);a>=t;a--)i.push(e[a]);a--}for(;a>=0;a--)i.push(e[a]);c.reverse(),i.sort(((t,e)=>t.claim_order-e.claim_order));for(let e=0,n=0;e<i.length;e++){for(;n<c.length&&i[e].claim_order>=c[n].claim_order;)n++;const o=n<c.length?c[n]:null;t.insertBefore(i[e],o)}}(t),(void 0===t.actual_end_child||null!==t.actual_end_child&&t.actual_end_child.parentElement!==t)&&(t.actual_end_child=t.firstChild),e!==t.actual_end_child?t.insertBefore(e,t.actual_end_child):t.actual_end_child=e.nextSibling):e.parentNode!==t&&t.appendChild(e)}function m(t,e,n){u&&!n?f(t,e):(e.parentNode!==t||n&&e.nextSibling!==n)&&t.insertBefore(e,n||null)}function p(t){t.parentNode.removeChild(t)}function h(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function g(t){return document.createElement(t)}function $(t){return document.createTextNode(t)}function v(){return $(" ")}function b(){return $("")}function y(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function k(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function x(t,e){t.value=null==e?"":e}function C(t,e,n){t.classList[n?"add":"remove"](e)}function S(t){l=t}function _(){if(!l)throw new Error("Function called outside component initialization");return l}function R(t){_().$$.on_mount.push(t)}function D(){const t=_();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);o.slice().forEach((e=>{e.call(t,r)}))}}}new Set;const E=[],j=[],N=[],T=[],O=Promise.resolve();let M=!1;function A(t){N.push(t)}let L=!1;const I=new Set;function P(){if(!L){L=!0;do{for(let t=0;t<E.length;t+=1){const e=E[t];S(e),B(e.$$)}for(S(null),E.length=0;j.length;)j.pop()();for(let t=0;t<N.length;t+=1){const e=N[t];I.has(e)||(I.add(e),e())}N.length=0}while(E.length);for(;T.length;)T.pop()();M=!1,L=!1,I.clear()}}function B(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}const U=new Set;let J,q;function F(){J={r:0,c:[],p:J}}function H(){J.r||o(J.c),J=J.p}function z(t,e){t&&t.i&&(U.delete(t),t.i(e))}function V(t,e,n,o){if(t&&t.o){if(U.has(t))return;U.add(t),J.c.push((()=>{U.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function W(t){t&&t.c()}function X(t,n,c,i){const{fragment:a,on_mount:s,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,c),i||A((()=>{const n=s.map(e).filter(r);l?l.push(...n):o(n),t.$$.on_mount=[]})),u.forEach(A)}function G(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function K(e,r,c,i,a,s,d=[-1]){const f=l;S(e);const m=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:r.context||[]),callbacks:n(),dirty:d,skip_bound:!1};let h=!1;if(m.ctx=c?c(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return m.ctx&&a(m.ctx[t],m.ctx[t]=r)&&(!m.skip_bound&&m.bound[t]&&m.bound[t](r),h&&function(t,e){-1===t.$$.dirty[0]&&(E.push(t),M||(M=!0,O.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],m.update(),h=!0,o(m.before_update),m.fragment=!!i&&i(m.ctx),r.target){if(r.hydrate){u=!0;const t=(g=r.target,Array.from(g.childNodes));m.fragment&&m.fragment.l(t),t.forEach(p)}else m.fragment&&m.fragment.c();r.intro&&z(e.$$.fragment),X(e,r.target,r.anchor,r.customElement),u=!1,P()}var g;S(f)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(q=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(r);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){o(this.$$.on_disconnect)}$destroy(){G(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!i(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class Q{$destroy(){G(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!i(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Y=[];function Z(e,n=t){let o;const r=[];function i(t){if(c(e,t)&&(e=t,o)){const t=!Y.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),Y.push(n,e)}if(t){for(let t=0;t<Y.length;t+=2)Y[t][0](Y[t+1]);Y.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(c,a=t){const s=[c,a];return r.push(s),1===r.length&&(o=n(i)||t),c(e),()=>{const t=r.indexOf(s);-1!==t&&r.splice(t,1),0===r.length&&(o(),o=null)}}}}function tt(e,n,c){const i=!Array.isArray(e),s=i?[e]:e,l=n.length<2;return{subscribe:Z(c,(e=>{let c=!1;const u=[];let d=0,f=t;const m=()=>{if(d)return;f();const o=n(i?u[0]:u,e);l?e(o):f=r(o)?o:t},p=s.map(((t,e)=>a(t,(t=>{u[e]=t,d&=~(1<<e),c&&m()}),(()=>{d|=1<<e}))));return c=!0,m(),function(){o(p),f()}})).subscribe}}const et=Z([]),nt=t=>{try{return!0===JSON.parse(t)}catch{return!1}},ot=Z((()=>{const t=Object.fromEntries(new URLSearchParams(location.search).entries()),e={role:t.role||"both",stream:t.stream||"both",audioVisOnly:nt(t.audioVisOnly),manual:nt(t.manual),remote:nt(t.remote),hideSignaling:nt(t.hideSignaling)};return Object.entries(e).map((([t,e])=>({key:t,value:e})))})()),rt=tt(ot,(t=>`${window.location.protocol}//${window.location.host}/?${(t=>{const e=new URLSearchParams;for(let[n,o]of t)e.set(n,o);return e.toString()})(t.map((({key:t,value:e})=>[t,e])))}`)),ct=tt(ot,(t=>{const e=Object.fromEntries(t.map((({key:t,value:e})=>[t,e])));let{role:n,stream:o,manual:r,remote:c,hideSignaling:i}=e;const a="recv"!==n,s="call"!==n&&"send"!==n||!1,l="down"!==o||!1,u="up"!==o||!1,d=r&&"no"!==r||!1,f=c&&"no"!==c||!1,m=a?"bob":"alice",p=s?"bob":"alice";return{...e,role:n,stream:o,manual:r,remote:c,hasCaller:a,hasReceiver:s,hasUpstream:l,hasDownstream:u,isManual:d,isRemote:f,hideSignaling:i,to:m,from:p}})),it=Z({});function at(t,e,n){const o=t.slice();return o[4]=e[n].key,o[5]=e[n].value,o[6]=e,o[7]=n,o}function st(t){let e,n,o;function r(){t[3].call(e,t[6],t[7])}return{c(){e=g("input"),k(e,"type","text")},m(c,i){m(c,e,i),x(e,t[5]),n||(o=y(e,"input",r),n=!0)},p(n,o){t=n,2&o&&e.value!==t[5]&&x(e,t[5])},d(t){t&&p(e),n=!1,o()}}}function lt(t){let e,n,o;function r(){t[2].call(e,t[6],t[7])}return{c(){e=g("input"),k(e,"type","checkbox")},m(c,i){m(c,e,i),e.checked=t[5],n||(o=y(e,"change",r),n=!0)},p(n,o){t=n,2&o&&(e.checked=t[5])},d(t){t&&p(e),n=!1,o()}}}function ut(t){let e,n,o,r,c,i,a=t[4]+"";function s(t,e){return"boolean"==typeof t[5]?lt:st}let l=s(t),u=l(t);return{c(){e=g("tr"),n=g("td"),o=$(a),r=v(),c=g("td"),u.c(),i=v()},m(t,a){m(t,e,a),f(e,n),f(n,o),f(e,r),f(e,c),u.m(c,null),f(e,i)},p(t,e){2&e&&a!==(a=t[4]+"")&&w(o,a),l===(l=s(t))&&u?u.p(t,e):(u.d(1),u=l(t),u&&(u.c(),u.m(c,null)))},d(t){t&&p(e),u.d()}}}function dt(e){let n,o,r,c,i,a,s,l,u,d=e[1],b=[];for(let t=0;t<d.length;t+=1)b[t]=ut(at(e,d,t));return{c(){n=g("details"),o=g("summary"),o.textContent="config",r=v(),c=g("code"),i=g("pre"),a=g("a"),s=$(e[0]),l=v(),u=g("table");for(let t=0;t<b.length;t+=1)b[t].c();k(a,"href",e[0])},m(t,e){m(t,n,e),f(n,o),f(n,r),f(n,c),f(c,i),f(i,a),f(a,s),f(n,l),f(n,u);for(let t=0;t<b.length;t+=1)b[t].m(u,null)},p(t,[e]){if(1&e&&w(s,t[0]),1&e&&k(a,"href",t[0]),2&e){let n;for(d=t[1],n=0;n<d.length;n+=1){const o=at(t,d,n);b[n]?b[n].p(o,e):(b[n]=ut(o),b[n].c(),b[n].m(u,null))}for(;n<b.length;n+=1)b[n].d(1);b.length=d.length}},i:t,o:t,d(t){t&&p(n),h(b,t)}}}function ft(t,e,n){let o,r;return s(t,rt,(t=>n(0,o=t))),s(t,ot,(t=>n(1,r=t))),[o,r,function(t,e){t[e].value=this.checked,ot.set(r)},function(t,e){t[e].value=this.value,ot.set(r)}]}const mt=class extends Q{constructor(t){super(),K(this,t,ft,dt,c,{})}},pt=Z({}),ht=Z({}),gt=Z({});function $t({from:t,offer:e}){pt.update((n=>({...n,[t]:e})))}function vt({from:t,answer:e}){ht.update((n=>({...n,[t]:e})))}function bt({from:t,candidate:e}){gt.update((n=>{const o=n[t]||[];return{...n,[t]:[...o,e]}}))}function yt({from:t}){gt.update((e=>({...e,[t]:[]})))}class kt{to;from;socket;constructor({to:t,from:e}){this.to=t,this.from=e}connect({url:t}){const e=new WebSocket(t);e.onopen=()=>{this.socket=e,this.socket.onmessage=this.received.bind(this)}}received({data:t}){const e=JSON.parse(t),{[this.to]:n,type:o}=e;console.debug("its for me!",n);const r=this.to;switch(o){case"offer":$t({from:r,offer:n});break;case"answer":vt({from:r,answer:n});break;case"candidate":bt({from:r,candidate:new RTCIceCandidate(n)})}}sendOffer(t){if(t){const e={[this.from]:t,type:"offer"};this.send(e)}}sendAnswer(t){if(t){const e={[this.from]:t,type:"answer"};this.send(e)}}sendCandidate(t){if(t){const e={[this.from]:t,type:"candidate"};this.send(e)}}send(t){if(this.socket){const e=JSON.stringify(t);this.socket.send(e)}}toString(){return`[Signaling Server calling ${this.from} → ${this.to}]`}}const wt=t=>"string"==typeof t?JSON.parse(t).sdp:"object"==typeof t?t.sdp:void 0,xt=t=>({type:"offer",sdp:t}),Ct=t=>({type:"answer",sdp:t});function St(e){let n,o,r,c,i,a,s,l,u=JSON.stringify(e[2],null,4)+"";return{c(){n=g("details"),o=g("summary"),r=$(e[1]),c=v(),i=g("pre"),a=g("code"),s=$(u),n.open=l=Boolean(e[2])&&e[0]},m(t,e){m(t,n,e),f(n,o),f(o,r),f(n,c),f(n,i),f(i,a),f(a,s)},p(t,[e]){2&e&&w(r,t[1]),4&e&&u!==(u=JSON.stringify(t[2],null,4)+"")&&w(s,u),5&e&&l!==(l=Boolean(t[2])&&t[0])&&(n.open=l)},i:t,o:t,d(t){t&&p(n)}}}function _t(t,e,n){let{open:o=!0}=e,{summary:r="???"}=e,{data:c}=e;return t.$$set=t=>{"open"in t&&n(0,o=t.open),"summary"in t&&n(1,r=t.summary),"data"in t&&n(2,c=t.data)},[o,r,c]}const Rt=class extends Q{constructor(t){super(),K(this,t,_t,St,c,{open:0,summary:1,data:2})}};function Dt(t,e,n){const o=t.slice();return o[21]=e[n],o}function Et(t,e,n){const o=t.slice();return o[24]=e[n],o[26]=n,o}function jt(t){let e,n,o,r,c,i=(t[24].label||`camera ${t[26]}`)+"";function a(){return t[14](t[24])}return{c(){e=g("button"),n=$(i),o=v(),k(e,"class","svelte-2jsuhx")},m(t,i){m(t,e,i),f(e,n),f(e,o),r||(c=y(e,"click",a),r=!0)},p(e,o){t=e,4&o&&i!==(i=(t[24].label||`camera ${t[26]}`)+"")&&w(n,i)},d(t){t&&p(e),r=!1,c()}}}function Nt(t){let e;return{c(){e=$("✔️")},m(t,n){m(t,e,n)},d(t){t&&p(e)}}}function Tt(t){let e,n,r,c,i,a,s,l,u,d,h,b,x,C,S,_=t[21].name+"",R=t[0]===t[21]&&Nt();function D(){return t[15](t[21])}function E(){return t[16](t[21])}function j(){return t[17](t[21])}return{c(){e=g("tr"),n=g("td"),R&&R.c(),r=v(),c=g("td"),i=g("button"),a=$(_),s=v(),l=g("td"),u=g("button"),u.textContent="stop",d=v(),h=g("td"),b=g("button"),b.textContent="X",x=v(),k(i,"class","svelte-2jsuhx"),k(u,"class","svelte-2jsuhx"),k(b,"class","svelte-2jsuhx")},m(t,o){m(t,e,o),f(e,n),R&&R.m(n,null),f(e,r),f(e,c),f(c,i),f(i,a),f(e,s),f(e,l),f(l,u),f(e,d),f(e,h),f(h,b),f(e,x),C||(S=[y(i,"click",D),y(u,"click",E),y(b,"click",j)],C=!0)},p(e,o){(t=e)[0]===t[21]?R||(R=Nt(),R.c(),R.m(n,null)):R&&(R.d(1),R=null),8&o&&_!==(_=t[21].name+"")&&w(a,_)},d(t){t&&p(e),R&&R.d(),C=!1,o(S)}}}function Ot(t){let e,n,o,r,c,i,a,s,l,u,d,h,b,y=t[4].readyState+"";return u=new Rt({props:{summary:"settings",data:t[4].getSettings()}}),h=new Rt({props:{summary:"constraints",data:t[4].getConstraints()}}),{c(){e=g("details"),n=g("summary"),o=$(t[5]),r=v(),c=g("dl"),i=g("dt"),i.textContent="readState",a=g("dd"),s=$(y),l=v(),W(u.$$.fragment),d=v(),W(h.$$.fragment)},m(t,p){m(t,e,p),f(e,n),f(n,o),f(e,r),f(e,c),f(c,i),f(c,a),f(a,s),f(e,l),X(u,e,null),f(e,d),X(h,e,null),b=!0},p(t,e){(!b||32&e)&&w(o,t[5]),(!b||16&e)&&y!==(y=t[4].readyState+"")&&w(s,y);const n={};16&e&&(n.data=t[4].getSettings()),u.$set(n);const r={};16&e&&(r.data=t[4].getConstraints()),h.$set(r)},i(t){b||(z(u.$$.fragment,t),z(h.$$.fragment,t),b=!0)},o(t){V(u.$$.fragment,t),V(h.$$.fragment,t),b=!1},d(t){t&&p(e),G(u),G(h)}}}function Mt(t){let e,n,r,c,i,a,s,l,u,d,$,w,x,C,S,_,R,D,E=t[2],j=[];for(let e=0;e<E.length;e+=1)j[e]=jt(Et(t,E,e));let N=t[3],T=[];for(let e=0;e<N.length;e+=1)T[e]=Tt(Dt(t,N,e));let O=t[4]&&Ot(t);return{c(){e=g("h5"),e.textContent="upstream",n=v(),r=g("video"),r.innerHTML='<track kind="captions"/>',c=v(),i=g("nav"),a=g("button"),a.textContent="default",s=v(),l=g("button"),l.textContent="noise",u=v(),d=g("br"),$=v();for(let t=0;t<j.length;t+=1)j[t].c();w=v(),x=g("table");for(let t=0;t<T.length;t+=1)T[t].c();C=v(),O&&O.c(),S=b(),k(r,"id","upstream"),r.autoplay="true",k(a,"class","svelte-2jsuhx"),k(l,"class","svelte-2jsuhx"),k(i,"class","svelte-2jsuhx")},m(o,p){m(o,e,p),m(o,n,p),m(o,r,p),t[11](r),m(o,c,p),m(o,i,p),f(i,a),f(i,s),f(i,l),f(i,u),f(i,d),f(i,$);for(let t=0;t<j.length;t+=1)j[t].m(i,null);m(o,w,p),m(o,x,p);for(let t=0;t<T.length;t+=1)T[t].m(x,null);m(o,C,p),O&&O.m(o,p),m(o,S,p),_=!0,R||(D=[y(a,"click",t[12]),y(l,"click",t[13])],R=!0)},p(t,[e]){if(132&e){let n;for(E=t[2],n=0;n<E.length;n+=1){const o=Et(t,E,n);j[n]?j[n].p(o,e):(j[n]=jt(o),j[n].c(),j[n].m(i,null))}for(;n<j.length;n+=1)j[n].d(1);j.length=E.length}if(1801&e){let n;for(N=t[3],n=0;n<N.length;n+=1){const o=Dt(t,N,n);T[n]?T[n].p(o,e):(T[n]=Tt(o),T[n].c(),T[n].m(x,null))}for(;n<T.length;n+=1)T[n].d(1);T.length=N.length}t[4]?O?(O.p(t,e),16&e&&z(O,1)):(O=Ot(t),O.c(),z(O,1),O.m(S.parentNode,S)):O&&(F(),V(O,1,1,(()=>{O=null})),H())},i(t){_||(z(O),_=!0)},o(t){V(O),_=!1},d(a){a&&p(e),a&&p(n),a&&p(r),t[11](null),a&&p(c),a&&p(i),h(j,a),a&&p(w),a&&p(x),h(T,a),a&&p(C),O&&O.d(a),a&&p(S),R=!1,o(D)}}}function At(t,e,n){let o,r;const c=D();let i,a,s=[],l=[];async function u(){const t=await function(){let t=Object.assign(document.createElement("canvas"),{width:400,height:300}),e=t.getContext("2d");e.fillRect(0,0,t.width,t.height);let n=e.getImageData(0,0,t.width,t.height);return requestAnimationFrame((function t(){for(var o=0;o<n.data.length;o++)n.data[o++]=n.data[o++]=n.data[o++]=255*Math.random();e.putImageData(n,0,0),requestAnimationFrame(t)})),t.captureStream(60)}();t.name="noise feed",f(t),n(3,l=[...l,t])}async function d(t){const e=await async function(t){const e={video:!t||{deviceId:t}};return await navigator.mediaDevices.getUserMedia(e)}(t);e.name=t?function(t){const e=t&&s.find((({deviceId:e})=>e===t));return e&&e.label}(t):"default webcam",f(e),n(3,l=[...l,e])}function f(t){n(0,a=t),n(1,i.srcObject=t,i),c("stream",t)}function m(t){t.getTracks().forEach((t=>t.stop())),c("stop",t)}function p(t){m(t),n(3,l=[...l.filter((e=>e!=t))]),a===t&&n(0,a=void 0)}async function h(){const t=await navigator.mediaDevices.enumerateDevices();n(2,s=t.filter((({kind:t})=>"videoinput"===t)))}return R((()=>{h();const t=()=>h();return navigator.mediaDevices.addEventListener("devicechange",t),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),t.$$.update=()=>{1&t.$$.dirty&&n(4,o=a&&a.getTracks()[0]),1&t.$$.dirty&&n(5,r=a&&a.constructor.name)},[a,i,s,l,o,r,u,d,f,m,p,function(t){j[t?"unshift":"push"]((()=>{i=t,n(1,i)}))},()=>d(),()=>u(),t=>d(t.deviceId),t=>f(t),t=>m(t),t=>p(t)]}const Lt=class extends Q{constructor(t){super(),K(this,t,At,Mt,c,{})}};function It(t){let e,n,o,r;return e=new Rt({props:{summary:"settings",data:t[1].getSettings()}}),o=new Rt({props:{summary:"constraints",data:t[1].getConstraints()}}),{c(){W(e.$$.fragment),n=v(),W(o.$$.fragment)},m(t,c){X(e,t,c),m(t,n,c),X(o,t,c),r=!0},p(t,n){const r={};2&n&&(r.data=t[1].getSettings()),e.$set(r);const c={};2&n&&(c.data=t[1].getConstraints()),o.$set(c)},i(t){r||(z(e.$$.fragment,t),z(o.$$.fragment,t),r=!0)},o(t){V(e.$$.fragment,t),V(o.$$.fragment,t),r=!1},d(t){G(e,t),t&&p(n),G(o,t)}}}function Pt(t){let e,n,o,r,c,i,a,s=t[1]&&It(t);return{c(){e=g("h5"),e.textContent="downstream",n=v(),o=g("video"),o.innerHTML='<track kind="captions"/>',c=v(),s&&s.c(),i=b(),o.autoplay=r=!0},m(r,l){m(r,e,l),m(r,n,l),m(r,o,l),t[3](o),m(r,c,l),s&&s.m(r,l),m(r,i,l),a=!0},p(t,[e]){t[1]?s?(s.p(t,e),2&e&&z(s,1)):(s=It(t),s.c(),z(s,1),s.m(i.parentNode,i)):s&&(F(),V(s,1,1,(()=>{s=null})),H())},i(t){a||(z(s),a=!0)},o(t){V(s),a=!1},d(r){r&&p(e),r&&p(n),r&&p(o),t[3](null),r&&p(c),s&&s.d(r),r&&p(i)}}}function Bt(t,e,n){let o,r,{stream:c}=e;return t.$$set=t=>{"stream"in t&&n(2,c=t.stream)},t.$$.update=()=>{4&t.$$.dirty&&n(1,o=c&&c.getTracks()[0]),5&t.$$.dirty&&r&&n(0,r.srcObject=c,r)},[r,o,c,function(t){j[t?"unshift":"push"]((()=>{r=t,n(0,r),n(2,c)}))}]}const Ut=class extends Q{constructor(t){super(),K(this,t,Bt,Pt,c,{stream:2})}};function Jt(e){let n,r,c,i,a,s,l;return{c(){n=g("form"),r=g("input"),c=v(),i=g("code"),a=$(e[0]),k(r,"size","90"),k(r,"placeholder","ws url")},m(t,o){var u;m(t,n,o),f(n,r),x(r,e[1]),m(t,c,o),m(t,i,o),f(i,a),s||(l=[y(r,"input",e[2]),y(n,"submit",(u=qt,function(t){return t.preventDefault(),u.call(this,t)}))],s=!0)},p(t,[e]){2&e&&r.value!==t[1]&&x(r,t[1]),1&e&&w(a,t[0])},i:t,o:t,d(t){t&&p(n),t&&p(c),t&&p(i),s=!1,o(l)}}}function qt(){}function Ft(t,e,n){let o,{signalingClient:r}=e;return t.$$set=t=>{"signalingClient"in t&&n(0,r=t.signalingClient)},t.$$.update=()=>{3&t.$$.dirty&&(r.connect({url:o}),window.client=r)},n(1,o=`wss://${window.location.host}/signaling/test`),[r,o,function(){o=this.value,n(1,o)}]}const Ht=class extends Q{constructor(t){super(),K(this,t,Ft,Jt,c,{signalingClient:0})}};function zt(t,e,n){const o=t.slice();return o[3]=e[n],o}function Vt(t){let e,n,o=t[0],r=[];for(let e=0;e<o.length;e+=1)r[e]=Wt(zt(t,o,e));const c=t=>V(r[t],1,1,(()=>{r[t]=null}));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=b()},m(t,o){for(let e=0;e<r.length;e+=1)r[e].m(t,o);m(t,e,o),n=!0},p(t,n){if(1&n){let i;for(o=t[0],i=0;i<o.length;i+=1){const c=zt(t,o,i);r[i]?(r[i].p(c,n),z(r[i],1)):(r[i]=Wt(c),r[i].c(),z(r[i],1),r[i].m(e.parentNode,e))}for(F(),i=o.length;i<r.length;i+=1)c(i);H()}},i(t){if(!n){for(let t=0;t<o.length;t+=1)z(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)V(r[t]);n=!1},d(t){h(r,t),t&&p(e)}}}function Wt(t){let e,n,o,r,c,i,a,s,l,u,d,h,b=`transceiver ${t[3].mid}`,y=t[3].mid+"";return d=new Rt({props:{summary:"details",data:t[3],open:!1}}),{c(){e=$(b),n=v(),o=g("table"),r=g("tr"),c=g("th"),c.textContent="mid",i=v(),a=g("td"),s=g("code"),l=$(y),u=v(),W(d.$$.fragment)},m(t,p){m(t,e,p),m(t,n,p),m(t,o,p),f(o,r),f(r,c),f(r,i),f(r,a),f(a,s),f(s,l),m(t,u,p),X(d,t,p),h=!0},p(t,n){(!h||1&n)&&b!==(b=`transceiver ${t[3].mid}`)&&w(e,b),(!h||1&n)&&y!==(y=t[3].mid+"")&&w(l,y);const o={};1&n&&(o.data=t[3]),d.$set(o)},i(t){h||(z(d.$$.fragment,t),h=!0)},o(t){V(d.$$.fragment,t),h=!1},d(t){t&&p(e),t&&p(n),t&&p(o),t&&p(u),G(d,t)}}}function Xt(t){let e,n,o,r,c=t[0]&&Vt(t);return{c(){e=g("h5"),e.textContent="transceivers",n=v(),c&&c.c(),o=b()},m(t,i){m(t,e,i),m(t,n,i),c&&c.m(t,i),m(t,o,i),r=!0},p(t,[e]){t[0]?c?(c.p(t,e),1&e&&z(c,1)):(c=Vt(t),c.c(),z(c,1),c.m(o.parentNode,o)):c&&(F(),V(c,1,1,(()=>{c=null})),H())},i(t){r||(z(c),r=!0)},o(t){V(c),r=!1},d(t){t&&p(e),t&&p(n),c&&c.d(t),t&&p(o)}}}function Gt(t,e,n){let o,r,{peerconnection:c}=e;return R((()=>{const t=setInterval((()=>{o&&n(0,r=o.map((({mid:t,direction:e,currentDirection:n,stopped:o,sender:r,receiver:c})=>{let i={},a={};{let{dtmf:t,track:e,transport:n}=r;i={dtmf:t,track:e,transport:n,parameters:r.getParameters&&r.getParameters()}}{let{dtmf:t,track:e,transport:n}=c;a={dtmf:t,track:e,transport:n,parameters:c.getParameters&&c.getParameters(),csrcs:c.getContributingSources(),ssrcs:c.getSynchronizationSources()}}return{mid:t,direction:e,currentDirection:n,stopped:o,sender:i,receiver:a}})))}),1e3);return()=>clearInterval(t)})),t.$$set=t=>{"peerconnection"in t&&n(1,c=t.peerconnection)},t.$$.update=()=>{2&t.$$.dirty&&(o=c&&c.getTransceivers())},[r,c]}const Kt=class extends Q{constructor(t){super(),K(this,t,Gt,Xt,c,{peerconnection:1})}};function Qt(e){let n,o;return n=new Ht({props:{signalingClient:e[23]}}),{c(){W(n.$$.fragment)},m(t,e){X(n,t,e),o=!0},p:t,i(t){o||(z(n.$$.fragment,t),o=!0)},o(t){V(n.$$.fragment,t),o=!1},d(t){G(n,t)}}}function Yt(e){let n,o,r;return o=new Lt({}),o.$on("stream",e[36]),o.$on("stop",e[37]),{c(){n=g("article"),W(o.$$.fragment),k(n,"id","upstream"),k(n,"class","box")},m(t,e){m(t,n,e),X(o,n,null),r=!0},p:t,i(t){r||(z(o.$$.fragment,t),r=!0)},o(t){V(o.$$.fragment,t),r=!1},d(t){t&&p(n),G(o)}}}function Zt(t){let e,n,o;return n=new Ut({props:{stream:void 0}}),t[38](n),{c(){e=g("article"),W(n.$$.fragment),k(e,"id","downstream"),k(e,"class","box")},m(t,r){m(t,e,r),X(n,e,null),o=!0},p(t,e){n.$set({})},i(t){o||(z(n.$$.fragment,t),o=!0)},o(t){V(n.$$.fragment,t),o=!1},d(o){o&&p(e),t[38](null),G(n)}}}function te(t){let e;return{c(){e=$("addStream")},m(t,n){m(t,e,n)},d(t){t&&p(e)}}}function ee(t){let e;return{c(){e=$("replaceTrack")},m(t,n){m(t,e,n)},d(t){t&&p(e)}}}function ne(t){let e,n,o,r,c,i,a,s=t[17].join(" ")+"";return{c(){e=g("tr"),n=g("th"),n.textContent="events:",o=v(),r=g("td"),c=g("code"),i=g("small"),a=$(s)},m(t,s){m(t,e,s),f(e,n),f(e,o),f(e,r),f(r,c),f(c,i),f(i,a)},p(t,e){131072&e[0]&&s!==(s=t[17].join(" ")+"")&&w(a,s)},d(t){t&&p(e)}}}function oe(t){let e,n,o,r,c,i,a,s,l,u=t[13]&&re(t),d=t[19]&&!t[5].isManual&&ce(t),h=t[5].isManual&&ie(t);return{c(){e=g("label"),n=$("1.\n                "),o=g("button"),o.textContent="create offer",r=v(),u&&u.c(),c=v(),d&&d.c(),i=v(),h&&h.c(),a=b()},m(p,g){m(p,e,g),f(e,n),f(e,o),m(p,r,g),u&&u.m(p,g),m(p,c,g),d&&d.m(p,g),m(p,i,g),h&&h.m(p,g),m(p,a,g),s||(l=y(o,"click",t[25]),s=!0)},p(t,e){t[13]?u?u.p(t,e):(u=re(t),u.c(),u.m(c.parentNode,c)):u&&(u.d(1),u=null),t[19]&&!t[5].isManual?d?d.p(t,e):(d=ce(t),d.c(),d.m(i.parentNode,i)):d&&(d.d(1),d=null),t[5].isManual?h?h.p(t,e):(h=ie(t),h.c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null)},d(t){t&&p(e),t&&p(r),u&&u.d(t),t&&p(c),d&&d.d(t),t&&p(i),h&&h.d(t),t&&p(a),s=!1,l()}}}function re(t){let e,n,r,c,i,a,s,l,u,d,h,b;return{c(){e=g("div"),n=g("textarea"),r=v(),c=g("br"),i=v(),a=g("label"),s=$("2.\n                        "),l=g("button"),l.textContent="setLocalDescription",u=v(),d=g("button"),d.textContent="send offer",k(n,"rows","20"),k(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(o,p){m(o,e,p),f(e,n),x(n,t[13]),f(e,r),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),f(a,u),f(a,d),h||(b=[y(n,"input",t[42]),y(l,"click",t[43]),y(d,"click",t[27])],h=!0)},p(t,e){8192&e[0]&&x(n,t[13]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&p(e),h=!1,o(b)}}}function ce(t){let e,n,r,c,i,a,s,l,u,d;return{c(){e=g("div"),n=g("textarea"),r=v(),c=g("br"),i=v(),a=g("label"),s=$("5.\n                        "),l=g("button"),l.textContent="setRemoteDescription",k(n,"rows","20"),k(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(o,p){m(o,e,p),f(e,n),x(n,t[19]),f(e,r),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),u||(d=[y(n,"input",t[44]),y(l,"click",t[45])],u=!0)},p(t,e){524288&e[0]&&x(n,t[19]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&p(e),u=!1,o(d)}}}function ie(t){let e,n,r,c,i,a,s,l,u,d,h,b;return{c(){e=g("div"),n=g("strong"),n.textContent="MANUAL ANSWER HERE",r=v(),c=g("textarea"),i=v(),a=g("br"),s=v(),l=g("label"),u=$("5.\n                        "),d=g("button"),d.textContent="setRemoteDescription",k(c,"rows","20"),k(c,"class","svelte-19mjatr")},m(o,p){m(o,e,p),f(e,n),f(e,r),f(e,c),x(c,t[16]),f(e,i),f(e,a),f(e,s),f(e,l),f(l,u),f(l,d),h||(b=[y(c,"input",t[46]),y(d,"click",t[47])],h=!0)},p(t,e){65536&e[0]&&x(c,t[16])},d(t){t&&p(e),h=!1,o(b)}}}function ae(t){let e,n,o,r=t[18]&&!t[5].isManual&&se(t),c=t[5].isManual&&le(t),i=t[14]&&t[18]&&ue(t);return{c(){r&&r.c(),e=v(),c&&c.c(),n=v(),i&&i.c(),o=b()},m(t,a){r&&r.m(t,a),m(t,e,a),c&&c.m(t,a),m(t,n,a),i&&i.m(t,a),m(t,o,a)},p(t,a){t[18]&&!t[5].isManual?r?r.p(t,a):(r=se(t),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),t[5].isManual?c?c.p(t,a):(c=le(t),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null),t[14]&&t[18]?i?i.p(t,a):(i=ue(t),i.c(),i.m(o.parentNode,o)):i&&(i.d(1),i=null)},d(t){r&&r.d(t),t&&p(e),c&&c.d(t),t&&p(n),i&&i.d(t),t&&p(o)}}}function se(t){let e,n,r,c,i,a,s,l,u,d,h,b;return{c(){e=g("div"),n=g("textarea"),r=v(),c=g("br"),i=v(),a=g("label"),s=$("3.\n                        "),l=g("button"),l.textContent="setRemoteDescription",u=v(),d=g("button"),d.textContent="create answer",k(n,"rows","20"),k(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(o,p){m(o,e,p),f(e,n),x(n,t[18]),f(e,r),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),f(a,u),f(a,d),h||(b=[y(n,"input",t[48]),y(l,"click",t[49]),y(d,"click",t[26])],h=!0)},p(t,e){262144&e[0]&&x(n,t[18]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&p(e),h=!1,o(b)}}}function le(t){let e,n,r,c,i,a,s,l,u,d,h,b,w,C;return{c(){e=g("div"),n=g("strong"),n.textContent="MANUAL OFFER HERE",r=v(),c=g("textarea"),i=v(),a=g("br"),s=v(),l=g("label"),u=$("3.\n                        "),d=g("button"),d.textContent="setRemoteDescription",h=v(),b=g("button"),b.textContent="create answer",k(c,"rows","20"),k(c,"class","svelte-19mjatr")},m(o,p){m(o,e,p),f(e,n),f(e,r),f(e,c),x(c,t[15]),f(e,i),f(e,a),f(e,s),f(e,l),f(l,u),f(l,d),f(l,h),f(l,b),w||(C=[y(c,"input",t[50]),y(d,"click",t[51]),y(b,"click",t[26])],w=!0)},p(t,e){32768&e[0]&&x(c,t[15])},d(t){t&&p(e),w=!1,o(C)}}}function ue(t){let e,n,r,c,i,a,s,l,u,d,h,b;return{c(){e=g("div"),n=g("textarea"),r=v(),c=g("br"),i=v(),a=g("label"),s=$("4.\n                        "),l=g("button"),l.textContent="setLocalDescription",u=v(),d=g("button"),d.textContent="send answer",k(n,"rows","20"),k(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(o,p){m(o,e,p),f(e,n),x(n,t[14]),f(e,r),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),f(a,u),f(a,d),h||(b=[y(n,"input",t[52]),y(l,"click",t[53]),y(d,"click",t[28])],h=!0)},p(t,e){16384&e[0]&&x(n,t[14]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&p(e),h=!1,o(b)}}}function de(t){let e,n,o;return{c(){e=g("textarea"),k(e,"rows","10"),k(e,"class","svelte-19mjatr"),C(e,"hideSignaling",t[22])},m(r,c){m(r,e,c),x(e,t[20]),n||(o=y(e,"input",t[54]),n=!0)},p(t,n){1048576&n[0]&&x(e,t[20]),4194304&n[0]&&C(e,"hideSignaling",t[22])},d(t){t&&p(e),n=!1,o()}}}function fe(t){let e,n,o,r,c,i,a,s,l=JSON.stringify(t[21],null,4)+"";return{c(){e=g("label"),e.textContent="injected Candidates",n=v(),o=g("textarea"),r=v(),c=g("pre"),i=$(l),k(e,"for","injectedCandidates"),k(o,"name","injectedCandidates"),k(o,"rows","20"),k(o,"class","svelte-19mjatr")},m(l,u){m(l,e,u),m(l,n,u),m(l,o,u),x(o,t[4]),m(l,r,u),m(l,c,u),f(c,i),a||(s=y(o,"input",t[55]),a=!0)},p(t,e){16&e[0]&&x(o,t[4]),2097152&e[0]&&l!==(l=JSON.stringify(t[21],null,4)+"")&&w(i,l)},d(t){t&&p(e),t&&p(n),t&&p(o),t&&p(r),t&&p(c),a=!1,s()}}}function me(t){let e,n,r,c,i,a,s,l,u,d,h,b,x,C,S,_,R,D,E,j,N,T,O,M,A,L,I,P,B,U,J,q,K,Q,Y,Z,tt,et,nt,ot,rt,ct,it,at,st,lt,ut,dt,ft,mt,pt,ht,gt,$t,vt,bt,yt,kt,wt,xt,Ct,St,_t,Rt=t[5].isRemote&&Qt(t),Dt=t[5].hasUpstream&&Yt(t),Et=t[5].hasDownstream&&Zt(t);function jt(t,e){return t[8]?ee:te}let Nt=jt(t),Tt=Nt(t);E=new Kt({props:{peerconnection:t[7]}});let Ot=!t[22]&&ne(t),Mt=t[0]&&oe(t),At=t[1]&&ae(t),Lt=(t[20].length||t[5].isManual)&&de(t),It=t[5].isManual&&fe(t);return{c(){e=g("section"),n=g("h3"),r=$(t[2]),c=v(),i=g("small"),a=$("talking to "),s=$(t[3]),l=v(),Rt&&Rt.c(),u=v(),Dt&&Dt.c(),d=v(),Et&&Et.c(),h=v(),b=g("article"),x=g("h5"),x.textContent="streams",C=v(),S=g("button"),Tt.c(),R=v(),D=g("article"),W(E.$$.fragment),j=v(),N=g("article"),T=g("h5"),T.textContent="signaling",O=v(),M=g("div"),A=g("table"),L=g("tr"),I=g("th"),I.textContent="signaling:",P=v(),B=g("td"),U=g("code"),J=$(t[10]),q=v(),K=g("tr"),Q=g("th"),Q.textContent="connection:",Y=v(),Z=g("td"),tt=g("code"),et=$(t[11]),nt=v(),ot=g("tr"),rt=g("th"),rt.textContent="ice:",ct=v(),it=g("td"),at=g("code"),st=$(t[12]),lt=v(),Ot&&Ot.c(),ut=v(),dt=g("div"),ft=g("span"),mt=g("label"),pt=g("input"),ht=$("\n                    caller"),gt=v(),$t=g("label"),vt=g("input"),bt=$("\n                    receiver"),yt=v(),Mt&&Mt.c(),kt=v(),At&&At.c(),wt=v(),Lt&&Lt.c(),xt=v(),It&&It.c(),S.disabled=_=!Boolean(t[9]),k(b,"class","box"),k(D,"class","box"),k(A,"class","vertical"),k(M,"class","box"),k(pt,"type","checkbox"),k(vt,"type","checkbox"),k(dt,"class","box"),k(N,"class","box")},m(o,p){m(o,e,p),f(e,n),f(n,r),f(n,c),f(n,i),f(i,a),f(i,s),f(e,l),Rt&&Rt.m(e,null),f(e,u),Dt&&Dt.m(e,null),f(e,d),Et&&Et.m(e,null),f(e,h),f(e,b),f(b,x),f(b,C),f(b,S),Tt.m(S,null),f(e,R),f(e,D),X(E,D,null),f(e,j),f(e,N),f(N,T),f(N,O),f(N,M),f(M,A),f(A,L),f(L,I),f(L,P),f(L,B),f(B,U),f(U,J),f(A,q),f(A,K),f(K,Q),f(K,Y),f(K,Z),f(Z,tt),f(tt,et),f(A,nt),f(A,ot),f(ot,rt),f(ot,ct),f(ot,it),f(it,at),f(at,st),f(A,lt),Ot&&Ot.m(A,null),f(N,ut),f(N,dt),f(dt,ft),f(ft,mt),f(mt,pt),pt.checked=t[0],f(mt,ht),f(ft,gt),f(ft,$t),f($t,vt),vt.checked=t[1],f($t,bt),f(N,yt),Mt&&Mt.m(N,null),f(N,kt),At&&At.m(N,null),f(N,wt),Lt&&Lt.m(N,null),f(N,xt),It&&It.m(N,null),Ct=!0,St||(_t=[y(S,"click",t[39]),y(pt,"change",t[40]),y(vt,"change",t[41])],St=!0)},p(t,n){(!Ct||4&n[0])&&w(r,t[2]),(!Ct||8&n[0])&&w(s,t[3]),t[5].isRemote?Rt?(Rt.p(t,n),32&n[0]&&z(Rt,1)):(Rt=Qt(t),Rt.c(),z(Rt,1),Rt.m(e,u)):Rt&&(F(),V(Rt,1,1,(()=>{Rt=null})),H()),t[5].hasUpstream?Dt?(Dt.p(t,n),32&n[0]&&z(Dt,1)):(Dt=Yt(t),Dt.c(),z(Dt,1),Dt.m(e,d)):Dt&&(F(),V(Dt,1,1,(()=>{Dt=null})),H()),t[5].hasDownstream?Et?(Et.p(t,n),32&n[0]&&z(Et,1)):(Et=Zt(t),Et.c(),z(Et,1),Et.m(e,h)):Et&&(F(),V(Et,1,1,(()=>{Et=null})),H()),Nt!==(Nt=jt(t))&&(Tt.d(1),Tt=Nt(t),Tt&&(Tt.c(),Tt.m(S,null))),(!Ct||512&n[0]&&_!==(_=!Boolean(t[9])))&&(S.disabled=_);const o={};128&n[0]&&(o.peerconnection=t[7]),E.$set(o),(!Ct||1024&n[0])&&w(J,t[10]),(!Ct||2048&n[0])&&w(et,t[11]),(!Ct||4096&n[0])&&w(st,t[12]),t[22]?Ot&&(Ot.d(1),Ot=null):Ot?Ot.p(t,n):(Ot=ne(t),Ot.c(),Ot.m(A,null)),1&n[0]&&(pt.checked=t[0]),2&n[0]&&(vt.checked=t[1]),t[0]?Mt?Mt.p(t,n):(Mt=oe(t),Mt.c(),Mt.m(N,kt)):Mt&&(Mt.d(1),Mt=null),t[1]?At?At.p(t,n):(At=ae(t),At.c(),At.m(N,wt)):At&&(At.d(1),At=null),t[20].length||t[5].isManual?Lt?Lt.p(t,n):(Lt=de(t),Lt.c(),Lt.m(N,xt)):Lt&&(Lt.d(1),Lt=null),t[5].isManual?It?It.p(t,n):(It=fe(t),It.c(),It.m(N,null)):It&&(It.d(1),It=null)},i(t){Ct||(z(Rt),z(Dt),z(Et),z(E.$$.fragment,t),Ct=!0)},o(t){V(Rt),V(Dt),V(Et),V(E.$$.fragment,t),Ct=!1},d(t){t&&p(e),Rt&&Rt.d(),Dt&&Dt.d(),Et&&Et.d(),Tt.d(),G(E),Ot&&Ot.d(),Mt&&Mt.d(),At&&At.d(),Lt&&Lt.d(),It&&It.d(),St=!1,o(_t)}}}function pe(t,e,n){let o,r,c,i,a,l,u,d,f,m,p;s(t,it,(t=>n(33,u=t))),s(t,pt,(t=>n(34,d=t))),s(t,ht,(t=>n(35,f=t))),s(t,ct,(t=>n(5,m=t))),s(t,gt,(t=>n(56,p=t)));var h=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,c){function i(t){try{s(o.next(t))}catch(t){c(t)}}function a(t){try{s(o.throw(t))}catch(t){c(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}s((o=o.apply(t,e||[])).next())}))};let{isCaller:g=!1}=e,{isReceiver:$=!1}=e,{name:v="unnamed participant"}=e,{recipient:b=null}=e;const y=new kt({from:v,to:b}),k=(t=>(e,n)=>function(t,e,n){const o={name:t,short:e,event:n};et.update((t=>[...t,o])),it.update((n=>({...n,[t]:[...n[t]||[],e]})))}(t,e,n))(v);let w,x,C,S,_="",D="",E="",N="",T="",O="",M="",A=[],L="",I="plan-b"===new URL(document.location.toString()).searchParams.get("semantic")?{sdpSemantics:"plan-b"}:{sdpSemantics:"unified-plan"};function P(t){C?(k("rt","replace track"),console.info("replace track",{sender:C}),C.replaceTrack(t.getTracks()[0])):(k("at","add track"),console.info("add track"),n(8,C=x.addTrack(t.getTracks()[0],t)))}function B(){return h(this,void 0,void 0,(function*(){k("o","create offer");const t=yield x.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});n(13,N=t.sdp)}))}function U(t){return h(this,void 0,void 0,(function*(){k("l","setLocalDescription"),console.debug("localDescription ->",t);const e=t;yt({from:v}),x.setLocalDescription(e),q(),yt({from:b})}))}function J(t){k("r","setRemoteDescription");const e=xt(t);x.setRemoteDescription(e),q(),yt({from:b})}function q(){m.isManual?(a||[]).forEach((t=>{t&&(k("ac","addIceCandidate"),x.addIceCandidate(t))})):(console.debug(p[b]),(p[b]||[]).forEach((t=>{t&&(k("ac","addIceCandidate"),x.addIceCandidate(t))})))}function F(t){k("r","setRemoteDescription");const e=Ct(t);x.setRemoteDescription(e),yt({from:v})}return R((()=>{n(7,x=function(){const t=new RTCPeerConnection(I);return t.ontrack=t=>{const{track:e,streams:n,transceiver:o}=t,r=n[0];w.$set({stream:r}),r.onaddtrack=()=>{k("ta","track added"),console.warn(`${v}track added to stream`,{track:e,stream:r})},"video"==e.kind&&(console.info(`${v}.ontrack`,{track:e,streams:n,kind:e.kind,transceiver:o}),e.onmute=t=>{k("tm","track muted"),console.info(`${v} track onmute`,{event:t})},e.onunmute=t=>{k("tu","track unmuted"),console.info(`${v} track onunmute`,{event:t})},e.onended=t=>{k("te","track ended"),console.debug(`${v} track onended`,{event:t})})},t.onicecandidate=({candidate:t})=>{k("lc","create candidate"),n(32,A=[...A,t]),function(t){v&&t&&(bt({from:v,candidate:t}),m.isRemote&&y.sendCandidate(t))}(t)},t.onsignalingstatechange=()=>n(10,_=t.signalingState),t.onconnectionstatechange=()=>n(11,D=t.connectionState),t.oniceconnectionstatechange=()=>n(12,E=t.iceConnectionState),console.info(`setup RTCPeerConnection for ${v}`,I,t),t}()),gt.subscribe((({[b]:t})=>{t&&k("rc")})),m.hasCaller&&B()})),t.$$set=t=>{"isCaller"in t&&n(0,g=t.isCaller),"isReceiver"in t&&n(1,$=t.isReceiver),"name"in t&&n(2,v=t.name),"recipient"in t&&n(3,b=t.recipient)},t.$$.update=()=>{4&t.$$.dirty[0]|4&t.$$.dirty[1]&&n(17,o=u[v]||[]),8&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(18,r=wt(d[b])),8&t.$$.dirty[0]|16&t.$$.dirty[1]&&n(19,c=wt(f[b])),2&t.$$.dirty[1]&&n(20,i=JSON.stringify(A)),16&t.$$.dirty[0]&&n(21,a=(t=>{try{return JSON.parse(t)}catch(e){return""!==t&&console.warn({parseError:e}),[]}})(L)),32&t.$$.dirty[0]&&n(22,l=m.hideSignaling)},[g,$,v,b,L,m,w,x,C,S,_,D,E,N,T,O,M,o,r,c,i,a,l,y,P,B,function(){return h(this,void 0,void 0,(function*(){k("a","create answer");const t=yield x.createAnswer();n(14,T=t.sdp)}))},function(){const t=xt(N);$t({from:v,offer:t}),m.isRemote&&y.sendOffer(t)},function(){const t=xt(T);vt({from:v,answer:t}),m.isRemote&&y.sendAnswer(t)},U,J,F,A,u,d,f,({detail:t})=>n(9,S=t),()=>n(9,S=void 0),function(t){j[t?"unshift":"push"]((()=>{w=t,n(6,w)}))},()=>P(S),function(){g=this.checked,n(0,g)},function(){$=this.checked,n(1,$)},function(){N=this.value,n(13,N)},()=>U(xt(N)),function(){c=this.value,n(19,c),n(35,f),n(3,b)},()=>F(c),function(){M=this.value,n(16,M)},()=>F(M),function(){r=this.value,n(18,r),n(34,d),n(3,b)},()=>J(r),function(){O=this.value,n(15,O)},()=>J(O),function(){T=this.value,n(14,T)},()=>U(Ct(T)),function(){i=this.value,n(20,i),n(32,A)},function(){L=this.value,n(4,L)}]}const he=class extends Q{constructor(t){super(),K(this,t,pe,me,c,{isCaller:0,isReceiver:1,name:2,recipient:3},[-1,-1,-1])}};function ge(t,e,n){const o=t.slice();return o[1]=e[n].name,o[2]=e[n].event,o}function $e(t){let e,n,o,r,c,i,a,s,l,u=t[1]+"",d=t[2]+"";return{c(){e=g("tr"),n=g("th"),o=$(u),r=$(":"),c=v(),i=g("td"),a=g("code"),s=$(d),l=v()},m(t,u){m(t,e,u),f(e,n),f(n,o),f(n,r),f(e,c),f(e,i),f(i,a),f(a,s),f(e,l)},p(t,e){1&e&&u!==(u=t[1]+"")&&w(o,u),1&e&&d!==(d=t[2]+"")&&w(s,d)},d(t){t&&p(e)}}}function ve(e){let n,o,r,c,i,a=e[0].filter(be),s=[];for(let t=0;t<a.length;t+=1)s[t]=$e(ge(e,a,t));return{c(){n=g("section"),o=g("h3"),o.innerHTML="Event Log <small>please open\n        <code>about://webrtc-internals</code></small>",r=v(),c=g("div"),i=g("table");for(let t=0;t<s.length;t+=1)s[t].c();k(i,"class","vertical svelte-111zlyk"),k(c,"class","box")},m(t,e){m(t,n,e),f(n,o),f(n,r),f(n,c),f(c,i);for(let t=0;t<s.length;t+=1)s[t].m(i,null)},p(t,[e]){if(1&e){let n;for(a=t[0].filter(be),n=0;n<a.length;n+=1){const o=ge(t,a,n);s[n]?s[n].p(o,e):(s[n]=$e(o),s[n].c(),s[n].m(i,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=a.length}},i:t,o:t,d(t){t&&p(n),h(s,t)}}}const be=t=>t.event;function ye(t,e,n){let o;return s(t,et,(t=>n(0,o=t))),[o]}const ke=class extends Q{constructor(t){super(),K(this,t,ye,ve,c,{})}};function we(t){let e,n;return e=new he({props:{name:"alice",isCaller:"true",recipient:"bob"}}),{c(){W(e.$$.fragment)},m(t,o){X(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function xe(t){let e,n;return e=new he({props:{name:"bob",isReceiver:"true",recipient:"alice"}}),{c(){W(e.$$.fragment)},m(t,o){X(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function Ce(t){let e,n;return e=new ke({}),{c(){W(e.$$.fragment)},m(t,o){X(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function Se(t){let e,n,o,r,c,i,a,s,l,u,d=t[0].hasCaller&&we(),h=t[0].hasReceiver&&xe(),$=!t[0].hideSignaling&&Ce();return l=new mt({}),{c(){e=g("div"),n=g("h1"),n.textContent="WebRTC Plumber",o=v(),r=g("main"),d&&d.c(),c=v(),h&&h.c(),i=v(),$&&$.c(),a=v(),s=g("aside"),W(l.$$.fragment),k(r,"class","svelte-1mx8d2d"),k(e,"class","svelte-1mx8d2d")},m(t,p){m(t,e,p),f(e,n),f(e,o),f(e,r),d&&d.m(r,null),f(r,c),h&&h.m(r,null),f(r,i),$&&$.m(r,null),f(e,a),f(e,s),X(l,s,null),u=!0},p(t,[e]){t[0].hasCaller?d?1&e&&z(d,1):(d=we(),d.c(),z(d,1),d.m(r,c)):d&&(F(),V(d,1,1,(()=>{d=null})),H()),t[0].hasReceiver?h?1&e&&z(h,1):(h=xe(),h.c(),z(h,1),h.m(r,i)):h&&(F(),V(h,1,1,(()=>{h=null})),H()),t[0].hideSignaling?$&&(F(),V($,1,1,(()=>{$=null})),H()):$?1&e&&z($,1):($=Ce(),$.c(),z($,1),$.m(r,null))},i(t){u||(z(d),z(h),z($),z(l.$$.fragment,t),u=!0)},o(t){V(d),V(h),V($),V(l.$$.fragment,t),u=!1},d(t){t&&p(e),d&&d.d(),h&&h.d(),$&&$.d(),G(l)}}}function _e(t,e,n){let o;return s(t,ct,(t=>n(0,o=t))),[o]}const Re=class extends Q{constructor(t){super(),K(this,t,_e,Se,c,{})}};function De(t,e,n){const o=t.slice();return o[26]=e[n],o[28]=n,o}function Ee(t){let e,n,o,r,c=(t[26].label||`micorophone ${t[28]}`)+"";function i(){return t[9](t[26])}return{c(){e=g("button"),n=$(c)},m(t,c){m(t,e,c),f(e,n),o||(r=y(e,"click",i),o=!0)},p(e,o){t=e,4&o&&c!==(c=(t[26].label||`micorophone ${t[28]}`)+"")&&w(n,c)},d(t){t&&p(e),o=!1,r()}}}function je(e){let n,r,c,i,a,s,l,u,d,$,b,w,x,C,S,_,R,D=e[2],E=[];for(let t=0;t<D.length;t+=1)E[t]=Ee(De(e,D,t));return{c(){n=g("h5"),n.textContent="audio devices",r=v(),c=g("audio"),c.innerHTML='<track kind="captions"/>',i=v(),a=g("nav");for(let t=0;t<E.length;t+=1)E[t].c();s=v(),l=g("hr"),u=v(),d=g("button"),d.textContent="pluginStream",$=v(),b=g("button"),b.textContent="start drawing",w=v(),x=g("button"),x.textContent="stop drawing",C=v(),S=g("canvas"),k(c,"id","upstream"),c.autoplay="false",c.controls="true"},m(t,o){m(t,n,o),m(t,r,o),m(t,c,o),e[8](c),m(t,i,o),m(t,a,o);for(let t=0;t<E.length;t+=1)E[t].m(a,null);f(a,s),f(a,l),f(a,u),f(a,d),f(a,$),f(a,b),f(a,w),f(a,x),m(t,C,o),m(t,S,o),e[13](S),_||(R=[y(d,"click",e[10]),y(b,"click",e[11]),y(x,"click",e[12])],_=!0)},p(t,[e]){if(20&e){let n;for(D=t[2],n=0;n<D.length;n+=1){const o=De(t,D,n);E[n]?E[n].p(o,e):(E[n]=Ee(o),E[n].c(),E[n].m(a,s))}for(;n<E.length;n+=1)E[n].d(1);E.length=D.length}},i:t,o:t,d(t){t&&p(n),t&&p(r),t&&p(c),e[8](null),t&&p(i),t&&p(a),h(E,t),t&&p(C),t&&p(S),e[13](null),_=!1,o(R)}}}function Ne(t,e,n){const o=D();let r,c,i,a,s,l,u,d,f=[],m=!1;async function p(){const t=await navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"audioinput"===t)))}async function h(t){const e=await async function(t){const e={audio:!t||{deviceId:t}};return await navigator.mediaDevices.getUserMedia(e)}(t);e.name=function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t),function(t){n(1,c=t),n(0,r.srcObject=t,r),o("stream",t)}(e)}function g(t){s.createMediaStreamSource(t).connect(l)}function $(){m||(m=!0,requestAnimationFrame(b))}function v(){m=!1,requestAnimationFrame(b)}function b(){m&&requestAnimationFrame(b),l.getByteTimeDomainData(d),l.getByteTimeDomainData(d),a.fillStyle="rgb(200, 200, 200)",a.fillRect(0,0,i.width,i.height),a.lineWidth=2,a.strokeStyle="rgb(0, 0, 0)",a.beginPath();let t=1*i.width/u,e=0;for(let n=0;n<u;n++){const o=d[n]/128*i.height/2;0===n?a.moveTo(e,o):a.lineTo(e,o),e+=t}a.lineTo(i.width,i.height/2),a.stroke()}return R((()=>{p();const t=()=>p();return navigator.mediaDevices.addEventListener("devicechange",t),a=i.getContext("2d"),s||(s=new AudioContext,l=s.createAnalyser(),l.fftSize=2048,u=l.frequencyBinCount,d=new Uint8Array(u)),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),[r,c,f,i,h,g,$,v,function(t){j[t?"unshift":"push"]((()=>{r=t,n(0,r)}))},t=>h(t.deviceId),()=>g(c),()=>$(),()=>v(),function(t){j[t?"unshift":"push"]((()=>{i=t,n(3,i)}))}]}const Te=class extends Q{constructor(t){super(),K(this,t,Ne,je,c,{})}};function Oe(t){let e,n;return e=new Re({}),{c(){W(e.$$.fragment)},m(t,o){X(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function Me(t){let e,n,o,r;return o=new Te({}),{c(){e=$("testdd\n"),n=g("article"),W(o.$$.fragment),k(n,"class","box")},m(t,c){m(t,e,c),m(t,n,c),X(o,n,null),r=!0},i(t){r||(z(o.$$.fragment,t),r=!0)},o(t){V(o.$$.fragment,t),r=!1},d(t){t&&p(e),t&&p(n),G(o)}}}function Ae(t){let e,n,o,r;const c=[Me,Oe],i=[];function a(t,e){return t[0].audioVisOnly?0:1}return e=a(t),n=i[e]=c[e](t),{c(){n.c(),o=b()},m(t,n){i[e].m(t,n),m(t,o,n),r=!0},p(t,[r]){let s=e;e=a(t),e!==s&&(F(),V(i[s],1,1,(()=>{i[s]=null})),H(),n=i[e],n||(n=i[e]=c[e](t),n.c()),z(n,1),n.m(o.parentNode,o))},i(t){r||(z(n),r=!0)},o(t){V(n),r=!1},d(t){i[e].d(t),t&&p(o)}}}function Le(t,e,n){let o;return s(t,ct,(t=>n(0,o=t))),[o]}const Ie=new class extends Q{constructor(t){super(),K(this,t,Le,Ae,c,{})}}({target:document.body,props:{}});window.app=Ie})();