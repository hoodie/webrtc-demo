(()=>{"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t){return 0===Object.keys(t).length}function a(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function s(t,e,n){t.$$.on_destroy.push(a(e,n))}new Set;let l,u=!1;function d(t,e,n,r){for(;t<e;){const o=t+(e-t>>1);n(o)<=r?t=o+1:e=o}return t}function f(t,e){u?(function(t){if(t.hydrate_init)return;t.hydrate_init=!0;const e=t.childNodes,n=new Int32Array(e.length+1),r=new Int32Array(e.length);n[0]=-1;let o=0;for(let t=0;t<e.length;t++){const c=d(1,o+1,(t=>e[n[t]].claim_order),e[t].claim_order)-1;r[t]=n[c]+1;const i=c+1;n[i]=t,o=Math.max(i,o)}const c=[],i=[];let a=e.length-1;for(let t=n[o]+1;0!=t;t=r[t-1]){for(c.push(e[t-1]);a>=t;a--)i.push(e[a]);a--}for(;a>=0;a--)i.push(e[a]);c.reverse(),i.sort(((t,e)=>t.claim_order-e.claim_order));for(let e=0,n=0;e<i.length;e++){for(;n<c.length&&i[e].claim_order>=c[n].claim_order;)n++;const r=n<c.length?c[n]:null;t.insertBefore(i[e],r)}}(t),(void 0===t.actual_end_child||null!==t.actual_end_child&&t.actual_end_child.parentElement!==t)&&(t.actual_end_child=t.firstChild),e!==t.actual_end_child?t.insertBefore(e,t.actual_end_child):t.actual_end_child=e.nextSibling):e.parentNode!==t&&t.appendChild(e)}function m(t,e,n){u&&!n?f(t,e):(e.parentNode!==t||n&&e.nextSibling!==n)&&t.insertBefore(e,n||null)}function p(t){t.parentNode.removeChild(t)}function h(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function g(t){return document.createElement(t)}function $(t){return document.createTextNode(t)}function b(){return $(" ")}function v(){return $("")}function y(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function k(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function x(t,e){t.value=null==e?"":e}function C(t,e,n){t.classList[n?"add":"remove"](e)}function S(t){l=t}function _(){if(!l)throw new Error("Function called outside component initialization");return l}function D(t){_().$$.on_mount.push(t)}function R(){const t=_();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const o=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);r.slice().forEach((e=>{e.call(t,o)}))}}}new Set;const j=[],E=[],N=[],T=[],O=Promise.resolve();let M=!1;function A(t){N.push(t)}let L=!1;const I=new Set;function B(){if(!L){L=!0;do{for(let t=0;t<j.length;t+=1){const e=j[t];S(e),P(e.$$)}for(S(null),j.length=0;E.length;)E.pop()();for(let t=0;t<N.length;t+=1){const e=N[t];I.has(e)||(I.add(e),e())}N.length=0}while(j.length);for(;T.length;)T.pop()();M=!1,L=!1,I.clear()}}function P(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}const U=new Set;let q,J;function F(){q={r:0,c:[],p:q}}function H(){q.r||r(q.c),q=q.p}function z(t,e){t&&t.i&&(U.delete(t),t.i(e))}function V(t,e,n,r){if(t&&t.o){if(U.has(t))return;U.add(t),q.c.push((()=>{U.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function W(t){t&&t.c()}function X(t,n,c,i){const{fragment:a,on_mount:s,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,c),i||A((()=>{const n=s.map(e).filter(o);l?l.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(A)}function G(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function K(e,o,c,i,a,s,d=[-1]){const f=l;S(e);const m=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:o.context||[]),callbacks:n(),dirty:d,skip_bound:!1};let h=!1;if(m.ctx=c?c(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return m.ctx&&a(m.ctx[t],m.ctx[t]=o)&&(!m.skip_bound&&m.bound[t]&&m.bound[t](o),h&&function(t,e){-1===t.$$.dirty[0]&&(j.push(t),M||(M=!0,O.then(B)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],m.update(),h=!0,r(m.before_update),m.fragment=!!i&&i(m.ctx),o.target){if(o.hydrate){u=!0;const t=(g=o.target,Array.from(g.childNodes));m.fragment&&m.fragment.l(t),t.forEach(p)}else m.fragment&&m.fragment.c();o.intro&&z(e.$$.fragment),X(e,o.target,o.anchor,o.customElement),u=!1,B()}var g;S(f)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(J=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(o);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){r(this.$$.on_disconnect)}$destroy(){G(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!i(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class Q{$destroy(){G(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!i(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Y=[];function Z(e,n=t){let r;const o=[];function i(t){if(c(e,t)&&(e=t,r)){const t=!Y.length;for(let t=0;t<o.length;t+=1){const n=o[t];n[1](),Y.push(n,e)}if(t){for(let t=0;t<Y.length;t+=2)Y[t][0](Y[t+1]);Y.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(c,a=t){const s=[c,a];return o.push(s),1===o.length&&(r=n(i)||t),c(e),()=>{const t=o.indexOf(s);-1!==t&&o.splice(t,1),0===o.length&&(r(),r=null)}}}}function tt(e,n,c){const i=!Array.isArray(e),s=i?[e]:e,l=n.length<2;return{subscribe:Z(c,(e=>{let c=!1;const u=[];let d=0,f=t;const m=()=>{if(d)return;f();const r=n(i?u[0]:u,e);l?e(r):f=o(r)?r:t},p=s.map(((t,e)=>a(t,(t=>{u[e]=t,d&=~(1<<e),c&&m()}),(()=>{d|=1<<e}))));return c=!0,m(),function(){r(p),f()}})).subscribe}}const et=Z([]),nt=t=>{try{return!0===JSON.parse(t)}catch{return!1}},rt=Z((()=>{const t=Object.fromEntries(new URLSearchParams(location.search).entries()),e={role:t.role||"both",stream:t.stream||"both",audioVisOnly:nt(t.audioVisOnly),manual:nt(t.manual),remote:nt(t.remote),hideSignaling:nt(t.hideSignaling)};return Object.entries(e).map((([t,e])=>({key:t,value:e})))})()),ot=tt(rt,(t=>`${window.location.protocol}//${window.location.host}/?${(t=>{const e=new URLSearchParams;for(let[n,r]of t)e.set(n,r);return e.toString()})(t.map((({key:t,value:e})=>[t,e])))}`)),ct=tt(rt,(t=>{const e=Object.fromEntries(t.map((({key:t,value:e})=>[t,e])));let{role:n,stream:r,manual:o,remote:c,hideSignaling:i}=e;const a="recv"!==n,s="call"!==n&&"send"!==n||!1,l="down"!==r||!1,u="up"!==r||!1,d=o&&"no"!==o||!1,f=c&&"no"!==c||!1,m=a?"bob":"alice",p=s?"bob":"alice";return{...e,role:n,stream:r,manual:o,remote:c,hasCaller:a,hasReceiver:s,hasUpstream:l,hasDownstream:u,isManual:d,isRemote:f,hideSignaling:i,to:m,from:p}})),it=Z({});function at(t,e,n){const r=t.slice();return r[6]=e[n].key,r[7]=e[n].value,r[8]=e,r[9]=n,r}function st(t){let e,n,r;function o(){t[3].call(e,t[8],t[9])}return{c(){e=g("input"),k(e,"type","text")},m(c,i){m(c,e,i),x(e,t[7]),n||(r=y(e,"input",o),n=!0)},p(n,r){t=n,2&r&&e.value!==t[7]&&x(e,t[7])},d(t){t&&p(e),n=!1,r()}}}function lt(t){let e,n,r;function o(){t[2].call(e,t[8],t[9])}return{c(){e=g("input"),k(e,"type","checkbox")},m(c,i){m(c,e,i),e.checked=t[7],n||(r=y(e,"change",o),n=!0)},p(n,r){t=n,2&r&&(e.checked=t[7])},d(t){t&&p(e),n=!1,r()}}}function ut(t){let e,n,r,o,c,i,a=t[6]+"";function s(t,e){return"boolean"==typeof t[7]?lt:st}let l=s(t),u=l(t);return{c(){e=g("tr"),n=g("td"),r=$(a),o=b(),c=g("td"),u.c(),i=b()},m(t,a){m(t,e,a),f(e,n),f(n,r),f(e,o),f(e,c),u.m(c,null),f(e,i)},p(t,e){2&e&&a!==(a=t[6]+"")&&w(r,a),l===(l=s(t))&&u?u.p(t,e):(u.d(1),u=l(t),u&&(u.c(),u.m(c,null)))},d(t){t&&p(e),u.d()}}}function dt(e){let n,r,o,c,i,a,s,l,u,d=e[1],v=[];for(let t=0;t<d.length;t+=1)v[t]=ut(at(e,d,t));return{c(){n=g("details"),r=g("summary"),r.textContent="config",o=b(),c=g("code"),i=g("pre"),a=g("a"),s=$(e[0]),l=b(),u=g("table");for(let t=0;t<v.length;t+=1)v[t].c();k(a,"href",e[0]),k(c,"class","svelte-12ii7jf")},m(t,e){m(t,n,e),f(n,r),f(n,o),f(n,c),f(c,i),f(i,a),f(a,s),f(n,l),f(n,u);for(let t=0;t<v.length;t+=1)v[t].m(u,null)},p(t,[e]){if(1&e&&w(s,t[0]),1&e&&k(a,"href",t[0]),2&e){let n;for(d=t[1],n=0;n<d.length;n+=1){const r=at(t,d,n);v[n]?v[n].p(r,e):(v[n]=ut(r),v[n].c(),v[n].m(u,null))}for(;n<v.length;n+=1)v[n].d(1);v.length=d.length}},i:t,o:t,d(t){t&&p(n),h(v,t)}}}function ft(t,e,n){let r,o;return s(t,ot,(t=>n(0,r=t))),s(t,rt,(t=>n(1,o=t))),[r,o,function(t,e){t[e].value=this.checked,rt.set(o)},function(t,e){t[e].value=this.value,rt.set(o)}]}const mt=class extends Q{constructor(t){super(),K(this,t,ft,dt,c,{})}},pt=Z({}),ht=Z({}),gt=Z({});function $t({from:t,offer:e}){pt.update((n=>({...n,[t]:e})))}function bt({from:t,answer:e}){ht.update((n=>({...n,[t]:e})))}function vt({from:t,candidate:e}){gt.update((n=>{const r=n[t]||[];return{...n,[t]:[...r,e]}}))}function yt({from:t}){gt.update((e=>({...e,[t]:[]})))}class kt{constructor({to:t,from:e}){this.to=t,this.from=e}connect({url:t}){this.url=t;const e=new WebSocket(t);e.onopen=()=>{this.socket=e,this.socket.onmessage=this.received.bind(this)}}received({data:t}){const e=JSON.parse(t),{[this.to]:n,type:r}=e;console.debug("its for me!",n);const o=this.to;switch(r){case"offer":$t({from:o,offer:n});break;case"answer":bt({from:o,answer:n});break;case"candidate":vt({from:o,candidate:new RTCIceCandidate(n)})}}sendOffer(t){if(t){const e={[this.from]:t,type:"offer"};this.send(e)}}sendAnswer(t){if(t){const e={[this.from]:t,type:"answer"};this.send(e)}}sendCandidate(t){if(t){const e={[this.from]:t,type:"candidate"};this.send(e)}}send(t){if(this.socket){const e=JSON.stringify(t);this.socket.send(e)}}toString(){return`[Signaling Server calling ${this.from} → ${this.to}]`}}const wt=t=>"string"==typeof t?JSON.parse(t).sdp:"object"==typeof t?t.sdp:void 0,xt=t=>({type:"offer",sdp:t}),Ct=t=>({type:"answer",sdp:t});function St(e){let n,r,o,c,i,a,s,l,u=JSON.stringify(e[2],null,4)+"";return{c(){n=g("details"),r=g("summary"),o=$(e[1]),c=b(),i=g("pre"),a=g("code"),s=$(u),k(a,"class","svelte-ubxtzq"),n.open=l=Boolean(e[2])&&e[0]},m(t,e){m(t,n,e),f(n,r),f(r,o),f(n,c),f(n,i),f(i,a),f(a,s)},p(t,[e]){2&e&&w(o,t[1]),4&e&&u!==(u=JSON.stringify(t[2],null,4)+"")&&w(s,u),5&e&&l!==(l=Boolean(t[2])&&t[0])&&(n.open=l)},i:t,o:t,d(t){t&&p(n)}}}function _t(t,e,n){let{open:r=!0}=e,{summary:o="???"}=e,{data:c}=e;return t.$$set=t=>{"open"in t&&n(0,r=t.open),"summary"in t&&n(1,o=t.summary),"data"in t&&n(2,c=t.data)},[r,o,c]}const Dt=class extends Q{constructor(t){super(),K(this,t,_t,St,c,{open:0,summary:1,data:2})}};function Rt(t,e,n){const r=t.slice();return r[23]=e[n],r}function jt(t,e,n){const r=t.slice();return r[26]=e[n],r[28]=n,r}function Et(t){let e,n,r,o,c,i=(t[26].label||`camera ${t[28]}`)+"";function a(){return t[14](t[26])}return{c(){e=g("button"),n=$(i),r=b(),k(e,"class","svelte-2jsuhx")},m(t,i){m(t,e,i),f(e,n),f(e,r),o||(c=y(e,"click",a),o=!0)},p(e,r){t=e,4&r&&i!==(i=(t[26].label||`camera ${t[28]}`)+"")&&w(n,i)},d(t){t&&p(e),o=!1,c()}}}function Nt(t){let e;return{c(){e=$("✔️")},m(t,n){m(t,e,n)},d(t){t&&p(e)}}}function Tt(t){let e,n,o,c,i,a,s,l,u,d,h,v,x,C,S,_=t[23].name+"",D=t[0]===t[23]&&Nt();function R(){return t[15](t[23])}function j(){return t[16](t[23])}function E(){return t[17](t[23])}return{c(){e=g("tr"),n=g("td"),D&&D.c(),o=b(),c=g("td"),i=g("button"),a=$(_),s=b(),l=g("td"),u=g("button"),u.textContent="stop",d=b(),h=g("td"),v=g("button"),v.textContent="X",x=b(),k(i,"class","svelte-2jsuhx"),k(u,"class","svelte-2jsuhx"),k(v,"class","svelte-2jsuhx")},m(t,r){m(t,e,r),f(e,n),D&&D.m(n,null),f(e,o),f(e,c),f(c,i),f(i,a),f(e,s),f(e,l),f(l,u),f(e,d),f(e,h),f(h,v),f(e,x),C||(S=[y(i,"click",R),y(u,"click",j),y(v,"click",E)],C=!0)},p(e,r){(t=e)[0]===t[23]?D||(D=Nt(),D.c(),D.m(n,null)):D&&(D.d(1),D=null),8&r&&_!==(_=t[23].name+"")&&w(a,_)},d(t){t&&p(e),D&&D.d(),C=!1,r(S)}}}function Ot(t){let e,n,r,o,c,i,a,s,l,u,d,h,v,y=t[4].readyState+"";return u=new Dt({props:{summary:"settings",data:t[4].getSettings()}}),h=new Dt({props:{summary:"constraints",data:t[4].getConstraints()}}),{c(){e=g("details"),n=g("summary"),r=$(t[5]),o=b(),c=g("dl"),i=g("dt"),i.textContent="readState",a=g("dd"),s=$(y),l=b(),W(u.$$.fragment),d=b(),W(h.$$.fragment)},m(t,p){m(t,e,p),f(e,n),f(n,r),f(e,o),f(e,c),f(c,i),f(c,a),f(a,s),f(e,l),X(u,e,null),f(e,d),X(h,e,null),v=!0},p(t,e){(!v||32&e)&&w(r,t[5]),(!v||16&e)&&y!==(y=t[4].readyState+"")&&w(s,y);const n={};16&e&&(n.data=t[4].getSettings()),u.$set(n);const o={};16&e&&(o.data=t[4].getConstraints()),h.$set(o)},i(t){v||(z(u.$$.fragment,t),z(h.$$.fragment,t),v=!0)},o(t){V(u.$$.fragment,t),V(h.$$.fragment,t),v=!1},d(t){t&&p(e),G(u),G(h)}}}function Mt(t){let e,n,o,c,i,a,s,l,u,d,$,w,x,C,S,_,D,R,j=t[2],E=[];for(let e=0;e<j.length;e+=1)E[e]=Et(jt(t,j,e));let N=t[3],T=[];for(let e=0;e<N.length;e+=1)T[e]=Tt(Rt(t,N,e));let O=t[4]&&Ot(t);return{c(){e=g("h5"),e.textContent="upstream",n=b(),o=g("video"),o.innerHTML='<track kind="captions"/>',c=b(),i=g("nav"),a=g("button"),a.textContent="default",s=b(),l=g("button"),l.textContent="noise",u=b(),d=g("br"),$=b();for(let t=0;t<E.length;t+=1)E[t].c();w=b(),x=g("table");for(let t=0;t<T.length;t+=1)T[t].c();C=b(),O&&O.c(),S=v(),k(o,"id","upstream"),o.autoplay="true",k(a,"class","svelte-2jsuhx"),k(l,"class","svelte-2jsuhx"),k(i,"class","svelte-2jsuhx")},m(r,p){m(r,e,p),m(r,n,p),m(r,o,p),t[11](o),m(r,c,p),m(r,i,p),f(i,a),f(i,s),f(i,l),f(i,u),f(i,d),f(i,$);for(let t=0;t<E.length;t+=1)E[t].m(i,null);m(r,w,p),m(r,x,p);for(let t=0;t<T.length;t+=1)T[t].m(x,null);m(r,C,p),O&&O.m(r,p),m(r,S,p),_=!0,D||(R=[y(a,"click",t[12]),y(l,"click",t[13])],D=!0)},p(t,[e]){if(132&e){let n;for(j=t[2],n=0;n<j.length;n+=1){const r=jt(t,j,n);E[n]?E[n].p(r,e):(E[n]=Et(r),E[n].c(),E[n].m(i,null))}for(;n<E.length;n+=1)E[n].d(1);E.length=j.length}if(1801&e){let n;for(N=t[3],n=0;n<N.length;n+=1){const r=Rt(t,N,n);T[n]?T[n].p(r,e):(T[n]=Tt(r),T[n].c(),T[n].m(x,null))}for(;n<T.length;n+=1)T[n].d(1);T.length=N.length}t[4]?O?(O.p(t,e),16&e&&z(O,1)):(O=Ot(t),O.c(),z(O,1),O.m(S.parentNode,S)):O&&(F(),V(O,1,1,(()=>{O=null})),H())},i(t){_||(z(O),_=!0)},o(t){V(O),_=!1},d(a){a&&p(e),a&&p(n),a&&p(o),t[11](null),a&&p(c),a&&p(i),h(E,a),a&&p(w),a&&p(x),h(T,a),a&&p(C),O&&O.d(a),a&&p(S),D=!1,r(R)}}}function At(t,e,n){let r,o,c;const i=R();let a,s,l=[],u=[];async function d(){const t=await function(){let t=Object.assign(document.createElement("canvas"),{width:400,height:300}),e=t.getContext("2d");e.fillRect(0,0,t.width,t.height);let n=e.getImageData(0,0,t.width,t.height);return requestAnimationFrame((function t(){for(var r=0;r<n.data.length;r++)n.data[r++]=n.data[r++]=n.data[r++]=255*Math.random();e.putImageData(n,0,0),requestAnimationFrame(t)})),t.captureStream(60)}();t.name="noise feed",m(t),n(3,u=[...u,t])}async function f(t){const e=await async function(t){const e={video:!t||{deviceId:t}};return await navigator.mediaDevices.getUserMedia(e)}(t);e.name=t?function(t){const e=t&&l.find((({deviceId:e})=>e===t));return e&&e.label}(t):"default webcam",m(e),n(3,u=[...u,e])}function m(t){n(0,s=t),n(1,a.srcObject=t,a),i("stream",t)}function p(t){t.getTracks().forEach((t=>t.stop())),i("stop",t)}function h(t){p(t),n(3,u=[...u.filter((e=>e!=t))]),s===t&&n(0,s=void 0)}async function g(){const t=await navigator.mediaDevices.enumerateDevices();n(2,l=t.filter((({kind:t})=>"videoinput"===t)))}return D((()=>{g(),navigator.mediaDevices.addEventListener("devicechange",(t=>{navigator.mediaDevices.enumerateDevices().then((t=>g()))}))})),t.$$.update=()=>{1&t.$$.dirty&&n(4,r=s&&s.getTracks()[0]),1&t.$$.dirty&&n(5,o=s&&s.constructor.name),1&t.$$.dirty&&(c=Boolean(s))},[s,a,l,u,r,o,d,f,m,p,h,function(t){E[t?"unshift":"push"]((()=>{a=t,n(1,a)}))},()=>f(),()=>d(),t=>f(t.deviceId),t=>m(t),t=>p(t),t=>h(t)]}const Lt=class extends Q{constructor(t){super(),K(this,t,At,Mt,c,{})}};function It(t){let e,n,r,o;return e=new Dt({props:{summary:"settings",data:t[1].getSettings()}}),r=new Dt({props:{summary:"constraints",data:t[1].getConstraints()}}),{c(){W(e.$$.fragment),n=b(),W(r.$$.fragment)},m(t,c){X(e,t,c),m(t,n,c),X(r,t,c),o=!0},p(t,n){const o={};2&n&&(o.data=t[1].getSettings()),e.$set(o);const c={};2&n&&(c.data=t[1].getConstraints()),r.$set(c)},i(t){o||(z(e.$$.fragment,t),z(r.$$.fragment,t),o=!0)},o(t){V(e.$$.fragment,t),V(r.$$.fragment,t),o=!1},d(t){G(e,t),t&&p(n),G(r,t)}}}function Bt(t){let e,n,r,o,c,i,a=t[1]&&It(t);return{c(){e=g("h5"),e.textContent="downstream",n=b(),r=g("video"),r.innerHTML='<track kind="captions"/>',o=b(),a&&a.c(),c=v(),r.autoplay="true"},m(s,l){m(s,e,l),m(s,n,l),m(s,r,l),t[3](r),m(s,o,l),a&&a.m(s,l),m(s,c,l),i=!0},p(t,[e]){t[1]?a?(a.p(t,e),2&e&&z(a,1)):(a=It(t),a.c(),z(a,1),a.m(c.parentNode,c)):a&&(F(),V(a,1,1,(()=>{a=null})),H())},i(t){i||(z(a),i=!0)},o(t){V(a),i=!1},d(i){i&&p(e),i&&p(n),i&&p(r),t[3](null),i&&p(o),a&&a.d(i),i&&p(c)}}}function Pt(t,e,n){let r,o,{stream:c}=e;return t.$$set=t=>{"stream"in t&&n(2,c=t.stream)},t.$$.update=()=>{4&t.$$.dirty&&n(1,r=c&&c.getTracks()[0]),5&t.$$.dirty&&o&&n(0,o.srcObject=c,o)},[o,r,c,function(t){E[t?"unshift":"push"]((()=>{o=t,n(0,o),n(2,c)}))}]}const Ut=class extends Q{constructor(t){super(),K(this,t,Pt,Bt,c,{stream:2})}};function qt(e){let n,o,c,i,a,s,l;return{c(){n=g("form"),o=g("input"),c=b(),i=g("code"),a=$(e[0]),k(o,"size","90"),k(o,"placeholder","ws url")},m(t,r){var u;m(t,n,r),f(n,o),x(o,e[1]),m(t,c,r),m(t,i,r),f(i,a),s||(l=[y(o,"input",e[2]),y(n,"submit",(u=Jt,function(t){return t.preventDefault(),u.call(this,t)}))],s=!0)},p(t,[e]){2&e&&o.value!==t[1]&&x(o,t[1]),1&e&&w(a,t[0])},i:t,o:t,d(t){t&&p(n),t&&p(c),t&&p(i),s=!1,r(l)}}}function Jt(){}function Ft(t,e,n){let r,{signalingClient:o}=e;return t.$$set=t=>{"signalingClient"in t&&n(0,o=t.signalingClient)},t.$$.update=()=>{3&t.$$.dirty&&(o.connect({url:r}),window.client=o)},n(1,r=`wss://${window.location.host}/signaling/test`),[o,r,function(){r=this.value,n(1,r)}]}const Ht=class extends Q{constructor(t){super(),K(this,t,Ft,qt,c,{signalingClient:0})}};function zt(t,e,n){const r=t.slice();return r[3]=e[n],r}function Vt(t){let e,n,r=t[0],o=[];for(let e=0;e<r.length;e+=1)o[e]=Wt(zt(t,r,e));const c=t=>V(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=v()},m(t,r){for(let e=0;e<o.length;e+=1)o[e].m(t,r);m(t,e,r),n=!0},p(t,n){if(1&n){let i;for(r=t[0],i=0;i<r.length;i+=1){const c=zt(t,r,i);o[i]?(o[i].p(c,n),z(o[i],1)):(o[i]=Wt(c),o[i].c(),z(o[i],1),o[i].m(e.parentNode,e))}for(F(),i=r.length;i<o.length;i+=1)c(i);H()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)z(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)V(o[t]);n=!1},d(t){h(o,t),t&&p(e)}}}function Wt(t){let e,n,r,o,c,i,a,s,l,u,d,h,v=`transceiver ${t[3].mid}`,y=t[3].mid+"";return d=new Dt({props:{summary:"details",data:t[3],open:!1}}),{c(){e=$(v),n=b(),r=g("table"),o=g("tr"),c=g("th"),c.textContent="mid",i=b(),a=g("td"),s=g("code"),l=$(y),u=b(),W(d.$$.fragment)},m(t,p){m(t,e,p),m(t,n,p),m(t,r,p),f(r,o),f(o,c),f(o,i),f(o,a),f(a,s),f(s,l),m(t,u,p),X(d,t,p),h=!0},p(t,n){(!h||1&n)&&v!==(v=`transceiver ${t[3].mid}`)&&w(e,v),(!h||1&n)&&y!==(y=t[3].mid+"")&&w(l,y);const r={};1&n&&(r.data=t[3]),d.$set(r)},i(t){h||(z(d.$$.fragment,t),h=!0)},o(t){V(d.$$.fragment,t),h=!1},d(t){t&&p(e),t&&p(n),t&&p(r),t&&p(u),G(d,t)}}}function Xt(t){let e,n,r,o,c=t[0]&&Vt(t);return{c(){e=g("h5"),e.textContent="transceivers",n=b(),c&&c.c(),r=v()},m(t,i){m(t,e,i),m(t,n,i),c&&c.m(t,i),m(t,r,i),o=!0},p(t,[e]){t[0]?c?(c.p(t,e),1&e&&z(c,1)):(c=Vt(t),c.c(),z(c,1),c.m(r.parentNode,r)):c&&(F(),V(c,1,1,(()=>{c=null})),H())},i(t){o||(z(c),o=!0)},o(t){V(c),o=!1},d(t){t&&p(e),t&&p(n),c&&c.d(t),t&&p(r)}}}function Gt(t,e,n){let r,o,{peerconnection:c}=e;return D((()=>{const t=setInterval((()=>{r&&n(0,o=r.map((({mid:t,direction:e,currentDirection:n,stopped:r,sender:o,receiver:c})=>{let i={},a={};{let{dtmf:t,track:e,transport:n}=o;i={dtmf:t,track:e,transport:n,parameters:o.getParameters&&o.getParameters()}}{let{dtmf:t,track:e,transport:n}=c;a={dtmf:t,track:e,transport:n,parameters:c.getParameters&&c.getParameters(),csrcs:c.getContributingSources(),ssrcs:c.getSynchronizationSources()}}return{mid:t,direction:e,currentDirection:n,stopped:r,sender:i,receiver:a}})))}),1e3);return()=>clearInterval(t)})),t.$$set=t=>{"peerconnection"in t&&n(1,c=t.peerconnection)},t.$$.update=()=>{2&t.$$.dirty&&(r=c&&c.getTransceivers())},[o,c]}const Kt=class extends Q{constructor(t){super(),K(this,t,Gt,Xt,c,{peerconnection:1})}};function Qt(e){let n,r;return n=new Ht({props:{signalingClient:e[23]}}),{c(){W(n.$$.fragment)},m(t,e){X(n,t,e),r=!0},p:t,i(t){r||(z(n.$$.fragment,t),r=!0)},o(t){V(n.$$.fragment,t),r=!1},d(t){G(n,t)}}}function Yt(e){let n,r,o;return r=new Lt({}),r.$on("stream",e[36]),r.$on("stop",e[37]),{c(){n=g("article"),W(r.$$.fragment),k(n,"id","upstream"),k(n,"class","box")},m(t,e){m(t,n,e),X(r,n,null),o=!0},p:t,i(t){o||(z(r.$$.fragment,t),o=!0)},o(t){V(r.$$.fragment,t),o=!1},d(t){t&&p(n),G(r)}}}function Zt(t){let e,n,r;return n=new Ut({props:{}}),t[38](n),{c(){e=g("article"),W(n.$$.fragment),k(e,"id","downstream"),k(e,"class","box")},m(t,o){m(t,e,o),X(n,e,null),r=!0},p(t,e){n.$set({})},i(t){r||(z(n.$$.fragment,t),r=!0)},o(t){V(n.$$.fragment,t),r=!1},d(r){r&&p(e),t[38](null),G(n)}}}function te(t){let e;return{c(){e=$("addStream")},m(t,n){m(t,e,n)},d(t){t&&p(e)}}}function ee(t){let e;return{c(){e=$("replaceTrack")},m(t,n){m(t,e,n)},d(t){t&&p(e)}}}function ne(t){let e,n,r,o,c,i,a,s=t[17].join(" ")+"";return{c(){e=g("tr"),n=g("th"),n.textContent="events:",r=b(),o=g("td"),c=g("code"),i=g("small"),a=$(s)},m(t,s){m(t,e,s),f(e,n),f(e,r),f(e,o),f(o,c),f(c,i),f(i,a)},p(t,e){131072&e[0]&&s!==(s=t[17].join(" ")+"")&&w(a,s)},d(t){t&&p(e)}}}function re(t){let e,n,r,o,c,i,a,s,l,u=t[13]&&oe(t),d=t[19]&&!t[5].isManual&&ce(t),h=t[5].isManual&&ie(t);return{c(){e=g("label"),n=$("1.\n                "),r=g("button"),r.textContent="create offer",o=b(),u&&u.c(),c=b(),d&&d.c(),i=b(),h&&h.c(),a=v()},m(p,g){m(p,e,g),f(e,n),f(e,r),m(p,o,g),u&&u.m(p,g),m(p,c,g),d&&d.m(p,g),m(p,i,g),h&&h.m(p,g),m(p,a,g),s||(l=y(r,"click",t[25]),s=!0)},p(t,e){t[13]?u?u.p(t,e):(u=oe(t),u.c(),u.m(c.parentNode,c)):u&&(u.d(1),u=null),t[19]&&!t[5].isManual?d?d.p(t,e):(d=ce(t),d.c(),d.m(i.parentNode,i)):d&&(d.d(1),d=null),t[5].isManual?h?h.p(t,e):(h=ie(t),h.c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null)},d(t){t&&p(e),t&&p(o),u&&u.d(t),t&&p(c),d&&d.d(t),t&&p(i),h&&h.d(t),t&&p(a),s=!1,l()}}}function oe(t){let e,n,o,c,i,a,s,l,u,d,h,v;return{c(){e=g("div"),n=g("textarea"),o=b(),c=g("br"),i=b(),a=g("label"),s=$("2.\n                        "),l=g("button"),l.textContent="setLocalDescription",u=b(),d=g("button"),d.textContent="send offer",k(n,"rows","20"),k(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(r,p){m(r,e,p),f(e,n),x(n,t[13]),f(e,o),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),f(a,u),f(a,d),h||(v=[y(n,"input",t[42]),y(l,"click",t[43]),y(d,"click",t[27])],h=!0)},p(t,e){8192&e[0]&&x(n,t[13]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&p(e),h=!1,r(v)}}}function ce(t){let e,n,o,c,i,a,s,l,u,d;return{c(){e=g("div"),n=g("textarea"),o=b(),c=g("br"),i=b(),a=g("label"),s=$("5.\n                        "),l=g("button"),l.textContent="setRemoteDescription",k(n,"rows","20"),k(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(r,p){m(r,e,p),f(e,n),x(n,t[19]),f(e,o),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),u||(d=[y(n,"input",t[44]),y(l,"click",t[45])],u=!0)},p(t,e){524288&e[0]&&x(n,t[19]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&p(e),u=!1,r(d)}}}function ie(t){let e,n,o,c,i,a,s,l,u,d,h,v;return{c(){e=g("div"),n=g("strong"),n.textContent="MANUAL ANSWER HERE",o=b(),c=g("textarea"),i=b(),a=g("br"),s=b(),l=g("label"),u=$("5.\n                        "),d=g("button"),d.textContent="setRemoteDescription",k(c,"rows","20"),k(c,"class","svelte-19mjatr")},m(r,p){m(r,e,p),f(e,n),f(e,o),f(e,c),x(c,t[16]),f(e,i),f(e,a),f(e,s),f(e,l),f(l,u),f(l,d),h||(v=[y(c,"input",t[46]),y(d,"click",t[47])],h=!0)},p(t,e){65536&e[0]&&x(c,t[16])},d(t){t&&p(e),h=!1,r(v)}}}function ae(t){let e,n,r,o=t[18]&&!t[5].isManual&&se(t),c=t[5].isManual&&le(t),i=t[14]&&t[18]&&ue(t);return{c(){o&&o.c(),e=b(),c&&c.c(),n=b(),i&&i.c(),r=v()},m(t,a){o&&o.m(t,a),m(t,e,a),c&&c.m(t,a),m(t,n,a),i&&i.m(t,a),m(t,r,a)},p(t,a){t[18]&&!t[5].isManual?o?o.p(t,a):(o=se(t),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),t[5].isManual?c?c.p(t,a):(c=le(t),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null),t[14]&&t[18]?i?i.p(t,a):(i=ue(t),i.c(),i.m(r.parentNode,r)):i&&(i.d(1),i=null)},d(t){o&&o.d(t),t&&p(e),c&&c.d(t),t&&p(n),i&&i.d(t),t&&p(r)}}}function se(t){let e,n,o,c,i,a,s,l,u,d,h,v;return{c(){e=g("div"),n=g("textarea"),o=b(),c=g("br"),i=b(),a=g("label"),s=$("3.\n                        "),l=g("button"),l.textContent="setRemoteDescription",u=b(),d=g("button"),d.textContent="create answer",k(n,"rows","20"),k(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(r,p){m(r,e,p),f(e,n),x(n,t[18]),f(e,o),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),f(a,u),f(a,d),h||(v=[y(n,"input",t[48]),y(l,"click",t[49]),y(d,"click",t[26])],h=!0)},p(t,e){262144&e[0]&&x(n,t[18]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&p(e),h=!1,r(v)}}}function le(t){let e,n,o,c,i,a,s,l,u,d,h,v,w,C;return{c(){e=g("div"),n=g("strong"),n.textContent="MANUAL OFFER HERE",o=b(),c=g("textarea"),i=b(),a=g("br"),s=b(),l=g("label"),u=$("3.\n                        "),d=g("button"),d.textContent="setRemoteDescription",h=b(),v=g("button"),v.textContent="create answer",k(c,"rows","20"),k(c,"class","svelte-19mjatr")},m(r,p){m(r,e,p),f(e,n),f(e,o),f(e,c),x(c,t[15]),f(e,i),f(e,a),f(e,s),f(e,l),f(l,u),f(l,d),f(l,h),f(l,v),w||(C=[y(c,"input",t[50]),y(d,"click",t[51]),y(v,"click",t[26])],w=!0)},p(t,e){32768&e[0]&&x(c,t[15])},d(t){t&&p(e),w=!1,r(C)}}}function ue(t){let e,n,o,c,i,a,s,l,u,d,h,v;return{c(){e=g("div"),n=g("textarea"),o=b(),c=g("br"),i=b(),a=g("label"),s=$("4.\n                        "),l=g("button"),l.textContent="setLocalDescription",u=b(),d=g("button"),d.textContent="send answer",k(n,"rows","20"),k(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(r,p){m(r,e,p),f(e,n),x(n,t[14]),f(e,o),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),f(a,u),f(a,d),h||(v=[y(n,"input",t[52]),y(l,"click",t[53]),y(d,"click",t[28])],h=!0)},p(t,e){16384&e[0]&&x(n,t[14]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&p(e),h=!1,r(v)}}}function de(t){let e,n,r;return{c(){e=g("textarea"),k(e,"rows","10"),k(e,"class","svelte-19mjatr"),C(e,"hideSignaling",t[22])},m(o,c){m(o,e,c),x(e,t[20]),n||(r=y(e,"input",t[54]),n=!0)},p(t,n){1048576&n[0]&&x(e,t[20]),4194304&n[0]&&C(e,"hideSignaling",t[22])},d(t){t&&p(e),n=!1,r()}}}function fe(t){let e,n,r,o,c,i,a,s,l=JSON.stringify(t[21],null,4)+"";return{c(){e=g("label"),e.textContent="injected Candidates",n=b(),r=g("textarea"),o=b(),c=g("pre"),i=$(l),k(e,"for","injectedCandidates"),k(r,"name","injectedCandidates"),k(r,"rows","20"),k(r,"class","svelte-19mjatr")},m(l,u){m(l,e,u),m(l,n,u),m(l,r,u),x(r,t[4]),m(l,o,u),m(l,c,u),f(c,i),a||(s=y(r,"input",t[55]),a=!0)},p(t,e){16&e[0]&&x(r,t[4]),2097152&e[0]&&l!==(l=JSON.stringify(t[21],null,4)+"")&&w(i,l)},d(t){t&&p(e),t&&p(n),t&&p(r),t&&p(o),t&&p(c),a=!1,s()}}}function me(t){let e,n,o,c,i,a,s,l,u,d,h,v,x,C,S,_,D,R,j,E,N,T,O,M,A,L,I,B,P,U,q,J,K,Q,Y,Z,tt,et,nt,rt,ot,ct,it,at,st,lt,ut,dt,ft,mt,pt,ht,gt,$t,bt,vt,yt,kt,wt,xt,Ct,St,_t,Dt=t[5].isRemote&&Qt(t),Rt=t[5].hasUpstream&&Yt(t),jt=t[5].hasDownstream&&Zt(t);function Et(t,e){return t[8]?ee:te}let Nt=Et(t),Tt=Nt(t);j=new Kt({props:{name:t[2],peerconnection:t[7]}});let Ot=!t[22]&&ne(t),Mt=t[0]&&re(t),At=t[1]&&ae(t),Lt=(t[20].length||t[5].isManual)&&de(t),It=t[5].isManual&&fe(t);return{c(){e=g("section"),n=g("h3"),o=$(t[2]),c=b(),i=g("small"),a=$("talking to "),s=$(t[3]),l=b(),Dt&&Dt.c(),u=b(),Rt&&Rt.c(),d=b(),jt&&jt.c(),h=b(),v=g("article"),x=g("h5"),x.textContent="streams",C=b(),S=g("button"),Tt.c(),D=b(),R=g("article"),W(j.$$.fragment),E=b(),N=g("article"),T=g("h5"),T.textContent="signaling",O=b(),M=g("div"),A=g("table"),L=g("tr"),I=g("th"),I.textContent="signaling:",B=b(),P=g("td"),U=g("code"),q=$(t[10]),J=b(),K=g("tr"),Q=g("th"),Q.textContent="connection:",Y=b(),Z=g("td"),tt=g("code"),et=$(t[11]),nt=b(),rt=g("tr"),ot=g("th"),ot.textContent="ice:",ct=b(),it=g("td"),at=g("code"),st=$(t[12]),lt=b(),Ot&&Ot.c(),ut=b(),dt=g("div"),ft=g("span"),mt=g("label"),pt=g("input"),ht=$("\n                    caller"),gt=b(),$t=g("label"),bt=g("input"),vt=$("\n                    receiver"),yt=b(),Mt&&Mt.c(),kt=b(),At&&At.c(),wt=b(),Lt&&Lt.c(),xt=b(),It&&It.c(),S.disabled=_=!Boolean(t[9]),k(v,"class","box"),k(R,"class","box"),k(A,"class","vertical"),k(M,"class","box"),k(pt,"type","checkbox"),k(bt,"type","checkbox"),k(dt,"class","box"),k(N,"class","box")},m(r,p){m(r,e,p),f(e,n),f(n,o),f(n,c),f(n,i),f(i,a),f(i,s),f(e,l),Dt&&Dt.m(e,null),f(e,u),Rt&&Rt.m(e,null),f(e,d),jt&&jt.m(e,null),f(e,h),f(e,v),f(v,x),f(v,C),f(v,S),Tt.m(S,null),f(e,D),f(e,R),X(j,R,null),f(e,E),f(e,N),f(N,T),f(N,O),f(N,M),f(M,A),f(A,L),f(L,I),f(L,B),f(L,P),f(P,U),f(U,q),f(A,J),f(A,K),f(K,Q),f(K,Y),f(K,Z),f(Z,tt),f(tt,et),f(A,nt),f(A,rt),f(rt,ot),f(rt,ct),f(rt,it),f(it,at),f(at,st),f(A,lt),Ot&&Ot.m(A,null),f(N,ut),f(N,dt),f(dt,ft),f(ft,mt),f(mt,pt),pt.checked=t[0],f(mt,ht),f(ft,gt),f(ft,$t),f($t,bt),bt.checked=t[1],f($t,vt),f(N,yt),Mt&&Mt.m(N,null),f(N,kt),At&&At.m(N,null),f(N,wt),Lt&&Lt.m(N,null),f(N,xt),It&&It.m(N,null),Ct=!0,St||(_t=[y(S,"click",t[39]),y(pt,"change",t[40]),y(bt,"change",t[41])],St=!0)},p(t,n){(!Ct||4&n[0])&&w(o,t[2]),(!Ct||8&n[0])&&w(s,t[3]),t[5].isRemote?Dt?(Dt.p(t,n),32&n[0]&&z(Dt,1)):(Dt=Qt(t),Dt.c(),z(Dt,1),Dt.m(e,u)):Dt&&(F(),V(Dt,1,1,(()=>{Dt=null})),H()),t[5].hasUpstream?Rt?(Rt.p(t,n),32&n[0]&&z(Rt,1)):(Rt=Yt(t),Rt.c(),z(Rt,1),Rt.m(e,d)):Rt&&(F(),V(Rt,1,1,(()=>{Rt=null})),H()),t[5].hasDownstream?jt?(jt.p(t,n),32&n[0]&&z(jt,1)):(jt=Zt(t),jt.c(),z(jt,1),jt.m(e,h)):jt&&(F(),V(jt,1,1,(()=>{jt=null})),H()),Nt!==(Nt=Et(t))&&(Tt.d(1),Tt=Nt(t),Tt&&(Tt.c(),Tt.m(S,null))),(!Ct||512&n[0]&&_!==(_=!Boolean(t[9])))&&(S.disabled=_);const r={};4&n[0]&&(r.name=t[2]),128&n[0]&&(r.peerconnection=t[7]),j.$set(r),(!Ct||1024&n[0])&&w(q,t[10]),(!Ct||2048&n[0])&&w(et,t[11]),(!Ct||4096&n[0])&&w(st,t[12]),t[22]?Ot&&(Ot.d(1),Ot=null):Ot?Ot.p(t,n):(Ot=ne(t),Ot.c(),Ot.m(A,null)),1&n[0]&&(pt.checked=t[0]),2&n[0]&&(bt.checked=t[1]),t[0]?Mt?Mt.p(t,n):(Mt=re(t),Mt.c(),Mt.m(N,kt)):Mt&&(Mt.d(1),Mt=null),t[1]?At?At.p(t,n):(At=ae(t),At.c(),At.m(N,wt)):At&&(At.d(1),At=null),t[20].length||t[5].isManual?Lt?Lt.p(t,n):(Lt=de(t),Lt.c(),Lt.m(N,xt)):Lt&&(Lt.d(1),Lt=null),t[5].isManual?It?It.p(t,n):(It=fe(t),It.c(),It.m(N,null)):It&&(It.d(1),It=null)},i(t){Ct||(z(Dt),z(Rt),z(jt),z(j.$$.fragment,t),Ct=!0)},o(t){V(Dt),V(Rt),V(jt),V(j.$$.fragment,t),Ct=!1},d(t){t&&p(e),Dt&&Dt.d(),Rt&&Rt.d(),jt&&jt.d(),Tt.d(),G(j),Ot&&Ot.d(),Mt&&Mt.d(),At&&At.d(),Lt&&Lt.d(),It&&It.d(),St=!1,r(_t)}}}function pe(t,e,n){let r,o,c,i,a,l,u,d,f,m,p;s(t,it,(t=>n(33,u=t))),s(t,pt,(t=>n(34,d=t))),s(t,ht,(t=>n(35,f=t))),s(t,ct,(t=>n(5,m=t))),s(t,gt,(t=>n(56,p=t)));let{isCaller:h=!1}=e,{isReceiver:g=!1}=e,{name:$="unnamed participant"}=e,{recipient:b=null}=e;const v=new kt({from:$,to:b}),y=(R(),(t=>(e,n)=>function(t,e,n){const r={name:t,short:e,event:n};et.update((t=>[...t,r])),it.update((n=>({...n,[t]:[...n[t]||[],e]})))}(t,e,n))($));let k,w,x,C,S="",_="",j="",N="",T="",O="",M="",A=[],L="",I="plan-b"===new URL(document.location).searchParams.get("semantic")?{sdpSemantics:"plan-b"}:{sdpSemantics:"unified-plan"};function B(t){x?(y("rt","replace track"),console.info("replace track",{sender:x}),x.replaceTrack(t.getTracks()[0])):(y("at","add track"),console.info("add track"),n(8,x=w.addTrack(t.getTracks()[0],t)))}async function P(){y("o","create offer");const t=await w.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});n(13,N=t.sdp)}async function U(t){y("l","setLocalDescription"),console.debug("localDescription ->",t);const e=t;yt($),w.setLocalDescription(e),J(),yt(b)}function q(t){y("r","setRemoteDescription");const e=xt(t);w.setRemoteDescription(e),J(),yt(b)}function J(){m.isManual?(a||[]).forEach((t=>{t&&(y("ac","addIceCandidate"),w.addIceCandidate(t))})):(console.debug(p[b]),(p[b]||[]).forEach((t=>{t&&(y("ac","addIceCandidate"),w.addIceCandidate(t))})))}function F(t){y("r","setRemoteDescription");const e=Ct(t);w.setRemoteDescription(e),yt($)}return D((()=>{n(7,w=function(){const t=new RTCPeerConnection(I);return t.ontrack=t=>{const{track:e,streams:n,transceiver:r}=t,o=n[0];k.$set({stream:o}),o.onaddtrack=()=>{y("ta","track added"),console.warn(`${$}track added to stream`,{track:e,stream:o})},"video"==e.kind&&(console.info(`${$}.ontrack`,{track:e,streams:n,kind:e.kind,transceiver:r}),e.onmute=t=>{y("tm","track muted"),console.info(`${$} track onmute`,{event:t})},e.onunmute=t=>{y("tu","track unmuted"),console.info(`${$} track onunmute`,{event:t})},e.onended=t=>{y("te","track ended"),console.debug(`${$} track onended`,{event:t})})},t.onicecandidate=({candidate:t})=>{y("lc","create candidate"),n(32,A=[...A,t]),function(t){$&&t&&(vt({from:$,candidate:t}),m.isRemote&&v.sendCandidate(t))}(t)},t.onsignalingstatechange=e=>n(10,S=t.signalingState),t.onconnectionstatechange=e=>n(11,_=t.connectionState),t.oniceconnectionstatechange=e=>n(12,j=t.iceConnectionState),console.info(`setup RTCPeerConnection for ${$}`,I,t),t}()),gt.subscribe((({[b]:t})=>{t&&y("rc")})),m.hasCaller&&P()})),t.$$set=t=>{"isCaller"in t&&n(0,h=t.isCaller),"isReceiver"in t&&n(1,g=t.isReceiver),"name"in t&&n(2,$=t.name),"recipient"in t&&n(3,b=t.recipient)},t.$$.update=()=>{4&t.$$.dirty[0]|4&t.$$.dirty[1]&&n(17,r=u[$]||[]),8&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(18,o=wt(d[b])),8&t.$$.dirty[0]|16&t.$$.dirty[1]&&n(19,c=wt(f[b])),2&t.$$.dirty[1]&&n(20,i=JSON.stringify(A)),16&t.$$.dirty[0]&&n(21,a=(t=>{try{return JSON.parse(t)}catch(e){return""!==t&&console.warn({parseError:e}),[]}})(L)),32&t.$$.dirty[0]&&n(22,l=m.hideSignaling)},[h,g,$,b,L,m,k,w,x,C,S,_,j,N,T,O,M,r,o,c,i,a,l,v,B,P,async function(){y("a","create answer");const t=await w.createAnswer();n(14,T=t.sdp)},function(){const t=xt(N);$t({from:$,offer:t}),m.isRemote&&v.sendOffer(t)},function(){const t=xt(T);bt({from:$,answer:t}),m.isRemote&&v.sendAnswer(t)},U,q,F,A,u,d,f,({detail:t})=>n(9,C=t),()=>n(9,C=void 0),function(t){E[t?"unshift":"push"]((()=>{k=t,n(6,k)}))},()=>B(C),function(){h=this.checked,n(0,h)},function(){g=this.checked,n(1,g)},function(){N=this.value,n(13,N)},()=>U(xt(N)),function(){c=this.value,n(19,c),n(35,f),n(3,b)},()=>F(c),function(){M=this.value,n(16,M)},()=>F(M),function(){o=this.value,n(18,o),n(34,d),n(3,b)},()=>q(o),function(){O=this.value,n(15,O)},()=>q(O),function(){T=this.value,n(14,T)},()=>U(Ct(T)),function(){i=this.value,n(20,i),n(32,A)},function(){L=this.value,n(4,L)}]}const he=class extends Q{constructor(t){super(),K(this,t,pe,me,c,{isCaller:0,isReceiver:1,name:2,recipient:3},[-1,-1,-1])}};function ge(t,e,n){const r=t.slice();return r[2]=e[n].name,r[3]=e[n].event,r}function $e(t){let e,n,r,o,c,i,a,s,l,u=t[2]+"",d=t[3]+"";return{c(){e=g("tr"),n=g("th"),r=$(u),o=$(":"),c=b(),i=g("td"),a=g("code"),s=$(d),l=b()},m(t,u){m(t,e,u),f(e,n),f(n,r),f(n,o),f(e,c),f(e,i),f(i,a),f(a,s),f(e,l)},p(t,e){1&e&&u!==(u=t[2]+"")&&w(r,u),1&e&&d!==(d=t[3]+"")&&w(s,d)},d(t){t&&p(e)}}}function be(e){let n,r,o,c,i,a=e[0].filter(ve),s=[];for(let t=0;t<a.length;t+=1)s[t]=$e(ge(e,a,t));return{c(){n=g("section"),r=g("h3"),r.innerHTML="Event Log <small>please open\n        <code>about://webrtc-internals</code></small>",o=b(),c=g("div"),i=g("table");for(let t=0;t<s.length;t+=1)s[t].c();k(i,"class","vertical svelte-111zlyk"),k(c,"class","box")},m(t,e){m(t,n,e),f(n,r),f(n,o),f(n,c),f(c,i);for(let t=0;t<s.length;t+=1)s[t].m(i,null)},p(t,[e]){if(1&e){let n;for(a=t[0].filter(ve),n=0;n<a.length;n+=1){const r=ge(t,a,n);s[n]?s[n].p(r,e):(s[n]=$e(r),s[n].c(),s[n].m(i,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=a.length}},i:t,o:t,d(t){t&&p(n),h(s,t)}}}const ve=t=>t.event;function ye(t,e,n){let r;return s(t,et,(t=>n(0,r=t))),Array(100).fill({name:"hendrik",event:"fun stuff"}),[r]}const ke=class extends Q{constructor(t){super(),K(this,t,ye,be,c,{})}};function we(t){let e,n;return e=new he({props:{name:"alice",isCaller:"true",recipient:"bob"}}),{c(){W(e.$$.fragment)},m(t,r){X(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function xe(t){let e,n;return e=new he({props:{name:"bob",isReceiver:"true",recipient:"alice"}}),{c(){W(e.$$.fragment)},m(t,r){X(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function Ce(t){let e,n;return e=new ke({}),{c(){W(e.$$.fragment)},m(t,r){X(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function Se(t){let e,n,r,o,c,i,a,s,l,u,d=t[0].hasCaller&&we(),h=t[0].hasReceiver&&xe(),$=!t[0].hideSignaling&&Ce();return l=new mt({}),{c(){e=g("div"),n=g("h1"),n.textContent="WebRTC Plumber",r=b(),o=g("main"),d&&d.c(),c=b(),h&&h.c(),i=b(),$&&$.c(),a=b(),s=g("aside"),W(l.$$.fragment),k(o,"class","svelte-1mx8d2d"),k(e,"class","svelte-1mx8d2d")},m(t,p){m(t,e,p),f(e,n),f(e,r),f(e,o),d&&d.m(o,null),f(o,c),h&&h.m(o,null),f(o,i),$&&$.m(o,null),f(e,a),f(e,s),X(l,s,null),u=!0},p(t,[e]){t[0].hasCaller?d?1&e&&z(d,1):(d=we(),d.c(),z(d,1),d.m(o,c)):d&&(F(),V(d,1,1,(()=>{d=null})),H()),t[0].hasReceiver?h?1&e&&z(h,1):(h=xe(),h.c(),z(h,1),h.m(o,i)):h&&(F(),V(h,1,1,(()=>{h=null})),H()),t[0].hideSignaling?$&&(F(),V($,1,1,(()=>{$=null})),H()):$?1&e&&z($,1):($=Ce(),$.c(),z($,1),$.m(o,null))},i(t){u||(z(d),z(h),z($),z(l.$$.fragment,t),u=!0)},o(t){V(d),V(h),V($),V(l.$$.fragment,t),u=!1},d(t){t&&p(e),d&&d.d(),h&&h.d(),$&&$.d(),G(l)}}}function _e(t,e,n){let r;return s(t,ct,(t=>n(0,r=t))),[r]}const De=class extends Q{constructor(t){super(),K(this,t,_e,Se,c,{})}};function Re(t,e,n){const r=t.slice();return r[26]=e[n],r[28]=n,r}function je(t){let e,n,r,o,c=(t[26].label||`micorophone ${t[28]}`)+"";function i(){return t[9](t[26])}return{c(){e=g("button"),n=$(c)},m(t,c){m(t,e,c),f(e,n),r||(o=y(e,"click",i),r=!0)},p(e,r){t=e,4&r&&c!==(c=(t[26].label||`micorophone ${t[28]}`)+"")&&w(n,c)},d(t){t&&p(e),r=!1,o()}}}function Ee(e){let n,o,c,i,a,s,l,u,d,$,v,w,x,C,S,_,D,R=e[2],j=[];for(let t=0;t<R.length;t+=1)j[t]=je(Re(e,R,t));return{c(){n=g("h5"),n.textContent="audio devices",o=b(),c=g("audio"),c.innerHTML='<track kind="captions"/>',i=b(),a=g("nav");for(let t=0;t<j.length;t+=1)j[t].c();s=b(),l=g("hr"),u=b(),d=g("button"),d.textContent="pluginStream",$=b(),v=g("button"),v.textContent="start drawing",w=b(),x=g("button"),x.textContent="stop drawing",C=b(),S=g("canvas"),k(c,"id","upstream"),c.autoplay="false",c.controls="true"},m(t,r){m(t,n,r),m(t,o,r),m(t,c,r),e[8](c),m(t,i,r),m(t,a,r);for(let t=0;t<j.length;t+=1)j[t].m(a,null);f(a,s),f(a,l),f(a,u),f(a,d),f(a,$),f(a,v),f(a,w),f(a,x),m(t,C,r),m(t,S,r),e[13](S),_||(D=[y(d,"click",e[10]),y(v,"click",e[11]),y(x,"click",e[12])],_=!0)},p(t,[e]){if(20&e){let n;for(R=t[2],n=0;n<R.length;n+=1){const r=Re(t,R,n);j[n]?j[n].p(r,e):(j[n]=je(r),j[n].c(),j[n].m(a,s))}for(;n<j.length;n+=1)j[n].d(1);j.length=R.length}},i:t,o:t,d(t){t&&p(n),t&&p(o),t&&p(c),e[8](null),t&&p(i),t&&p(a),h(j,t),t&&p(C),t&&p(S),e[13](null),_=!1,r(D)}}}function Ne(t,e,n){const r=R();let o,c,i,a,s,l,u,d,f=[],m=!1;async function p(){const t=await navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"audioinput"===t)))}async function h(t){const e=await async function(t){const e={audio:!t||{deviceId:t}};return await navigator.mediaDevices.getUserMedia(e)}(t);e.name=function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t),function(t){n(1,c=t),n(0,o.srcObject=t,o),r("stream",t)}(e)}function g(t){s.createMediaStreamSource(t).connect(l)}function $(){m||(m=!0,requestAnimationFrame(v))}function b(){m=!1,requestAnimationFrame(v)}function v(){m&&requestAnimationFrame(v),l.getByteTimeDomainData(d),l.getByteTimeDomainData(d),a.fillStyle="rgb(200, 200, 200)",a.fillRect(0,0,i.width,i.height),a.lineWidth=2,a.strokeStyle="rgb(0, 0, 0)",a.beginPath();let t=1*i.width/u,e=0;for(let n=0;n<u;n++){const r=d[n]/128*i.height/2;0===n?a.moveTo(e,r):a.lineTo(e,r),e+=t}a.lineTo(i.width,i.height/2),a.stroke()}return D((()=>{p(),navigator.mediaDevices.addEventListener("devicechange",(t=>{navigator.mediaDevices.enumerateDevices().then((t=>p()))})),a=i.getContext("2d"),s||(s=new AudioContext,l=s.createAnalyser(),l.fftSize=2048,u=l.frequencyBinCount,d=new Uint8Array(u))})),[o,c,f,i,h,g,$,b,function(t){E[t?"unshift":"push"]((()=>{o=t,n(0,o)}))},t=>h(t.deviceId),()=>g(c),()=>$(),()=>b(),function(t){E[t?"unshift":"push"]((()=>{i=t,n(3,i)}))}]}const Te=class extends Q{constructor(t){super(),K(this,t,Ne,Ee,c,{})}};function Oe(t){let e,n;return e=new De({}),{c(){W(e.$$.fragment)},m(t,r){X(e,t,r),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function Me(t){let e,n,r;return n=new Te({}),{c(){e=g("article"),W(n.$$.fragment),k(e,"class","box")},m(t,o){m(t,e,o),X(n,e,null),r=!0},i(t){r||(z(n.$$.fragment,t),r=!0)},o(t){V(n.$$.fragment,t),r=!1},d(t){t&&p(e),G(n)}}}function Ae(t){let e,n,r,o;const c=[Me,Oe],i=[];function a(t,e){return t[0].audioVisOnly?0:1}return e=a(t),n=i[e]=c[e](t),{c(){n.c(),r=v()},m(t,n){i[e].m(t,n),m(t,r,n),o=!0},p(t,[o]){let s=e;e=a(t),e!==s&&(F(),V(i[s],1,1,(()=>{i[s]=null})),H(),n=i[e],n||(n=i[e]=c[e](t),n.c()),z(n,1),n.m(r.parentNode,r))},i(t){o||(z(n),o=!0)},o(t){V(n),o=!1},d(t){i[e].d(t),t&&p(r)}}}function Le(t,e,n){let r;return s(t,ct,(t=>n(0,r=t))),[r]}const Ie=new class extends Q{constructor(t){super(),K(this,t,Le,Ae,c,{})}}({target:document.body,props:{}});window.app=Ie})();