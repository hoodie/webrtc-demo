(()=>{"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function i(t){t.forEach(e)}function o(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t){return 0===Object.keys(t).length}function a(e,...n){if(null==e)return t;const i=e.subscribe(...n);return i.unsubscribe?()=>i.unsubscribe():i}function s(t,e,n){t.$$.on_destroy.push(a(e,n))}new Set;let l,u=!1;function d(t,e){t.appendChild(e)}function f(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function h(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function g(t){return document.createTextNode(t)}function $(){return g(" ")}function v(){return g("")}function b(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function k(t){return""===t?null:+t}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function x(t,e){t.value=null==e?"":e}function C(t,e,n){t.classList[n?"add":"remove"](e)}function S(t){l=t}function E(){if(!l)throw new Error("Function called outside component initialization");return l}function T(t){E().$$.on_mount.push(t)}function R(){const t=E();return(e,n)=>{const i=t.$$.callbacks[e];if(i){const o=function(t,e,n=!1){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,!1,e),i}(e,n);i.slice().forEach((e=>{e.call(t,o)}))}}}new Set;const L=[],D=[],_=[],A=[],O=Promise.resolve();let j=!1;function M(t){_.push(t)}function N(t){A.push(t)}let I=!1;const P=new Set;function F(){if(!I){I=!0;do{for(let t=0;t<L.length;t+=1){const e=L[t];S(e),B(e.$$)}for(S(null),L.length=0;D.length;)D.pop()();for(let t=0;t<_.length;t+=1){const e=_[t];P.has(e)||(P.add(e),e())}_.length=0}while(L.length);for(;A.length;)A.pop()();j=!1,I=!1,P.clear()}}function B(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const q=new Set;let U,J;function W(){U={r:0,c:[],p:U}}function H(){U.r||i(U.c),U=U.p}function z(t,e){t&&t.i&&(q.delete(t),t.i(e))}function V(t,e,n,i){if(t&&t.o){if(q.has(t))return;q.add(t),U.c.push((()=>{q.delete(t),i&&(n&&t.d(1),i())})),t.o(e)}}function G(t,e,n){const i=t.$$.props[e];void 0!==i&&(t.$$.bound[i]=n,n(t.$$.ctx[i]))}function X(t){t&&t.c()}function K(t,n,r,c){const{fragment:a,on_mount:s,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,r),c||M((()=>{const n=s.map(e).filter(o);l?l.push(...n):i(n),t.$$.on_mount=[]})),u.forEach(M)}function Q(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Y(e,o,r,c,a,s,d,f=[-1]){const h=l;S(e);const p=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:o.context||[]),callbacks:n(),dirty:f,skip_bound:!1,root:o.target||h.$$.root};d&&d(p.root);let g=!1;if(p.ctx=r?r(e,o.props||{},((t,n,...i)=>{const o=i.length?i[0]:n;return p.ctx&&a(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),g&&function(t,e){-1===t.$$.dirty[0]&&(L.push(t),j||(j=!0,O.then(F)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],p.update(),g=!0,i(p.before_update),p.fragment=!!c&&c(p.ctx),o.target){if(o.hydrate){u=!0;const t=($=o.target,Array.from($.childNodes));p.fragment&&p.fragment.l(t),t.forEach(m)}else p.fragment&&p.fragment.c();o.intro&&z(e.$$.fragment),K(e,o.target,o.anchor,o.customElement),u=!1,F()}var $;S(h)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(J=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(o);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){i(this.$$.on_disconnect)}$destroy(){Q(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!c(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class Z{$destroy(){Q(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!c(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const tt=[];function et(e,n=t){let i;const o=new Set;function c(t){if(r(e,t)&&(e=t,i)){const t=!tt.length;for(const t of o)t[1](),tt.push(t,e);if(t){for(let t=0;t<tt.length;t+=2)tt[t][0](tt[t+1]);tt.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(r,a=t){const s=[r,a];return o.add(s),1===o.size&&(i=n(c)||t),r(e),()=>{o.delete(s),0===o.size&&(i(),i=null)}}}}function nt(e,n,r){const c=!Array.isArray(e),s=c?[e]:e,l=n.length<2;return{subscribe:et(r,(e=>{let r=!1;const u=[];let d=0,f=t;const m=()=>{if(d)return;f();const i=n(c?u[0]:u,e);l?e(i):f=o(i)?i:t},h=s.map(((t,e)=>a(t,(t=>{u[e]=t,d&=~(1<<e),r&&m()}),(()=>{d|=1<<e}))));return r=!0,m(),function(){i(h),f()}})).subscribe}}const it=et([]),ot=t=>{try{return!0===JSON.parse(t)}catch{return!1}},rt=et((()=>{const t=Object.fromEntries(new URLSearchParams(location.search).entries()),e={role:t.role||"both",stream:t.stream||"both",autoSignal:ot(t.autoSignal),audioVisOnly:ot(t.audioVisOnly),manual:ot(t.manual),remote:ot(t.remote),hideSignaling:ot(t.hideSignaling),hideEvents:ot(t.hideEvents)};return Object.entries(e).map((([t,e])=>({key:t,value:e})))})()),ct=nt(rt,(t=>`${window.origin}${window.location.pathname}?${(t=>{const e=new URLSearchParams;for(let[n,i]of t)e.set(n,i);return e.toString()})(t.map((({key:t,value:e})=>[t,e])))}`)),at=nt(rt,(t=>{const e=Object.fromEntries(t.map((({key:t,value:e})=>[t,e])));let{role:n,stream:i,manual:o,remote:r,hideSignaling:c,hideEvents:a,autoSignal:s}=e;const l="recv"!==n,u="call"!==n&&"send"!==n||!1,d="down"!==i||!1,f="up"!==i||!1,m=o&&"no"!==o||!1,h=r&&"no"!==r||!1,p=l?"bob":"alice",g=u?"bob":"alice";return{...e,role:n,stream:i,manual:o,remote:r,hasCaller:l,hasReceiver:u,hasUpstream:d,hasDownstream:f,autoSignal:s,isManual:m,isRemote:h,hideSignaling:c,hideEvents:a,to:p,from:g}})),st=et({});function lt(t,e,n){const i=t.slice();return i[4]=e[n].key,i[5]=e[n].value,i[6]=e,i[7]=n,i}function ut(t){let e,n,i;function o(){t[3].call(e,t[6],t[7])}return{c(){e=p("input"),y(e,"type","text")},m(r,c){f(r,e,c),x(e,t[5]),n||(i=b(e,"input",o),n=!0)},p(n,i){t=n,1&i&&e.value!==t[5]&&x(e,t[5])},d(t){t&&m(e),n=!1,i()}}}function dt(t){let e,n,i;function o(){t[2].call(e,t[6],t[7])}return{c(){e=p("input"),y(e,"type","checkbox")},m(r,c){f(r,e,c),e.checked=t[5],n||(i=b(e,"change",o),n=!0)},p(n,i){t=n,1&i&&(e.checked=t[5])},d(t){t&&m(e),n=!1,i()}}}function ft(t){let e,n,i,o,r,c,a=t[4]+"";function s(t,e){return"boolean"==typeof t[5]?dt:ut}let l=s(t),u=l(t);return{c(){e=p("tr"),n=p("td"),i=g(a),o=$(),r=p("td"),u.c(),c=$()},m(t,a){f(t,e,a),d(e,n),d(n,i),d(e,o),d(e,r),u.m(r,null),d(e,c)},p(t,e){1&e&&a!==(a=t[4]+"")&&w(i,a),l===(l=s(t))&&u?u.p(t,e):(u.d(1),u=l(t),u&&(u.c(),u.m(r,null)))},d(t){t&&m(e),u.d()}}}function mt(e){let n,i,o,r,c,a,s,l,u,v,b=e[0],k=[];for(let t=0;t<b.length;t+=1)k[t]=ft(lt(e,b,t));return{c(){n=p("details"),i=p("summary"),i.textContent="Config",o=$(),r=p("div"),c=p("table");for(let t=0;t<k.length;t+=1)k[t].c();a=$(),s=p("code"),l=p("pre"),u=p("a"),v=g(e[1]),y(i,"class","svelte-6741wn"),y(u,"href",e[1]),y(n,"class","svelte-6741wn")},m(t,e){f(t,n,e),d(n,i),d(n,o),d(n,r),d(r,c);for(let t=0;t<k.length;t+=1)k[t].m(c,null);d(r,a),d(r,s),d(s,l),d(l,u),d(u,v)},p(t,[e]){if(1&e){let n;for(b=t[0],n=0;n<b.length;n+=1){const i=lt(t,b,n);k[n]?k[n].p(i,e):(k[n]=ft(i),k[n].c(),k[n].m(c,null))}for(;n<k.length;n+=1)k[n].d(1);k.length=b.length}2&e&&w(v,t[1]),2&e&&y(u,"href",t[1])},i:t,o:t,d(t){t&&m(n),h(k,t)}}}function ht(t,e,n){let i,o;return s(t,rt,(t=>n(0,i=t))),s(t,ct,(t=>n(1,o=t))),[i,o,function(t,e){t[e].value=this.checked,rt.set(i)},function(t,e){t[e].value=this.value,rt.set(i)}]}const pt=class extends Z{constructor(t){super(),Y(this,t,ht,mt,r,{})}},gt=et({}),$t=et({}),vt=et({});function bt({from:t,offer:e}){gt.update((n=>({...n,[t]:e})))}function yt({from:t,answer:e}){$t.update((n=>({...n,[t]:e})))}function kt({from:t,candidate:e}){vt.update((n=>{const i=n[t]||[];return{...n,[t]:[...i,e]}}))}function wt({from:t}){vt.update((e=>({...e,[t]:[]})))}const xt=new EventTarget;class Ct{to;from;socket;constructor({to:t,from:e}){this.to=t,this.from=e}connect({url:t}){const e=new WebSocket(t);e.onopen=()=>{this.socket=e,this.socket.onmessage=this.received.bind(this)}}received({data:t}){const e=JSON.parse(t),{[this.to]:n,type:i}=e;console.debug("its for me!",n);const o=this.to;switch(i){case"offer":bt({from:o,offer:n});break;case"answer":yt({from:o,answer:n});break;case"candidate":kt({from:o,candidate:new RTCIceCandidate(n)})}}sendOffer(t){if(t){const e={[this.from]:t,type:"offer"};this.send(e)}}sendAnswer(t){if(t){const e={[this.from]:t,type:"answer"};this.send(e)}}sendCandidate(t){if(t){const e={[this.from]:t,type:"candidate"};this.send(e)}}send(t){if(this.socket){const e=JSON.stringify(t);this.socket.send(e)}}toString(){return`[Signaling Server calling ${this.from} ‚Üí ${this.to}]`}}const St=t=>"string"==typeof t?JSON.parse(t).sdp:"object"==typeof t?t.sdp:void 0,Et=t=>({type:"offer",sdp:t}),Tt=t=>({type:"answer",sdp:t});function Rt(e){let n,i,o,r,c,a,s,l,u=JSON.stringify(e[2],null,4)+"";return{c(){n=p("details"),i=p("summary"),o=g(e[1]),r=$(),c=p("pre"),a=p("code"),s=g(u),n.open=l=Boolean(e[2])&&e[0]},m(t,e){f(t,n,e),d(n,i),d(i,o),d(n,r),d(n,c),d(c,a),d(a,s)},p(t,[e]){2&e&&w(o,t[1]),4&e&&u!==(u=JSON.stringify(t[2],null,4)+"")&&w(s,u),5&e&&l!==(l=Boolean(t[2])&&t[0])&&(n.open=l)},i:t,o:t,d(t){t&&m(n)}}}function Lt(t,e,n){let{open:i=!0}=e,{summary:o="???"}=e,{data:r}=e;return t.$$set=t=>{"open"in t&&n(0,i=t.open),"summary"in t&&n(1,o=t.summary),"data"in t&&n(2,r=t.data)},[i,o,r]}const Dt=class extends Z{constructor(t){super(),Y(this,t,Lt,Rt,r,{open:0,summary:1,data:2})}};function _t(t,e,n){const i=t.slice();return i[27]=e[n],i}function At(t,e,n){const i=t.slice();return i[30]=e[n],i[32]=n,i}function Ot(t){let e,n,i,o,r,c=(t[30].label||`camera ${t[32]}`)+"";function a(){return t[18](t[30])}return{c(){e=p("button"),n=g(c),i=$(),y(e,"class","svelte-vk2oy1")},m(t,c){f(t,e,c),d(e,n),d(e,i),o||(r=b(e,"click",a),o=!0)},p(e,i){t=e,4&i[0]&&c!==(c=(t[30].label||`camera ${t[32]}`)+"")&&w(n,c)},d(t){t&&m(e),o=!1,r()}}}function jt(t){let e;return{c(){e=g("‚úîÔ∏è")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Mt(t){let e;return{c(){e=g("(canvas)")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Nt(t){let e,n,o,r,c,a,s,l,u,h,v,k,x,C,S,E,T,R=t[27].name+"",L=t[9](t[27]),D=t[0]===t[27]&&jt();function _(){return t[19](t[27])}function A(){return t[20](t[27])}function O(){return t[21](t[27])}let j=L&&Mt();return{c(){e=p("tr"),n=p("td"),D&&D.c(),o=$(),r=p("td"),c=p("button"),a=g(R),s=$(),l=p("td"),u=p("button"),u.textContent="stop",h=$(),v=p("td"),k=p("button"),k.textContent="X",x=$(),C=p("td"),j&&j.c(),S=$(),y(c,"class","svelte-vk2oy1"),y(u,"class","svelte-vk2oy1"),y(k,"class","svelte-vk2oy1")},m(t,i){f(t,e,i),d(e,n),D&&D.m(n,null),d(e,o),d(e,r),d(r,c),d(c,a),d(e,s),d(e,l),d(l,u),d(e,h),d(e,v),d(v,k),d(e,x),d(e,C),j&&j.m(C,null),d(e,S),E||(T=[b(c,"click",_),b(u,"click",A),b(k,"click",O)],E=!0)},p(e,i){(t=e)[0]===t[27]?D||(D=jt(),D.c(),D.m(n,null)):D&&(D.d(1),D=null),8&i[0]&&R!==(R=t[27].name+"")&&w(a,R),8&i[0]&&(L=t[9](t[27])),L?j||(j=Mt(),j.c(),j.m(C,null)):j&&(j.d(1),j=null)},d(t){t&&m(e),D&&D.d(),j&&j.d(),E=!1,i(T)}}}function It(t){let e,n,i,o,r,c,a,s,l,u,h,v,b,y,k,x,C,S,E,T=t[8].readyState+"";return x=new Dt({props:{summary:"settings",data:t[8].getSettings()}}),S=new Dt({props:{summary:"constraints",data:t[8].getConstraints()}}),{c(){e=p("details"),n=p("summary"),i=g(t[7]),o=g(" / "),r=g(t[6]),c=g(" / "),a=g(t[5]),s=g("/ "),l=g(t[4]),u=$(),h=p("dl"),v=p("dt"),v.textContent="readState",b=p("dd"),y=g(T),k=$(),X(x.$$.fragment),C=$(),X(S.$$.fragment)},m(t,m){f(t,e,m),d(e,n),d(n,i),d(n,o),d(n,r),d(n,c),d(n,a),d(n,s),d(n,l),d(e,u),d(e,h),d(h,v),d(h,b),d(b,y),d(e,k),K(x,e,null),d(e,C),K(S,e,null),E=!0},p(t,e){(!E||128&e[0])&&w(i,t[7]),(!E||64&e[0])&&w(r,t[6]),(!E||32&e[0])&&w(a,t[5]),(!E||16&e[0])&&w(l,t[4]),(!E||256&e[0])&&T!==(T=t[8].readyState+"")&&w(y,T);const n={};256&e[0]&&(n.data=t[8].getSettings()),x.$set(n);const o={};256&e[0]&&(o.data=t[8].getConstraints()),S.$set(o)},i(t){E||(z(x.$$.fragment,t),z(S.$$.fragment,t),E=!0)},o(t){V(x.$$.fragment,t),V(S.$$.fragment,t),E=!1},d(t){t&&m(e),Q(x),Q(S)}}}function Pt(t){let e,n,o,r,c,a,s,l,u,g,k,w,x,C,S,E,T,R,L=t[2],D=[];for(let e=0;e<L.length;e+=1)D[e]=Ot(At(t,L,e));let _=t[3],A=[];for(let e=0;e<_.length;e+=1)A[e]=Nt(_t(t,_,e));let O=t[8]&&It(t);return{c(){e=p("h5"),e.textContent="upstream",n=$(),o=p("video"),o.innerHTML='<track kind="captions"/>',r=$(),c=p("nav"),a=p("button"),a.textContent="default",s=$(),l=p("button"),l.textContent="noise",u=$(),g=p("br"),k=$();for(let t=0;t<D.length;t+=1)D[t].c();w=$(),x=p("table");for(let t=0;t<A.length;t+=1)A[t].c();C=$(),O&&O.c(),S=v(),y(o,"id","upstream"),o.autoplay="true",y(o,"class","svelte-vk2oy1"),y(a,"class","svelte-vk2oy1"),y(l,"class","svelte-vk2oy1"),y(c,"class","svelte-vk2oy1")},m(i,m){f(i,e,m),f(i,n,m),f(i,o,m),t[15](o),f(i,r,m),f(i,c,m),d(c,a),d(c,s),d(c,l),d(c,u),d(c,g),d(c,k);for(let t=0;t<D.length;t+=1)D[t].m(c,null);f(i,w,m),f(i,x,m);for(let t=0;t<A.length;t+=1)A[t].m(x,null);f(i,C,m),O&&O.m(i,m),f(i,S,m),E=!0,T||(R=[b(a,"click",t[16]),b(l,"click",t[17])],T=!0)},p(t,e){if(2052&e[0]){let n;for(L=t[2],n=0;n<L.length;n+=1){const i=At(t,L,n);D[n]?D[n].p(i,e):(D[n]=Ot(i),D[n].c(),D[n].m(c,null))}for(;n<D.length;n+=1)D[n].d(1);D.length=L.length}if(29193&e[0]){let n;for(_=t[3],n=0;n<_.length;n+=1){const i=_t(t,_,n);A[n]?A[n].p(i,e):(A[n]=Nt(i),A[n].c(),A[n].m(x,null))}for(;n<A.length;n+=1)A[n].d(1);A.length=_.length}t[8]?O?(O.p(t,e),256&e[0]&&z(O,1)):(O=It(t),O.c(),z(O,1),O.m(S.parentNode,S)):O&&(W(),V(O,1,1,(()=>{O=null})),H())},i(t){E||(z(O),E=!0)},o(t){V(O),E=!1},d(a){a&&m(e),a&&m(n),a&&m(o),t[15](null),a&&m(r),a&&m(c),h(D,a),a&&m(w),a&&m(x),h(A,a),a&&m(C),O&&O.d(a),a&&m(S),T=!1,i(R)}}}function Ft(t,e,n){let i,o,r,c,a;var s=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function c(t){try{s(i.next(t))}catch(t){r(t)}}function a(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((i=i.apply(t,e||[])).next())}))};const l=R();let u,d,f=[],m=[];function h(){return s(this,void 0,void 0,(function*(){const t=yield function(){let t=Object.assign(document.createElement("canvas"),{width:400,height:300}),e=t.getContext("2d");e.fillRect(0,0,t.width,t.height);let n=e.getImageData(0,0,t.width,t.height);return requestAnimationFrame((function t(){for(var i=0;i<n.data.length;i++)n.data[i++]=n.data[i++]=n.data[i++]=255*Math.random();e.putImageData(n,0,0),requestAnimationFrame(t)})),t.captureStream(60)}();t.name="noise feed",g(t),n(3,m=[...m,t])}))}function p(t){return s(this,void 0,void 0,(function*(){const e=yield function(t){return s(this,void 0,void 0,(function*(){const e={video:!t||{deviceId:t}};return yield navigator.mediaDevices.getUserMedia(e)}))}(t);e.name=t?function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t):"default webcam",g(e),n(3,m=[...m,e])}))}function g(t){n(0,d=t),n(1,u.srcObject=t,u),l("stream",t)}function $(t){t.getTracks().forEach((t=>t.stop())),l("stop",t)}function v(t){$(t),n(3,m=[...m.filter((e=>e!=t))]),d===t&&n(0,d=void 0)}function b(){return s(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"videoinput"===t)))}))}return T((()=>{b();const t=()=>b();return navigator.mediaDevices.addEventListener("devicechange",t),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),t.$$.update=()=>{1&t.$$.dirty[0]&&n(8,i=d&&d.getTracks()[0]),1&t.$$.dirty[0]&&n(7,o=d&&d.constructor.name),1&t.$$.dirty[0]&&n(6,r=d&&d.getTracks()[0].constructor.name),1&t.$$.dirty[0]&&n(5,c=d&&d.canvas),1&t.$$.dirty[0]&&n(4,a=d&&d.getTracks()[0].canvas)},[d,u,f,m,a,c,r,o,i,t=>"CanvasCaptureMediaStream"===(null==t?void 0:t.constructor.name)||"CanvasCaptureMediaStreamTrack"===(null==t?void 0:t.getTracks()[0].constructor.name),h,p,g,$,v,function(t){D[t?"unshift":"push"]((()=>{u=t,n(1,u)}))},()=>p(),()=>h(),t=>p(t.deviceId),t=>g(t),t=>$(t),t=>v(t)]}const Bt=class extends Z{constructor(t){super(),Y(this,t,Ft,Pt,r,{},null,[-1,-1])}};function qt(t){let e,n,i,o;return e=new Dt({props:{summary:"settings",data:t[1].getSettings()}}),i=new Dt({props:{summary:"constraints",data:t[1].getConstraints()}}),{c(){X(e.$$.fragment),n=$(),X(i.$$.fragment)},m(t,r){K(e,t,r),f(t,n,r),K(i,t,r),o=!0},p(t,n){const o={};2&n&&(o.data=t[1].getSettings()),e.$set(o);const r={};2&n&&(r.data=t[1].getConstraints()),i.$set(r)},i(t){o||(z(e.$$.fragment,t),z(i.$$.fragment,t),o=!0)},o(t){V(e.$$.fragment,t),V(i.$$.fragment,t),o=!1},d(t){Q(e,t),t&&m(n),Q(i,t)}}}function Ut(t){let e,n,i,o,r,c,a,s=t[1]&&qt(t);return{c(){e=p("h5"),e.textContent="downstream",n=$(),i=p("video"),i.innerHTML='<track kind="captions"/>',r=$(),s&&s.c(),c=v(),i.autoplay=o=!0},m(o,l){f(o,e,l),f(o,n,l),f(o,i,l),t[3](i),f(o,r,l),s&&s.m(o,l),f(o,c,l),a=!0},p(t,[e]){t[1]?s?(s.p(t,e),2&e&&z(s,1)):(s=qt(t),s.c(),z(s,1),s.m(c.parentNode,c)):s&&(W(),V(s,1,1,(()=>{s=null})),H())},i(t){a||(z(s),a=!0)},o(t){V(s),a=!1},d(o){o&&m(e),o&&m(n),o&&m(i),t[3](null),o&&m(r),s&&s.d(o),o&&m(c)}}}function Jt(t,e,n){let i,o,{stream:r}=e;return t.$$set=t=>{"stream"in t&&n(2,r=t.stream)},t.$$.update=()=>{4&t.$$.dirty&&n(1,i=r&&r.getTracks()[0]),5&t.$$.dirty&&o&&n(0,o.srcObject=r,o)},[o,i,r,function(t){D[t?"unshift":"push"]((()=>{o=t,n(0,o),n(2,r)}))}]}const Wt=class extends Z{constructor(t){super(),Y(this,t,Jt,Ut,r,{stream:2})}};function Ht(e){let n,o,r,c,a,s,l;return{c(){n=p("form"),o=p("input"),r=$(),c=p("code"),a=g(e[0]),y(o,"size","90"),y(o,"placeholder","ws url")},m(t,i){var u;f(t,n,i),d(n,o),x(o,e[1]),f(t,r,i),f(t,c,i),d(c,a),s||(l=[b(o,"input",e[2]),b(n,"submit",(u=zt,function(t){return t.preventDefault(),u.call(this,t)}))],s=!0)},p(t,[e]){2&e&&o.value!==t[1]&&x(o,t[1]),1&e&&w(a,t[0])},i:t,o:t,d(t){t&&m(n),t&&m(r),t&&m(c),s=!1,i(l)}}}function zt(){}function Vt(t,e,n){let i,{signalingClient:o}=e;return t.$$set=t=>{"signalingClient"in t&&n(0,o=t.signalingClient)},t.$$.update=()=>{3&t.$$.dirty&&(o.connect({url:i}),window.client=o)},n(1,i=`wss://${window.location.host}/signaling/test`),[o,i,function(){i=this.value,n(1,i)}]}const Gt=class extends Z{constructor(t){super(),Y(this,t,Vt,Ht,r,{signalingClient:0})}};function Xt(t,e,n){const i=t.slice();return i[6]=e[n][0],i[7]=e[n][1],i}function Kt(t){let e,n,i=t[0],o=[];for(let e=0;e<i.length;e+=1)o[e]=Qt(Xt(t,i,e));const r=t=>V(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=v()},m(t,i){for(let e=0;e<o.length;e+=1)o[e].m(t,i);f(t,e,i),n=!0},p(t,n){if(3&n){let c;for(i=t[0],c=0;c<i.length;c+=1){const r=Xt(t,i,c);o[c]?(o[c].p(r,n),z(o[c],1)):(o[c]=Qt(r),o[c].c(),z(o[c],1),o[c].m(e.parentNode,e))}for(W(),c=i.length;c<o.length;c+=1)r(c);H()}},i(t){if(!n){for(let t=0;t<i.length;t+=1)z(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)V(o[t]);n=!1},d(t){h(o,t),t&&m(e)}}}function Qt(t){let e,n,r,c,a,s,l,u,h,v,k,x,C,S,E,T,R,L,D,_,A,O,j,M,N,I,P,F,B,q=`transceiver ${t[7].mid}`,U=t[7].mid+"",J=t[7].sender.track+"";function W(){return t[4](t[6])}return _=new Dt({props:{summary:"details",data:t[7],open:!1}}),{c(){e=p("div"),n=p("div"),r=g(q),c=$(),a=p("table"),s=p("tr"),l=p("th"),l.textContent="mid",u=$(),h=p("td"),v=p("code"),k=g(U),x=$(),C=p("tr"),S=p("th"),S.textContent="track",E=$(),T=p("td"),R=p("code"),L=g(J),D=$(),X(_.$$.fragment),A=$(),O=p("div"),j=p("button"),j.textContent="replaceTrack",M=$(),N=p("button"),N.textContent="replaceTrack(null)",I=$(),y(j,"class","btn-small"),y(N,"class","btn-small"),y(e,"class","grid box svelte-1nbk03h")},m(i,m){f(i,e,m),d(e,n),d(n,r),d(n,c),d(n,a),d(a,s),d(s,l),d(s,u),d(s,h),d(h,v),d(v,k),d(a,x),d(a,C),d(C,S),d(C,E),d(C,T),d(T,R),d(R,L),d(n,D),K(_,n,null),d(e,A),d(e,O),d(O,j),d(O,M),d(O,N),d(e,I),P=!0,F||(B=[b(j,"click",(function(){o(t[1](t[6].sender))&&t[1](t[6].sender).apply(this,arguments)})),b(N,"click",W)],F=!0)},p(e,n){t=e,(!P||1&n)&&q!==(q=`transceiver ${t[7].mid}`)&&w(r,q),(!P||1&n)&&U!==(U=t[7].mid+"")&&w(k,U),(!P||1&n)&&J!==(J=t[7].sender.track+"")&&w(L,J);const i={};1&n&&(i.data=t[7]),_.$set(i)},i(t){P||(z(_.$$.fragment,t),P=!0)},o(t){V(_.$$.fragment,t),P=!1},d(t){t&&m(e),Q(_),F=!1,i(B)}}}function Yt(t){let e,n,i,o,r=t[0]&&Kt(t);return{c(){e=p("h5"),e.textContent="transceivers",n=$(),r&&r.c(),i=v()},m(t,c){f(t,e,c),f(t,n,c),r&&r.m(t,c),f(t,i,c),o=!0},p(t,[e]){t[0]?r?(r.p(t,e),1&e&&z(r,1)):(r=Kt(t),r.c(),z(r,1),r.m(i.parentNode,i)):r&&(W(),V(r,1,1,(()=>{r=null})),H())},i(t){o||(z(r),o=!0)},o(t){V(r),o=!1},d(t){t&&m(e),t&&m(n),r&&r.d(t),t&&m(i)}}}function Zt(t,e,n){let i,o,{peerconnection:r}=e,{streamSource:c}=e;return T((()=>{const t=setInterval((()=>{i&&n(0,o=i.map((t=>{const{mid:e,direction:n,currentDirection:i,stopped:o,sender:r,receiver:c}=t;let a={},s={};{let{dtmf:t,track:e,transport:n}=r;a={dtmf:t,track:e,transport:n,parameters:r.getParameters&&r.getParameters()}}{let{dtmf:t,track:e,transport:n}=c;s={dtmf:t,track:e,transport:n,parameters:c.getParameters&&c.getParameters(),csrcs:c.getContributingSources(),ssrcs:c.getSynchronizationSources()}}return[t,{mid:e,direction:n,currentDirection:i,stopped:o,sender:a,receiver:s}]})))}),1e3);return()=>clearInterval(t)})),t.$$set=t=>{"peerconnection"in t&&n(2,r=t.peerconnection),"streamSource"in t&&n(3,c=t.streamSource)},t.$$.update=()=>{4&t.$$.dirty&&(i=r&&r.getTransceivers())},[o,function(t){return()=>{const e=c().getTracks()[0];e&&t.replaceTrack(e)}},r,c,t=>t.sender.replaceTrack(null)]}const te=class extends Z{constructor(t){super(),Y(this,t,Zt,Yt,r,{peerconnection:2,streamSource:3})}};function ee(e){let n,i,o,r,c,a,s,l,u,h,v,k,S,E,T,R,L,D,_,A,O=e[4].join(", ")+"";return{c(){n=p("div"),i=p("textarea"),o=$(),r=p("div"),c=p("table"),a=p("tr"),s=p("th"),s.textContent="mlines",l=$(),u=p("td"),h=p("code"),v=g(e[5]),k=$(),S=p("tr"),E=p("th"),E.textContent="directions",T=$(),R=p("td"),L=p("code"),D=g(O),y(i,"rows",e[1]),y(i,"name",e[2]),y(i,"class","svelte-cn7s01"),C(i,"hideSignaling",e[3]),y(c,"class","vertical"),y(r,"class","box")},m(t,m){f(t,n,m),d(n,i),x(i,e[0]),d(n,o),d(n,r),d(r,c),d(c,a),d(a,s),d(a,l),d(a,u),d(u,h),d(h,v),d(c,k),d(c,S),d(S,E),d(S,T),d(S,R),d(R,L),d(L,D),_||(A=b(i,"input",e[7]),_=!0)},p(t,[e]){2&e&&y(i,"rows",t[1]),4&e&&y(i,"name",t[2]),1&e&&x(i,t[0]),8&e&&C(i,"hideSignaling",t[3]),32&e&&w(v,t[5]),16&e&&O!==(O=t[4].join(", ")+"")&&w(D,O)},i:t,o:t,d(t){t&&m(n),_=!1,A()}}}function ne(t,e,n){let i,o,r,{value:c}=e,{rows:a}=e,{name:s}=e,{hideSignaling:l}=e;return t.$$set=t=>{"value"in t&&n(0,c=t.value),"rows"in t&&n(1,a=t.rows),"name"in t&&n(2,s=t.name),"hideSignaling"in t&&n(3,l=t.hideSignaling)},t.$$.update=()=>{1&t.$$.dirty&&n(6,i=c.split("\n")),64&t.$$.dirty&&n(5,o=i.filter((t=>t.startsWith("m="))).length),64&t.$$.dirty&&n(4,r=Array.from(i.filter((t=>t.startsWith("a=sendrecv")||t.startsWith("a=sendonly")||t.startsWith("a=recvonly")||t.startsWith("a=inactive"))),(t=>null==t?void 0:t.slice(2))))},[c,a,s,l,r,o,i,function(){c=this.value,n(0,c)}]}const ie=class extends Z{constructor(t){super(),Y(this,t,ne,ee,r,{value:0,rows:1,name:2,hideSignaling:3})}};function oe(e){let n,i;return n=new Gt({props:{signalingClient:e[26]}}),{c(){X(n.$$.fragment)},m(t,e){K(n,t,e),i=!0},p:t,i(t){i||(z(n.$$.fragment,t),i=!0)},o(t){V(n.$$.fragment,t),i=!1},d(t){Q(n,t)}}}function re(e){let n,i,o;return i=new Bt({}),i.$on("stream",e[40]),i.$on("stop",e[41]),{c(){n=p("article"),X(i.$$.fragment),y(n,"id","upstream"),y(n,"class","box")},m(t,e){f(t,n,e),K(i,n,null),o=!0},p:t,i(t){o||(z(i.$$.fragment,t),o=!0)},o(t){V(i.$$.fragment,t),o=!1},d(t){t&&m(n),Q(i)}}}function ce(t){let e,n,i;return n=new Wt({props:{stream:void 0}}),t[42](n),{c(){e=p("article"),X(n.$$.fragment),y(e,"id","downstream"),y(e,"class","box")},m(t,o){f(t,e,o),K(n,e,null),i=!0},p(t,e){n.$set({})},i(t){i||(z(n.$$.fragment,t),i=!0)},o(t){V(n.$$.fragment,t),i=!1},d(i){i&&m(e),t[42](null),Q(n)}}}function ae(t){let e;return{c(){e=g("addStream")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function se(t){let e;return{c(){e=g("replaceTrack")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function le(t){let e,n,i,o,r=t[9].name+"";return{c(){e=p("small"),n=p("code"),i=p("pre"),o=g(r)},m(t,r){f(t,e,r),d(e,n),d(n,i),d(i,o)},p(t,e){512&e[0]&&r!==(r=t[9].name+"")&&w(o,r)},d(t){t&&m(e)}}}function ue(t){let e,n,i,o,r,c,a,s=t[25].join(" ")+"";return{c(){e=p("tr"),n=p("th"),n.textContent="events:",i=$(),o=p("td"),r=p("code"),c=p("small"),a=g(s)},m(t,s){f(t,e,s),d(e,n),d(e,i),d(e,o),d(o,r),d(r,c),d(c,a)},p(t,e){33554432&e[0]&&s!==(s=t[25].join(" ")+"")&&w(a,s)},d(t){t&&m(e)}}}function de(t){let e,n,i,o,r,c,a,s,l,u,h,y,k=t[22]&&fe(t),w=t[14]&&me(t),x=t[23]&&!t[5].isManual&&he(t),C=t[5].isManual&&pe(t);return{c(){k&&k.c(),e=$(),n=p("label"),i=g("1.\n                "),o=p("button"),r=g("create offer"),c=$(),w&&w.c(),a=$(),x&&x.c(),s=$(),C&&C.c(),l=v(),o.disabled=t[22]},m(m,p){k&&k.m(m,p),f(m,e,p),f(m,n,p),d(n,i),d(n,o),d(o,r),f(m,c,p),w&&w.m(m,p),f(m,a,p),x&&x.m(m,p),f(m,s,p),C&&C.m(m,p),f(m,l,p),u=!0,h||(y=b(o,"click",t[29]),h=!0)},p(t,n){t[22]?k?k.p(t,n):(k=fe(t),k.c(),k.m(e.parentNode,e)):k&&(k.d(1),k=null),(!u||4194304&n[0])&&(o.disabled=t[22]),t[14]?w?(w.p(t,n),16384&n[0]&&z(w,1)):(w=me(t),w.c(),z(w,1),w.m(a.parentNode,a)):w&&(W(),V(w,1,1,(()=>{w=null})),H()),t[23]&&!t[5].isManual?x?(x.p(t,n),8388640&n[0]&&z(x,1)):(x=he(t),x.c(),z(x,1),x.m(s.parentNode,s)):x&&(W(),V(x,1,1,(()=>{x=null})),H()),t[5].isManual?C?(C.p(t,n),32&n[0]&&z(C,1)):(C=pe(t),C.c(),z(C,1),C.m(l.parentNode,l)):C&&(W(),V(C,1,1,(()=>{C=null})),H())},i(t){u||(z(w),z(x),z(C),u=!0)},o(t){V(w),V(x),V(C),u=!1},d(t){k&&k.d(t),t&&m(e),t&&m(n),t&&m(c),w&&w.d(t),t&&m(a),x&&x.d(t),t&&m(s),C&&C.d(t),t&&m(l),h=!1,y()}}}function fe(e){let n,i,o,r,c;return{c(){n=p("label"),i=g("0.\n                    "),o=p("button"),o.textContent="start call"},m(t,a){f(t,n,a),d(n,i),d(n,o),r||(c=b(o,"click",e[28]),r=!0)},p:t,d(t){t&&m(n),r=!1,c()}}}function me(t){let e,n,o,r,c,a,s,l,u,h,v,y,k,w,x,C;function S(e){t[48](e)}let E={hideSignaling:t[19],rows:20};return void 0!==t[14]&&(E.value=t[14]),n=new ie({props:E}),D.push((()=>G(n,"value",S))),{c(){e=p("div"),X(n.$$.fragment),r=$(),c=p("br"),a=$(),s=p("label"),l=g("2.\n                        "),u=p("button"),h=g("setLocalDescription"),v=$(),y=p("button"),k=g("send offer"),u.disabled=t[22],y.disabled=t[22]},m(i,o){f(i,e,o),K(n,e,null),d(e,r),d(e,c),d(e,a),d(e,s),d(s,l),d(s,u),d(u,h),d(s,v),d(s,y),d(y,k),w=!0,x||(C=[b(u,"click",t[49]),b(y,"click",t[31])],x=!0)},p(t,e){const i={};524288&e[0]&&(i.hideSignaling=t[19]),!o&&16384&e[0]&&(o=!0,i.value=t[14],N((()=>o=!1))),n.$set(i),(!w||4194304&e[0])&&(u.disabled=t[22]),(!w||4194304&e[0])&&(y.disabled=t[22])},i(t){w||(z(n.$$.fragment,t),w=!0)},o(t){V(n.$$.fragment,t),w=!1},d(t){t&&m(e),Q(n),x=!1,i(C)}}}function he(t){let e,n,i,o,r,c,a,s,l,u,h,v,y;function k(e){t[50](e)}let w={hideSignaling:t[19],rows:20};return void 0!==t[23]&&(w.value=t[23]),n=new ie({props:w}),D.push((()=>G(n,"value",k))),{c(){e=p("div"),X(n.$$.fragment),o=$(),r=p("br"),c=$(),a=p("label"),s=g("5.\n                        "),l=p("button"),u=g("setRemoteDescription"),l.disabled=t[22]},m(i,m){f(i,e,m),K(n,e,null),d(e,o),d(e,r),d(e,c),d(e,a),d(a,s),d(a,l),d(l,u),h=!0,v||(y=b(l,"click",t[51]),v=!0)},p(t,e){const o={};524288&e[0]&&(o.hideSignaling=t[19]),!i&&8388608&e[0]&&(i=!0,o.value=t[23],N((()=>i=!1))),n.$set(o),(!h||4194304&e[0])&&(l.disabled=t[22])},i(t){h||(z(n.$$.fragment,t),h=!0)},o(t){V(n.$$.fragment,t),h=!1},d(t){t&&m(e),Q(n),v=!1,y()}}}function pe(t){let e,n,i,o,r,c,a,s,l,u,h,v,y,k,w;function x(e){t[52](e)}let C={hideSignaling:t[19],rows:20};return void 0!==t[17]&&(C.value=t[17]),o=new ie({props:C}),D.push((()=>G(o,"value",x))),{c(){e=p("div"),n=p("strong"),n.textContent="MANUAL ANSWER HERE",i=$(),X(o.$$.fragment),c=$(),a=p("br"),s=$(),l=p("label"),u=g("5.\n                        "),h=p("button"),v=g("setRemoteDescription"),h.disabled=t[22]},m(r,m){f(r,e,m),d(e,n),d(e,i),K(o,e,null),d(e,c),d(e,a),d(e,s),d(e,l),d(l,u),d(l,h),d(h,v),y=!0,k||(w=b(h,"click",t[53]),k=!0)},p(t,e){const n={};524288&e[0]&&(n.hideSignaling=t[19]),!r&&131072&e[0]&&(r=!0,n.value=t[17],N((()=>r=!1))),o.$set(n),(!y||4194304&e[0])&&(h.disabled=t[22])},i(t){y||(z(o.$$.fragment,t),y=!0)},o(t){V(o.$$.fragment,t),y=!1},d(t){t&&m(e),Q(o),k=!1,w()}}}function ge(t){let e,n,i,o,r=t[24]&&!t[5].isManual&&$e(t),c=t[5].isManual&&ve(t),a=t[15]&&t[24]&&be(t);return{c(){r&&r.c(),e=$(),c&&c.c(),n=$(),a&&a.c(),i=v()},m(t,s){r&&r.m(t,s),f(t,e,s),c&&c.m(t,s),f(t,n,s),a&&a.m(t,s),f(t,i,s),o=!0},p(t,o){t[24]&&!t[5].isManual?r?(r.p(t,o),16777248&o[0]&&z(r,1)):(r=$e(t),r.c(),z(r,1),r.m(e.parentNode,e)):r&&(W(),V(r,1,1,(()=>{r=null})),H()),t[5].isManual?c?(c.p(t,o),32&o[0]&&z(c,1)):(c=ve(t),c.c(),z(c,1),c.m(n.parentNode,n)):c&&(W(),V(c,1,1,(()=>{c=null})),H()),t[15]&&t[24]?a?(a.p(t,o),16809984&o[0]&&z(a,1)):(a=be(t),a.c(),z(a,1),a.m(i.parentNode,i)):a&&(W(),V(a,1,1,(()=>{a=null})),H())},i(t){o||(z(r),z(c),z(a),o=!0)},o(t){V(r),V(c),V(a),o=!1},d(t){r&&r.d(t),t&&m(e),c&&c.d(t),t&&m(n),a&&a.d(t),t&&m(i)}}}function $e(t){let e,n,o,r,c,a,s,l,u,h,v,y,k,w,x,C;function S(e){t[54](e)}let E={hideSignaling:t[19],rows:20};return void 0!==t[24]&&(E.value=t[24]),n=new ie({props:E}),D.push((()=>G(n,"value",S))),{c(){e=p("div"),X(n.$$.fragment),r=$(),c=p("br"),a=$(),s=p("label"),l=g("3.\n                        "),u=p("button"),h=g("setRemoteDescription"),v=$(),y=p("button"),k=g("create answer"),u.disabled=t[22],y.disabled=t[22]},m(i,o){f(i,e,o),K(n,e,null),d(e,r),d(e,c),d(e,a),d(e,s),d(s,l),d(s,u),d(u,h),d(s,v),d(s,y),d(y,k),w=!0,x||(C=[b(u,"click",t[55]),b(y,"click",t[30])],x=!0)},p(t,e){const i={};524288&e[0]&&(i.hideSignaling=t[19]),!o&&16777216&e[0]&&(o=!0,i.value=t[24],N((()=>o=!1))),n.$set(i),(!w||4194304&e[0])&&(u.disabled=t[22]),(!w||4194304&e[0])&&(y.disabled=t[22])},i(t){w||(z(n.$$.fragment,t),w=!0)},o(t){V(n.$$.fragment,t),w=!1},d(t){t&&m(e),Q(n),x=!1,i(C)}}}function ve(t){let e,n,o,r,c,a,s,l,u,h,v,y,k,w,x,C,S,E;function T(e){t[56](e)}let R={rows:20};return void 0!==t[16]&&(R.value=t[16]),r=new ie({props:R}),D.push((()=>G(r,"value",T))),{c(){e=p("div"),n=p("strong"),n.textContent="MANUAL OFFER HERE",o=$(),X(r.$$.fragment),a=$(),s=p("br"),l=$(),u=p("label"),h=g("3.\n                        "),v=p("button"),y=g("setRemoteDescription"),k=$(),w=p("button"),x=g("create answer"),v.disabled=t[22],w.disabled=t[22]},m(i,c){f(i,e,c),d(e,n),d(e,o),K(r,e,null),d(e,a),d(e,s),d(e,l),d(e,u),d(u,h),d(u,v),d(v,y),d(u,k),d(u,w),d(w,x),C=!0,S||(E=[b(v,"click",t[57]),b(w,"click",t[30])],S=!0)},p(t,e){const n={};!c&&65536&e[0]&&(c=!0,n.value=t[16],N((()=>c=!1))),r.$set(n),(!C||4194304&e[0])&&(v.disabled=t[22]),(!C||4194304&e[0])&&(w.disabled=t[22])},i(t){C||(z(r.$$.fragment,t),C=!0)},o(t){V(r.$$.fragment,t),C=!1},d(t){t&&m(e),Q(r),S=!1,i(E)}}}function be(t){let e,n,o,r,c,a,s,l,u,h,v,y,k,w,x,C;function S(e){t[58](e)}let E={hideSignaling:t[19],rows:20};return void 0!==t[15]&&(E.value=t[15]),n=new ie({props:E}),D.push((()=>G(n,"value",S))),{c(){e=p("div"),X(n.$$.fragment),r=$(),c=p("br"),a=$(),s=p("label"),l=g("4.\n                        "),u=p("button"),h=g("setLocalDescription"),v=$(),y=p("button"),k=g("send answer"),u.disabled=t[22],y.disabled=t[22]},m(i,o){f(i,e,o),K(n,e,null),d(e,r),d(e,c),d(e,a),d(e,s),d(s,l),d(s,u),d(u,h),d(s,v),d(s,y),d(y,k),w=!0,x||(C=[b(u,"click",t[59]),b(y,"click",t[32])],x=!0)},p(t,e){const i={};524288&e[0]&&(i.hideSignaling=t[19]),!o&&32768&e[0]&&(o=!0,i.value=t[15],N((()=>o=!1))),n.$set(i),(!w||4194304&e[0])&&(u.disabled=t[22]),(!w||4194304&e[0])&&(y.disabled=t[22])},i(t){w||(z(n.$$.fragment,t),w=!0)},o(t){V(n.$$.fragment,t),w=!1},d(t){t&&m(e),Q(n),x=!1,i(C)}}}function ye(t){let e,n,i;return{c(){e=p("textarea"),y(e,"rows","10"),y(e,"class","svelte-3b0r9n"),C(e,"hideSignaling",t[19])},m(o,r){f(o,e,r),x(e,t[21]),n||(i=b(e,"input",t[60]),n=!0)},p(t,n){2097152&n[0]&&x(e,t[21]),524288&n[0]&&C(e,"hideSignaling",t[19])},d(t){t&&m(e),n=!1,i()}}}function ke(t){let e,n,i,o,r,c,a,s,l=JSON.stringify(t[20],null,4)+"";return{c(){e=p("label"),e.textContent="injected Candidates",n=$(),i=p("textarea"),o=$(),r=p("pre"),c=g(l),y(e,"for","injectedCandidates"),y(i,"name","injectedCandidates"),y(i,"rows","20"),y(i,"class","svelte-3b0r9n")},m(l,u){f(l,e,u),f(l,n,u),f(l,i,u),x(i,t[4]),f(l,o,u),f(l,r,u),d(r,c),a||(s=b(i,"input",t[61]),a=!0)},p(t,e){16&e[0]&&x(i,t[4]),1048576&e[0]&&l!==(l=JSON.stringify(t[20],null,4)+"")&&w(c,l)},d(t){t&&m(e),t&&m(n),t&&m(i),t&&m(o),t&&m(r),a=!1,s()}}}function we(t){let e,n,o,r,c,a,s,l,u,h,v,k,x,C,S,E,T,R,L,D,_,A,O,j,M,N,I,P,F,B,q,U,J,G,Y,Z,tt,et,nt,it,ot,rt,ct,at,st,lt,ut,dt,ft,mt,ht,pt,gt,$t,vt,bt,yt,kt,wt,xt,Ct,St,Et,Tt,Rt,Lt,Dt,_t,At,Ot,jt,Mt,Nt,It,Pt=t[5].isRemote&&oe(t),Ft=t[5].hasUpstream&&re(t),Bt=t[5].hasDownstream&&ce(t);function qt(t,e){return t[8]?se:ae}let Ut=qt(t),Jt=Ut(t),Wt=t[9]&&t[9].name&&le(t);L=new te({props:{peerconnection:t[7],streamSource:t[44]}});let Ht=!t[18]&&ue(t),zt=t[0]&&de(t),Vt=t[1]&&ge(t),Gt=(t[21].length||t[5].isManual)&&ye(t),Xt=t[5].isManual&&ke(t);return{c(){e=p("section"),n=p("h3"),o=g(t[2]),r=$(),c=p("small"),a=g("talking to "),s=g(t[3]),l=$(),Pt&&Pt.c(),u=$(),Ft&&Ft.c(),h=$(),Bt&&Bt.c(),v=$(),k=p("article"),x=p("h5"),x.textContent="peerconnection",C=$(),S=p("button"),Jt.c(),T=$(),Wt&&Wt.c(),R=$(),X(L.$$.fragment),D=$(),_=p("article"),A=p("h5"),A.textContent="signaling",O=$(),j=p("div"),M=p("table"),N=p("tr"),I=p("th"),I.textContent="signaling:",P=$(),F=p("td"),B=p("code"),q=g(t[10]),U=$(),J=p("tr"),G=p("th"),G.textContent="connection:",Y=$(),Z=p("td"),tt=p("code"),et=g(t[11]),nt=$(),it=p("tr"),ot=p("th"),ot.textContent="iceGathering:",rt=$(),ct=p("td"),at=p("code"),st=g(t[13]),lt=$(),ut=p("tr"),dt=p("th"),dt.textContent="iceConnection:",ft=$(),mt=p("td"),ht=p("code"),pt=g(t[12]),gt=$(),Ht&&Ht.c(),$t=$(),vt=p("div"),bt=p("span"),yt=p("label"),kt=p("input"),wt=g("\n                    caller"),xt=$(),Ct=p("label"),St=p("input"),Et=g("\n                    receiver"),Tt=$(),Rt=p("label"),Lt=p("input"),Dt=g("\n                    auto"),_t=$(),zt&&zt.c(),At=$(),Vt&&Vt.c(),Ot=$(),Gt&&Gt.c(),jt=$(),Xt&&Xt.c(),S.disabled=E=!Boolean(t[9]),y(k,"class","box"),y(M,"class","vertical"),y(j,"class","box"),y(kt,"type","checkbox"),y(St,"type","checkbox"),y(Lt,"type","checkbox"),y(vt,"class","box"),y(_,"class","box")},m(i,m){f(i,e,m),d(e,n),d(n,o),d(n,r),d(n,c),d(c,a),d(c,s),d(e,l),Pt&&Pt.m(e,null),d(e,u),Ft&&Ft.m(e,null),d(e,h),Bt&&Bt.m(e,null),d(e,v),d(e,k),d(k,x),d(k,C),d(k,S),Jt.m(S,null),d(k,T),Wt&&Wt.m(k,null),d(k,R),K(L,k,null),d(e,D),d(e,_),d(_,A),d(_,O),d(_,j),d(j,M),d(M,N),d(N,I),d(N,P),d(N,F),d(F,B),d(B,q),d(M,U),d(M,J),d(J,G),d(J,Y),d(J,Z),d(Z,tt),d(tt,et),d(M,nt),d(M,it),d(it,ot),d(it,rt),d(it,ct),d(ct,at),d(at,st),d(M,lt),d(M,ut),d(ut,dt),d(ut,ft),d(ut,mt),d(mt,ht),d(ht,pt),d(M,gt),Ht&&Ht.m(M,null),d(_,$t),d(_,vt),d(vt,bt),d(bt,yt),d(yt,kt),kt.checked=t[0],d(yt,wt),d(bt,xt),d(bt,Ct),d(Ct,St),St.checked=t[1],d(Ct,Et),d(bt,Tt),d(bt,Rt),d(Rt,Lt),Lt.checked=t[22],d(Rt,Dt),d(_,_t),zt&&zt.m(_,null),d(_,At),Vt&&Vt.m(_,null),d(_,Ot),Gt&&Gt.m(_,null),d(_,jt),Xt&&Xt.m(_,null),Mt=!0,Nt||(It=[b(S,"click",t[43]),b(kt,"change",t[45]),b(St,"change",t[46]),b(Lt,"change",t[47])],Nt=!0)},p(t,n){(!Mt||4&n[0])&&w(o,t[2]),(!Mt||8&n[0])&&w(s,t[3]),t[5].isRemote?Pt?(Pt.p(t,n),32&n[0]&&z(Pt,1)):(Pt=oe(t),Pt.c(),z(Pt,1),Pt.m(e,u)):Pt&&(W(),V(Pt,1,1,(()=>{Pt=null})),H()),t[5].hasUpstream?Ft?(Ft.p(t,n),32&n[0]&&z(Ft,1)):(Ft=re(t),Ft.c(),z(Ft,1),Ft.m(e,h)):Ft&&(W(),V(Ft,1,1,(()=>{Ft=null})),H()),t[5].hasDownstream?Bt?(Bt.p(t,n),32&n[0]&&z(Bt,1)):(Bt=ce(t),Bt.c(),z(Bt,1),Bt.m(e,v)):Bt&&(W(),V(Bt,1,1,(()=>{Bt=null})),H()),Ut!==(Ut=qt(t))&&(Jt.d(1),Jt=Ut(t),Jt&&(Jt.c(),Jt.m(S,null))),(!Mt||512&n[0]&&E!==(E=!Boolean(t[9])))&&(S.disabled=E),t[9]&&t[9].name?Wt?Wt.p(t,n):(Wt=le(t),Wt.c(),Wt.m(k,R)):Wt&&(Wt.d(1),Wt=null);const i={};128&n[0]&&(i.peerconnection=t[7]),512&n[0]&&(i.streamSource=t[44]),L.$set(i),(!Mt||1024&n[0])&&w(q,t[10]),(!Mt||2048&n[0])&&w(et,t[11]),(!Mt||8192&n[0])&&w(st,t[13]),(!Mt||4096&n[0])&&w(pt,t[12]),t[18]?Ht&&(Ht.d(1),Ht=null):Ht?Ht.p(t,n):(Ht=ue(t),Ht.c(),Ht.m(M,null)),1&n[0]&&(kt.checked=t[0]),2&n[0]&&(St.checked=t[1]),4194304&n[0]&&(Lt.checked=t[22]),t[0]?zt?(zt.p(t,n),1&n[0]&&z(zt,1)):(zt=de(t),zt.c(),z(zt,1),zt.m(_,At)):zt&&(W(),V(zt,1,1,(()=>{zt=null})),H()),t[1]?Vt?(Vt.p(t,n),2&n[0]&&z(Vt,1)):(Vt=ge(t),Vt.c(),z(Vt,1),Vt.m(_,Ot)):Vt&&(W(),V(Vt,1,1,(()=>{Vt=null})),H()),t[21].length||t[5].isManual?Gt?Gt.p(t,n):(Gt=ye(t),Gt.c(),Gt.m(_,jt)):Gt&&(Gt.d(1),Gt=null),t[5].isManual?Xt?Xt.p(t,n):(Xt=ke(t),Xt.c(),Xt.m(_,null)):Xt&&(Xt.d(1),Xt=null)},i(t){Mt||(z(Pt),z(Ft),z(Bt),z(L.$$.fragment,t),z(zt),z(Vt),Mt=!0)},o(t){V(Pt),V(Ft),V(Bt),V(L.$$.fragment,t),V(zt),V(Vt),Mt=!1},d(t){t&&m(e),Pt&&Pt.d(),Ft&&Ft.d(),Bt&&Bt.d(),Jt.d(),Wt&&Wt.d(),Q(L),Ht&&Ht.d(),zt&&zt.d(),Vt&&Vt.d(),Gt&&Gt.d(),Xt&&Xt.d(),Nt=!1,i(It)}}}function xe(t,e,n){let i,o,r,c,a,l,u,d,f,m,h,p,g;s(t,at,(t=>n(5,f=t))),s(t,vt,(t=>n(62,m=t))),s(t,$t,(t=>n(37,h=t))),s(t,gt,(t=>n(38,p=t))),s(t,st,(t=>n(39,g=t)));var $=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function c(t){try{s(i.next(t))}catch(t){r(t)}}function a(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((i=i.apply(t,e||[])).next())}))};let{isCaller:v=!1}=e,{isReceiver:b=!1}=e,{name:y="unnamed participant"}=e,{recipient:k=null}=e;const w=new Ct({from:y,to:k}),x=(t=>(e,n)=>function(t,e,n){const i={name:t,short:e,event:n,timestamp:(new Date).toISOString().split("T")[1]};it.update((t=>[...t,i])),st.update((n=>({...n,[t]:[...n[t]||[],e]})))}(t,e,n))(y);let C,S,E,R,L="",_="",A="",O="",j="";xt.addEventListener(`OfferTo:${y}`,(({detail:t})=>$(void 0,void 0,void 0,(function*(){i&&(V(St(t)),yield J(),z(Tt(M)),H())})))),xt.addEventListener(`AnswerTo:${y}`,(({detail:t})=>$(void 0,void 0,void 0,(function*(){i&&X(St(t))})))),xt.addEventListener(`CandidateTo:${y}`,(({detail:t})=>$(void 0,void 0,void 0,(function*(){i&&(yield function(t){return $(this,void 0,void 0,(function*(){x("ac","addIceCandidate"),yield S.addIceCandidate(t)}))}(t))}))));let M="",N="",I="",P=[],F="",B="plan-b"===new URL(document.location.toString()).searchParams.get("semantic")?{sdpSemantics:"plan-b"}:{sdpSemantics:"unified-plan"};function q(t){E?(x("rt","replace track"),console.info("replace track",{sender:E}),E.replaceTrack(t.getTracks()[0])):(x("at","add track"),console.info("add track"),n(8,E=S.addTrack(t.getTracks()[0],t)))}function U(){return $(this,void 0,void 0,(function*(){x("o","create offer");const t=yield S.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});n(14,j=t.sdp)}))}function J(){return $(this,void 0,void 0,(function*(){x("a","create answer");const t=yield S.createAnswer();n(15,M=t.sdp)}))}function W(){const t=Et(j);bt({from:y,offer:t}),f.isRemote&&w.sendOffer(t),xt.dispatchEvent(new CustomEvent(`OfferTo:${k}`,{detail:t}))}function H(){const t=Et(M);yt({from:y,answer:t}),f.isRemote&&w.sendAnswer(t),xt.dispatchEvent(new CustomEvent(`AnswerTo:${k}`,{detail:t}))}function z(t){return $(this,void 0,void 0,(function*(){x("l","setLocalDescription"),console.debug("localDescription ->",t);const e=t;wt({from:y}),S.setLocalDescription(e),G(),wt({from:k})}))}function V(t){x("r","setRemoteDescription");const e=Et(t);S.setRemoteDescription(e),G(),wt({from:k})}function G(){f.isManual?(l||[]).forEach((t=>{t&&(x("ac","addIceCandidate"),S.addIceCandidate(t))})):(console.debug(m[k]),(m[k]||[]).forEach((t=>{t&&(x("ac","addIceCandidate"),S.addIceCandidate(t))})))}function X(t){x("r","setRemoteDescription");const e=Tt(t);S.setRemoteDescription(e),wt({from:y})}return T((()=>{n(7,S=function(){const t=new RTCPeerConnection(B);return t.addEventListener("track",(t=>{x("pct","pc ontrack");const{track:e,streams:n,transceiver:i}=t,o=n[0];console.info(`${y}.ontrack`,{track:e,streams:n,kind:e.kind,transceiver:i}),C.$set({stream:o}),e.addEventListener("ended",(()=>{x("track ended","te"),console.info(`${y} track ended`,{event:t})})),e.addEventListener("mute",(()=>{x("track muted","mute"),console.info(`${y} track muted`,{event:t})})),e.addEventListener("unmute",(()=>{x("track unmuted","unmute"),console.info(`${y} track unmuted`,{event:t})})),o.addEventListener("addtrack",(()=>{x("stream track added","add")})),o.addEventListener("removetrack",(()=>{x("stream track removed","rem")}))})),t.addEventListener("icecandidate",(({candidate:t})=>{x("lc","create candidate"),n(36,P=[...P,t]),function(t){y&&t&&(kt({from:y,candidate:t}),f.isRemote&&w.sendCandidate(t),xt.dispatchEvent(new CustomEvent(`CandidateTo:${k}`,{detail:t})))}(t)})),t.addEventListener("signalingstatechange",(()=>n(10,L=t.signalingState))),t.addEventListener("connectionstatechange",(()=>n(11,_=t.connectionState))),t.addEventListener("iceconnectionstatechange",(()=>n(12,A=t.iceConnectionState))),t.addEventListener("icegatheringstatechange",(({target:{iceGatheringState:t}})=>n(13,O=t))),t.addEventListener("negotiationneeded",(()=>x("negotiation needed","nn"))),t.addEventListener("addstream",(t=>{x("addstream","üóëas"),console.warn("addstream",t)})),t.addEventListener("removestream",(t=>{x("removestream","üóërs"),console.warn("removestream",t)})),console.info(`setup RTCPeerConnection for ${y}`,B,t),t}()),vt.subscribe((({[k]:t})=>{t&&x("rc")})),f.hasCaller&&U()})),t.$$set=t=>{"isCaller"in t&&n(0,v=t.isCaller),"isReceiver"in t&&n(1,b=t.isReceiver),"name"in t&&n(2,y=t.name),"recipient"in t&&n(3,k=t.recipient)},t.$$.update=()=>{32&t.$$.dirty[0]&&n(22,i=f.autoSignal),4&t.$$.dirty[0]|256&t.$$.dirty[1]&&n(25,o=g[y]||[]),8&t.$$.dirty[0]|128&t.$$.dirty[1]&&n(24,r=St(p[k])),8&t.$$.dirty[0]|64&t.$$.dirty[1]&&n(23,c=St(h[k])),32&t.$$.dirty[1]&&n(21,a=JSON.stringify(P)),16&t.$$.dirty[0]&&n(20,l=(t=>{try{return JSON.parse(t)}catch(e){return""!==t&&console.warn({parseError:e}),[]}})(F)),32&t.$$.dirty[0]&&n(19,u=f.hideSignaling),32&t.$$.dirty[0]&&n(18,d=f.hideEvents)},[v,b,y,k,F,f,C,S,E,R,L,_,A,O,j,M,N,I,d,u,l,a,i,c,r,o,w,q,function(){return $(this,void 0,void 0,(function*(){yield U(),z(Et(j)),W()}))},U,J,W,H,z,V,X,P,h,p,g,({detail:t})=>n(9,R=t),()=>n(9,R=void 0),function(t){D[t?"unshift":"push"]((()=>{C=t,n(6,C)}))},()=>q(R),()=>R,function(){v=this.checked,n(0,v)},function(){b=this.checked,n(1,b)},function(){i=this.checked,n(22,i),n(5,f)},function(t){j=t,n(14,j)},()=>z(Et(j)),function(t){c=t,n(23,c),n(37,h),n(3,k)},()=>X(c),function(t){I=t,n(17,I)},()=>X(I),function(t){r=t,n(24,r),n(38,p),n(3,k)},()=>V(r),function(t){N=t,n(16,N)},()=>V(N),function(t){M=t,n(15,M)},()=>z(Tt(M)),function(){a=this.value,n(21,a),n(36,P)},function(){F=this.value,n(4,F)}]}const Ce=class extends Z{constructor(t){super(),Y(this,t,xe,we,r,{isCaller:0,isReceiver:1,name:2,recipient:3},null,[-1,-1,-1])}};function Se(t,e,n){const i=t.slice();return i[6]=e[n].name,i[7]=e[n].event,i[8]=e[n].timestamp,i}function Ee(t){let e,n,i,o,r,c,a,s,l,u,h,v,b,k=t[8]+"",x=t[6]+"",C=t[7]+"";return{c(){e=p("tr"),n=p("td"),i=p("code"),o=g(k),r=$(),c=p("th"),a=g(x),s=g(":"),l=$(),u=p("td"),h=p("code"),v=g(C),b=$(),y(i,"class","timestamp svelte-944373")},m(t,m){f(t,e,m),d(e,n),d(n,i),d(i,o),d(e,r),d(e,c),d(c,a),d(c,s),d(e,l),d(e,u),d(u,h),d(h,v),d(e,b)},p(t,e){8&e&&k!==(k=t[8]+"")&&w(o,k),8&e&&x!==(x=t[6]+"")&&w(a,x),8&e&&C!==(C=t[7]+"")&&w(v,C)},d(t){t&&m(e)}}}function Te(e){let n,o,r,c,a,s,l,u,v,C,S,E,T,R,L,D,_=e[2].length+"",A=e[3],O=[];for(let t=0;t<A.length;t+=1)O[t]=Ee(Se(e,A,t));return{c(){n=p("section"),o=p("h3"),o.innerHTML="Event Log <small>please open\n            <code>about://webrtc-internals</code></small>",r=$(),c=p("label"),a=p("input"),s=g("\n        reversed"),l=$(),u=p("label"),v=p("input"),C=g(" of "),S=g(_),E=$(),T=p("div"),R=p("table");for(let t=0;t<O.length;t+=1)O[t].c();y(a,"type","checkbox"),y(a,"name","reverse"),y(a,"id","reverse"),y(c,"for","reverse"),y(v,"type","number"),y(v,"name","length"),y(v,"id","length"),y(v,"class","svelte-944373"),y(u,"for","reverse"),y(R,"class","vertical svelte-944373"),y(T,"class","box svelte-944373")},m(t,i){f(t,n,i),d(n,o),d(n,r),d(n,c),d(c,a),a.checked=e[0],d(c,s),d(n,l),d(n,u),d(u,v),x(v,e[1]),d(u,C),d(u,S),d(n,E),d(n,T),d(T,R);for(let t=0;t<O.length;t+=1)O[t].m(R,null);L||(D=[b(a,"change",e[4]),b(v,"input",e[5])],L=!0)},p(t,[e]){if(1&e&&(a.checked=t[0]),2&e&&k(v.value)!==t[1]&&x(v,t[1]),4&e&&_!==(_=t[2].length+"")&&w(S,_),8&e){let n;for(A=t[3],n=0;n<A.length;n+=1){const i=Se(t,A,n);O[n]?O[n].p(i,e):(O[n]=Ee(i),O[n].c(),O[n].m(R,null))}for(;n<O.length;n+=1)O[n].d(1);O.length=A.length}},i:t,o:t,d(t){t&&m(n),h(O,t),L=!1,i(D)}}}function Re(t,e,n){let i,o;s(t,it,(t=>n(2,o=t)));let r=!0,c=80;return t.$$.update=()=>{7&t.$$.dirty&&n(3,i=r?o.filter((t=>t.event)).reverse().slice(0,c):o.filter((t=>t.event)).slice(0,c))},[r,c,o,i,function(){r=this.checked,n(0,r)},function(){c=k(this.value),n(1,c)}]}const Le=class extends Z{constructor(t){super(),Y(this,t,Re,Te,r,{})}};function De(t){let e,n;return e=new Ce({props:{name:"alice",isCaller:"true",recipient:"bob"}}),{c(){X(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function _e(t){let e,n;return e=new Ce({props:{name:"bob",isReceiver:"true",recipient:"alice"}}),{c(){X(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function Ae(t){let e,n;return e=new Le({}),{c(){X(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function Oe(t){let e,n,i,o,r,c,a,s,l,u;r=new pt({});let h=t[0].hasCaller&&De(),g=t[0].hasReceiver&&_e(),v=!t[0].hideEvents&&Ae();return{c(){e=p("div"),n=p("h1"),n.textContent="WebRTC Plumber",i=$(),o=p("aside"),X(r.$$.fragment),c=$(),a=p("main"),h&&h.c(),s=$(),g&&g.c(),l=$(),v&&v.c(),y(o,"class","svelte-if8jgd"),y(a,"class","svelte-if8jgd"),y(e,"class","svelte-if8jgd")},m(t,m){f(t,e,m),d(e,n),d(e,i),d(e,o),K(r,o,null),d(e,c),d(e,a),h&&h.m(a,null),d(a,s),g&&g.m(a,null),d(a,l),v&&v.m(a,null),u=!0},p(t,[e]){t[0].hasCaller?h?1&e&&z(h,1):(h=De(),h.c(),z(h,1),h.m(a,s)):h&&(W(),V(h,1,1,(()=>{h=null})),H()),t[0].hasReceiver?g?1&e&&z(g,1):(g=_e(),g.c(),z(g,1),g.m(a,l)):g&&(W(),V(g,1,1,(()=>{g=null})),H()),t[0].hideEvents?v&&(W(),V(v,1,1,(()=>{v=null})),H()):v?1&e&&z(v,1):(v=Ae(),v.c(),z(v,1),v.m(a,null))},i(t){u||(z(r.$$.fragment,t),z(h),z(g),z(v),u=!0)},o(t){V(r.$$.fragment,t),V(h),V(g),V(v),u=!1},d(t){t&&m(e),Q(r),h&&h.d(),g&&g.d(),v&&v.d()}}}function je(t,e,n){let i;return s(t,at,(t=>n(0,i=t))),[i]}const Me=class extends Z{constructor(t){super(),Y(this,t,je,Oe,r,{})}};function Ne(t,e,n){const i=t.slice();return i[33]=e[n],i}function Ie(t,e,n){const i=t.slice();return i[36]=e[n],i[38]=n,i}function Pe(t){let e,n,i,o,r=(t[36].label||`micorophone ${t[38]}`)+"";function c(){return t[13](t[36])}return{c(){e=p("button"),n=g(r),y(e,"class","svelte-2jsuhx")},m(t,r){f(t,e,r),d(e,n),i||(o=b(e,"click",c),i=!0)},p(e,i){t=e,4&i[0]&&r!==(r=(t[36].label||`micorophone ${t[38]}`)+"")&&w(n,r)},d(t){t&&m(e),i=!1,o()}}}function Fe(t){let e;return{c(){e=g("‚úîÔ∏è")},m(t,n){f(t,e,n)},d(t){t&&m(e)}}}function Be(t){let e,n,o,r,c,a,s,l,u,h,v,k,x,C,S,E=t[33].name+"",T=t[1]===t[33]&&Fe();function R(){return t[18](t[33])}function L(){return t[19](t[33])}function D(){return t[20](t[33])}return{c(){e=p("tr"),n=p("td"),T&&T.c(),o=$(),r=p("td"),c=p("button"),a=g(E),s=$(),l=p("td"),u=p("button"),u.textContent="stop",h=$(),v=p("td"),k=p("button"),k.textContent="X",x=$(),y(c,"class","svelte-2jsuhx"),y(u,"class","svelte-2jsuhx"),y(k,"class","svelte-2jsuhx")},m(t,i){f(t,e,i),d(e,n),T&&T.m(n,null),d(e,o),d(e,r),d(r,c),d(c,a),d(e,s),d(e,l),d(l,u),d(e,h),d(e,v),d(v,k),d(e,x),C||(S=[b(c,"click",R),b(u,"click",L),b(k,"click",D)],C=!0)},p(e,i){(t=e)[1]===t[33]?T||(T=Fe(),T.c(),T.m(n,null)):T&&(T.d(1),T=null),8&i[0]&&E!==(E=t[33].name+"")&&w(a,E)},d(t){t&&m(e),T&&T.d(),C=!1,i(S)}}}function qe(e){let n,o,r,c,a,s,l,u,g,v,k,w,x,C,S,E,T,R,L,D,_=e[2],A=[];for(let t=0;t<_.length;t+=1)A[t]=Pe(Ie(e,_,t));let O=e[3],j=[];for(let t=0;t<O.length;t+=1)j[t]=Be(Ne(e,O,t));return{c(){n=p("h5"),n.textContent="audio devices",o=$(),r=p("canvas"),c=$(),a=p("nav");for(let t=0;t<A.length;t+=1)A[t].c();s=$(),l=p("audio"),u=p("track"),k=$(),w=p("button"),w.textContent="bars",x=$(),C=p("button"),C.textContent="waveform",S=$(),E=p("button"),E.textContent="volume",T=$(),R=p("table");for(let t=0;t<j.length;t+=1)j[t].c();y(u,"kind","captions"),y(l,"id","upstream"),l.autoplay=g=!1,l.controls=v=Boolean(e[1]),y(a,"class","svelte-2jsuhx"),y(w,"class","svelte-2jsuhx"),y(C,"class","svelte-2jsuhx"),y(E,"class","svelte-2jsuhx")},m(t,i){f(t,n,i),f(t,o,i),f(t,r,i),e[12](r),f(t,c,i),f(t,a,i);for(let t=0;t<A.length;t+=1)A[t].m(a,null);d(a,s),d(a,l),d(l,u),e[14](l),f(t,k,i),f(t,w,i),f(t,x,i),f(t,C,i),f(t,S,i),f(t,E,i),f(t,T,i),f(t,R,i);for(let t=0;t<j.length;t+=1)j[t].m(R,null);L||(D=[b(w,"click",e[15]),b(C,"click",e[16]),b(E,"click",e[17])],L=!0)},p(t,e){if(260&e[0]){let n;for(_=t[2],n=0;n<_.length;n+=1){const i=Ie(t,_,n);A[n]?A[n].p(i,e):(A[n]=Pe(i),A[n].c(),A[n].m(a,s))}for(;n<A.length;n+=1)A[n].d(1);A.length=_.length}if(2&e[0]&&v!==(v=Boolean(t[1]))&&(l.controls=v),3594&e[0]){let n;for(O=t[3],n=0;n<O.length;n+=1){const i=Ne(t,O,n);j[n]?j[n].p(i,e):(j[n]=Be(i),j[n].c(),j[n].m(R,null))}for(;n<j.length;n+=1)j[n].d(1);j.length=O.length}},i:t,o:t,d(t){t&&m(n),t&&m(o),t&&m(r),e[12](null),t&&m(c),t&&m(a),h(A,t),e[14](null),t&&m(k),t&&m(w),t&&m(x),t&&m(C),t&&m(S),t&&m(E),t&&m(T),t&&m(R),h(j,t),L=!1,i(D)}}}function Ue(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function c(t){try{s(i.next(t))}catch(t){r(t)}}function a(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((i=i.apply(t,e||[])).next())}))};const o=R();let r,c,a,s,l,u,d,f=[],m=[];function h(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),i=t.frequencyBinCount,o=new Uint8Array(i);let r;function c(){t.getByteTimeDomainData(o),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,e.width,e.height),n.lineWidth=2,n.strokeStyle="rgb(255, 255, 255)",n.beginPath();let a=1*e.width/i,s=0;for(let t=0;t<i;t++){const i=o[t]/128*e.height/2;0===t?n.moveTo(s,i):n.lineTo(s,i),s+=a}n.lineTo(e.width,e.height/2),n.stroke(),r=requestAnimationFrame(c)}return{start(){void 0===r&&c()},stop(){cancelAnimationFrame(r),r=void 0}}}({analyser:l,canvas:a}),u.start()}function p(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),i=t.frequencyBinCount,o=new Float32Array(i);let r;const{width:c,height:a}=e;function s(){t.getFloatFrequencyData(o),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,c,a);for(var e,l=c/i*2.5,u=0,d=0;d<i;d++)e=2*(o[d]+140),n.fillStyle="rgb("+Math.floor(e+100)+",50,50)",n.fillRect(u,a-e/2,l,e/2),u+=l+1;r=requestAnimationFrame(s)}return{start(){void 0===r&&s()},stop(){cancelAnimationFrame(r),r=void 0}}}({analyser:l,canvas:a}),u.start()}function g(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),i=t.frequencyBinCount,o=new Uint8Array(i);let r;function c(){t.getByteTimeDomainData(o),n.fillStyle="rgba(0, 0, 0, 0.1)",n.fillRect(0,0,e.width,e.height),n.font="15px sans-serif",n.strokeStyle="rgb(255, 255, 255)";let a=0;n.lineWidth=5;for(let t=0;t<i;t++){const n=o[t]/128*e.height/2;n>a&&(a=n)}let s=2*(a-75),l=e.height-s;n.beginPath(),n.moveTo(0,l),n.lineTo(e.width,l),n.stroke(),n.fillStyle="rgb(100,255,100)",n.fillRect(0,e.height,e.width,-e.height+l),n.fillStyle="rgb(0,0,0)",n.fillText(String(s),e.width-40,e.height-10),r=requestAnimationFrame(c)}return{start(){void 0===r&&c()},stop(){cancelAnimationFrame(r),r=void 0}}}({analyser:l,canvas:a}),u.start()}function $(){return i(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"audioinput"===t)))}))}function v(t){return i(this,void 0,void 0,(function*(){const e=yield function(t){return i(this,void 0,void 0,(function*(){const e={audio:!t||{deviceId:t}};return yield navigator.mediaDevices.getUserMedia(e)}))}(t);e.name=function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t),b(e),n(3,m=[...m,e])}))}function b(t){n(1,c=t),n(0,r.srcObject=t,r),function(t){console.debug("disconnecting",d),null==d||d.disconnect(l),d=void 0;const e=s.createMediaStreamSource(t);e.connect(l),d=e}(t),o("stream",t)}function y(t){t.getTracks().forEach((t=>t.stop())),o("stop",t)}function k(t){y(t),n(3,m=[...m.filter((e=>e!=t))]),c===t&&n(1,c=void 0)}return T((()=>{$();const t=()=>$();return navigator.mediaDevices.addEventListener("devicechange",t),s||(s=new AudioContext,l=s.createAnalyser(),l.fftSize=2048),g(),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),[r,c,f,m,a,h,p,g,v,b,y,k,function(t){D[t?"unshift":"push"]((()=>{a=t,n(4,a)}))},t=>v(t.deviceId),function(t){D[t?"unshift":"push"]((()=>{r=t,n(0,r)}))},()=>p(),()=>h(),()=>g(),t=>b(t),t=>y(t),t=>k(t)]}const Je=class extends Z{constructor(t){super(),Y(this,t,Ue,qe,r,{},null,[-1,-1])}};function We(t){let e,n;return e=new Me({}),{c(){X(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function He(t){let e,n,i,o,r,c,a;return i=new Je({}),c=new Bt({}),{c(){e=p("section"),n=p("article"),X(i.$$.fragment),o=$(),r=p("article"),X(c.$$.fragment),y(n,"class","box"),y(r,"class","box")},m(t,s){f(t,e,s),d(e,n),K(i,n,null),d(e,o),d(e,r),K(c,r,null),a=!0},i(t){a||(z(i.$$.fragment,t),z(c.$$.fragment,t),a=!0)},o(t){V(i.$$.fragment,t),V(c.$$.fragment,t),a=!1},d(t){t&&m(e),Q(i),Q(c)}}}function ze(t){let e,n,i,o;const r=[He,We],c=[];function a(t,e){return t[0].audioVisOnly?0:1}return e=a(t),n=c[e]=r[e](t),{c(){n.c(),i=v()},m(t,n){c[e].m(t,n),f(t,i,n),o=!0},p(t,[o]){let s=e;e=a(t),e!==s&&(W(),V(c[s],1,1,(()=>{c[s]=null})),H(),n=c[e],n||(n=c[e]=r[e](t),n.c()),z(n,1),n.m(i.parentNode,i))},i(t){o||(z(n),o=!0)},o(t){V(n),o=!1},d(t){c[e].d(t),t&&m(i)}}}function Ve(t,e,n){let i;return s(t,at,(t=>n(0,i=t))),[i]}const Ge=new class extends Z{constructor(t){super(),Y(this,t,Ve,ze,r,{})}}({target:document.body,props:{}});window.app=Ge})();