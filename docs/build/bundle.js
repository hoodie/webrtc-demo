(()=>{"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t){return 0===Object.keys(t).length}function a(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function s(t,e,n){t.$$.on_destroy.push(a(e,n))}new Set;let l,u=!1;function d(t,e,n,o){for(;t<e;){const r=t+(e-t>>1);n(r)<=o?t=r+1:e=r}return t}function f(t,e){u?(function(t){if(t.hydrate_init)return;t.hydrate_init=!0;const e=t.childNodes,n=new Int32Array(e.length+1),o=new Int32Array(e.length);n[0]=-1;let r=0;for(let t=0;t<e.length;t++){const c=d(1,r+1,(t=>e[n[t]].claim_order),e[t].claim_order)-1;o[t]=n[c]+1;const i=c+1;n[i]=t,r=Math.max(i,r)}const c=[],i=[];let a=e.length-1;for(let t=n[r]+1;0!=t;t=o[t-1]){for(c.push(e[t-1]);a>=t;a--)i.push(e[a]);a--}for(;a>=0;a--)i.push(e[a]);c.reverse(),i.sort(((t,e)=>t.claim_order-e.claim_order));for(let e=0,n=0;e<i.length;e++){for(;n<c.length&&i[e].claim_order>=c[n].claim_order;)n++;const o=n<c.length?c[n]:null;t.insertBefore(i[e],o)}}(t),(void 0===t.actual_end_child||null!==t.actual_end_child&&t.actual_end_child.parentElement!==t)&&(t.actual_end_child=t.firstChild),e!==t.actual_end_child?t.insertBefore(e,t.actual_end_child):t.actual_end_child=e.nextSibling):e.parentNode!==t&&t.appendChild(e)}function m(t,e,n){u&&!n?f(t,e):(e.parentNode!==t||n&&e.nextSibling!==n)&&t.insertBefore(e,n||null)}function h(t){t.parentNode.removeChild(t)}function p(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function g(t){return document.createElement(t)}function $(t){return document.createTextNode(t)}function v(){return $(" ")}function b(){return $("")}function y(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function x(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function k(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function w(t,e){t.value=null==e?"":e}function C(t,e,n){t.classList[n?"add":"remove"](e)}function S(t){l=t}function _(){if(!l)throw new Error("Function called outside component initialization");return l}function R(t){_().$$.on_mount.push(t)}function j(){const t=_();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);o.slice().forEach((e=>{e.call(t,r)}))}}}new Set;const D=[],E=[],T=[],N=[],O=Promise.resolve();let A=!1;function M(t){T.push(t)}let L=!1;const I=new Set;function P(){if(!L){L=!0;do{for(let t=0;t<D.length;t+=1){const e=D[t];S(e),B(e.$$)}for(S(null),D.length=0;E.length;)E.pop()();for(let t=0;t<T.length;t+=1){const e=T[t];I.has(e)||(I.add(e),e())}T.length=0}while(D.length);for(;N.length;)N.pop()();A=!1,L=!1,I.clear()}}function B(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const U=new Set;let J,q;function F(){J={r:0,c:[],p:J}}function H(){J.r||o(J.c),J=J.p}function z(t,e){t&&t.i&&(U.delete(t),t.i(e))}function W(t,e,n,o){if(t&&t.o){if(U.has(t))return;U.add(t),J.c.push((()=>{U.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function V(t){t&&t.c()}function X(t,n,c,i){const{fragment:a,on_mount:s,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,c),i||M((()=>{const n=s.map(e).filter(r);l?l.push(...n):o(n),t.$$.on_mount=[]})),u.forEach(M)}function G(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function K(e,r,c,i,a,s,d=[-1]){const f=l;S(e);const m=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:r.context||[]),callbacks:n(),dirty:d,skip_bound:!1};let p=!1;if(m.ctx=c?c(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return m.ctx&&a(m.ctx[t],m.ctx[t]=r)&&(!m.skip_bound&&m.bound[t]&&m.bound[t](r),p&&function(t,e){-1===t.$$.dirty[0]&&(D.push(t),A||(A=!0,O.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],m.update(),p=!0,o(m.before_update),m.fragment=!!i&&i(m.ctx),r.target){if(r.hydrate){u=!0;const t=(g=r.target,Array.from(g.childNodes));m.fragment&&m.fragment.l(t),t.forEach(h)}else m.fragment&&m.fragment.c();r.intro&&z(e.$$.fragment),X(e,r.target,r.anchor,r.customElement),u=!1,P()}var g;S(f)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(q=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(r);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){o(this.$$.on_disconnect)}$destroy(){G(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!i(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class Q{$destroy(){G(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){this.$$set&&!i(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Y=[];function Z(e,n=t){let o;const r=[];function i(t){if(c(e,t)&&(e=t,o)){const t=!Y.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),Y.push(n,e)}if(t){for(let t=0;t<Y.length;t+=2)Y[t][0](Y[t+1]);Y.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(c,a=t){const s=[c,a];return r.push(s),1===r.length&&(o=n(i)||t),c(e),()=>{const t=r.indexOf(s);-1!==t&&r.splice(t,1),0===r.length&&(o(),o=null)}}}}function tt(e,n,c){const i=!Array.isArray(e),s=i?[e]:e,l=n.length<2;return{subscribe:Z(c,(e=>{let c=!1;const u=[];let d=0,f=t;const m=()=>{if(d)return;f();const o=n(i?u[0]:u,e);l?e(o):f=r(o)?o:t},h=s.map(((t,e)=>a(t,(t=>{u[e]=t,d&=~(1<<e),c&&m()}),(()=>{d|=1<<e}))));return c=!0,m(),function(){o(h),f()}})).subscribe}}const et=Z([]),nt=t=>{try{return!0===JSON.parse(t)}catch{return!1}},ot=Z((()=>{const t=Object.fromEntries(new URLSearchParams(location.search).entries()),e={role:t.role||"both",stream:t.stream||"both",audioVisOnly:nt(t.audioVisOnly),manual:nt(t.manual),remote:nt(t.remote),hideSignaling:nt(t.hideSignaling)};return Object.entries(e).map((([t,e])=>({key:t,value:e})))})()),rt=tt(ot,(t=>`${window.location.protocol}//${window.location.host}/?${(t=>{const e=new URLSearchParams;for(let[n,o]of t)e.set(n,o);return e.toString()})(t.map((({key:t,value:e})=>[t,e])))}`)),ct=tt(ot,(t=>{const e=Object.fromEntries(t.map((({key:t,value:e})=>[t,e])));let{role:n,stream:o,manual:r,remote:c,hideSignaling:i}=e;const a="recv"!==n,s="call"!==n&&"send"!==n||!1,l="down"!==o||!1,u="up"!==o||!1,d=r&&"no"!==r||!1,f=c&&"no"!==c||!1,m=a?"bob":"alice",h=s?"bob":"alice";return{...e,role:n,stream:o,manual:r,remote:c,hasCaller:a,hasReceiver:s,hasUpstream:l,hasDownstream:u,isManual:d,isRemote:f,hideSignaling:i,to:m,from:h}})),it=Z({});function at(t,e,n){const o=t.slice();return o[4]=e[n].key,o[5]=e[n].value,o[6]=e,o[7]=n,o}function st(t){let e,n,o;function r(){t[3].call(e,t[6],t[7])}return{c(){e=g("input"),x(e,"type","text")},m(c,i){m(c,e,i),w(e,t[5]),n||(o=y(e,"input",r),n=!0)},p(n,o){t=n,2&o&&e.value!==t[5]&&w(e,t[5])},d(t){t&&h(e),n=!1,o()}}}function lt(t){let e,n,o;function r(){t[2].call(e,t[6],t[7])}return{c(){e=g("input"),x(e,"type","checkbox")},m(c,i){m(c,e,i),e.checked=t[5],n||(o=y(e,"change",r),n=!0)},p(n,o){t=n,2&o&&(e.checked=t[5])},d(t){t&&h(e),n=!1,o()}}}function ut(t){let e,n,o,r,c,i,a=t[4]+"";function s(t,e){return"boolean"==typeof t[5]?lt:st}let l=s(t),u=l(t);return{c(){e=g("tr"),n=g("td"),o=$(a),r=v(),c=g("td"),u.c(),i=v()},m(t,a){m(t,e,a),f(e,n),f(n,o),f(e,r),f(e,c),u.m(c,null),f(e,i)},p(t,e){2&e&&a!==(a=t[4]+"")&&k(o,a),l===(l=s(t))&&u?u.p(t,e):(u.d(1),u=l(t),u&&(u.c(),u.m(c,null)))},d(t){t&&h(e),u.d()}}}function dt(e){let n,o,r,c,i,a,s,l,u,d=e[1],b=[];for(let t=0;t<d.length;t+=1)b[t]=ut(at(e,d,t));return{c(){n=g("details"),o=g("summary"),o.textContent="config",r=v(),c=g("code"),i=g("pre"),a=g("a"),s=$(e[0]),l=v(),u=g("table");for(let t=0;t<b.length;t+=1)b[t].c();x(a,"href",e[0])},m(t,e){m(t,n,e),f(n,o),f(n,r),f(n,c),f(c,i),f(i,a),f(a,s),f(n,l),f(n,u);for(let t=0;t<b.length;t+=1)b[t].m(u,null)},p(t,[e]){if(1&e&&k(s,t[0]),1&e&&x(a,"href",t[0]),2&e){let n;for(d=t[1],n=0;n<d.length;n+=1){const o=at(t,d,n);b[n]?b[n].p(o,e):(b[n]=ut(o),b[n].c(),b[n].m(u,null))}for(;n<b.length;n+=1)b[n].d(1);b.length=d.length}},i:t,o:t,d(t){t&&h(n),p(b,t)}}}function ft(t,e,n){let o,r;return s(t,rt,(t=>n(0,o=t))),s(t,ot,(t=>n(1,r=t))),[o,r,function(t,e){t[e].value=this.checked,ot.set(r)},function(t,e){t[e].value=this.value,ot.set(r)}]}const mt=class extends Q{constructor(t){super(),K(this,t,ft,dt,c,{})}},ht=Z({}),pt=Z({}),gt=Z({});function $t({from:t,offer:e}){ht.update((n=>({...n,[t]:e})))}function vt({from:t,answer:e}){pt.update((n=>({...n,[t]:e})))}function bt({from:t,candidate:e}){gt.update((n=>{const o=n[t]||[];return{...n,[t]:[...o,e]}}))}function yt({from:t}){gt.update((e=>({...e,[t]:[]})))}class xt{to;from;socket;constructor({to:t,from:e}){this.to=t,this.from=e}connect({url:t}){const e=new WebSocket(t);e.onopen=()=>{this.socket=e,this.socket.onmessage=this.received.bind(this)}}received({data:t}){const e=JSON.parse(t),{[this.to]:n,type:o}=e;console.debug("its for me!",n);const r=this.to;switch(o){case"offer":$t({from:r,offer:n});break;case"answer":vt({from:r,answer:n});break;case"candidate":bt({from:r,candidate:new RTCIceCandidate(n)})}}sendOffer(t){if(t){const e={[this.from]:t,type:"offer"};this.send(e)}}sendAnswer(t){if(t){const e={[this.from]:t,type:"answer"};this.send(e)}}sendCandidate(t){if(t){const e={[this.from]:t,type:"candidate"};this.send(e)}}send(t){if(this.socket){const e=JSON.stringify(t);this.socket.send(e)}}toString(){return`[Signaling Server calling ${this.from} → ${this.to}]`}}const kt=t=>"string"==typeof t?JSON.parse(t).sdp:"object"==typeof t?t.sdp:void 0,wt=t=>({type:"offer",sdp:t}),Ct=t=>({type:"answer",sdp:t});function St(e){let n,o,r,c,i,a,s,l,u=JSON.stringify(e[2],null,4)+"";return{c(){n=g("details"),o=g("summary"),r=$(e[1]),c=v(),i=g("pre"),a=g("code"),s=$(u),n.open=l=Boolean(e[2])&&e[0]},m(t,e){m(t,n,e),f(n,o),f(o,r),f(n,c),f(n,i),f(i,a),f(a,s)},p(t,[e]){2&e&&k(r,t[1]),4&e&&u!==(u=JSON.stringify(t[2],null,4)+"")&&k(s,u),5&e&&l!==(l=Boolean(t[2])&&t[0])&&(n.open=l)},i:t,o:t,d(t){t&&h(n)}}}function _t(t,e,n){let{open:o=!0}=e,{summary:r="???"}=e,{data:c}=e;return t.$$set=t=>{"open"in t&&n(0,o=t.open),"summary"in t&&n(1,r=t.summary),"data"in t&&n(2,c=t.data)},[o,r,c]}const Rt=class extends Q{constructor(t){super(),K(this,t,_t,St,c,{open:0,summary:1,data:2})}};function jt(t,e,n){const o=t.slice();return o[21]=e[n],o}function Dt(t,e,n){const o=t.slice();return o[24]=e[n],o[26]=n,o}function Et(t){let e,n,o,r,c,i=(t[24].label||`camera ${t[26]}`)+"";function a(){return t[14](t[24])}return{c(){e=g("button"),n=$(i),o=v(),x(e,"class","svelte-2jsuhx")},m(t,i){m(t,e,i),f(e,n),f(e,o),r||(c=y(e,"click",a),r=!0)},p(e,o){t=e,4&o&&i!==(i=(t[24].label||`camera ${t[26]}`)+"")&&k(n,i)},d(t){t&&h(e),r=!1,c()}}}function Tt(t){let e;return{c(){e=$("✔️")},m(t,n){m(t,e,n)},d(t){t&&h(e)}}}function Nt(t){let e,n,r,c,i,a,s,l,u,d,p,b,w,C,S,_=t[21].name+"",R=t[0]===t[21]&&Tt();function j(){return t[15](t[21])}function D(){return t[16](t[21])}function E(){return t[17](t[21])}return{c(){e=g("tr"),n=g("td"),R&&R.c(),r=v(),c=g("td"),i=g("button"),a=$(_),s=v(),l=g("td"),u=g("button"),u.textContent="stop",d=v(),p=g("td"),b=g("button"),b.textContent="X",w=v(),x(i,"class","svelte-2jsuhx"),x(u,"class","svelte-2jsuhx"),x(b,"class","svelte-2jsuhx")},m(t,o){m(t,e,o),f(e,n),R&&R.m(n,null),f(e,r),f(e,c),f(c,i),f(i,a),f(e,s),f(e,l),f(l,u),f(e,d),f(e,p),f(p,b),f(e,w),C||(S=[y(i,"click",j),y(u,"click",D),y(b,"click",E)],C=!0)},p(e,o){(t=e)[0]===t[21]?R||(R=Tt(),R.c(),R.m(n,null)):R&&(R.d(1),R=null),8&o&&_!==(_=t[21].name+"")&&k(a,_)},d(t){t&&h(e),R&&R.d(),C=!1,o(S)}}}function Ot(t){let e,n,o,r,c,i,a,s,l,u,d,p,b,y=t[4].readyState+"";return u=new Rt({props:{summary:"settings",data:t[4].getSettings()}}),p=new Rt({props:{summary:"constraints",data:t[4].getConstraints()}}),{c(){e=g("details"),n=g("summary"),o=$(t[5]),r=v(),c=g("dl"),i=g("dt"),i.textContent="readState",a=g("dd"),s=$(y),l=v(),V(u.$$.fragment),d=v(),V(p.$$.fragment)},m(t,h){m(t,e,h),f(e,n),f(n,o),f(e,r),f(e,c),f(c,i),f(c,a),f(a,s),f(e,l),X(u,e,null),f(e,d),X(p,e,null),b=!0},p(t,e){(!b||32&e)&&k(o,t[5]),(!b||16&e)&&y!==(y=t[4].readyState+"")&&k(s,y);const n={};16&e&&(n.data=t[4].getSettings()),u.$set(n);const r={};16&e&&(r.data=t[4].getConstraints()),p.$set(r)},i(t){b||(z(u.$$.fragment,t),z(p.$$.fragment,t),b=!0)},o(t){W(u.$$.fragment,t),W(p.$$.fragment,t),b=!1},d(t){t&&h(e),G(u),G(p)}}}function At(t){let e,n,r,c,i,a,s,l,u,d,$,k,w,C,S,_,R,j,D=t[2],E=[];for(let e=0;e<D.length;e+=1)E[e]=Et(Dt(t,D,e));let T=t[3],N=[];for(let e=0;e<T.length;e+=1)N[e]=Nt(jt(t,T,e));let O=t[4]&&Ot(t);return{c(){e=g("h5"),e.textContent="upstream",n=v(),r=g("video"),r.innerHTML='<track kind="captions"/>',c=v(),i=g("nav"),a=g("button"),a.textContent="default",s=v(),l=g("button"),l.textContent="noise",u=v(),d=g("br"),$=v();for(let t=0;t<E.length;t+=1)E[t].c();k=v(),w=g("table");for(let t=0;t<N.length;t+=1)N[t].c();C=v(),O&&O.c(),S=b(),x(r,"id","upstream"),r.autoplay="true",x(a,"class","svelte-2jsuhx"),x(l,"class","svelte-2jsuhx"),x(i,"class","svelte-2jsuhx")},m(o,h){m(o,e,h),m(o,n,h),m(o,r,h),t[11](r),m(o,c,h),m(o,i,h),f(i,a),f(i,s),f(i,l),f(i,u),f(i,d),f(i,$);for(let t=0;t<E.length;t+=1)E[t].m(i,null);m(o,k,h),m(o,w,h);for(let t=0;t<N.length;t+=1)N[t].m(w,null);m(o,C,h),O&&O.m(o,h),m(o,S,h),_=!0,R||(j=[y(a,"click",t[12]),y(l,"click",t[13])],R=!0)},p(t,[e]){if(132&e){let n;for(D=t[2],n=0;n<D.length;n+=1){const o=Dt(t,D,n);E[n]?E[n].p(o,e):(E[n]=Et(o),E[n].c(),E[n].m(i,null))}for(;n<E.length;n+=1)E[n].d(1);E.length=D.length}if(1801&e){let n;for(T=t[3],n=0;n<T.length;n+=1){const o=jt(t,T,n);N[n]?N[n].p(o,e):(N[n]=Nt(o),N[n].c(),N[n].m(w,null))}for(;n<N.length;n+=1)N[n].d(1);N.length=T.length}t[4]?O?(O.p(t,e),16&e&&z(O,1)):(O=Ot(t),O.c(),z(O,1),O.m(S.parentNode,S)):O&&(F(),W(O,1,1,(()=>{O=null})),H())},i(t){_||(z(O),_=!0)},o(t){W(O),_=!1},d(a){a&&h(e),a&&h(n),a&&h(r),t[11](null),a&&h(c),a&&h(i),p(E,a),a&&h(k),a&&h(w),p(N,a),a&&h(C),O&&O.d(a),a&&h(S),R=!1,o(j)}}}function Mt(t,e,n){let o,r;const c=j();let i,a,s=[],l=[];async function u(){const t=await function(){let t=Object.assign(document.createElement("canvas"),{width:400,height:300}),e=t.getContext("2d");e.fillRect(0,0,t.width,t.height);let n=e.getImageData(0,0,t.width,t.height);return requestAnimationFrame((function t(){for(var o=0;o<n.data.length;o++)n.data[o++]=n.data[o++]=n.data[o++]=255*Math.random();e.putImageData(n,0,0),requestAnimationFrame(t)})),t.captureStream(60)}();t.name="noise feed",f(t),n(3,l=[...l,t])}async function d(t){const e=await async function(t){const e={video:!t||{deviceId:t}};return await navigator.mediaDevices.getUserMedia(e)}(t);e.name=t?function(t){const e=t&&s.find((({deviceId:e})=>e===t));return e&&e.label}(t):"default webcam",f(e),n(3,l=[...l,e])}function f(t){n(0,a=t),n(1,i.srcObject=t,i),c("stream",t)}function m(t){t.getTracks().forEach((t=>t.stop())),c("stop",t)}function h(t){m(t),n(3,l=[...l.filter((e=>e!=t))]),a===t&&n(0,a=void 0)}async function p(){const t=await navigator.mediaDevices.enumerateDevices();n(2,s=t.filter((({kind:t})=>"videoinput"===t)))}return R((()=>{p();const t=()=>p();return navigator.mediaDevices.addEventListener("devicechange",t),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),t.$$.update=()=>{1&t.$$.dirty&&n(4,o=a&&a.getTracks()[0]),1&t.$$.dirty&&n(5,r=a&&a.constructor.name)},[a,i,s,l,o,r,u,d,f,m,h,function(t){E[t?"unshift":"push"]((()=>{i=t,n(1,i)}))},()=>d(),()=>u(),t=>d(t.deviceId),t=>f(t),t=>m(t),t=>h(t)]}const Lt=class extends Q{constructor(t){super(),K(this,t,Mt,At,c,{})}};function It(t){let e,n,o,r;return e=new Rt({props:{summary:"settings",data:t[1].getSettings()}}),o=new Rt({props:{summary:"constraints",data:t[1].getConstraints()}}),{c(){V(e.$$.fragment),n=v(),V(o.$$.fragment)},m(t,c){X(e,t,c),m(t,n,c),X(o,t,c),r=!0},p(t,n){const r={};2&n&&(r.data=t[1].getSettings()),e.$set(r);const c={};2&n&&(c.data=t[1].getConstraints()),o.$set(c)},i(t){r||(z(e.$$.fragment,t),z(o.$$.fragment,t),r=!0)},o(t){W(e.$$.fragment,t),W(o.$$.fragment,t),r=!1},d(t){G(e,t),t&&h(n),G(o,t)}}}function Pt(t){let e,n,o,r,c,i,a,s=t[1]&&It(t);return{c(){e=g("h5"),e.textContent="downstream",n=v(),o=g("video"),o.innerHTML='<track kind="captions"/>',c=v(),s&&s.c(),i=b(),o.autoplay=r=!0},m(r,l){m(r,e,l),m(r,n,l),m(r,o,l),t[3](o),m(r,c,l),s&&s.m(r,l),m(r,i,l),a=!0},p(t,[e]){t[1]?s?(s.p(t,e),2&e&&z(s,1)):(s=It(t),s.c(),z(s,1),s.m(i.parentNode,i)):s&&(F(),W(s,1,1,(()=>{s=null})),H())},i(t){a||(z(s),a=!0)},o(t){W(s),a=!1},d(r){r&&h(e),r&&h(n),r&&h(o),t[3](null),r&&h(c),s&&s.d(r),r&&h(i)}}}function Bt(t,e,n){let o,r,{stream:c}=e;return t.$$set=t=>{"stream"in t&&n(2,c=t.stream)},t.$$.update=()=>{4&t.$$.dirty&&n(1,o=c&&c.getTracks()[0]),5&t.$$.dirty&&r&&n(0,r.srcObject=c,r)},[r,o,c,function(t){E[t?"unshift":"push"]((()=>{r=t,n(0,r),n(2,c)}))}]}const Ut=class extends Q{constructor(t){super(),K(this,t,Bt,Pt,c,{stream:2})}};function Jt(e){let n,r,c,i,a,s,l;return{c(){n=g("form"),r=g("input"),c=v(),i=g("code"),a=$(e[0]),x(r,"size","90"),x(r,"placeholder","ws url")},m(t,o){var u;m(t,n,o),f(n,r),w(r,e[1]),m(t,c,o),m(t,i,o),f(i,a),s||(l=[y(r,"input",e[2]),y(n,"submit",(u=qt,function(t){return t.preventDefault(),u.call(this,t)}))],s=!0)},p(t,[e]){2&e&&r.value!==t[1]&&w(r,t[1]),1&e&&k(a,t[0])},i:t,o:t,d(t){t&&h(n),t&&h(c),t&&h(i),s=!1,o(l)}}}function qt(){}function Ft(t,e,n){let o,{signalingClient:r}=e;return t.$$set=t=>{"signalingClient"in t&&n(0,r=t.signalingClient)},t.$$.update=()=>{3&t.$$.dirty&&(r.connect({url:o}),window.client=r)},n(1,o=`wss://${window.location.host}/signaling/test`),[r,o,function(){o=this.value,n(1,o)}]}const Ht=class extends Q{constructor(t){super(),K(this,t,Ft,Jt,c,{signalingClient:0})}};function zt(t,e,n){const o=t.slice();return o[3]=e[n],o}function Wt(t){let e,n,o=t[0],r=[];for(let e=0;e<o.length;e+=1)r[e]=Vt(zt(t,o,e));const c=t=>W(r[t],1,1,(()=>{r[t]=null}));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=b()},m(t,o){for(let e=0;e<r.length;e+=1)r[e].m(t,o);m(t,e,o),n=!0},p(t,n){if(1&n){let i;for(o=t[0],i=0;i<o.length;i+=1){const c=zt(t,o,i);r[i]?(r[i].p(c,n),z(r[i],1)):(r[i]=Vt(c),r[i].c(),z(r[i],1),r[i].m(e.parentNode,e))}for(F(),i=o.length;i<r.length;i+=1)c(i);H()}},i(t){if(!n){for(let t=0;t<o.length;t+=1)z(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)W(r[t]);n=!1},d(t){p(r,t),t&&h(e)}}}function Vt(t){let e,n,o,r,c,i,a,s,l,u,d,p,b=`transceiver ${t[3].mid}`,y=t[3].mid+"";return d=new Rt({props:{summary:"details",data:t[3],open:!1}}),{c(){e=$(b),n=v(),o=g("table"),r=g("tr"),c=g("th"),c.textContent="mid",i=v(),a=g("td"),s=g("code"),l=$(y),u=v(),V(d.$$.fragment)},m(t,h){m(t,e,h),m(t,n,h),m(t,o,h),f(o,r),f(r,c),f(r,i),f(r,a),f(a,s),f(s,l),m(t,u,h),X(d,t,h),p=!0},p(t,n){(!p||1&n)&&b!==(b=`transceiver ${t[3].mid}`)&&k(e,b),(!p||1&n)&&y!==(y=t[3].mid+"")&&k(l,y);const o={};1&n&&(o.data=t[3]),d.$set(o)},i(t){p||(z(d.$$.fragment,t),p=!0)},o(t){W(d.$$.fragment,t),p=!1},d(t){t&&h(e),t&&h(n),t&&h(o),t&&h(u),G(d,t)}}}function Xt(t){let e,n,o,r,c=t[0]&&Wt(t);return{c(){e=g("h5"),e.textContent="transceivers",n=v(),c&&c.c(),o=b()},m(t,i){m(t,e,i),m(t,n,i),c&&c.m(t,i),m(t,o,i),r=!0},p(t,[e]){t[0]?c?(c.p(t,e),1&e&&z(c,1)):(c=Wt(t),c.c(),z(c,1),c.m(o.parentNode,o)):c&&(F(),W(c,1,1,(()=>{c=null})),H())},i(t){r||(z(c),r=!0)},o(t){W(c),r=!1},d(t){t&&h(e),t&&h(n),c&&c.d(t),t&&h(o)}}}function Gt(t,e,n){let o,r,{peerconnection:c}=e;return R((()=>{const t=setInterval((()=>{o&&n(0,r=o.map((({mid:t,direction:e,currentDirection:n,stopped:o,sender:r,receiver:c})=>{let i={},a={};{let{dtmf:t,track:e,transport:n}=r;i={dtmf:t,track:e,transport:n,parameters:r.getParameters&&r.getParameters()}}{let{dtmf:t,track:e,transport:n}=c;a={dtmf:t,track:e,transport:n,parameters:c.getParameters&&c.getParameters(),csrcs:c.getContributingSources(),ssrcs:c.getSynchronizationSources()}}return{mid:t,direction:e,currentDirection:n,stopped:o,sender:i,receiver:a}})))}),1e3);return()=>clearInterval(t)})),t.$$set=t=>{"peerconnection"in t&&n(1,c=t.peerconnection)},t.$$.update=()=>{2&t.$$.dirty&&(o=c&&c.getTransceivers())},[r,c]}const Kt=class extends Q{constructor(t){super(),K(this,t,Gt,Xt,c,{peerconnection:1})}};function Qt(e){let n,o;return n=new Ht({props:{signalingClient:e[23]}}),{c(){V(n.$$.fragment)},m(t,e){X(n,t,e),o=!0},p:t,i(t){o||(z(n.$$.fragment,t),o=!0)},o(t){W(n.$$.fragment,t),o=!1},d(t){G(n,t)}}}function Yt(e){let n,o,r;return o=new Lt({}),o.$on("stream",e[36]),o.$on("stop",e[37]),{c(){n=g("article"),V(o.$$.fragment),x(n,"id","upstream"),x(n,"class","box")},m(t,e){m(t,n,e),X(o,n,null),r=!0},p:t,i(t){r||(z(o.$$.fragment,t),r=!0)},o(t){W(o.$$.fragment,t),r=!1},d(t){t&&h(n),G(o)}}}function Zt(t){let e,n,o;return n=new Ut({props:{stream:void 0}}),t[38](n),{c(){e=g("article"),V(n.$$.fragment),x(e,"id","downstream"),x(e,"class","box")},m(t,r){m(t,e,r),X(n,e,null),o=!0},p(t,e){n.$set({})},i(t){o||(z(n.$$.fragment,t),o=!0)},o(t){W(n.$$.fragment,t),o=!1},d(o){o&&h(e),t[38](null),G(n)}}}function te(t){let e;return{c(){e=$("addStream")},m(t,n){m(t,e,n)},d(t){t&&h(e)}}}function ee(t){let e;return{c(){e=$("replaceTrack")},m(t,n){m(t,e,n)},d(t){t&&h(e)}}}function ne(t){let e,n,o,r,c,i,a,s=t[17].join(" ")+"";return{c(){e=g("tr"),n=g("th"),n.textContent="events:",o=v(),r=g("td"),c=g("code"),i=g("small"),a=$(s)},m(t,s){m(t,e,s),f(e,n),f(e,o),f(e,r),f(r,c),f(c,i),f(i,a)},p(t,e){131072&e[0]&&s!==(s=t[17].join(" ")+"")&&k(a,s)},d(t){t&&h(e)}}}function oe(t){let e,n,o,r,c,i,a,s,l,u=t[13]&&re(t),d=t[19]&&!t[5].isManual&&ce(t),p=t[5].isManual&&ie(t);return{c(){e=g("label"),n=$("1.\n                "),o=g("button"),o.textContent="create offer",r=v(),u&&u.c(),c=v(),d&&d.c(),i=v(),p&&p.c(),a=b()},m(h,g){m(h,e,g),f(e,n),f(e,o),m(h,r,g),u&&u.m(h,g),m(h,c,g),d&&d.m(h,g),m(h,i,g),p&&p.m(h,g),m(h,a,g),s||(l=y(o,"click",t[25]),s=!0)},p(t,e){t[13]?u?u.p(t,e):(u=re(t),u.c(),u.m(c.parentNode,c)):u&&(u.d(1),u=null),t[19]&&!t[5].isManual?d?d.p(t,e):(d=ce(t),d.c(),d.m(i.parentNode,i)):d&&(d.d(1),d=null),t[5].isManual?p?p.p(t,e):(p=ie(t),p.c(),p.m(a.parentNode,a)):p&&(p.d(1),p=null)},d(t){t&&h(e),t&&h(r),u&&u.d(t),t&&h(c),d&&d.d(t),t&&h(i),p&&p.d(t),t&&h(a),s=!1,l()}}}function re(t){let e,n,r,c,i,a,s,l,u,d,p,b;return{c(){e=g("div"),n=g("textarea"),r=v(),c=g("br"),i=v(),a=g("label"),s=$("2.\n                        "),l=g("button"),l.textContent="setLocalDescription",u=v(),d=g("button"),d.textContent="send offer",x(n,"rows","20"),x(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(o,h){m(o,e,h),f(e,n),w(n,t[13]),f(e,r),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),f(a,u),f(a,d),p||(b=[y(n,"input",t[42]),y(l,"click",t[43]),y(d,"click",t[27])],p=!0)},p(t,e){8192&e[0]&&w(n,t[13]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&h(e),p=!1,o(b)}}}function ce(t){let e,n,r,c,i,a,s,l,u,d;return{c(){e=g("div"),n=g("textarea"),r=v(),c=g("br"),i=v(),a=g("label"),s=$("5.\n                        "),l=g("button"),l.textContent="setRemoteDescription",x(n,"rows","20"),x(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(o,h){m(o,e,h),f(e,n),w(n,t[19]),f(e,r),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),u||(d=[y(n,"input",t[44]),y(l,"click",t[45])],u=!0)},p(t,e){524288&e[0]&&w(n,t[19]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&h(e),u=!1,o(d)}}}function ie(t){let e,n,r,c,i,a,s,l,u,d,p,b;return{c(){e=g("div"),n=g("strong"),n.textContent="MANUAL ANSWER HERE",r=v(),c=g("textarea"),i=v(),a=g("br"),s=v(),l=g("label"),u=$("5.\n                        "),d=g("button"),d.textContent="setRemoteDescription",x(c,"rows","20"),x(c,"class","svelte-19mjatr")},m(o,h){m(o,e,h),f(e,n),f(e,r),f(e,c),w(c,t[16]),f(e,i),f(e,a),f(e,s),f(e,l),f(l,u),f(l,d),p||(b=[y(c,"input",t[46]),y(d,"click",t[47])],p=!0)},p(t,e){65536&e[0]&&w(c,t[16])},d(t){t&&h(e),p=!1,o(b)}}}function ae(t){let e,n,o,r=t[18]&&!t[5].isManual&&se(t),c=t[5].isManual&&le(t),i=t[14]&&t[18]&&ue(t);return{c(){r&&r.c(),e=v(),c&&c.c(),n=v(),i&&i.c(),o=b()},m(t,a){r&&r.m(t,a),m(t,e,a),c&&c.m(t,a),m(t,n,a),i&&i.m(t,a),m(t,o,a)},p(t,a){t[18]&&!t[5].isManual?r?r.p(t,a):(r=se(t),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),t[5].isManual?c?c.p(t,a):(c=le(t),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null),t[14]&&t[18]?i?i.p(t,a):(i=ue(t),i.c(),i.m(o.parentNode,o)):i&&(i.d(1),i=null)},d(t){r&&r.d(t),t&&h(e),c&&c.d(t),t&&h(n),i&&i.d(t),t&&h(o)}}}function se(t){let e,n,r,c,i,a,s,l,u,d,p,b;return{c(){e=g("div"),n=g("textarea"),r=v(),c=g("br"),i=v(),a=g("label"),s=$("3.\n                        "),l=g("button"),l.textContent="setRemoteDescription",u=v(),d=g("button"),d.textContent="create answer",x(n,"rows","20"),x(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(o,h){m(o,e,h),f(e,n),w(n,t[18]),f(e,r),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),f(a,u),f(a,d),p||(b=[y(n,"input",t[48]),y(l,"click",t[49]),y(d,"click",t[26])],p=!0)},p(t,e){262144&e[0]&&w(n,t[18]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&h(e),p=!1,o(b)}}}function le(t){let e,n,r,c,i,a,s,l,u,d,p,b,k,C;return{c(){e=g("div"),n=g("strong"),n.textContent="MANUAL OFFER HERE",r=v(),c=g("textarea"),i=v(),a=g("br"),s=v(),l=g("label"),u=$("3.\n                        "),d=g("button"),d.textContent="setRemoteDescription",p=v(),b=g("button"),b.textContent="create answer",x(c,"rows","20"),x(c,"class","svelte-19mjatr")},m(o,h){m(o,e,h),f(e,n),f(e,r),f(e,c),w(c,t[15]),f(e,i),f(e,a),f(e,s),f(e,l),f(l,u),f(l,d),f(l,p),f(l,b),k||(C=[y(c,"input",t[50]),y(d,"click",t[51]),y(b,"click",t[26])],k=!0)},p(t,e){32768&e[0]&&w(c,t[15])},d(t){t&&h(e),k=!1,o(C)}}}function ue(t){let e,n,r,c,i,a,s,l,u,d,p,b;return{c(){e=g("div"),n=g("textarea"),r=v(),c=g("br"),i=v(),a=g("label"),s=$("4.\n                        "),l=g("button"),l.textContent="setLocalDescription",u=v(),d=g("button"),d.textContent="send answer",x(n,"rows","20"),x(n,"class","svelte-19mjatr"),C(n,"hideSignaling",t[22])},m(o,h){m(o,e,h),f(e,n),w(n,t[14]),f(e,r),f(e,c),f(e,i),f(e,a),f(a,s),f(a,l),f(a,u),f(a,d),p||(b=[y(n,"input",t[52]),y(l,"click",t[53]),y(d,"click",t[28])],p=!0)},p(t,e){16384&e[0]&&w(n,t[14]),4194304&e[0]&&C(n,"hideSignaling",t[22])},d(t){t&&h(e),p=!1,o(b)}}}function de(t){let e,n,o;return{c(){e=g("textarea"),x(e,"rows","10"),x(e,"class","svelte-19mjatr"),C(e,"hideSignaling",t[22])},m(r,c){m(r,e,c),w(e,t[20]),n||(o=y(e,"input",t[54]),n=!0)},p(t,n){1048576&n[0]&&w(e,t[20]),4194304&n[0]&&C(e,"hideSignaling",t[22])},d(t){t&&h(e),n=!1,o()}}}function fe(t){let e,n,o,r,c,i,a,s,l=JSON.stringify(t[21],null,4)+"";return{c(){e=g("label"),e.textContent="injected Candidates",n=v(),o=g("textarea"),r=v(),c=g("pre"),i=$(l),x(e,"for","injectedCandidates"),x(o,"name","injectedCandidates"),x(o,"rows","20"),x(o,"class","svelte-19mjatr")},m(l,u){m(l,e,u),m(l,n,u),m(l,o,u),w(o,t[4]),m(l,r,u),m(l,c,u),f(c,i),a||(s=y(o,"input",t[55]),a=!0)},p(t,e){16&e[0]&&w(o,t[4]),2097152&e[0]&&l!==(l=JSON.stringify(t[21],null,4)+"")&&k(i,l)},d(t){t&&h(e),t&&h(n),t&&h(o),t&&h(r),t&&h(c),a=!1,s()}}}function me(t){let e,n,r,c,i,a,s,l,u,d,p,b,w,C,S,_,R,j,D,E,T,N,O,A,M,L,I,P,B,U,J,q,K,Q,Y,Z,tt,et,nt,ot,rt,ct,it,at,st,lt,ut,dt,ft,mt,ht,pt,gt,$t,vt,bt,yt,xt,kt,wt,Ct,St,_t,Rt=t[5].isRemote&&Qt(t),jt=t[5].hasUpstream&&Yt(t),Dt=t[5].hasDownstream&&Zt(t);function Et(t,e){return t[8]?ee:te}let Tt=Et(t),Nt=Tt(t);D=new Kt({props:{peerconnection:t[7]}});let Ot=!t[22]&&ne(t),At=t[0]&&oe(t),Mt=t[1]&&ae(t),Lt=(t[20].length||t[5].isManual)&&de(t),It=t[5].isManual&&fe(t);return{c(){e=g("section"),n=g("h3"),r=$(t[2]),c=v(),i=g("small"),a=$("talking to "),s=$(t[3]),l=v(),Rt&&Rt.c(),u=v(),jt&&jt.c(),d=v(),Dt&&Dt.c(),p=v(),b=g("article"),w=g("h5"),w.textContent="streams",C=v(),S=g("button"),Nt.c(),R=v(),j=g("article"),V(D.$$.fragment),E=v(),T=g("article"),N=g("h5"),N.textContent="signaling",O=v(),A=g("div"),M=g("table"),L=g("tr"),I=g("th"),I.textContent="signaling:",P=v(),B=g("td"),U=g("code"),J=$(t[10]),q=v(),K=g("tr"),Q=g("th"),Q.textContent="connection:",Y=v(),Z=g("td"),tt=g("code"),et=$(t[11]),nt=v(),ot=g("tr"),rt=g("th"),rt.textContent="ice:",ct=v(),it=g("td"),at=g("code"),st=$(t[12]),lt=v(),Ot&&Ot.c(),ut=v(),dt=g("div"),ft=g("span"),mt=g("label"),ht=g("input"),pt=$("\n                    caller"),gt=v(),$t=g("label"),vt=g("input"),bt=$("\n                    receiver"),yt=v(),At&&At.c(),xt=v(),Mt&&Mt.c(),kt=v(),Lt&&Lt.c(),wt=v(),It&&It.c(),S.disabled=_=!Boolean(t[9]),x(b,"class","box"),x(j,"class","box"),x(M,"class","vertical"),x(A,"class","box"),x(ht,"type","checkbox"),x(vt,"type","checkbox"),x(dt,"class","box"),x(T,"class","box")},m(o,h){m(o,e,h),f(e,n),f(n,r),f(n,c),f(n,i),f(i,a),f(i,s),f(e,l),Rt&&Rt.m(e,null),f(e,u),jt&&jt.m(e,null),f(e,d),Dt&&Dt.m(e,null),f(e,p),f(e,b),f(b,w),f(b,C),f(b,S),Nt.m(S,null),f(e,R),f(e,j),X(D,j,null),f(e,E),f(e,T),f(T,N),f(T,O),f(T,A),f(A,M),f(M,L),f(L,I),f(L,P),f(L,B),f(B,U),f(U,J),f(M,q),f(M,K),f(K,Q),f(K,Y),f(K,Z),f(Z,tt),f(tt,et),f(M,nt),f(M,ot),f(ot,rt),f(ot,ct),f(ot,it),f(it,at),f(at,st),f(M,lt),Ot&&Ot.m(M,null),f(T,ut),f(T,dt),f(dt,ft),f(ft,mt),f(mt,ht),ht.checked=t[0],f(mt,pt),f(ft,gt),f(ft,$t),f($t,vt),vt.checked=t[1],f($t,bt),f(T,yt),At&&At.m(T,null),f(T,xt),Mt&&Mt.m(T,null),f(T,kt),Lt&&Lt.m(T,null),f(T,wt),It&&It.m(T,null),Ct=!0,St||(_t=[y(S,"click",t[39]),y(ht,"change",t[40]),y(vt,"change",t[41])],St=!0)},p(t,n){(!Ct||4&n[0])&&k(r,t[2]),(!Ct||8&n[0])&&k(s,t[3]),t[5].isRemote?Rt?(Rt.p(t,n),32&n[0]&&z(Rt,1)):(Rt=Qt(t),Rt.c(),z(Rt,1),Rt.m(e,u)):Rt&&(F(),W(Rt,1,1,(()=>{Rt=null})),H()),t[5].hasUpstream?jt?(jt.p(t,n),32&n[0]&&z(jt,1)):(jt=Yt(t),jt.c(),z(jt,1),jt.m(e,d)):jt&&(F(),W(jt,1,1,(()=>{jt=null})),H()),t[5].hasDownstream?Dt?(Dt.p(t,n),32&n[0]&&z(Dt,1)):(Dt=Zt(t),Dt.c(),z(Dt,1),Dt.m(e,p)):Dt&&(F(),W(Dt,1,1,(()=>{Dt=null})),H()),Tt!==(Tt=Et(t))&&(Nt.d(1),Nt=Tt(t),Nt&&(Nt.c(),Nt.m(S,null))),(!Ct||512&n[0]&&_!==(_=!Boolean(t[9])))&&(S.disabled=_);const o={};128&n[0]&&(o.peerconnection=t[7]),D.$set(o),(!Ct||1024&n[0])&&k(J,t[10]),(!Ct||2048&n[0])&&k(et,t[11]),(!Ct||4096&n[0])&&k(st,t[12]),t[22]?Ot&&(Ot.d(1),Ot=null):Ot?Ot.p(t,n):(Ot=ne(t),Ot.c(),Ot.m(M,null)),1&n[0]&&(ht.checked=t[0]),2&n[0]&&(vt.checked=t[1]),t[0]?At?At.p(t,n):(At=oe(t),At.c(),At.m(T,xt)):At&&(At.d(1),At=null),t[1]?Mt?Mt.p(t,n):(Mt=ae(t),Mt.c(),Mt.m(T,kt)):Mt&&(Mt.d(1),Mt=null),t[20].length||t[5].isManual?Lt?Lt.p(t,n):(Lt=de(t),Lt.c(),Lt.m(T,wt)):Lt&&(Lt.d(1),Lt=null),t[5].isManual?It?It.p(t,n):(It=fe(t),It.c(),It.m(T,null)):It&&(It.d(1),It=null)},i(t){Ct||(z(Rt),z(jt),z(Dt),z(D.$$.fragment,t),Ct=!0)},o(t){W(Rt),W(jt),W(Dt),W(D.$$.fragment,t),Ct=!1},d(t){t&&h(e),Rt&&Rt.d(),jt&&jt.d(),Dt&&Dt.d(),Nt.d(),G(D),Ot&&Ot.d(),At&&At.d(),Mt&&Mt.d(),Lt&&Lt.d(),It&&It.d(),St=!1,o(_t)}}}function he(t,e,n){let o,r,c,i,a,l,u,d,f,m,h;s(t,it,(t=>n(33,u=t))),s(t,ht,(t=>n(34,d=t))),s(t,pt,(t=>n(35,f=t))),s(t,ct,(t=>n(5,m=t))),s(t,gt,(t=>n(56,h=t)));var p=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,c){function i(t){try{s(o.next(t))}catch(t){c(t)}}function a(t){try{s(o.throw(t))}catch(t){c(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}s((o=o.apply(t,e||[])).next())}))};let{isCaller:g=!1}=e,{isReceiver:$=!1}=e,{name:v="unnamed participant"}=e,{recipient:b=null}=e;const y=new xt({from:v,to:b}),x=(t=>(e,n)=>function(t,e,n){const o={name:t,short:e,event:n};et.update((t=>[...t,o])),it.update((n=>({...n,[t]:[...n[t]||[],e]})))}(t,e,n))(v);let k,w,C,S,_="",j="",D="",T="",N="",O="",A="",M=[],L="",I="plan-b"===new URL(document.location.toString()).searchParams.get("semantic")?{sdpSemantics:"plan-b"}:{sdpSemantics:"unified-plan"};function P(t){C?(x("rt","replace track"),console.info("replace track",{sender:C}),C.replaceTrack(t.getTracks()[0])):(x("at","add track"),console.info("add track"),n(8,C=w.addTrack(t.getTracks()[0],t)))}function B(){return p(this,void 0,void 0,(function*(){x("o","create offer");const t=yield w.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!1});n(13,T=t.sdp)}))}function U(t){return p(this,void 0,void 0,(function*(){x("l","setLocalDescription"),console.debug("localDescription ->",t);const e=t;yt({from:v}),w.setLocalDescription(e),q(),yt({from:b})}))}function J(t){x("r","setRemoteDescription");const e=wt(t);w.setRemoteDescription(e),q(),yt({from:b})}function q(){m.isManual?(a||[]).forEach((t=>{t&&(x("ac","addIceCandidate"),w.addIceCandidate(t))})):(console.debug(h[b]),(h[b]||[]).forEach((t=>{t&&(x("ac","addIceCandidate"),w.addIceCandidate(t))})))}function F(t){x("r","setRemoteDescription");const e=Ct(t);w.setRemoteDescription(e),yt({from:v})}return R((()=>{n(7,w=function(){const t=new RTCPeerConnection(I);return t.ontrack=t=>{const{track:e,streams:n,transceiver:o}=t,r=n[0];k.$set({stream:r}),r.onaddtrack=()=>{x("ta","track added"),console.warn(`${v}track added to stream`,{track:e,stream:r})},"video"==e.kind&&(console.info(`${v}.ontrack`,{track:e,streams:n,kind:e.kind,transceiver:o}),e.onmute=t=>{x("tm","track muted"),console.info(`${v} track onmute`,{event:t})},e.onunmute=t=>{x("tu","track unmuted"),console.info(`${v} track onunmute`,{event:t})},e.onended=t=>{x("te","track ended"),console.debug(`${v} track onended`,{event:t})})},t.onicecandidate=({candidate:t})=>{x("lc","create candidate"),n(32,M=[...M,t]),function(t){v&&t&&(bt({from:v,candidate:t}),m.isRemote&&y.sendCandidate(t))}(t)},t.onsignalingstatechange=()=>n(10,_=t.signalingState),t.onconnectionstatechange=()=>n(11,j=t.connectionState),t.oniceconnectionstatechange=()=>n(12,D=t.iceConnectionState),console.info(`setup RTCPeerConnection for ${v}`,I,t),t}()),gt.subscribe((({[b]:t})=>{t&&x("rc")})),m.hasCaller&&B()})),t.$$set=t=>{"isCaller"in t&&n(0,g=t.isCaller),"isReceiver"in t&&n(1,$=t.isReceiver),"name"in t&&n(2,v=t.name),"recipient"in t&&n(3,b=t.recipient)},t.$$.update=()=>{4&t.$$.dirty[0]|4&t.$$.dirty[1]&&n(17,o=u[v]||[]),8&t.$$.dirty[0]|8&t.$$.dirty[1]&&n(18,r=kt(d[b])),8&t.$$.dirty[0]|16&t.$$.dirty[1]&&n(19,c=kt(f[b])),2&t.$$.dirty[1]&&n(20,i=JSON.stringify(M)),16&t.$$.dirty[0]&&n(21,a=(t=>{try{return JSON.parse(t)}catch(e){return""!==t&&console.warn({parseError:e}),[]}})(L)),32&t.$$.dirty[0]&&n(22,l=m.hideSignaling)},[g,$,v,b,L,m,k,w,C,S,_,j,D,T,N,O,A,o,r,c,i,a,l,y,P,B,function(){return p(this,void 0,void 0,(function*(){x("a","create answer");const t=yield w.createAnswer();n(14,N=t.sdp)}))},function(){const t=wt(T);$t({from:v,offer:t}),m.isRemote&&y.sendOffer(t)},function(){const t=wt(N);vt({from:v,answer:t}),m.isRemote&&y.sendAnswer(t)},U,J,F,M,u,d,f,({detail:t})=>n(9,S=t),()=>n(9,S=void 0),function(t){E[t?"unshift":"push"]((()=>{k=t,n(6,k)}))},()=>P(S),function(){g=this.checked,n(0,g)},function(){$=this.checked,n(1,$)},function(){T=this.value,n(13,T)},()=>U(wt(T)),function(){c=this.value,n(19,c),n(35,f),n(3,b)},()=>F(c),function(){A=this.value,n(16,A)},()=>F(A),function(){r=this.value,n(18,r),n(34,d),n(3,b)},()=>J(r),function(){O=this.value,n(15,O)},()=>J(O),function(){N=this.value,n(14,N)},()=>U(Ct(N)),function(){i=this.value,n(20,i),n(32,M)},function(){L=this.value,n(4,L)}]}const pe=class extends Q{constructor(t){super(),K(this,t,he,me,c,{isCaller:0,isReceiver:1,name:2,recipient:3},[-1,-1,-1])}};function ge(t,e,n){const o=t.slice();return o[1]=e[n].name,o[2]=e[n].event,o}function $e(t){let e,n,o,r,c,i,a,s,l,u=t[1]+"",d=t[2]+"";return{c(){e=g("tr"),n=g("th"),o=$(u),r=$(":"),c=v(),i=g("td"),a=g("code"),s=$(d),l=v()},m(t,u){m(t,e,u),f(e,n),f(n,o),f(n,r),f(e,c),f(e,i),f(i,a),f(a,s),f(e,l)},p(t,e){1&e&&u!==(u=t[1]+"")&&k(o,u),1&e&&d!==(d=t[2]+"")&&k(s,d)},d(t){t&&h(e)}}}function ve(e){let n,o,r,c,i,a=e[0].filter(be),s=[];for(let t=0;t<a.length;t+=1)s[t]=$e(ge(e,a,t));return{c(){n=g("section"),o=g("h3"),o.innerHTML="Event Log <small>please open\n        <code>about://webrtc-internals</code></small>",r=v(),c=g("div"),i=g("table");for(let t=0;t<s.length;t+=1)s[t].c();x(i,"class","vertical svelte-111zlyk"),x(c,"class","box")},m(t,e){m(t,n,e),f(n,o),f(n,r),f(n,c),f(c,i);for(let t=0;t<s.length;t+=1)s[t].m(i,null)},p(t,[e]){if(1&e){let n;for(a=t[0].filter(be),n=0;n<a.length;n+=1){const o=ge(t,a,n);s[n]?s[n].p(o,e):(s[n]=$e(o),s[n].c(),s[n].m(i,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=a.length}},i:t,o:t,d(t){t&&h(n),p(s,t)}}}const be=t=>t.event;function ye(t,e,n){let o;return s(t,et,(t=>n(0,o=t))),[o]}const xe=class extends Q{constructor(t){super(),K(this,t,ye,ve,c,{})}};function ke(t){let e,n;return e=new pe({props:{name:"alice",isCaller:"true",recipient:"bob"}}),{c(){V(e.$$.fragment)},m(t,o){X(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function we(t){let e,n;return e=new pe({props:{name:"bob",isReceiver:"true",recipient:"alice"}}),{c(){V(e.$$.fragment)},m(t,o){X(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function Ce(t){let e,n;return e=new xe({}),{c(){V(e.$$.fragment)},m(t,o){X(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function Se(t){let e,n,o,r,c,i,a,s,l,u,d=t[0].hasCaller&&ke(),p=t[0].hasReceiver&&we(),$=!t[0].hideSignaling&&Ce();return l=new mt({}),{c(){e=g("div"),n=g("h1"),n.textContent="WebRTC Plumber",o=v(),r=g("main"),d&&d.c(),c=v(),p&&p.c(),i=v(),$&&$.c(),a=v(),s=g("aside"),V(l.$$.fragment),x(r,"class","svelte-1mx8d2d"),x(e,"class","svelte-1mx8d2d")},m(t,h){m(t,e,h),f(e,n),f(e,o),f(e,r),d&&d.m(r,null),f(r,c),p&&p.m(r,null),f(r,i),$&&$.m(r,null),f(e,a),f(e,s),X(l,s,null),u=!0},p(t,[e]){t[0].hasCaller?d?1&e&&z(d,1):(d=ke(),d.c(),z(d,1),d.m(r,c)):d&&(F(),W(d,1,1,(()=>{d=null})),H()),t[0].hasReceiver?p?1&e&&z(p,1):(p=we(),p.c(),z(p,1),p.m(r,i)):p&&(F(),W(p,1,1,(()=>{p=null})),H()),t[0].hideSignaling?$&&(F(),W($,1,1,(()=>{$=null})),H()):$?1&e&&z($,1):($=Ce(),$.c(),z($,1),$.m(r,null))},i(t){u||(z(d),z(p),z($),z(l.$$.fragment,t),u=!0)},o(t){W(d),W(p),W($),W(l.$$.fragment,t),u=!1},d(t){t&&h(e),d&&d.d(),p&&p.d(),$&&$.d(),G(l)}}}function _e(t,e,n){let o;return s(t,ct,(t=>n(0,o=t))),[o]}const Re=class extends Q{constructor(t){super(),K(this,t,_e,Se,c,{})}};function je(t,e,n){const o=t.slice();return o[31]=e[n],o}function De(t,e,n){const o=t.slice();return o[34]=e[n],o[36]=n,o}function Ee(t){let e,n,o,r,c=(t[34].label||`micorophone ${t[36]}`)+"";function i(){return t[12](t[34])}return{c(){e=g("button"),n=$(c),x(e,"class","svelte-2jsuhx")},m(t,c){m(t,e,c),f(e,n),o||(r=y(e,"click",i),o=!0)},p(e,o){t=e,4&o[0]&&c!==(c=(t[34].label||`micorophone ${t[36]}`)+"")&&k(n,c)},d(t){t&&h(e),o=!1,r()}}}function Te(t){let e;return{c(){e=$("✔️")},m(t,n){m(t,e,n)},d(t){t&&h(e)}}}function Ne(t){let e,n,r,c,i,a,s,l,u,d,p,b,w,C,S,_=t[31].name+"",R=t[1]===t[31]&&Te();function j(){return t[16](t[31])}function D(){return t[17](t[31])}function E(){return t[18](t[31])}return{c(){e=g("tr"),n=g("td"),R&&R.c(),r=v(),c=g("td"),i=g("button"),a=$(_),s=v(),l=g("td"),u=g("button"),u.textContent="stop",d=v(),p=g("td"),b=g("button"),b.textContent="X",w=v(),x(i,"class","svelte-2jsuhx"),x(u,"class","svelte-2jsuhx"),x(b,"class","svelte-2jsuhx")},m(t,o){m(t,e,o),f(e,n),R&&R.m(n,null),f(e,r),f(e,c),f(c,i),f(i,a),f(e,s),f(e,l),f(l,u),f(e,d),f(e,p),f(p,b),f(e,w),C||(S=[y(i,"click",j),y(u,"click",D),y(b,"click",E)],C=!0)},p(e,o){(t=e)[1]===t[31]?R||(R=Te(),R.c(),R.m(n,null)):R&&(R.d(1),R=null),8&o[0]&&_!==(_=t[31].name+"")&&k(a,_)},d(t){t&&h(e),R&&R.d(),C=!1,o(S)}}}function Oe(e){let n,r,c,i,a,s,l,u,d,$,b,k,w,C,S,_,R,j,D=e[2],E=[];for(let t=0;t<D.length;t+=1)E[t]=Ee(De(e,D,t));let T=e[3],N=[];for(let t=0;t<T.length;t+=1)N[t]=Ne(je(e,T,t));return{c(){n=g("h5"),n.textContent="audio devices",r=v(),c=g("canvas"),i=v(),a=g("nav");for(let t=0;t<E.length;t+=1)E[t].c();s=v(),l=g("audio"),u=g("track"),b=v(),k=g("button"),k.textContent="waveform",w=v(),C=g("button"),C.textContent="volume",S=v(),_=g("table");for(let t=0;t<N.length;t+=1)N[t].c();x(u,"kind","captions"),x(l,"id","upstream"),l.autoplay=d=!1,l.controls=$=Boolean(e[1]),x(a,"class","svelte-2jsuhx"),x(k,"class","svelte-2jsuhx"),x(C,"class","svelte-2jsuhx")},m(t,o){m(t,n,o),m(t,r,o),m(t,c,o),e[11](c),m(t,i,o),m(t,a,o);for(let t=0;t<E.length;t+=1)E[t].m(a,null);f(a,s),f(a,l),f(l,u),e[13](l),m(t,b,o),m(t,k,o),m(t,w,o),m(t,C,o),m(t,S,o),m(t,_,o);for(let t=0;t<N.length;t+=1)N[t].m(_,null);R||(j=[y(k,"click",e[14]),y(C,"click",e[15])],R=!0)},p(t,e){if(132&e[0]){let n;for(D=t[2],n=0;n<D.length;n+=1){const o=De(t,D,n);E[n]?E[n].p(o,e):(E[n]=Ee(o),E[n].c(),E[n].m(a,s))}for(;n<E.length;n+=1)E[n].d(1);E.length=D.length}if(2&e[0]&&$!==($=Boolean(t[1]))&&(l.controls=$),1802&e[0]){let n;for(T=t[3],n=0;n<T.length;n+=1){const o=je(t,T,n);N[n]?N[n].p(o,e):(N[n]=Ne(o),N[n].c(),N[n].m(_,null))}for(;n<N.length;n+=1)N[n].d(1);N.length=T.length}},i:t,o:t,d(t){t&&h(n),t&&h(r),t&&h(c),e[11](null),t&&h(i),t&&h(a),p(E,t),e[13](null),t&&h(b),t&&h(k),t&&h(w),t&&h(C),t&&h(S),t&&h(_),p(N,t),R=!1,o(j)}}}function Ae(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,c){function i(t){try{s(o.next(t))}catch(t){c(t)}}function a(t){try{s(o.throw(t))}catch(t){c(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}s((o=o.apply(t,e||[])).next())}))};const r=j();let c,i,a,s,l,u,d,f=[],m=[];function h(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),o=t.frequencyBinCount,r=new Uint8Array(o);let c;function i(){t.getByteTimeDomainData(r),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,e.width,e.height),n.lineWidth=2,n.strokeStyle="rgb(255, 255, 255)",n.beginPath();let a=1*e.width/o,s=0;for(let t=0;t<o;t++){const o=r[t]/128*e.height/2;0===t?n.moveTo(s,o):n.lineTo(s,o),s+=a}n.lineTo(e.width,e.height/2),n.stroke(),c=requestAnimationFrame(i)}return{start(){void 0===c&&i()},stop(){cancelAnimationFrame(c),c=void 0}}}({analyser:l,canvas:a}),u.start()}function p(){u&&u.stop(),u=function({analyser:t,canvas:e}){console.log("creating renderer",{analyser:t,canvas:e});const n=e.getContext("2d"),o=t.frequencyBinCount,r=new Uint8Array(o);let c;function i(){t.getByteTimeDomainData(r),n.fillStyle="rgba(0, 0, 0, 0.1)",n.fillRect(0,0,e.width,e.height),n.font="15px sans-serif",n.strokeStyle="rgb(255, 255, 255)";let a=0;n.lineWidth=5;for(let t=0;t<o;t++){const n=r[t]/128*e.height/2;n>a&&(a=n)}let s=2*(a-75),l=e.height-s;n.beginPath(),n.moveTo(0,l),n.lineTo(e.width,l),n.stroke(),n.fillStyle="rgb(100,255,100)",n.fillRect(0,e.height,e.width,-e.height+l),n.fillStyle="rgb(0,0,0)",n.fillText(String(s),e.width-40,e.height-10),c=requestAnimationFrame(i)}return{start(){void 0===c&&i()},stop(){cancelAnimationFrame(c),c=void 0}}}({analyser:l,canvas:a}),u.start()}function g(){return o(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();n(2,f=t.filter((({kind:t})=>"audioinput"===t)))}))}function $(t){return o(this,void 0,void 0,(function*(){const e=yield function(t){return o(this,void 0,void 0,(function*(){const e={audio:!t||{deviceId:t}};return yield navigator.mediaDevices.getUserMedia(e)}))}(t);e.name=function(t){const e=t&&f.find((({deviceId:e})=>e===t));return e&&e.label}(t),v(e),n(3,m=[...m,e])}))}function v(t){n(1,i=t),n(0,c.srcObject=t,c),function(t){console.debug("disconnecting",d),null==d||d.disconnect(l),d=void 0;const e=s.createMediaStreamSource(t);e.connect(l),d=e}(t),r("stream",t)}function b(t){t.getTracks().forEach((t=>t.stop())),r("stop",t)}function y(t){b(t),n(3,m=[...m.filter((e=>e!=t))]),i===t&&n(1,i=void 0)}return R((()=>{g();const t=()=>g();return navigator.mediaDevices.addEventListener("devicechange",t),s||(s=new AudioContext,l=s.createAnalyser(),l.fftSize=2048),p(),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}})),[c,i,f,m,a,h,p,$,v,b,y,function(t){E[t?"unshift":"push"]((()=>{a=t,n(4,a)}))},t=>$(t.deviceId),function(t){E[t?"unshift":"push"]((()=>{c=t,n(0,c)}))},()=>h(),()=>p(),t=>v(t),t=>b(t),t=>y(t)]}const Me=class extends Q{constructor(t){super(),K(this,t,Ae,Oe,c,{},[-1,-1])}};function Le(t){let e,n;return e=new Re({}),{c(){V(e.$$.fragment)},m(t,o){X(e,t,o),n=!0},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){W(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function Ie(t){let e,n,o,r,c,i,a;return o=new Me({}),i=new Lt({}),{c(){e=g("section"),n=g("article"),V(o.$$.fragment),r=v(),c=g("article"),V(i.$$.fragment),x(n,"class","box"),x(c,"class","box")},m(t,s){m(t,e,s),f(e,n),X(o,n,null),f(e,r),f(e,c),X(i,c,null),a=!0},i(t){a||(z(o.$$.fragment,t),z(i.$$.fragment,t),a=!0)},o(t){W(o.$$.fragment,t),W(i.$$.fragment,t),a=!1},d(t){t&&h(e),G(o),G(i)}}}function Pe(t){let e,n,o,r;const c=[Ie,Le],i=[];function a(t,e){return t[0].audioVisOnly?0:1}return e=a(t),n=i[e]=c[e](t),{c(){n.c(),o=b()},m(t,n){i[e].m(t,n),m(t,o,n),r=!0},p(t,[r]){let s=e;e=a(t),e!==s&&(F(),W(i[s],1,1,(()=>{i[s]=null})),H(),n=i[e],n||(n=i[e]=c[e](t),n.c()),z(n,1),n.m(o.parentNode,o))},i(t){r||(z(n),r=!0)},o(t){W(n),r=!1},d(t){i[e].d(t),t&&h(o)}}}function Be(t,e,n){let o;return s(t,ct,(t=>n(0,o=t))),[o]}const Ue=new class extends Q{constructor(t){super(),K(this,t,Be,Pe,c,{})}}({target:document.body,props:{}});window.app=Ue})();